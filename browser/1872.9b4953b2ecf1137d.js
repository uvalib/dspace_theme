(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[1872],{89147:(X,$,o)=>{"use strict";o.d($,{r:()=>c});var y=o(84572),O=o(96354),e=o(25558),E=o(82777),M=o(8917),D=o(98926),A=o(1676),C=o(80183),k=o(45663),F=o(54438),u=o(7901);let c=(()=>{class b{constructor(d,g,m,_){this._window=d,this.configurationService=g,this.researcherProfileService=m,this.router=_}isLinkedToOrcid(d){return d.hasMetadata("dspace.orcid.authenticated")}onlyAdminCanDisconnectProfileFromOrcid(){return this.getOrcidDisconnectionAllowedUsersConfiguration().pipe((0,O.T)(d=>d.hasSucceeded&&d.payload.values.map(g=>g.toLowerCase()).includes("only_admin")))}ownerCanDisconnectProfileFromOrcid(){return this.getOrcidDisconnectionAllowedUsersConfiguration().pipe((0,O.T)(d=>d.hasSucceeded&&d.payload.values.map(g=>g.toLowerCase()).includes("admin_and_owner")))}linkOrcidByItem(d,g){const m=[{path:"/orcid",op:"add",value:g}];return this.researcherProfileService.findById(d.firstMetadata("dspace.object.owner").authority).pipe((0,C.qD)(),(0,e.n)(_=>this.researcherProfileService.patch(_.payload,m)))}unlinkOrcidByItem(d){const g=[{path:"/orcid",op:"remove"}];return this.researcherProfileService.findById(d.firstMetadata("dspace.object.owner").authority).pipe((0,C.qD)(),(0,e.n)(m=>this.researcherProfileService.patch(m.payload,g)))}getOrcidAuthorizeUrl(d){return(0,y.z)([this.configurationService.findByPropertyName("orcid.authorize-url").pipe((0,C.ak)()),this.configurationService.findByPropertyName("orcid.application-client-id").pipe((0,C.ak)()),this.configurationService.findByPropertyName("orcid.scope").pipe((0,C.ak)())]).pipe((0,O.T)(([g,m,_])=>{const I=new k.t(this._window.nativeWindow.origin,encodeURIComponent(this.router.url.split("?")[0]));return g.values[0]+"?client_id="+m.values[0]+"&redirect_uri="+I+"&response_type=code&scope="+_.values.join(" ")}))}getOrcidAuthorizationScopesByItem(d){return(0,E.hj)(d)?d.allMetadataValues("dspace.orcid.scope"):[]}getOrcidAuthorizationScopes(){return this.configurationService.findByPropertyName("orcid.scope").pipe((0,C.qD)(),(0,O.T)(d=>d.hasSucceeded?d.payload.values:[]))}getOrcidDisconnectionAllowedUsersConfiguration(){return this.configurationService.findByPropertyName("orcid.disconnection.allowed-users").pipe((0,C.qD)())}static{this.\u0275fac=function(g){return new(g||b)(F.KVO(A.lc),F.KVO(M.ConfigurationDataService),F.KVO(D.ResearcherProfileDataService),F.KVO(u.Ix))}}static{this.\u0275prov=F.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}}return b})()},21872:(X,$,o)=>{"use strict";o.r($),o.d($,{ROUTES:()=>Pt});var y=o(69799),O=o(49347),e=o(54438),E=o(56273),M=o(29326),D=o(70025),A=o(67045),k=o(85021),F=o(34237),u=o(60177),c=o(89417),b=o(7901),h=o(41780),d=o(84572),g=o(7673),m=o(96354),_=o(5964),I=o(25558),R=o(96697),T=o(67116),j=o(96526),z=o(42578),L=o(65007),P=o(3970),oe=o(11122),re=o(52920),f=o(80183),H=o(60456),v=o(82777),N=o(39806),B=o(90887);function ae(s,a){if(1&s&&(e.j41(0,"div",27)(1,"span"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"a",3),e.EFF(5),e.nI1(6,"translate"),e.k0s()()),2&s){const t=e.XpG();e.R7$(2),e.JRh(e.bMT(3,3,"bitstream-request-a-copy.alert.canDownload1")),e.R7$(2),e.Y8G("routerLink",t.getBitstreamLink()),e.R7$(),e.JRh(e.bMT(6,5,"bitstream-request-a-copy.alert.canDownload2"))}}function ce(s,a){if(1&s&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Lme("",e.bMT(2,2,"bitstream-request-a-copy.intro.bitstream.one")," ",t.bitstreamName,"")}}function le(s,a){1&s&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"bitstream-request-a-copy.intro.bitstream.all")))}function de(s,a){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"bitstream-request-a-copy.name.error")," "))}function ue(s,a){if(1&s&&(e.j41(0,"div",28),e.DNE(1,de,3,3,"span",4),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.name.errors&&t.name.errors.required)}}function pe(s,a){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"bitstream-request-a-copy.email.error")," "))}function me(s,a){if(1&s&&(e.j41(0,"div",28),e.DNE(1,pe,3,3,"span",4),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.email.errors)}}let he=(()=>{class s{constructor(t,n,i,r,l,p,G,Q,K,Nt,Ut){this.location=t,this.translateService=n,this.route=i,this.router=r,this.authorizationService=l,this.auth=p,this.formBuilder=G,this.itemRequestDataService=Q,this.notificationsService=K,this.dsoNameService=Nt,this.bitstreamService=Ut,this.subs=[]}ngOnInit(){this.requestCopyForm=this.formBuilder.group({name:new c.hs("",{validators:[c.k0.required]}),email:new c.hs("",{validators:[c.k0.required,c.k0.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$")]}),allfiles:new c.hs(""),message:new c.hs("")}),this.item$=this.route.data.pipe((0,m.T)(n=>n.dso),(0,f.ak)()),this.subs.push(this.item$.subscribe(n=>{this.item=n,this.itemName=this.dsoNameService.getName(n)})),this.bitstream$=this.route.queryParams.pipe((0,_.p)(n=>(0,v.a4)(n)&&(0,v.a4)(n.bitstream)),(0,I.n)(n=>this.bitstreamService.findById(n.bitstream)),(0,f.ak)()),this.subs.push(this.bitstream$.subscribe(n=>{this.bitstream=n,this.bitstreamName=this.dsoNameService.getName(n)})),this.canDownload$=this.bitstream$.pipe((0,I.n)(n=>this.authorizationService.isAuthorized(P._.CanDownload,(0,v.hj)(n)?n.self:void 0)));const t=this.bitstream$.pipe((0,I.n)(n=>this.authorizationService.isAuthorized(P._.CanRequestACopy,(0,v.hj)(n)?n.self:void 0)));this.subs.push((0,d.z)([this.canDownload$,t]).subscribe(([n,i])=>{!n&&!i&&this.router.navigateByUrl((0,y.bZ)(),{skipLocationChange:!0})})),this.initValues()}get name(){return this.requestCopyForm.get("name")}get email(){return this.requestCopyForm.get("email")}get message(){return this.requestCopyForm.get("message")}get allfiles(){return this.requestCopyForm.get("allfiles")}initValues(){this.getCurrentUser().pipe((0,R.s)(1)).subscribe(t=>{this.requestCopyForm.patchValue({allfiles:"true"}),(0,v.a4)(t)&&this.requestCopyForm.patchValue({name:t.name,email:t.email})}),this.bitstream$.pipe((0,R.s)(1)).subscribe(t=>{this.requestCopyForm.patchValue({allfiles:"false"})})}getCurrentUser(){return this.auth.isAuthenticated().pipe((0,I.n)(t=>t?this.auth.getAuthenticatedUserFromStore():(0,g.of)(void 0)))}onSubmit(){const t=new re.b;(0,v.a4)(this.bitstream)&&(t.bitstreamId=this.bitstream.uuid),t.itemId=this.item.uuid,t.allfiles=this.allfiles.value,t.requestEmail=this.email.value,t.requestName=this.name.value,t.requestMessage=this.message.value,this.itemRequestDataService.requestACopy(t).pipe((0,f.qD)()).subscribe(n=>{n.hasSucceeded?(this.notificationsService.success(this.translateService.get("bitstream-request-a-copy.submit.success")),this.navigateBack()):this.notificationsService.error(this.translateService.get("bitstream-request-a-copy.submit.error"))})}ngOnDestroy(){(0,v.a4)(this.subs)&&this.subs.forEach(t=>{(0,v.a4)(t)&&t.unsubscribe()})}navigateBack(){this.location.back()}getItemPath(){return[(0,B._o)(this.item)]}getBitstreamLink(){return[(0,y.hV)(this.bitstream)]}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(u.aZ),e.rXU(h.c$),e.rXU(b.nX),e.rXU(b.Ix),e.rXU(L.AuthorizationDataService),e.rXU(T.uR),e.rXU(c.ze),e.rXU(oe.W),e.rXU(N.I),e.rXU(j.f),e.rXU(z.BitstreamDataService))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-bitstream-request-a-copy-page"]],standalone:!0,features:[e.aNF],decls:64,vars:52,consts:[[1,"container"],[1,"mb-4"],["class","alert alert-success",4,"ngIf"],[3,"routerLink"],[4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"form-group"],[1,"row","mb-4"],[1,"col-12"],["for","name"],["type","text","id","name","formControlName","name",3,"className"],["class","invalid-feedback show-feedback",4,"ngIf"],["for","email"],["id","email","formControlName","email",3,"className"],[1,"text-muted","ds-hint"],[1,"ml-4"],["type","radio","id","allfiles-true","formControlName","allfiles","value","true",3,"className"],["for","allfiles-true",1,"form-check-label"],["type","radio","id","allfiles-false","formControlName","allfiles","value","false",3,"className"],["for","allfiles-false",1,"form-check-label"],["for","message"],["rows","5","id","message","formControlName","message",3,"className"],[1,"row"],[1,"col-12","text-right"],["role","button",1,"btn","btn-outline-secondary","mr-1",3,"click"],[1,"fas","fa-arrow-left"],[1,"btn","btn-default","btn-primary",3,"click","dsBtnDisabled"],[1,"alert","alert-success"],[1,"invalid-feedback","show-feedback"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,ae,7,7,"div",2),e.nI1(5,"async"),e.j41(6,"div")(7,"p"),e.EFF(8),e.nI1(9,"translate"),e.j41(10,"a",3),e.EFF(11),e.k0s()(),e.DNE(12,ce,3,4,"p",4)(13,le,3,3,"p",4),e.k0s(),e.j41(14,"form",5),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(15,"div",6)(16,"div",7)(17,"div",8)(18,"label",9),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.nrm(21,"input",10),e.DNE(22,ue,2,1,"div",11),e.k0s()(),e.j41(23,"div",7)(24,"div",8)(25,"label",12),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.nrm(28,"input",13),e.DNE(29,me,2,1,"div",11),e.j41(30,"small",14),e.EFF(31),e.nI1(32,"translate"),e.k0s()()(),e.j41(33,"div",7)(34,"div",8)(35,"div"),e.EFF(36),e.nI1(37,"translate"),e.k0s(),e.j41(38,"div",15),e.nrm(39,"input",16),e.j41(40,"label",17),e.EFF(41),e.nI1(42,"translate"),e.k0s()(),e.j41(43,"div",15),e.nrm(44,"input",18),e.j41(45,"label",19),e.EFF(46),e.nI1(47,"translate"),e.k0s()()()(),e.j41(48,"div",7)(49,"div",8)(50,"label",20),e.EFF(51),e.nI1(52,"translate"),e.k0s(),e.nrm(53,"textarea",21),e.k0s()()()(),e.nrm(54,"hr"),e.j41(55,"div",22)(56,"div",23)(57,"a",24),e.bIt("click",function(){return i.navigateBack()}),e.nrm(58,"i",25),e.EFF(59),e.nI1(60,"translate"),e.k0s(),e.j41(61,"button",26),e.bIt("click",function(){return i.onSubmit()}),e.EFF(62),e.nI1(63,"translate"),e.k0s()()()()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,28,"bitstream-request-a-copy.header")),e.R7$(2),e.Y8G("ngIf",e.bMT(5,30,i.canDownload$)),e.R7$(4),e.SpI("",e.bMT(9,32,"bitstream-request-a-copy.intro")," "),e.R7$(2),e.Y8G("routerLink",i.getItemPath()),e.R7$(),e.JRh(i.itemName),e.R7$(),e.Y8G("ngIf",void 0!==i.bitstream&&"false"===i.allfiles.value),e.R7$(),e.Y8G("ngIf","true"===i.allfiles.value),e.R7$(),e.HbH("ng-invalid"),e.Y8G("formGroup",i.requestCopyForm),e.R7$(5),e.JRh(e.bMT(20,34,"bitstream-request-a-copy.name.label")),e.R7$(2),e.Y8G("className",i.name.invalid&&(i.name.dirty||i.name.touched)?"form-control is-invalid":"form-control"),e.R7$(),e.Y8G("ngIf",i.name.invalid&&(i.name.dirty||i.name.touched)),e.R7$(4),e.JRh(e.bMT(27,36,"bitstream-request-a-copy.email.label")),e.R7$(2),e.Y8G("className",i.email.invalid&&(i.email.dirty||i.email.touched)?"form-control is-invalid":"form-control"),e.R7$(),e.Y8G("ngIf",i.email.invalid&&(i.email.dirty||i.email.touched)),e.R7$(2),e.JRh(e.bMT(32,38,"bitstream-request-a-copy.email.hint")),e.R7$(5),e.JRh(e.bMT(37,40,"bitstream-request-a-copy.allfiles.label")),e.R7$(3),e.Y8G("className","form-check-input"),e.R7$(2),e.JRh(e.bMT(42,42,"bitstream-request-a-copy.files-all-true.label")),e.R7$(3),e.Y8G("className","form-check-input"),e.BMQ("disabled",void 0===i.bitstream||null),e.R7$(2),e.JRh(e.bMT(47,44,"bitstream-request-a-copy.files-all-false.label")),e.R7$(5),e.JRh(e.bMT(52,46,"bitstream-request-a-copy.message.label")),e.R7$(2),e.Y8G("className","form-control"),e.R7$(6),e.SpI(" ",e.bMT(60,48,"bitstream-request-a-copy.return")," "),e.R7$(2),e.Y8G("dsBtnDisabled",i.requestCopyForm.invalid),e.R7$(),e.JRh(e.bMT(63,50,"bitstream-request-a-copy.submit")))},dependencies:[h.h,h.D9,b.Wk,u.Jj,c.X1,c.qT,c.me,c.Fm,c.BC,c.cb,c.j4,c.JD,u.bT,H.A],encapsulation:2})}}return s})();var q=o(88280),ge=o(81443),fe=o(32473),Z=o(70673),ve=o(78448),be=o(7581),ye=o(17191),_e=o(46301),Ie=o(56386),Oe=o(14412);const Se=s=>({"is-invalid":s}),Te=()=>({standalone:!0}),Ce=s=>({show:s});function Re(s,a){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"button",9,2),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.onClickSuggestion(i))}),e.nrm(3,"ds-listable-object-component-loader",10),e.k0s()()}if(2&s){const t=a.$implicit,n=e.XpG();e.R7$(3),e.Y8G("object",t)("viewMode",n.viewMode)("linkType",n.linkTypes.None)}}let Me=(()=>{class s extends Oe.t{constructor(t){super(),this.dsoNameService=t,this.viewMode=ve.n.ListElement,this.linkTypes=be.n,this.suggestions=[]}onSubmit(t){(0,v.a4)(t)&&(this.value=this.dsoNameService.getName(t),this.currentObject=t,this.submitSuggestion.emit(t))}onClickSuggestion(t){return this.value=this.dsoNameService.getName(t),this.currentObject=t,this.clickSuggestion.emit(t),this.close(),this.blockReopen=!0,this.queryInput.nativeElement.focus(),!1}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(j.f))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-dso-input-suggestions"]],inputs:{suggestions:"suggestions"},standalone:!0,features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3,e.aNF],decls:11,vars:19,consts:[["form","ngForm"],["inputField",""],["suggestion",""],[3,"ngSubmit","keydown.arrowdown","keydown.arrowup","keydown.esc","dsClickOutside","action"],["type","text","autocomplete","off",1,"form-control","suggestion_input","mb-2",3,"ngModelChange","onDebounce","ngModel","name","ngClass","dsDebounce","placeholder","ngModelOptions"],["type","submit",1,"sr-only"],[1,"autocomplete","dropdown-menu",3,"ngClass"],[1,"dropdown-list"],[4,"ngFor","ngForOf"],[1,"d-block","dropdown-item",3,"click"],[3,"object","viewMode","linkType"]],template:function(n,i){if(1&n){const r=e.RV6();e.j41(0,"form",3,0),e.bIt("ngSubmit",function(){return e.eBV(r),e.Njj(i.onSubmit(i.currentObject))})("keydown.arrowdown",function(p){return e.eBV(r),e.Njj(i.shiftFocusDown(p))})("keydown.arrowup",function(p){return e.eBV(r),e.Njj(i.shiftFocusUp(p))})("keydown.esc",function(){return e.eBV(r),e.Njj(i.close())})("dsClickOutside",function(){return e.eBV(r),e.Njj(i.close())}),e.j41(2,"input",4,1),e.mxI("ngModelChange",function(p){return e.eBV(r),e.DH7(i.value,p)||(i.value=p),e.Njj(p)}),e.bIt("onDebounce",function(p){return e.eBV(r),e.Njj(i.find(p))}),e.k0s(),e.j41(4,"button",5),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"div",6),e.nI1(8,"async"),e.j41(9,"div",7),e.DNE(10,Re,4,3,"div",8),e.k0s()()()}2&n&&(e.Y8G("action",i.action,e.B4B),e.R7$(2),e.R50("ngModel",i.value),e.Y8G("name",i.name)("ngClass",e.eq3(14,Se,!i.valid))("dsDebounce",i.debounceTime)("placeholder",i.placeholder)("ngModelOptions",e.lJ4(16,Te)),e.R7$(3),e.SpI(" ",e.bMT(6,10,"search.filters.search.submit")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(17,Ce,e.bMT(8,12,i.show)&&i.isNotEmpty(i.suggestions))),e.R7$(3),e.Y8G("ngForOf",i.suggestions))},dependencies:[c.YN,c.qT,c.me,c.BC,c.cb,c.vS,c.cV,_e.z,Ie.R,u.YU,u.pM,ye.v,u.Jj,h.h,h.D9],styles:[".autocomplete[_ngcontent-%COMP%]{width:100%}.autocomplete[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{white-space:normal;word-break:break-word;padding:var(--bs-input-padding-y) var(--bs-input-padding-x)}.autocomplete[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]:focus{outline:none}form[_ngcontent-%COMP%]{position:relative}"]})}}return s})();var ee=o(43095),Fe=o(32979),Ee=o(18226);function De(s,a){if(1&s&&(e.j41(0,"div")(1,"span",7),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&s){const t=e.XpG().ngVar,n=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,2,"item.bitstreams.upload.item")),e.R7$(3),e.JRh(n.dsoNameService.getName(t))}}function je(s,a){if(1&s&&(e.qex(0),e.DNE(1,De,6,4,"div",2),e.bVm()),2&s){const t=a.ngVar;e.R7$(),e.Y8G("ngIf",t)}}function $e(s,a){if(1&s){const t=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.createBundle())}),e.nrm(1,"i",13),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"item.bitstreams.upload.bundle.new")," "))}function Be(s,a){if(1&s){const t=e.RV6();e.j41(0,"ds-uploader",14),e.bIt("onCompleteItem",function(i){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onCompleteItem(i))})("onUploadError",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onUploadError())}),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("dropMsg","item.bitstreams.upload.drop-message")("dropOverDocumentMsg","item.bitstreams.upload.drop-message")("enableDragOverDocument",!0)("uploadFilesOptions",t.uploadFilesOptions)}}function ke(s,a){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"div",3)(2,"div",4)(3,"h1"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.DNE(6,je,2,1,"ng-container",5),e.nI1(7,"async"),e.k0s(),e.j41(8,"div",6)(9,"label",7),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"ds-dso-input-suggestions",8,0),e.nI1(14,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const r=e.XpG();return e.DH7(r.selectedBundleName,i)||(r.selectedBundleName=i),e.Njj(i)}),e.bIt("typeSuggestion",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.bundleNameChange())})("clickSuggestion",function(i){e.eBV(t);const r=e.XpG();return e.Njj(r.onClick(i))})("click",function(){e.eBV(t);const i=e.sdS(13);return e.Njj(i.open())}),e.k0s(),e.DNE(15,$e,4,3,"button",9)(16,Be,1,4,"ds-uploader",10),e.j41(17,"button",11),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onCancel())}),e.EFF(18),e.nI1(19,"translate"),e.k0s()()(),e.bVm()}if(2&s){let t;const n=e.XpG();e.R7$(4),e.JRh(e.bMT(5,12,"item.bitstreams.upload.title")),e.R7$(2),e.Y8G("ngVar",null==(t=e.bMT(7,14,n.itemRD$))?null:t.payload),e.R7$(4),e.JRh(e.bMT(11,16,"item.bitstreams.upload.bundle")),e.R7$(2),e.Y8G("suggestions",n.bundles)("placeholder",e.bMT(14,18,"item.bitstreams.upload.bundle.placeholder"))("action",n.getCurrentUrl())("name","bundle-select")("debounceTime",50),e.R50("ngModel",n.selectedBundleName),e.R7$(3),e.Y8G("ngIf",!n.selectedBundleId&&(null==n.selectedBundleName?null:n.selectedBundleName.length)>0),e.R7$(),e.Y8G("ngIf",n.selectedBundleId),e.R7$(2),e.JRh(e.bMT(19,20,"item.bitstreams.upload.cancel"))}}let Ae=(()=>{class s{constructor(t,n,i,r,l,p,G,Q,K){this.route=t,this.router=n,this.itemService=i,this.bundleService=r,this.authService=l,this.notificationsService=p,this.translate=G,this.requestService=Q,this.dsoNameService=K,this.bundles=[],this.uploadFilesOptions=Object.assign(new Fe.H,{url:"placeholder",authToken:null,disableMultipart:!1,itemAlias:null}),this.NOTIFICATIONS_PREFIX="item.bitstreams.upload.notifications.",this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.params.id,this.entityType=this.route.snapshot.params["entity-type"],this.itemRD$=this.route.data.pipe((0,m.T)(n=>n.dso));const t=this.itemService.getBundles(this.itemId).pipe((0,f.qD)(),(0,I.n)(n=>{if(n.hasSucceeded){if(n.payload.page){this.bundles=n.payload.page;for(const i of q.c.bundle.standardBundles){let r=!0;n.payload.page.forEach(l=>{i===l.name&&(r=!1)}),r&&this.bundles.push(Object.assign(new Z.N,{_name:i,type:"bundle"}))}}else this.bundles=q.c.bundle.standardBundles.map(i=>Object.assign(new Z.N,{_name:i,type:"bundle"}));return(0,g.of)(n.payload.page)}}));this.selectedBundleId=this.route.snapshot.queryParams.bundle,(0,v.hj)(this.selectedBundleId)&&(this.subs.push(this.bundleService.findById(this.selectedBundleId).pipe((0,f.ak)()).subscribe(n=>{this.selectedBundleName=n.name})),this.setUploadUrl()),this.subs.push(t.subscribe())}createBundle(){this.itemService.createBundle(this.itemId,this.selectedBundleName).pipe((0,f.ak)()).subscribe(t=>{this.selectedBundleId=t.id,this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"bundle.created.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"bundle.created.content")),this.setUploadUrl()})}bundleNameChange(){this.selectedBundleId=void 0;for(const t of this.bundles)if(this.selectedBundleName===t.name){this.selectedBundleId=t.id;break}}setUploadUrl(){this.bundleService.getBitstreamsEndpoint(this.selectedBundleId).pipe((0,R.s)(1)).subscribe(t=>{this.uploadFilesOptions.url=t,(0,v.Im)(this.uploadFilesOptions.authToken)&&(this.uploadFilesOptions.authToken=this.authService.buildAuthHeader()),this.uploaderComponent&&(this.uploaderComponent.ngOnInit(),this.uploaderComponent.ngAfterViewInit())})}onCompleteItem(t){this.bundleService.getBitstreamsEndpoint(this.selectedBundleId).pipe((0,R.s)(1)).subscribe(i=>{this.requestService.removeByHrefSubstring(i)});const n={itemId:this.itemId,entityType:this.entityType};this.router.navigate([(0,y.dF)(),t.id,"edit"],{queryParams:n})}onUploadError(){this.notificationsService.error(null,this.translate.get(this.NOTIFICATIONS_PREFIX+"upload.failed"))}onClick(t){this.selectedBundleId=t.id,this.selectedBundleName=t.name,t.id&&this.setUploadUrl()}onCancel(){this.router.navigate([(0,B.DL)(this.entityType,this.itemId),"bitstreams"])}getCurrentUrl(){return this.router.url}ngOnDestroy(){this.subs.filter(t=>(0,v.a4)(t)).forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(b.nX),e.rXU(b.Ix),e.rXU(M.ItemDataService),e.rXU(ge.BundleDataService),e.rXU(T.uR),e.rXU(N.I),e.rXU(h.c$),e.rXU(fe.B),e.rXU(j.f))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-upload-bitstream"]],viewQuery:function(n,i){if(1&n&&e.GBs(ee.y,5),2&n){let r;e.mGM(r=e.lsd())&&(i.uploaderComponent=r.first)}},standalone:!0,features:[e.aNF],decls:2,vars:1,consts:[["f",""],[1,"container"],[4,"ngIf"],[1,"row"],[1,"col-12","mb-2"],[4,"ngVar"],[1,"col-12"],[1,"font-weight-bold"],["id","search-form","ngDefaultControl","",3,"ngModelChange","typeSuggestion","clickSuggestion","click","suggestions","placeholder","action","name","debounceTime","ngModel"],["class","btn btn-success mr-2",3,"click",4,"ngIf"],["class","w-100",3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[1,"btn","btn-outline-secondary",3,"click"],[1,"btn","btn-success","mr-2",3,"click"],[1,"fa","fa-plus"],[1,"w-100",3,"onCompleteItem","onUploadError","dropMsg","dropOverDocumentMsg","enableDragOverDocument","uploadFilesOptions"]],template:function(n,i){1&n&&(e.j41(0,"div",1),e.DNE(1,ke,20,22,"ng-container",2),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",i.bundles))},dependencies:[h.h,h.D9,u.Jj,Ee.r,u.bT,Me,c.YN,c.me,c.BC,c.vS,ee.y],encapsulation:2})}}return s})();var Pe=o(10870),te=o(35925),S=o(84412),V=o(89147),Y=o(308),x=o(16292),w=o(47978),ne=o(82394),J=o(99437),Ne=o(1676),W=(o(88318),o(43404));function Ue(s,a){1&s&&e.eu8(0)}function Ge(s,a){if(1&s&&(e.j41(0,"li",19),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=a.$implicit,n=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,1,n.getAuthorizationDescription(t))," ")}}function Xe(s,a){if(1&s&&(e.j41(0,"div",16)(1,"div",8)(2,"div",9),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",10)(6,"div",17)(7,"ul"),e.DNE(8,Ge,3,3,"li",18),e.nI1(9,"async"),e.k0s()()()()()),2&s){const t=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,2,"person.page.orcid.granted-authorizations")),e.R7$(5),e.Y8G("ngForOf",e.bMT(9,4,t.getOrcidAuthorizations()))}}function ze(s,a){1&s&&(e.j41(0,"ds-alert",20),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.Y8G("type","alert-success"),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.no-missing-authorizations-message")," "))}function Le(s,a){if(1&s&&(e.j41(0,"li",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=a.$implicit,n=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,1,n.getAuthorizationDescription(t))," ")}}function xe(s,a){if(1&s&&(e.j41(0,"ds-alert",21),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"ul"),e.DNE(4,Le,3,3,"li",22),e.nI1(5,"async"),e.k0s()()),2&s){const t=e.XpG(2);e.Y8G("type","alert-warning"),e.R7$(),e.SpI(" ",e.bMT(2,3,"person.page.orcid.missing-authorizations-message")," "),e.R7$(3),e.Y8G("ngForOf",e.bMT(5,5,t.getMissingOrcidAuthorizations()))}}function Ve(s,a){1&s&&(e.j41(0,"ds-alert",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.Y8G("type","alert-warning"),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.remove-orcid-message")," "))}function Ye(s,a){1&s&&(e.j41(0,"span"),e.nrm(1,"i",30),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"person.page.orcid.unlink"),""))}function we(s,a){1&s&&(e.j41(0,"span"),e.nrm(1,"i",31),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"person.page.orcid.unlink.processing"),""))}function Je(s,a){if(1&s){const t=e.RV6();e.j41(0,"button",32),e.bIt("click",function(){e.eBV(t);const i=e.XpG(3);return e.Njj(i.linkOrcid())}),e.j41(1,"span"),e.nrm(2,"i",33),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}2&s&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"person.page.orcid.grant-authorizations"),""))}function We(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"div",26)(2,"button",27),e.nI1(3,"async"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.unlinkOrcid())}),e.DNE(4,Ye,4,3,"span",28),e.nI1(5,"async"),e.DNE(6,we,4,3,"span",28),e.nI1(7,"async"),e.k0s(),e.DNE(8,Je,5,3,"button",29),e.nI1(9,"async"),e.k0s()()}if(2&s){const t=e.XpG(2);e.R7$(2),e.Y8G("dsBtnDisabled",e.bMT(3,4,t.unlinkProcessing)),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(5,6,t.unlinkProcessing)),e.R7$(2),e.Y8G("ngIf",e.bMT(7,8,t.unlinkProcessing)),e.R7$(2),e.Y8G("ngIf",e.bMT(9,10,t.hasMissingOrcidAuthorizations()))}}function Qe(s,a){if(1&s&&(e.j41(0,"div",4)(1,"div",5),e.DNE(2,Xe,10,6,"div",6),e.nI1(3,"async"),e.j41(4,"div",7)(5,"div",8)(6,"div",9),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"div",10)(10,"div",11),e.DNE(11,ze,3,4,"ds-alert",12),e.nI1(12,"async"),e.DNE(13,xe,6,7,"ds-alert",13),e.nI1(14,"async"),e.k0s()()()()(),e.DNE(15,Ve,3,4,"ds-alert",14),e.nI1(16,"async"),e.nI1(17,"async"),e.DNE(18,We,10,12,"div",15),e.nI1(19,"async"),e.k0s()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",e.bMT(3,6,t.hasOrcidAuthorizations())),e.R7$(5),e.JRh(e.bMT(8,8,"person.page.orcid.missing-authorizations")),e.R7$(4),e.Y8G("ngIf",!0!==e.bMT(12,10,t.hasMissingOrcidAuthorizations())),e.R7$(2),e.Y8G("ngIf",e.bMT(14,12,t.hasMissingOrcidAuthorizations())),e.R7$(2),e.Y8G("ngIf",e.bMT(16,14,t.onlyAdminCanDisconnectProfileFromOrcid())&&!0!==e.bMT(17,16,t.ownerCanDisconnectProfileFromOrcid())),e.R7$(3),e.Y8G("ngIf",e.bMT(19,18,t.ownerCanDisconnectProfileFromOrcid()))}}function Ke(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",34)(1,"div",5)(2,"div",35),e.nrm(3,"img",36),e.k0s(),e.j41(4,"div",26)(5,"ds-alert",37),e.EFF(6),e.nI1(7,"async"),e.k0s()()(),e.j41(8,"div",5)(9,"div",26)(10,"button",38),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.linkOrcid())}),e.nrm(11,"i",39),e.EFF(12),e.nI1(13,"translate"),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(5),e.Y8G("type","alert-info"),e.R7$(),e.JRh(e.bMT(7,3,t.getOrcidNotLinkedMessage())),e.R7$(6),e.SpI(" ",e.bMT(13,5,"person.page.orcid.link")," ")}}let He=(()=>{class s{constructor(t,n,i,r){this.orcidAuthService=t,this.translateService=n,this.notificationsService=i,this._window=r,this.profileAuthorizationScopes=new S.t([]),this.missingAuthorizationScopes=new S.t([]),this.orcidAuthorizationScopes=new S.t([]),this.unlinkProcessing=new S.t(!1),this.isOrcidLinked$=new S.t(!1),this.onlyAdminCanDisconnectProfileFromOrcid$=new S.t(!1),this.ownerCanDisconnectProfileFromOrcid$=new S.t(!1),this.unlink=new e.bkB}ngOnInit(){this.orcidAuthService.getOrcidAuthorizationScopes().subscribe(t=>{this.orcidAuthorizationScopes.next(t),this.initOrcidAuthSettings()})}ngOnChanges(t){!t.item.isFirstChange()&&t.item.currentValue!==t.item.previousValue&&this.initOrcidAuthSettings()}hasOrcidAuthorizations(){return this.profileAuthorizationScopes.asObservable().pipe((0,m.T)(t=>t.length>0))}getOrcidAuthorizations(){return this.profileAuthorizationScopes.asObservable()}hasMissingOrcidAuthorizations(){return this.missingAuthorizationScopes.asObservable().pipe((0,m.T)(t=>t.length>0))}getMissingOrcidAuthorizations(){return this.profileAuthorizationScopes.asObservable()}isLinkedToOrcid(){return this.isOrcidLinked$.asObservable()}getOrcidNotLinkedMessage(){const t=this.item.firstMetadataValue("person.identifier.orcid");return t?this.translateService.get("person.page.orcid.orcid-not-linked-message",{orcid:t}):this.translateService.get("person.page.orcid.no-orcid-message")}getAuthorizationDescription(t){return"person.page.orcid.scope."+t.substring(1).replace("/","-")}onlyAdminCanDisconnectProfileFromOrcid(){return this.onlyAdminCanDisconnectProfileFromOrcid$.asObservable()}ownerCanDisconnectProfileFromOrcid(){return this.ownerCanDisconnectProfileFromOrcid$.asObservable()}linkOrcid(){this.orcidAuthService.getOrcidAuthorizeUrl(this.item).subscribe(t=>{this._window.nativeWindow.location.href=t})}unlinkOrcid(){this.unlinkProcessing.next(!0),this.orcidAuthService.unlinkOrcidByItem(this.item).pipe((0,f.qD)(),(0,J.W)(W.V7)).subscribe(t=>{this.unlinkProcessing.next(!1),t.hasFailed?this.notificationsService.error(this.translateService.get("person.page.orcid.unlink.error")):(this.notificationsService.success(this.translateService.get("person.page.orcid.unlink.success")),this.unlink.emit())})}initOrcidAuthSettings(){this.setOrcidAuthorizationsFromItem(),this.setMissingOrcidAuthorizations(),this.orcidAuthService.onlyAdminCanDisconnectProfileFromOrcid().subscribe(t=>{this.onlyAdminCanDisconnectProfileFromOrcid$.next(t)}),this.orcidAuthService.ownerCanDisconnectProfileFromOrcid().subscribe(t=>{this.ownerCanDisconnectProfileFromOrcid$.next(t)}),this.isOrcidLinked$.next(this.orcidAuthService.isLinkedToOrcid(this.item))}setMissingOrcidAuthorizations(){const t=this.orcidAuthService.getOrcidAuthorizationScopesByItem(this.item),i=this.orcidAuthorizationScopes.value.filter(r=>!t.includes(r));this.missingAuthorizationScopes.next(i)}setOrcidAuthorizationsFromItem(){this.profileAuthorizationScopes.next(this.orcidAuthService.getOrcidAuthorizationScopesByItem(this.item))}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(V.r),e.rXU(h.c$),e.rXU(N.I),e.rXU(Ne.lc))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-auth"]],inputs:{item:"item"},outputs:{unlink:"unlink"},standalone:!0,features:[e.OA$,e.aNF],decls:10,vars:8,consts:[["orcidLinked",""],["orcidNotLinked",""],[1,"container","mb-5"],[4,"ngIf","ngIfThen","ngIfElse"],["data-test","orcidLinked"],[1,"row"],["class","col-sm-6 mb-3","data-test","hasOrcidAuthorizations",4,"ngIf"],[1,"col-sm-6","mb-3"],[1,"card","h-100"],[1,"card-header"],[1,"card-body"],[1,"container"],["data-test","noMissingOrcidAuthorizations",3,"type",4,"ngIf"],["data-test","missingOrcidAuthorizations",3,"type",4,"ngIf"],["data-test","unlinkOnlyAdmin",3,"type",4,"ngIf"],["class","row","data-test","unlinkOwner",4,"ngIf"],["data-test","hasOrcidAuthorizations",1,"col-sm-6","mb-3"],[1,"container","p-0"],["data-test","orcidAuthorization",4,"ngFor","ngForOf"],["data-test","orcidAuthorization"],["data-test","noMissingOrcidAuthorizations",3,"type"],["data-test","missingOrcidAuthorizations",3,"type"],["data-test","missingOrcidAuthorization",4,"ngFor","ngForOf"],["data-test","missingOrcidAuthorization"],["data-test","unlinkOnlyAdmin",3,"type"],["data-test","unlinkOwner",1,"row"],[1,"col"],["type","submit",1,"btn","btn-danger","float-right",3,"click","dsBtnDisabled"],[4,"ngIf"],["type","submit","class","btn btn-primary float-right",3,"click",4,"ngIf"],[1,"fas","fa-unlink"],[1,"fas","fa-circle-notch","fa-spin"],["type","submit",1,"btn","btn-primary","float-right",3,"click"],[1,"fas","fa-check"],["data-test","orcidNotLinked"],[1,"col-2"],["alt","orcid-logo","src","../../../../assets/images/orcid.logo.icon.svg"],[3,"type"],[1,"btn","btn-primary","float-right",3,"click"],[1,"fas","fa-link"]],template:function(n,i){if(1&n&&(e.j41(0,"div",2)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Ue,1,0,"ng-container",3),e.nI1(5,"async"),e.k0s(),e.DNE(6,Qe,20,20,"ng-template",null,0,e.C5r)(8,Ke,14,7,"ng-template",null,1,e.C5r)),2&n){const r=e.sdS(7),l=e.sdS(9);e.R7$(2),e.JRh(e.bMT(3,4,"person.orcid.registry.auth")),e.R7$(2),e.Y8G("ngIf",e.bMT(5,6,i.isLinkedToOrcid()))("ngIfThen",r)("ngIfElse",l)}},dependencies:[h.h,h.D9,u.Jj,u.bT,u.Sq,x.C,H.A]})}}return s})();var ie=o(52149),qe=o(70152),Ze=o(23294),et=o(88141),tt=o(52326),nt=o(53067),it=o(22978),st=o(5682),ot=o(23401);function rt(s,a){1&s&&e.nrm(0,"ds-loading")}function at(s,a){if(1&s&&(e.j41(0,"ds-alert",4),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG();e.Y8G("type",t.AlertTypeEnum.Info),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.sync-queue.empty-message")," ")}}function ct(s,a){if(1&s){const t=e.RV6();e.j41(0,"tr",10)(1,"td",11),e.nrm(2,"i",12),e.nI1(3,"translate"),e.k0s(),e.j41(4,"td",8),e.EFF(5),e.k0s(),e.j41(6,"td",13)(7,"div",14)(8,"button",15),e.nI1(9,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.send(i))}),e.nrm(10,"span",16),e.j41(11,"span",17),e.EFF(12),e.nI1(13,"translate"),e.k0s()(),e.j41(14,"button",18),e.nI1(15,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.discardEntry(i))}),e.nrm(16,"span",19),e.j41(17,"span",17),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()()()}if(2&s){const t=a.$implicit,n=e.XpG(2);e.R7$(2),e.Y8G("ngClass",n.getIconClass(t))("ngbTooltip",e.bMT(3,8,n.getIconTooltip(t))),e.R7$(3),e.SpI(" ",t.description," "),e.R7$(3),e.Y8G("ngbTooltip",e.bMT(9,10,n.getOperationTooltip(t))),e.R7$(2),e.Y8G("ngClass",n.getOperationClass(t)),e.R7$(2),e.JRh(e.bMT(13,12,n.getOperationTooltip(t))),e.R7$(2),e.Y8G("ngbTooltip",e.bMT(15,14,"person.page.orcid.sync-queue.discard")),e.R7$(4),e.JRh(e.bMT(19,16,"person.page.orcid.sync-queue.discard"))}}function lt(s,a){if(1&s){const t=e.RV6();e.j41(0,"ds-pagination",5),e.nI1(1,"async"),e.bIt("paginationChange",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.updateList())}),e.j41(2,"div",6)(3,"table",7)(4,"thead")(5,"tr",8)(6,"th"),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th"),e.EFF(13),e.nI1(14,"translate"),e.k0s()()(),e.j41(15,"tbody"),e.DNE(16,ct,20,18,"tr",9),e.nI1(17,"async"),e.k0s()()()()}if(2&s){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.paginationOptions)("collectionSize",null==(t=e.bMT(1,8,i.getList()))||null==t.payload?null:t.payload.totalElements)("retainScrollPosition",!1)("hideGear",!0),e.R7$(7),e.JRh(e.bMT(8,10,"person.page.orcid.sync-queue.table.header.type")),e.R7$(3),e.JRh(e.bMT(11,12,"person.page.orcid.sync-queue.table.header.description")),e.R7$(3),e.JRh(e.bMT(14,14,"person.page.orcid.sync-queue.table.header.action")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(17,16,i.getList()))||null==n.payload?null:n.payload.page)}}let dt=(()=>{class s{constructor(t,n,i,r,l,p){this.orcidAuthService=t,this.orcidQueueService=n,this.translateService=i,this.paginationService=r,this.notificationsService=l,this.orcidHistoryService=p,this.paginationOptions=Object.assign(new ot.W,{id:"oqp",pageSize:5}),this.processing$=new S.t(!1),this.list$=new S.t({}),this.AlertTypeEnum=w.v,this.subs=[]}ngOnInit(){this.updateList()}ngOnChanges(t){!t.item.isFirstChange()&&t.item.currentValue!==t.item.previousValue&&this.updateList()}updateList(){this.subs.push(this.paginationService.getCurrentPagination(this.paginationOptions.id,this.paginationOptions).pipe((0,qe.B)(100),(0,Ze.F)(),(0,et.M)(()=>this.processing$.next(!0)),(0,I.n)(t=>this.orcidQueueService.searchByProfileItemId(this.item.id,t,!1)),(0,f.qD)()).subscribe(t=>{this.processing$.next(!1),this.list$.next(t),this.orcidQueueService.clearFindByProfileItemRequests()}))}getList(){return this.list$.asObservable()}getIconClass(t){if(!t.recordType)return"fa fa-user";switch(t.recordType.toLowerCase()){case"publication":return"fas fa-book";case"project":return"fas fa-wallet";case"education":return"fas fa-school";case"affiliation":return"fas fa-university";case"country":return"fas fa-globe-europe";case"external_ids":case"researcher_urls":return"fas fa-external-link-alt";default:return"fa fa-user"}}getIconTooltip(t){return t.recordType?"person.page.orcid.sync-queue.tooltip."+t.recordType.toLowerCase():""}getOperationTooltip(t){return t.operation?"person.page.orcid.sync-queue.tooltip."+t.operation.toLowerCase():""}getOperationClass(t){if(!t.operation)return"";switch(t.operation.toLowerCase()){case"insert":return"fas fa-plus";case"update":return"fas fa-edit";case"delete":return"fas fa-trash-alt";default:return""}}discardEntry(t){this.processing$.next(!0),this.subs.push(this.orcidQueueService.deleteById(t.id).pipe((0,f.qD)()).subscribe(n=>{this.processing$.next(!1),n.isSuccess?(this.notificationsService.success(this.translateService.get("person.page.orcid.sync-queue.discard.success")),this.updateList()):this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.discard.error"))}))}send(t){this.processing$.next(!0),this.subs.push(this.orcidHistoryService.sendToORCID(t).pipe((0,f.qD)()).subscribe(n=>{this.processing$.next(!1),n.isSuccess?this.handleOrcidHistoryRecordCreation(n.payload):422===n.statusCode?this.handleValidationErrors(n):this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.error"))}))}getUnauthorizedErrorContent(){return this.orcidAuthService.getOrcidAuthorizeUrl(this.item).pipe((0,I.n)(t=>this.translateService.get("person.page.orcid.sync-queue.send.unauthorized-error.content",{orcid:t})))}handleOrcidHistoryRecordCreation(t){switch(t.status){case 200:case 201:case 204:this.notificationsService.success(this.translateService.get("person.page.orcid.sync-queue.send.success")),this.updateList();break;case 400:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.bad-request-error"),null,{timeOut:0});break;case 401:(0,d.z)([this.translateService.get("person.page.orcid.sync-queue.send.unauthorized-error.title"),this.getUnauthorizedErrorContent()]).subscribe(([n,i])=>{this.notificationsService.error(n,i,{timeOut:0},!0)});break;case 404:this.notificationsService.warning(this.translateService.get("person.page.orcid.sync-queue.send.not-found-warning"));break;case 409:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.conflict-error"),null,{timeOut:0});break;default:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.error"),null,{timeOut:0})}}handleValidationErrors(t){const n=[this.translateService.get("person.page.orcid.sync-queue.send.validation-error")],i=t.errorMessage;i&&i.indexOf("Error codes:")>0&&i.substring(i.indexOf(":")+1).trim().split(",").forEach(r=>n.push(this.translateService.get("person.page.orcid.sync-queue.send.validation-error."+r))),(0,d.z)(n).subscribe(r=>{const l=r.shift(),p="<ul>"+r.map(G=>`<li>${G}</li>`).join("")+"</ul>";this.notificationsService.error(l,p,{timeOut:0},!0)})}ngOnDestroy(){this.list$=null,this.subs.filter(t=>(0,v.a4)(t)).forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(V.r),e.rXU(nt.OrcidQueueDataService),e.rXU(h.c$),e.rXU(it.m),e.rXU(N.I),e.rXU(tt.OrcidHistoryDataService))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-queue"]],inputs:{item:"item"},standalone:!0,features:[e.OA$,e.aNF],decls:13,vars:16,consts:[[4,"ngIf"],[1,"container"],[3,"type",4,"ngIf"],[3,"paginationOptions","collectionSize","retainScrollPosition","hideGear","paginationChange",4,"ngIf"],[3,"type"],[3,"paginationChange","paginationOptions","collectionSize","retainScrollPosition","hideGear"],[1,"table-responsive"],["id","groups",1,"table","table-sm","table-striped","table-hover","table-bordered"],[1,"text-center","align-middle"],["data-test","orcidQueueElementRow",4,"ngFor","ngForOf"],["data-test","orcidQueueElementRow"],[1,"text-center","align-middle",2,"width","15%"],["aria-hidden","true",1,"fa-2x",3,"ngClass","ngbTooltip"],[1,"text-center",2,"width","20%"],[1,"btn-group","edit-field"],["container","body",1,"btn","btn-outline-primary","my-1","col-md",3,"click","ngbTooltip"],[3,"ngClass"],[1,"sr-only"],["container","body",1,"btn","btn-outline-danger","my-1","col-md",3,"click","ngbTooltip"],[1,"fas","fa-unlink"]],template:function(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,rt,1,0,"ds-loading",0),e.nI1(2,"async"),e.j41(3,"div",1)(4,"h2"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,at,3,4,"ds-alert",2),e.nI1(8,"async"),e.nI1(9,"async"),e.DNE(10,lt,18,18,"ds-pagination",3),e.nI1(11,"async"),e.nI1(12,"async"),e.k0s()()),2&n){let r,l;e.R7$(),e.Y8G("ngIf",e.bMT(2,4,i.processing$)),e.R7$(4),e.JRh(e.bMT(6,6,"person.orcid.registry.queue")),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(8,8,i.processing$)&&0===(null==(r=e.bMT(9,10,i.getList()))||null==r.payload?null:r.payload.totalElements)),e.R7$(3),e.Y8G("ngIf",!0!==e.bMT(11,12,i.processing$)&&(null==(l=e.bMT(12,14,i.getList()))||null==l.payload?null:l.payload.totalElements)>0)}},dependencies:[u.MD,u.YU,u.Sq,u.bT,u.Jj,ie.n8,ie.md,h.h,h.D9,ne.v,x.C,st.e]})}}return s})();var U=o(56977),ut=o(98926);function pt(s,a){if(1&s&&(e.j41(0,"option",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(e.bMT(2,2,t.label))}}function mt(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"input",26),e.mxI("ngModelChange",function(i){e.eBV(t);const r=e.XpG();return e.DH7(r.currentSyncPublications,i)||(r.currentSyncPublications=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=a.$implicit,n=e.XpG();e.R7$(),e.Mz_("id","publicationOption_",t.value,""),e.R50("ngModel",n.currentSyncPublications),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","publicationOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,7,t.label))}}function ht(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"input",28),e.mxI("ngModelChange",function(i){e.eBV(t);const r=e.XpG();return e.DH7(r.currentSyncFunding,i)||(r.currentSyncFunding=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=a.$implicit,n=e.XpG();e.R7$(),e.Mz_("id","fundingOption_",t.value,""),e.R50("ngModel",n.currentSyncFunding),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","fundingOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,7,t.label))}}function gt(s,a){if(1&s){const t=e.RV6();e.j41(0,"div",25)(1,"input",29),e.mxI("ngModelChange",function(i){const r=e.eBV(t).$implicit;return e.DH7(r.checked,i)||(r.checked=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=a.$implicit;e.R7$(),e.Mz_("name","syncProfile_",t.value,""),e.Mz_("id","profileOption_",t.value,""),e.R50("ngModel",t.checked),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","profileOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,9,t.label))}}let ft=(()=>{class s{#e;#t;#n;constructor(t,n,i){this.researcherProfileService=t,this.notificationsService=n,this.translateService=i,this.AlertType=w.v,this.messagePrefix="person.page.orcid",this.settingsUpdated=new e.bkB,this.#e=new e.bkB,this.#t=new S.t(null)}set item(t){this.#t.next(t)}ngOnDestroy(){this.#e.next()}ngOnInit(){this.syncModes=[{label:this.messagePrefix+".synchronization-mode.batch",value:"BATCH"},{label:this.messagePrefix+".synchronization-mode.manual",value:"MANUAL"}],this.syncPublicationOptions=["DISABLED","ALL"].map(t=>({label:this.messagePrefix+".sync-publications."+t.toLowerCase(),value:t})),this.syncFundingOptions=["DISABLED","ALL"].map(t=>({label:this.messagePrefix+".sync-fundings."+t.toLowerCase(),value:t})),this.updateSyncProfileOptions(this.#t.asObservable()),this.updateSyncPreferences(this.#t.asObservable()),this.#n=this.#t.pipe((0,I.n)(t=>this.researcherProfileService.findByRelatedItem(t).pipe((0,f.qD)(),(0,J.W)(W.V7),(0,f.Bo)())),(0,U.Q)(this.#e))}onSubmit(t){const n=[];this.fillOperationsFor(n,"/orcid/mode",t.value.syncMode),this.fillOperationsFor(n,"/orcid/publications",t.value.syncPublications),this.fillOperationsFor(n,"/orcid/fundings",t.value.syncFundings);const i=this.syncProfileOptions.map(r=>r.value).filter(r=>t.value["syncProfile_"+r]).join(",");this.fillOperationsFor(n,"/orcid/profile",i),0!==n.length&&this.#n.pipe((0,I.n)(r=>this.researcherProfileService.patch(r,n)),(0,f.qD)(),(0,J.W)(W.V7),(0,R.s)(1)).subscribe(r=>{r.hasFailed?this.notificationsService.error(this.translateService.get(this.messagePrefix+".synchronization-settings-update.error")):(this.notificationsService.success(this.translateService.get(this.messagePrefix+".synchronization-settings-update.success")),this.settingsUpdated.emit())})}updateSyncPreferences(t){t.pipe((0,_.p)(v.a4),(0,m.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-mode",["BATCH","MANUAL"],"MANUAL")),(0,U.Q)(this.#e)).subscribe(n=>this.currentSyncMode=n),t.pipe((0,_.p)(v.a4),(0,m.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-publications",["DISABLED","ALL"],"DISABLED")),(0,U.Q)(this.#e)).subscribe(n=>this.currentSyncPublications=n),t.pipe((0,_.p)(v.a4),(0,m.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-fundings",["DISABLED","ALL"],"DISABLED")),(0,U.Q)(this.#e)).subscribe(n=>this.currentSyncFunding=n)}updateSyncProfileOptions(t){t.pipe((0,_.p)(v.a4),(0,m.T)(n=>n.allMetadataValues("dspace.orcid.sync-profile")),(0,m.T)(n=>["BIOGRAPHICAL","IDENTIFIERS"].map(i=>({label:this.messagePrefix+".sync-profile."+i.toLowerCase(),value:i,checked:n.includes(i)}))),(0,U.Q)(this.#e)).subscribe(n=>this.syncProfileOptions=n)}getCurrentPreference(t,n,i,r){const l=t.firstMetadataValue(n);return l&&i.includes(l)?l:r}fillOperationsFor(t,n,i){t.push({path:n,op:"replace",value:i})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(ut.ResearcherProfileDataService),e.rXU(N.I),e.rXU(h.c$))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-sync-setting"]],inputs:{item:"item"},outputs:{settingsUpdated:"settingsUpdated"},standalone:!0,features:[e.aNF],decls:70,vars:42,consts:[["f","ngForm"],[1,"container","mb-5"],[3,"ngSubmit"],[1,"row","mb-3"],[1,"col-md"],["data-test","sync-mode",1,"card"],[1,"card-header"],[1,"card-body"],[1,"container"],[1,"row"],[3,"type"],[1,"form-group","row"],["for","syncMode"],["name","syncMode","id","syncMode","required","",1,"form-control",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md","mb-3"],["data-test","sync-mode-publication",1,"card","h-100"],[1,"form-group"],["class","row form-check",4,"ngFor","ngForOf"],["data-test","sync-mode-funding",1,"card","h-100"],["data-test","profile-preferences",1,"card","h-100"],[1,"col"],["type","submit",1,"btn","btn-primary","float-right"],[1,"fas","fa-edit"],[3,"value"],[1,"row","form-check"],["type","radio","name","syncPublications","required","",3,"ngModelChange","ngModel","id","value"],[1,"ml-2",3,"for"],["type","radio","name","syncFundings","required","",3,"ngModelChange","ngModel","id","value"],["type","checkbox",3,"ngModelChange","ngModel","name","id","value"]],template:function(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",1)(1,"h2"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"form",2,0),e.bIt("ngSubmit",function(){e.eBV(r);const p=e.sdS(5);return e.Njj(i.onSubmit(p.form))}),e.j41(6,"div",3)(7,"div",4)(8,"div",5)(9,"div",6),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"div",7)(13,"div",8)(14,"div",9)(15,"ds-alert",10),e.EFF(16),e.nI1(17,"translate"),e.k0s()(),e.j41(18,"div",11)(19,"label",12),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"select",13),e.mxI("ngModelChange",function(p){return e.eBV(r),e.DH7(i.currentSyncMode,p)||(i.currentSyncMode=p),e.Njj(p)}),e.DNE(23,pt,3,4,"option",14),e.k0s()()()()()()(),e.j41(24,"div",9)(25,"div",15)(26,"div",16)(27,"div",6),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"div",7)(31,"div",8)(32,"div",9)(33,"ds-alert",10),e.EFF(34),e.nI1(35,"translate"),e.k0s()(),e.j41(36,"div",17),e.DNE(37,mt,5,9,"div",18),e.k0s()()()()(),e.j41(38,"div",15)(39,"div",19)(40,"div",6),e.EFF(41),e.nI1(42,"translate"),e.k0s(),e.j41(43,"div",7)(44,"div",8)(45,"div",9)(46,"ds-alert",10),e.EFF(47),e.nI1(48,"translate"),e.k0s()(),e.j41(49,"div",17),e.DNE(50,ht,5,9,"div",18),e.k0s()()()()(),e.j41(51,"div",15)(52,"div",20)(53,"div",6),e.EFF(54),e.nI1(55,"translate"),e.k0s(),e.j41(56,"div",7)(57,"div",8)(58,"div",9)(59,"ds-alert",10),e.EFF(60),e.nI1(61,"translate"),e.k0s()(),e.j41(62,"div",17),e.DNE(63,gt,5,11,"div",18),e.k0s()()()()()(),e.j41(64,"div",9)(65,"div",21)(66,"button",22),e.nrm(67,"i",23),e.EFF(68),e.nI1(69,"translate"),e.k0s()()()()()}2&n&&(e.R7$(2),e.JRh(e.bMT(3,20,"person.orcid.sync.setting")),e.R7$(8),e.JRh(e.bMT(11,22,"person.page.orcid.synchronization-mode")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(17,24,"person.page.orcid.synchronization-mode-message")," "),e.R7$(4),e.JRh(e.bMT(21,26,"person.page.orcid.synchronization-mode.label")),e.R7$(2),e.R50("ngModel",i.currentSyncMode),e.R7$(),e.Y8G("ngForOf",i.syncModes),e.R7$(5),e.JRh(e.bMT(29,28,"person.page.orcid.publications-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(35,30,"person.page.orcid.synchronization-mode-publication-message")," "),e.R7$(3),e.Y8G("ngForOf",i.syncPublicationOptions),e.R7$(4),e.JRh(e.bMT(42,32,"person.page.orcid.funding-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(48,34,"person.page.orcid.synchronization-mode-funding-message")," "),e.R7$(3),e.Y8G("ngForOf",i.syncFundingOptions),e.R7$(4),e.JRh(e.bMT(55,36,"person.page.orcid.profile-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(61,38,"person.page.orcid.synchronization-mode-profile-message")," "),e.R7$(3),e.Y8G("ngForOf",i.syncProfileOptions),e.R7$(5),e.SpI(" ",e.bMT(69,40,"person.page.orcid.save.preference.changes")," "))},dependencies:[x.C,c.YN,c.qT,c.xH,c.y7,c.me,c.Zm,c.wz,c.Fm,c.BC,c.cb,c.YS,c.vS,c.cV,h.h,h.D9,u.Sq]})}}return s})();function vt(s,a){1&s&&(e.nrm(0,"ds-loading",4),e.nI1(1,"translate")),2&s&&e.Y8G("message",e.bMT(1,1,"person.page.orcid.link.processing"))}function bt(s,a){if(1&s&&(e.j41(0,"div",5)(1,"ds-alert",6),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s){const t=e.XpG();e.R7$(),e.Y8G("type",t.AlertType.Error),e.R7$(),e.JRh(e.bMT(3,2,"person.page.orcid.link.error.message"))}}function yt(s,a){if(1&s){const t=e.RV6();e.j41(0,"ds-orcid-sync-setting",10),e.nI1(1,"async"),e.bIt("settingsUpdated",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.updateItem())}),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("item",e.bMT(1,1,t.item))}}function _t(s,a){if(1&s&&(e.nrm(0,"ds-orcid-queue",11),e.nI1(1,"async")),2&s){const t=e.XpG(2);e.Y8G("item",e.bMT(1,1,t.item))}}function It(s,a){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"ds-orcid-auth",7),e.nI1(2,"async"),e.bIt("unlink",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.updateItem())}),e.k0s(),e.DNE(3,yt,2,3,"ds-orcid-sync-setting",8)(4,_t,2,3,"ds-orcid-queue",9),e.bVm()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("item",e.bMT(2,3,t.item)),e.R7$(2),e.Y8G("ngIf",t.isLinkedToOrcid()),e.R7$(),e.Y8G("ngIf",t.isLinkedToOrcid())}}function Ot(s,a){if(1&s&&(e.j41(0,"div",12)(1,"div",13)(2,"div",14)(3,"a",15),e.nrm(4,"i",16),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()()),2&s){const t=e.XpG();e.R7$(3),e.Y8G("routerLink",t.getItemPage()),e.R7$(2),e.SpI(" ",e.bMT(6,2,"item.orcid.return")," ")}}let St=(()=>{class s{constructor(t,n,i,r,l,p){this.platformId=t,this.authService=n,this.itemService=i,this.orcidAuthService=r,this.route=l,this.router=p,this.AlertType=w.v,this.connectionStatus=new S.t(!1),this.item=new S.t(null),this.processingConnection=new S.t(!0)}ngOnInit(){if((0,u.UE)(this.platformId)){const t=this.route.queryParamMap.pipe((0,R.s)(1),(0,m.T)(i=>i.get("code"))),n=this.route.data.pipe((0,m.T)(i=>i.dso),(0,Y.QD)(this.router,this.authService),(0,f.ak)());(0,d.z)([t,n]).subscribe(([i,r])=>{this.itemId=r.id,(0,v.hj)(i)?this.linkProfileToOrcid(r,i):(this.item.next(r),this.processingConnection.next(!1),this.connectionStatus.next(!0))})}}isLinkedToOrcid(){return this.orcidAuthService.isLinkedToOrcid(this.item.value)}getItemPage(){return(0,B._o)(this.item.value)}updateItem(){this.clearRouteParams(),this.itemService.findById(this.itemId,!1).pipe((0,f.qD)()).subscribe(t=>{t.hasSucceeded&&this.item.next(t.payload)})}linkProfileToOrcid(t,n){this.orcidAuthService.linkOrcidByItem(t,n).pipe((0,f.qD)()).subscribe(i=>{this.processingConnection.next(!1),i.hasSucceeded?(this.connectionStatus.next(!0),this.updateItem()):(this.item.next(t),this.connectionStatus.next(!1),this.clearRouteParams())})}clearRouteParams(){this.route.queryParamMap.pipe((0,_.p)(t=>(0,v.hj)(t.keys)),(0,m.T)(t=>Object.assign({})),(0,R.s)(1)).subscribe(t=>this.router.navigate([],{relativeTo:this.route,queryParams:t}))}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(e.Agw),e.rXU(T.uR),e.rXU(M.ItemDataService),e.rXU(V.r),e.rXU(b.nX),e.rXU(b.Ix))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-page"]],standalone:!0,features:[e.aNF],decls:12,vars:20,consts:[[3,"message",4,"ngIf"],["class","container","data-test","error-box",4,"ngIf"],[4,"ngIf"],["class","container",4,"ngIf"],[3,"message"],["data-test","error-box",1,"container"],[3,"type"],["data-test","orcid-auth",3,"unlink","item"],["data-test","orcid-sync-setting",3,"item","settingsUpdated",4,"ngIf"],[3,"item",4,"ngIf"],["data-test","orcid-sync-setting",3,"settingsUpdated","item"],[3,"item"],[1,"container"],[1,"button-row","bottom","mb-3"],[1,"text-right"],["role","button","data-test","back-button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(n,i){1&n&&(e.DNE(0,vt,2,3,"ds-loading",0),e.nI1(1,"async"),e.DNE(2,bt,4,4,"div",1),e.nI1(3,"async"),e.nI1(4,"async"),e.DNE(5,It,5,5,"ng-container",2),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.DNE(9,Ot,7,4,"div",3),e.nI1(10,"async"),e.nI1(11,"async")),2&n&&(e.Y8G("ngIf",e.bMT(1,4,i.processingConnection)),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(3,6,i.processingConnection)&&!0!==e.bMT(4,8,i.connectionStatus)),e.R7$(3),e.Y8G("ngIf",!0!==e.bMT(6,10,i.processingConnection)&&e.bMT(7,12,i.item)&&e.bMT(8,14,i.connectionStatus)),e.R7$(4),e.Y8G("ngIf",!0!==e.bMT(10,16,i.processingConnection)&&e.bMT(11,18,i.item)))},dependencies:[u.MD,u.bT,u.Jj,ne.v,x.C,He,ft,dt,h.h,h.D9,b.Wk]})}}return s})();const Ct=(0,o(6056).L)(()=>te.Z,()=>(0,g.of)(P._.CanSynchronizeWithORCID));var Rt=o(8886);o(91459);const Mt=["*"];function Ft(s,a){}let Et=(()=>{class s extends Rt.J{getComponentName(){return"ItemPageComponent"}importThemedComponent(t){return o(5729)(`./${t}/app/item-page/simple/item-page.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,91459))}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.xGo(s)))(i||s)}})()}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-item-page"]],standalone:!0,features:[e.Vt3,e.aNF],ngContentSelectors:Mt,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(n,i){1&n&&(e.NAR(),e.DNE(0,Ft,0,0,"ng-template",null,0,e.C5r),e.j41(2,"div",null,1),e.SdG(4),e.k0s())},encapsulation:2})}}return s})();var Dt=o(25499),se=o(81783),jt=o(81225);const Bt=[(0,o(67600).s)("item")],Pt=[{path:":id",resolve:{dso:te.Z,breadcrumb:(s,a,t=(0,e.WQX)(A.U),n=(0,e.WQX)(M.ItemDataService))=>{const i=(0,E.U)();return(0,D.G)(s,a,t,n,...i)}},runGuardsAndResolvers:"always",children:[{path:"",component:Et,pathMatch:"full",resolve:{menu:k.c}},{path:"full",component:Pe.i,resolve:{menu:k.c}},{path:B.jU,loadChildren:()=>Promise.all([o.e(2754),o.e(9366),o.e(7558),o.e(2073),o.e(3534),o.e(2076),o.e(2418)]).then(o.bind(o,52418)).then(s=>s.ROUTES)},{path:B.aX,component:Ae,canActivate:[O.t]},{path:y.RZ,component:he},{path:B._z,component:St,canActivate:[O.t,Ct]}],data:{menu:{public:[{id:"statistics_item_:id",active:!0,visible:!0,index:2,model:{type:F.x.LINK,text:"menu.section.statistics",link:"statistics/items/:id/"}}]}}},{path:"version",children:[{path:":id",component:(()=>{class s{constructor(t,n,i,r){this.route=t,this.router=n,this.versionService=i,this.authService=r}ngOnInit(){this.versionRD$=this.route.data.pipe((0,m.T)(t=>t.dso),(0,Y.QD)(this.router,this.authService)),this.versionRD$.pipe((0,f.ak)(),(0,I.n)(t=>t.item),(0,Y.QD)(this.router,this.authService),(0,f.qD)()).subscribe(t=>{if(t.hasNoContent)this.router.navigateByUrl((0,y.EX)(),{skipLocationChange:!0});else{const n=(0,B._o)(t.payload);this.router.navigateByUrl(n)}})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(b.nX),e.rXU(b.Ix),e.rXU(se.VersionDataService),e.rXU(T.uR))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-version-page"]],standalone:!0,features:[e.aNF],decls:0,vars:0,template:function(n,i){}})}}return s})(),resolve:{dso:(s,a,t=(0,e.WQX)(se.VersionDataService),n=(0,e.WQX)(Dt.il))=>{const i=t.findById(s.params.id,!0,!1,...Bt).pipe((0,f.qD)());return i.subscribe(r=>{n.dispatch(new jt.j(a.url,r.payload))}),i}}}]}]},35925:(X,$,o)=>{"use strict";o.d($,{Z:()=>b});var y=o(54438),O=o(7901),e=o(25499),E=o(96354),M=o(67116),D=o(29326),A=o(81225),C=o(308),k=o(80183),F=o(82777),u=o(56273),c=o(90887);const b=(h,d,g=(0,y.WQX)(O.Ix),m=(0,y.WQX)(D.ItemDataService),_=(0,y.WQX)(e.il),I=(0,y.WQX)(M.uR))=>{const R=m.findById(h.params.id,!0,!1,...(0,u.U)()).pipe((0,k.qD)(),(0,C.QD)(g,I));return R.subscribe(T=>{_.dispatch(new A.j(d.url,T.payload))}),R.pipe((0,E.T)(T=>{if(T.hasSucceeded&&(0,F.a4)(T.payload)){const j=d.url,z=g.parseUrl((0,c._o)(T.payload)).toString();if(!j.startsWith(z)){const L=T.payload.uuid,P=j.substring(j.indexOf(L)+L.length,j.length);g.navigateByUrl(z+P)}}return T}))}},5729:(X,$,o)=>{var y={"./custom/app/item-page/simple/item-page.component":[37078,7078]};function O(e){if(!o.o(y,e))return Promise.resolve().then(()=>{var D=new Error("Cannot find module '"+e+"'");throw D.code="MODULE_NOT_FOUND",D});var E=y[e],M=E[0];return o.e(E[1]).then(()=>o(M))}O.keys=()=>Object.keys(y),O.id=5729,X.exports=O}}]);