(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[2418],{52418:(pt,J,r)=>{"use strict";r.r(J),r.d(J,{ROUTES:()=>gs});var N=r(70379),Y=r(13707),L=r(55584),W=r(10676),Q=r(92117),b=r(45539),h=r(60177),t=r(54438),v=r(7901),T=r(52149),g=r(41780),$=r(7673),R=r(84572),u=r(96354),it=r(50332),p=r(82777),V=r(90887);const It=s=>({active:s}),lt=s=>[s];function ut(s,l){if(1&s&&(t.j41(0,"a",18),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const e=t.XpG().$implicit,i=t.XpG(2);t.Y8G("ngClass",t.eq3(7,It,e.page===i.currentPage))("routerLink",t.eq3(9,lt,"./"+e.page)),t.BMQ("aria-selected",e.page===i.currentPage)("data-test",e.page),t.R7$(),t.SpI(" ",t.bMT(2,5,"item.edit.tabs."+e.page+".head")," ")}}function Z(s,l){if(1&s&&(t.j41(0,"button",19),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,"item.edit.tabs."+e.page+".head")," ")}}function ht(s,l){if(1&s&&(t.j41(0,"li",14),t.DNE(1,ut,3,11,"a",15),t.nI1(2,"async"),t.j41(3,"span",16),t.nI1(4,"translate"),t.DNE(5,Z,3,3,"button",17),t.nI1(6,"async"),t.k0s()()),2&s){const e=l.$implicit;t.R7$(),t.Y8G("ngIf",t.bMT(2,3,e.enabled)),t.R7$(2),t.Y8G("ngbTooltip",t.bMT(4,5,"item.edit.tabs.disabled.tooltip")),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(6,7,e.enabled))}}function Tt(s,l){if(1&s&&(t.j41(0,"ul",12),t.DNE(1,ht,7,9,"li",13),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.pages)}}let w=(()=>{class s{constructor(e,i,n){this.route=e,this.router=i,this.injector=n,this.router.events.subscribe(()=>this.initPageParamsByRoute())}ngOnInit(){this.initPageParamsByRoute(),this.pages=this.route.routeConfig.children.filter(e=>(0,p.hj)(e.path)).map(e=>{let i=(0,$.of)(!0);return(0,p.hj)(e.canActivate)&&(i=(0,R.z)(e.canActivate.map(n=>(0,t.N4e)(this.injector,()=>n(this.route.snapshot,this.router.routerState.snapshot)))).pipe((0,u.T)(n=>n.every(a=>!0===a)))),{page:e.path,enabled:i}}),this.itemRD$=this.route.data.pipe((0,u.T)(e=>e.dso))}getItemPage(e){return(0,V._o)(e)}initPageParamsByRoute(){this.currentPage=this.route.snapshot.firstChild.routeConfig.path}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(t.zZn))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-edit-item-page"]],standalone:!0,features:[t.aNF],decls:18,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"border-bottom"],[1,"pt-2"],["class","nav nav-tabs justify-content-start","role","tablist",4,"ngIf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],["role","tablist",1,"nav","nav-tabs","justify-content-start"],["class","nav-item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"nav-item"],["class","nav-link","role","tab",3,"ngClass","routerLink",4,"ngIf"],[3,"ngbTooltip"],["class","nav-link disabled",4,"ngIf"],["role","tab",1,"nav-link",3,"ngClass","routerLink"],[1,"nav-link","disabled"]],template:function(i,n){if(1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",4),t.DNE(7,Tt,2,1,"ul",5),t.j41(8,"div",6)(9,"div",7),t.nrm(10,"router-outlet"),t.k0s(),t.j41(11,"div",8)(12,"div",9)(13,"a",10),t.nI1(14,"async"),t.nrm(15,"i",11),t.EFF(16),t.nI1(17,"translate"),t.k0s()()()()()()()()),2&i){let a;t.R7$(4),t.JRh(t.bMT(5,4,"item.edit.head")),t.R7$(3),t.Y8G("ngIf",n.pages.length>0),t.R7$(6),t.Y8G("routerLink",n.getItemPage(null==(a=t.bMT(14,6,n.itemRD$))?null:a.payload)),t.R7$(3),t.SpI(" ",t.bMT(17,8,"item.edit.return"),"")}},dependencies:[g.h,g.D9,h.YU,h.bT,h.Sq,h.Jj,T.n8,T.md,v.Wk,v.n3],encapsulation:2,data:{animation:[it.qG,it.Ws]},changeDetection:0})}}return s})();var c=r(4436),m=r(80183),yt=r(89366);function St(s,l){1&s&&t.nrm(0,"ds-access-control-form-container",1),2&s&&t.Y8G("itemRD",l.ngIf)("showLimitToSpecificBitstreams",!0)}let $t=(()=>{class s{constructor(e){this.route=e}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,u.T)(e=>e.dso)).pipe((0,m.yd)())}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-access-control"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["titleMessage","item-access-control-title",3,"itemRD","showLimitToSpecificBitstreams",4,"ngIf"],["titleMessage","item-access-control-title",3,"itemRD","showLimitToSpecificBitstreams"]],template:function(i,n){1&i&&(t.DNE(0,St,1,2,"ds-access-control-form-container",0),t.nI1(1,"async")),2&i&&t.Y8G("ngIf",t.bMT(1,1,n.itemRD$))},dependencies:[yt.o,h.bT,h.Jj]})}}return s})();var Rt=r(48125),gt=r.n(Rt),I=r(84412),E=r(61594),f=r(5964),F=r(73028),M=r(99437),S=r(96697),z=r(96526),nt=r(1321),B=r(96820),j=r(16292);let st=(()=>{class s{constructor(e){this.ngFor=e,this.ngFor.ngForTrackBy=(i,n)=>n?n.id:void 0}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(h.Sq,1))}}static{this.\u0275dir=t.FsC({type:s,selectors:[["","ngForTrackById",""]],standalone:!0})}}return s})();var ft=r(92772),k=r(67600);function te(s,l){if(1&s&&(t.qex(0),t.nrm(1,"ds-resource-policies",5),t.bVm()),2&s){const e=l.$implicit;t.R7$(),t.Y8G("resourceType","bitstream")("resourceUUID",e.id)("resourceName",e.name)}}function ee(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",11)(1,"button",12),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2).$implicit,a=t.XpG();return t.Njj(a.onBitstreamsLoad(n))}),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}2&s&&(t.R7$(2),t.JRh(t.bMT(3,1,"collection.edit.item.authorizations.load-more-button")))}function ie(s,l){if(1&s){const e=t.RV6();t.qex(0),t.j41(1,"div",7)(2,"div",8)(3,"button",9),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,a=t.XpG();return t.Njj(a.collapseArea(n.id))}),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",10),t.DNE(7,te,2,3,"ng-container",3),t.nI1(8,"async"),t.DNE(9,ee,4,3,"div",4),t.k0s()(),t.bVm()}if(2&s){const e=t.XpG().$implicit,i=t.XpG();t.R7$(3),t.BMQ("aria-expanded",!1)("aria-controls",e.id),t.R7$(),t.Lme(" ",t.bMT(5,8,"collection.edit.item.authorizations.show-bitstreams-button")," ",i.nameService.getName(e)," "),t.R7$(2),t.Y8G("id",e.id)("ngbCollapse",i.bundleBitstreamsMap.get(e.id).isCollapsed),t.R7$(),t.Y8G("ngForOf",t.bMT(8,10,i.bundleBitstreamsMap.get(e.id).bitstreams)),t.R7$(2),t.Y8G("ngIf",!i.bundleBitstreamsMap.get(e.id).allBitstreamsLoaded)}}function ne(s,l){if(1&s&&(t.qex(0),t.nrm(1,"ds-resource-policies",5),t.DNE(2,ie,10,12,"ng-container",6),t.nI1(3,"async"),t.bVm()),2&s){let e;const i=l.$implicit,n=t.XpG();t.R7$(),t.Y8G("resourceType","bundle")("resourceUUID",i.id)("resourceName",i.name),t.R7$(),t.Y8G("ngIf",(null==(e=t.bMT(3,4,null==(e=n.bundleBitstreamsMap.get(i.id))?null:e.bitstreams))?null:e.length)>0)}}function se(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",11)(1,"button",12),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onBundleLoad())}),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}2&s&&(t.R7$(2),t.JRh(t.bMT(3,1,"collection.edit.item.authorizations.load-bundle-button")))}let ae=(()=>{class s{constructor(e,i,n){this.linkService=e,this.route=i,this.nameService=n,this.bundleBitstreamsMap=new Map,this.bundles$=new I.t([]),this.subs=[],this.bundlesPerPage=6,this.bundlesPageSize=1,this.allBundlesLoaded=!1,this.bitstreamSize=4,this.bitstreamPageSize=4}ngOnInit(){this.getBundlesPerItem()}getItemUUID(){return this.item$.pipe((0,u.T)(e=>e.id),(0,E.$)(e=>(0,p.hj)(e)))}getItemName(){return this.item$.pipe((0,u.T)(e=>this.nameService.getName(e)))}getItemBundles(){return this.bundles$.asObservable()}getBundlesPerItem(e=1){this.item$=this.route.data.pipe((0,u.T)(n=>n.dso),(0,m.QQ)(),(0,u.T)(n=>this.linkService.resolveLink(n,(0,k.s)("bundles",{findListOptions:{currentPage:e,elementsPerPage:this.bundlesPerPage}},(0,k.s)("bitstreams")))));const i=this.item$.pipe((0,f.p)(n=>(0,p.hj)(n.bundles)),(0,F.Z)(n=>n.bundles),(0,m.QQ)(),(0,M.W)(n=>(console.error(n),(0,$.of)((0,B.g)(null,[])))));this.subs.push(i.pipe((0,S.s)(1),(0,u.T)(n=>n.page)).subscribe(n=>{(gt()(n.length,0)||n.length<this.bundlesPerPage)&&(this.allBundlesLoaded=!0),gt()(e,1)?this.bundles$.next(n):this.bundles$.next(this.bundles$.getValue().concat(n))}),i.pipe((0,S.s)(1),(0,F.Z)(n=>n.page),(0,u.T)(n=>({id:n.id,bitstreams:this.getBundleBitstreams(n)}))).subscribe(n=>{const a={isCollapsed:!0,allBitstreamsLoaded:!1,bitstreams:null};a.bitstreams=n.bitstreams.pipe((0,u.T)(o=>(a.allBitstreamsLoaded=o?.page.length<this.bitstreamSize,[...o.page.slice(0,this.bitstreamSize)]))),this.bundleBitstreamsMap.set(n.id,a)}))}getBundleBitstreams(e){return e.bitstreams.pipe((0,m.ak)(),(0,M.W)(i=>(console.error(i),(0,$.of)((0,B.g)(null,[])))))}collapseArea(e){this.bundleBitstreamsMap.get(e).isCollapsed=!this.bundleBitstreamsMap.get(e).isCollapsed}onBundleLoad(){this.bundlesPageSize++,this.getBundlesPerItem(this.bundlesPageSize)}onBitstreamsLoad(e){return this.getBundleBitstreams(e).subscribe(i=>{const n=i?.page.slice(this.bitstreamPageSize,this.bitstreamPageSize+this.bitstreamSize),a=this.bundleBitstreamsMap.get(e.id).bitstreams.pipe((0,u.T)(d=>[...d,...n]));this.bitstreamPageSize=this.bitstreamPageSize+this.bitstreamSize;const o={bitstreams:a,isCollapsed:this.bundleBitstreamsMap.get(e.id).isCollapsed,allBitstreamsLoaded:i?.page.length<=this.bitstreamPageSize};this.bundleBitstreamsMap.set(e.id,o)})}ngOnDestroy(){this.subs.filter(e=>(0,p.a4)(e)).forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(nt._),t.rXU(v.nX),t.rXU(z.f))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-authorizations"]],standalone:!0,features:[t.aNF],decls:8,vars:13,consts:[[1,"container"],[3,"type","content"],[3,"resourceType","resourceName","resourceUUID"],[4,"ngFor","ngForTrackById","ngForOf"],["class","row justify-content-center",4,"ngIf"],[3,"resourceType","resourceUUID","resourceName"],[4,"ngIf"],[1,"card","auth-bitstream-container"],[1,"card-header"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"card-body",3,"id","ngbCollapse"],[1,"row","justify-content-center"],["type","button",1,"btn","btn-link",3,"click"]],template:function(i,n){1&i&&(t.j41(0,"div",0),t.nrm(1,"ds-alert",1)(2,"ds-resource-policies",2),t.nI1(3,"async"),t.nI1(4,"async"),t.DNE(5,ne,4,6,"ng-container",3),t.nI1(6,"async"),t.DNE(7,se,4,3,"div",4),t.k0s()),2&i&&(t.R7$(),t.Y8G("type","alert-info")("content","item.edit.authorizations.heading"),t.R7$(),t.Y8G("resourceType","item")("resourceName",t.bMT(3,7,n.getItemName()))("resourceUUID",t.bMT(4,9,n.getItemUUID())),t.R7$(3),t.Y8G("ngForOf",t.bMT(6,11,n.bundles$)),t.R7$(2),t.Y8G("ngIf",!n.allBundlesLoaded))},dependencies:[ft.e,T.HC,T.$G,g.h,g.D9,h.Sq,st,h.Jj,h.bT,j.C],styles:[".auth-bitstream-container[_ngcontent-%COMP%]{margin-top:-1em;margin-bottom:1.5em}"]})}}return s})();var at=r(88141),y=r(25558),Ct=r(47978),xt=r(41684),Vt=r(42578),Mt=r(81443),X=r(29326),A=r(59033),ct=r(32473),q=r(60456),bt=r(82394),G=r(39806),dt=r(23401),Bt=r(33550);let Xt=(()=>{class s{transform(e){const i=[];return(0,p.hj)(e)&&Object.values(e).forEach(n=>i.push(n)),i}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275pipe=t.EJ8({name:"dsObjectValues",type:s,pure:!0,standalone:!0})}}return s})();var ot=r(18226),oe=r(88280),re=(r(88318),r(45969)),le=r(56273);let Nt=(()=>{class s extends re.F{constructor(e,i,n,a,o,d){super(i,a,o,n),this.itemService=e,this.objectUpdatesService=i,this.router=n,this.notificationsService=a,this.translateService=o,this.route=d}ngOnInit(){(0,p.a4)(this.item)?this.setItem(this.item):this.itemUpdateSubscription=(0,R.z)([this.route.data,this.route.parent.data]).pipe((0,u.T)(([e,i])=>Object.assign({},e,i)),(0,u.T)(e=>e.dso),(0,at.M)(e=>{this.item=e.payload}),(0,y.n)(e=>this.itemService.findByHref(e.payload._links.self.href,!0,!0,...(0,le.U)())),(0,m.v7)()).subscribe(e=>{this.setItem(e.payload)}),super.ngOnInit(),this.discardTimeOut=oe.c.item.edit.undoTimeout,this.hasChanges().pipe((0,S.s)(1)).subscribe(e=>{e?this.checkLastModified():this.initializeOriginalFields()}),this.initializeNotificationsPrefix(),this.initializeUpdates()}setItem(e){this.item=e,this.itemPageRoute=(0,V._o)(this.item),this.postItemInit(),this.initializeUpdates()}ngOnDestroy(){(0,p.a4)(this.itemUpdateSubscription)&&this.itemUpdateSubscription.unsubscribe()}postItemInit(){}initializeUpdates(){}initializeNotificationsPrefix(){}initializeOriginalFields(){}submit(){}trackUpdate(e,i){return i&&i.field?i.field.uuid:void 0}isValid(){return this.objectUpdatesService.isValidPage(this.url)}checkLastModified(){const e=this.item.lastModified;this.objectUpdatesService.getLastModified(this.url).pipe((0,S.s)(1)).subscribe(i=>{i.getDate()!==e.getDate()&&(this.notificationsService.warning(this.getNotificationTitle("outdated"),this.getNotificationContent("outdated")),this.initializeOriginalFields())})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(X.ItemDataService),t.rXU(A.F),t.rXU(v.Ix),t.rXU(G.I),t.rXU(g.c$),t.rXU(v.nX))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-abstract-item-update"]],inputs:{item:"item"},standalone:!0,features:[t.Vt3,t.aNF],decls:0,vars:0,template:function(i,n){},encapsulation:2})}}return s})();var ce=r(44437),de=r(69799),P=r(25103),me=r(25488);class mt{constructor(l,e,i,n,a){this.xs=l,this.sm=e,this.md=i,this.lg=n,this.xl=a}buildClasses(){return`col-${this.xs} col-sm-${this.sm} col-md-${this.md} col-lg-${this.lg} col-xl-${this.xl}`}}class pe{constructor(l){this.columns=l}combineColumns(l,e){if(l<e&&(0,p.a4)(this.columns[l])&&(0,p.a4)(this.columns[e])){let i=this.columns[l].xs,n=this.columns[l].sm,a=this.columns[l].md,o=this.columns[l].lg,d=this.columns[l].xl;for(let _=l+1;_<e+1;_++)i+=this.columns[_].xs,n+=this.columns[_].sm,a+=this.columns[_].md,o+=this.columns[_].lg,d+=this.columns[_].xl;return new mt(i,n,a,o,d)}}}const Dt="item.edit.bitstreams.notifications.move";let wt=(()=>{class s{constructor(e,i,n,a,o,d,_,C){this.notificationsService=e,this.translateService=i,this.objectUpdatesService=n,this.bitstreamService=a,this.bundleService=o,this.dsoNameService=d,this.requestService=_,this.liveRegionService=C,this.selectionAction$=new I.t(null),this.isPerformingMoveRequest=new I.t(!1)}getSelectionAction$(){return this.selectionAction$}getSelectionAction(){const e=this.selectionAction$.value;return(0,p.Tn)(e)?null:Object.assign({},e)}hasSelectedBitstream(){const e=this.getSelectionAction();if((0,p.Tn)(e))return!1;const i=e.action;return"Selected"===i||"Moved"===i}getSelectedBitstream(){if(!this.hasSelectedBitstream())return null;const e=this.getSelectionAction();return Object.assign({},e.selectedEntry)}selectBitstreamEntry(e){(0,p.a4)(e)&&e.bitstream!==this.getSelectedBitstream()?.bitstream&&(this.announceSelect(e.bitstream.name),this.updateSelectionAction({action:"Selected",selectedEntry:e}))}updateSelectionAction(e){this.selectionAction$.next(e)}clearSelection(){const e=this.getSelectedBitstream();(0,p.a4)(e)&&(this.updateSelectionAction({action:"Cleared",selectedEntry:e}),this.announceClear(e.bitstream.name),e.currentPosition!==e.originalPosition&&this.displaySuccessNotification(Dt))}cancelSelection(){const e=this.getSelectedBitstream();if((0,p.Tn)(e)||this.getPerformingMoveRequest())return;const i=e.originalPosition,n=e.currentPosition;n===i?(this.announceClear(e.bitstream.name),this.updateSelectionAction({action:"Cleared",selectedEntry:e})):(this.announceCancel(e.bitstream.name,i),this.performBitstreamMoveRequest(e.bundle,n,i),this.updateSelectionAction({action:"Cancelled",selectedEntry:e}))}moveSelectedBitstreamUp(){const e=this.getSelectedBitstream();if((0,p.Tn)(e)||this.getPerformingMoveRequest())return;const i=e.currentPosition;if(i>0){const n=i-1;e.currentPosition=n,this.performBitstreamMoveRequest(e.bundle,i,n,()=>{this.announceMove(e.bitstream.name,n)}),this.updateSelectionAction({action:"Moved",selectedEntry:e})}}moveSelectedBitstreamDown(){const e=this.getSelectedBitstream();if((0,p.Tn)(e)||this.getPerformingMoveRequest())return;const i=e.currentPosition;if(i<e.bundleSize-1){const n=i+1;e.currentPosition=n,this.performBitstreamMoveRequest(e.bundle,i,n,()=>{this.announceMove(e.bitstream.name,n)}),this.updateSelectionAction({action:"Moved",selectedEntry:e})}}performBitstreamMoveRequest(e,i,n,a){if(this.getPerformingMoveRequest())return void console.warn("Attempted to perform move request while previous request has not completed yet");const o={op:"move",from:`/_links/bitstreams/${i}/href`,path:`/_links/bitstreams/${n}/href`};this.announceLoading(),this.isPerformingMoveRequest.next(!0),this.bundleService.patch(e,[o]).pipe((0,m.qD)(),(0,at.M)(d=>this.displayFailedResponseNotifications(Dt,[d])),(0,y.n)(()=>this.requestService.setStaleByHrefSubstring(e.self)),(0,S.s)(1)).subscribe(()=>{this.isPerformingMoveRequest.next(!1),a?.()})}getPerformingMoveRequest(){return this.isPerformingMoveRequest.value}getPerformingMoveRequest$(){return this.isPerformingMoveRequest}getInitialBundlesPaginationOptions(){return Object.assign(new dt.W,{id:"bundles-pagination-options",currentPage:1,pageSize:9999})}getInitialBitstreamsPaginationOptions(e){return Object.assign(new dt.W,{id:e,currentPage:1,pageSize:10})}getColumnSizes(){return new pe([new mt(2,2,3,4,4),new mt(2,3,3,3,3),new mt(2,2,2,2,2),new mt(6,5,4,3,3)])}displayNotifications(e,i){this.displayFailedResponseNotifications(e,i),this.displaySuccessFulResponseNotifications(e,i)}displayFailedResponseNotifications(e,i){i.filter(a=>(0,p.a4)(a)&&a.hasFailed).forEach(a=>{this.displayErrorNotification(e,a.errorMessage)})}displayErrorNotification(e,i){this.notificationsService.error(this.translateService.instant(`${e}.failed.title`),i)}displaySuccessFulResponseNotifications(e,i){i.filter(a=>(0,p.a4)(a)&&a.hasSucceeded).length>0&&this.displaySuccessNotification(e)}displaySuccessNotification(e){this.notificationsService.success(this.translateService.instant(`${e}.saved.title`),this.translateService.instant(`${e}.saved.content`))}removeMarkedBitstreams(e){return e.pipe((0,S.s)(1)).pipe((0,y.n)(a=>(0,ce.y)(...a.map(o=>this.objectUpdatesService.getFieldUpdates(o.self,[],!0)))),(0,u.T)(a=>[].concat(...a.map(o=>Object.values(o).filter(d=>d.changeType===P.B.REMOVE)))),(0,u.T)(a=>a.map(o=>o.field))).pipe((0,S.s)(1),(0,y.n)(a=>this.bitstreamService.removeMultiple(a)))}mapBitstreamsToTableEntries(e){return e.map(i=>{const n=this.dsoNameService.getName(i);return{bitstream:i,id:i.uuid,name:n,nameStripped:this.nameToHeader(n),description:i.firstMetadataValue("dc.description"),format:i.format.pipe((0,m.ak)()),downloadUrl:(0,de.hV)(i)}})}nameToHeader(e){return this.stripWhiteSpace(e)}stripWhiteSpace(e){return e.replace(/\s+/g,"")}announceSelect(e){const i=this.translateService.instant("item.edit.bitstreams.edit.live.select",{bitstream:e});this.liveRegionService.addMessage(i)}announceMove(e,i){const n=this.translateService.instant("item.edit.bitstreams.edit.live.move",{bitstream:e,toIndex:i+1});this.liveRegionService.addMessage(n)}announceCancel(e,i){const n=this.translateService.instant("item.edit.bitstreams.edit.live.cancel",{bitstream:e,toIndex:i+1});this.liveRegionService.addMessage(n)}announceClear(e){const i=this.translateService.instant("item.edit.bitstreams.edit.live.clear",{bitstream:e});this.liveRegionService.addMessage(i)}announceLoading(){const e=this.translateService.instant("item.edit.bitstreams.edit.live.loading");this.liveRegionService.addMessage(e)}static{this.\u0275fac=function(i){return new(i||s)(t.KVO(G.I),t.KVO(g.c$),t.KVO(A.F),t.KVO(Vt.BitstreamDataService),t.KVO(Mt.BundleDataService),t.KVO(z.f),t.KVO(ct.B),t.KVO(me.A))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var Lt=r(52717),ue=r(44668),Yt=r(22978),vt=(r(70673),r(5682)),he=r(75465);const ge=["bundleView"],fe=["dragTooltip"],zt=s=>({bundle:s}),be=s=>({name:s}),ve=s=>[s,"bitstreams","new"],_e=s=>({invisible:s}),Ie=s=>["/bitstreams/",s,"edit"];function Te(s,l){if(1&s){const e=t.RV6();t.j41(0,"li",28),t.nI1(1,"async"),t.j41(2,"button",29),t.bIt("click",function(){const n=t.eBV(e).$implicit,a=t.XpG(4);return t.Njj(a.doPageSizeChange(n))}),t.nrm(3,"i",30),t.nI1(4,"async"),t.EFF(5),t.k0s()()}if(2&s){const e=l.$implicit,i=t.XpG(4);t.BMQ("aria-selected",e===t.bMT(1,3,i.pageSize$)),t.R7$(3),t.Y8G("ngClass",t.eq3(7,_e,e!==t.bMT(4,5,i.pageSize$))),t.R7$(2),t.SpI(" ",e," ")}}function ye(s,l){if(1&s){const e=t.RV6();t.j41(0,"tr",32),t.bIt("cdkDragStarted",function(){t.eBV(e);const n=t.XpG(5);return t.Njj(n.dragStart())})("cdkDragEnded",function(){t.eBV(e);const n=t.XpG(5);return t.Njj(n.dragEnd())}),t.j41(1,"th",33)(2,"div",34),t.bIt("keydown.enter",function(n){t.eBV(e);const a=t.XpG().$implicit,o=t.XpG(4);return t.Njj(o.select(n,a))})("keydown.space",function(n){t.eBV(e);const a=t.XpG().$implicit,o=t.XpG(4);return t.Njj(o.select(n,a))})("click",function(n){t.eBV(e);const a=t.XpG().$implicit,o=t.XpG(4);return t.Njj(o.select(n,a))}),t.nrm(3,"i",35),t.nI1(4,"translate"),t.k0s(),t.EFF(5),t.k0s(),t.j41(6,"td",36),t.EFF(7),t.k0s(),t.j41(8,"td",36),t.EFF(9),t.nI1(10,"async"),t.k0s(),t.j41(11,"td",36)(12,"div",37)(13,"div",38)(14,"a",39),t.nI1(15,"translate"),t.nI1(16,"translate"),t.nI1(17,"dsBrowserOnly"),t.nrm(18,"i",40),t.k0s(),t.j41(19,"button",41),t.nI1(20,"translate"),t.nI1(21,"translate"),t.nrm(22,"i",42),t.k0s(),t.j41(23,"button",43),t.nI1(24,"translate"),t.nI1(25,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,a=t.XpG(4);return t.Njj(a.remove(n.bitstream))}),t.nrm(26,"i",44),t.k0s(),t.j41(27,"button",45),t.nI1(28,"translate"),t.nI1(29,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,a=t.XpG(4);return t.Njj(a.undo(n.bitstream))}),t.nrm(30,"i",46),t.k0s()()()()()}if(2&s){let e;const i=l.ngIf,n=t.XpG().$implicit,a=t.XpG(4);t.Y8G("ngClass",a.getRowClass(i,n)),t.R7$(),t.ZvI("bitstream-name row-element ",a.columnSizes.columns[0].buildClasses(),""),t.FS9("id",n.nameStripped),t.Mz_("headers","",a.bundleName," name"),t.R7$(2),t.Y8G("title",t.bMT(4,42,"item.edit.bitstreams.edit.buttons.drag")),t.R7$(2),t.SpI(" ",n.name," "),t.R7$(),t.ZvI("row-element ",a.columnSizes.columns[1].buildClasses(),""),t.FCK("headers","",n.nameStripped," ",a.bundleName," description"),t.R7$(),t.SpI(" ",n.description," "),t.R7$(),t.ZvI("row-element ",a.columnSizes.columns[2].buildClasses(),""),t.FCK("headers","",n.nameStripped," ",a.bundleName," format"),t.R7$(),t.SpI(" ",null==(e=t.bMT(10,44,n.format))?null:e.shortDescription," "),t.R7$(2),t.ZvI("row-element ",a.columnSizes.columns[3].buildClasses(),""),t.FCK("headers","",n.nameStripped," ",a.bundleName," actions"),t.R7$(3),t.FS9("title",t.bMT(15,46,"item.edit.bitstreams.edit.buttons.download")),t.Y8G("href",n.downloadUrl,t.B4B),t.BMQ("aria-label",t.bMT(16,48,"item.edit.bitstreams.edit.buttons.download"))("data-test",t.bMT(17,50,"download-button")),t.R7$(5),t.FS9("title",t.bMT(20,52,"item.edit.bitstreams.edit.buttons.edit")),t.Y8G("routerLink",t.eq3(64,Ie,n.id)),t.BMQ("aria-label",t.bMT(21,54,"item.edit.bitstreams.edit.buttons.edit")),t.R7$(4),t.FS9("title",t.bMT(24,56,"item.edit.bitstreams.edit.buttons.remove")),t.Y8G("dsBtnDisabled",!a.canRemove(i)),t.BMQ("aria-label",t.bMT(25,58,"item. edit bitstreams.edit.buttons.remove")),t.R7$(4),t.FS9("title",t.bMT(28,60,"item.edit.bitstreams.edit.buttons.undo")),t.Y8G("dsBtnDisabled",!a.canUndo(i)),t.BMQ("aria-label",t.bMT(29,62,"item.edit.bitstreams.edit.buttons.undo"))}}function Se(s,l){if(1&s&&(t.qex(0),t.DNE(1,ye,31,66,"tr",31),t.bVm()),2&s){const e=l.$implicit,i=t.XpG().ngIf;t.R7$(),t.Y8G("ngIf",i[e.id])}}function $e(s,l){if(1&s){const e=t.RV6();t.qex(0),t.j41(1,"table",6),t.nI1(2,"translate"),t.j41(3,"thead")(4,"tr",7)(5,"th",8),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"th",9),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.j41(11,"th",10),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"th",11),t.EFF(15),t.nI1(16,"translate"),t.k0s()()(),t.j41(17,"tbody",12),t.bIt("cdkDropListDropped",function(n){t.eBV(e);const a=t.XpG(3);return t.Njj(a.drop(n))}),t.j41(18,"tr",13)(19,"th",14),t.EFF(20),t.nI1(21,"translate"),t.k0s(),t.j41(22,"td",15)(23,"div",16)(24,"button",17),t.nI1(25,"translate"),t.nI1(26,"translate"),t.nrm(27,"i",18),t.k0s(),t.j41(28,"div",19,2)(30,"button",20),t.nI1(31,"translate"),t.nI1(32,"translate"),t.nrm(33,"i",21),t.k0s(),t.j41(34,"ul",22)(35,"li",23)(36,"span",24),t.EFF(37),t.nI1(38,"translate"),t.k0s(),t.j41(39,"ul",25),t.DNE(40,Te,6,9,"li",26),t.k0s()()()()()()(),t.DNE(41,Se,2,1,"ng-container",27),t.nI1(42,"async"),t.k0s()(),t.bVm()}if(2&s){const e=t.XpG(3);t.R7$(),t.AVh("mt-n1",!e.isFirstTable),t.BMQ("aria-label",t.i5U(2,32,"item.edit.bitstreams.bundle.table.aria-label",t.eq3(58,zt,e.bundleName))),t.R7$(2),t.AVh("visually-hidden",!e.isFirstTable),t.R7$(2),t.HbH(e.columnSizes.columns[0].buildClasses()),t.R7$(),t.SpI(" ",t.bMT(7,35,"item.edit.bitstreams.headers.name")," "),t.R7$(2),t.HbH(e.columnSizes.columns[1].buildClasses()),t.R7$(),t.SpI(" ",t.bMT(10,37,"item.edit.bitstreams.headers.description")," "),t.R7$(2),t.HbH(e.columnSizes.columns[2].buildClasses()),t.R7$(),t.SpI(" ",t.bMT(13,39,"item.edit.bitstreams.headers.format")," "),t.R7$(2),t.ZvI("",e.columnSizes.columns[3].buildClasses()," text-center"),t.R7$(),t.SpI(" ",t.bMT(16,41,"item.edit.bitstreams.headers.actions")," "),t.R7$(4),t.FS9("id",e.bundleName),t.R7$(),t.SpI(" ",t.i5U(21,43,"item.edit.bitstreams.bundle.name",t.eq3(60,be,e.bundleName))," "),t.R7$(4),t.FS9("title",t.bMT(25,46,"item.edit.bitstreams.bundle.edit.buttons.upload")),t.Y8G("routerLink",t.eq3(62,ve,e.itemPageRoute))("queryParams",t.eq3(64,zt,e.bundle.id)),t.BMQ("aria-label",t.bMT(26,48,"item.edit.bitstreams.bundle.edit.buttons.upload")),t.R7$(6),t.Y8G("title",t.bMT(31,50,"pagination.options.description")),t.BMQ("aria-label",t.bMT(32,52,"pagination.options.description")),t.R7$(7),t.JRh(t.bMT(38,54,"pagination.results-per-page")),t.R7$(3),t.Y8G("ngForOf",e.paginationOptions.pageSizeOptions),t.R7$(),t.Y8G("ngForOf",t.bMT(42,56,e.tableEntries$))}}function Re(s,l){if(1&s&&(t.j41(0,"ds-pagination",4,1),t.nI1(2,"translate"),t.DNE(3,$e,43,66,"ng-container",5),t.nI1(4,"async"),t.k0s()),2&s){const e=l.ngIf,i=t.XpG(2);t.Y8G("hideGear",!0)("hidePagerWhenSinglePage",!0)("hidePaginationDetail",!0)("paginationOptions",i.paginationOptions)("collectionSize",e.totalElements)("retainScrollPosition",!0)("ngbTooltip",t.bMT(2,9,"item.edit.bitstreams.bundle.tooltip"))("autoClose",!1),t.R7$(3),t.Y8G("ngIf",t.bMT(4,11,i.updates$))}}function Ce(s,l){if(1&s&&(t.DNE(0,Re,5,13,"ds-pagination",3),t.nI1(1,"async")),2&s){let e;const i=t.XpG();t.Y8G("ngIf",null==(e=t.bMT(1,1,i.bitstreamsRD$))?null:e.payload)}}let Me=(()=>{class s{constructor(e,i,n,a,o,d,_){this.viewContainerRef=e,this.dsoNameService=i,this.bundleService=n,this.objectUpdatesService=a,this.paginationService=o,this.requestService=d,this.itemBitstreamsService=_,this.FieldChangeType=P.B,this.isFirstTable=!1,this.tableEntries$=new I.t([]),this.updates$=new I.t(null),this.subscriptions=[]}ngOnInit(){this.bundleNameColumn=this.columnSizes.combineColumns(0,2),this.viewContainerRef.createEmbeddedView(this.bundleView),this.itemPageRoute=(0,V._o)(this.item),this.bundleName=this.dsoNameService.getName(this.bundle),this.bundleUrl=this.bundle.self,this.initializePagination(),this.initializeBitstreams(),this.initializeSelectionActions()}ngOnDestroy(){this.viewContainerRef.clear(),this.subscriptions.forEach(e=>e?.unsubscribe())}initializePagination(){this.paginationOptions=this.itemBitstreamsService.getInitialBitstreamsPaginationOptions(this.bundleName),this.currentPaginationOptions$=new I.t(this.paginationOptions),this.pageSize$=new I.t(this.paginationOptions.pageSize),this.subscriptions.push(this.paginationService.getCurrentPagination(this.paginationOptions.id,this.paginationOptions).subscribe(e=>{this.currentPaginationOptions$.next(e),this.pageSize$.next(e.pageSize)}))}initializeBitstreams(){this.bitstreamsRD$=this.currentPaginationOptions$.pipe((0,y.n)(e=>{const i=new Bt.C({pagination:Object.assign({},e)});return this.bundleService.getBitstreamsEndpoint(this.bundle.id,i).pipe((0,y.n)(n=>this.requestService.hasByHref$(n)),(0,y.n)(()=>this.bundleService.getBitstreams(this.bundle.id,i,(0,k.s)("format"))))}),(0,m.v7)(),(0,ue.t)({bufferSize:1,refCount:!0})),this.subscriptions.push(this.bitstreamsRD$.pipe((0,S.s)(1),(0,at.M)(e=>this.bundleSize=e.payload.totalElements),(0,m.qn)()).subscribe(e=>{this.objectUpdatesService.initialize(this.bundleUrl,e,new Date)}),this.bitstreamsRD$.pipe((0,m.qn)(),(0,y.n)(e=>this.objectUpdatesService.getFieldUpdatesExclusive(this.bundleUrl,e))).subscribe(e=>this.updates$.next(e)),this.bitstreamsRD$.pipe((0,m.qn)(),(0,u.T)(e=>this.itemBitstreamsService.mapBitstreamsToTableEntries(e))).subscribe(e=>this.tableEntries$.next(e)))}initializeSelectionActions(){this.subscriptions.push(this.itemBitstreamsService.getSelectionAction$().subscribe(e=>this.handleSelectionAction(e)))}handleSelectionAction(e){(0,p.Tn)(e)||e.selectedEntry.bundle!==this.bundle||("Moved"===e.action&&this.redirectToCurrentPage(e.selectedEntry),"Cancelled"===e.action&&this.redirectToOriginalPage(e.selectedEntry),"Cleared"===e.action&&this.redirectToCurrentPage(e.selectedEntry))}redirectToCurrentPage(e){const i=this.getCurrentPage(),n=this.bundleIndexToPage(e.currentPosition);i!==n&&this.changeToPage(n)}redirectToOriginalPage(e){const i=this.getCurrentPage(),n=this.bundleIndexToPage(e.originalPosition);i!==n&&this.changeToPage(n)}canRemove(e){return e.changeType!==P.B.REMOVE}canUndo(e){return e.changeType>=P.B.UPDATE}remove(e){this.objectUpdatesService.saveRemoveFieldUpdate(this.bundleUrl,e)}undo(e){this.objectUpdatesService.removeSingleFieldUpdate(this.bundleUrl,e.uuid)}getRowClass(e,i){const n=this.itemBitstreamsService.getSelectedBitstream();if((0,p.a4)(n)&&i.id===n.bitstream.id)return"table-info";switch(e.changeType){case P.B.UPDATE:return"table-warning";case P.B.ADD:return"table-success";case P.B.REMOVE:return"table-danger";default:return"bg-white"}}doPageSizeChange(e){this.paginationComponent.doPageSizeChange(e)}dragStart(){this.paginationComponent.shouldShowBottomPager.pipe((0,S.s)(1),(0,f.p)(e=>e)).subscribe(()=>{this.dragTooltip.open()})}dragEnd(){this.dragTooltip.close()}drop(e){const i=e.previousIndex;let n=e.currentIndex;const a=this.getCurrentPage();let o=this.getCurrentPage();const d=document.elementFromPoint(e.dropPoint.x,e.dropPoint.y);if((0,p.a4)(d)&&(0,p.a4)(d.textContent)&&d.classList.contains("page-link")){let H=Number(d.textContent);(0,p.a4)(H)&&!Number.isNaN(H)&&(H-=1,H!==a&&(o=H,n=o>a?0:this.getCurrentPageSize()-1))}const _=this.pageIndexToBundleIndex(i,a),C=this.pageIndexToBundleIndex(n,o);if(_===C)return;const x=this.tableEntries$.value[i];this.itemBitstreamsService.performBitstreamMoveRequest(this.bundle,_,C,()=>{this.itemBitstreamsService.announceMove(x.name,C),o!==this.getCurrentPage()&&this.changeToPage(o),this.itemBitstreamsService.displaySuccessNotification(Dt)})}select(e,i){if(e.preventDefault(),e instanceof KeyboardEvent&&e.repeat)return;const n=this.itemBitstreamsService.getSelectedBitstream();if((0,p.a4)(n)&&n.bitstream===i)this.itemBitstreamsService.cancelSelection();else{const a=this.createBitstreamSelectionObject(i);if((0,p.Tn)(a))return void console.warn("Failed to create selection object");this.itemBitstreamsService.selectBitstreamEntry(a)}}createBitstreamSelectionObject(e){const i=this.findBitstreamPageIndex(e);if(-1===i)return null;const n=this.pageIndexToBundleIndex(i,this.getCurrentPage());return{bitstream:e,bundle:this.bundle,bundleSize:this.bundleSize,currentPosition:n,originalPosition:n}}findBitstreamPageIndex(e){return this.tableEntries$.value.findIndex(n=>n===e)}getCurrentPage(){return this.currentPaginationOptions$.value.currentPage-1}getCurrentPageSize(){return this.currentPaginationOptions$.value.pageSize}pageIndexToBundleIndex(e,i){return i*this.getCurrentPageSize()+e}bundleIndexToPage(e){return Math.floor(e/this.getCurrentPageSize())}changeToPage(e){this.paginationComponent.doPageChange(e+1)}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(t.c1b),t.rXU(z.f),t.rXU(Mt.BundleDataService),t.rXU(A.F),t.rXU(Yt.m),t.rXU(ct.B),t.rXU(wt))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-edit-bitstream-bundle"]],viewQuery:function(i,n){if(1&i&&(t.GBs(ge,7),t.GBs(vt.e,5),t.GBs(fe,5)),2&i){let a;t.mGM(a=t.lsd())&&(n.bundleView=a.first),t.mGM(a=t.lsd())&&(n.paginationComponent=a.first),t.mGM(a=t.lsd())&&(n.dragTooltip=a.first)}},inputs:{bundle:"bundle",item:"item",columnSizes:"columnSizes",isFirstTable:"isFirstTable"},standalone:!0,features:[t.aNF],decls:2,vars:0,consts:[["bundleView",""],["dragTooltip","ngbTooltip"],["paginationControls","ngbDropdown"],["placement","bottom","triggers","manual",3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","collectionSize","retainScrollPosition","ngbTooltip","autoClose",4,"ngIf"],["placement","bottom","triggers","manual",3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","collectionSize","retainScrollPosition","ngbTooltip","autoClose"],[4,"ngIf"],[1,"table"],[1,"header-row","font-weight-bold"],["id","name","scope","col"],["id","description","scope","col"],["id","format","scope","col"],["id","actions","scope","col"],["cdkDropList","",3,"cdkDropListDropped"],[1,"bundle-row"],["colspan","3","scope","colgroup",1,"span",3,"id"],[1,"text-center"],[1,"btn-group"],[1,"btn","btn-outline-success","btn-sm",3,"routerLink","queryParams","title"],[1,"fas","fa-upload","fa-fw"],["ngbDropdown","","placement","bottom-right",1,"btn-group","float-right","btn-sm","p-0"],["id","paginationControls","ngbDropdownToggle","","aria-haspopup","true","aria-expanded","false",1,"btn","btn-outline-secondary",3,"title"],["aria-hidden","true",1,"fas","fa-cog"],["id","paginationControlsDropdownMenu","aria-labelledby","paginationControls","role","menu","ngbDropdownMenu",""],["role","menuitem"],["id","pagination-control_results-per-page","role","heading",1,"dropdown-header"],["aria-labelledby","pagination-control_results-per-page","role","listbox",1,"list-unstyled"],["role","option",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["role","option"],[1,"dropdown-item",3,"click"],["aria-hidden","true",1,"fas","fa-check",3,"ngClass"],["class","bitstream-row","cdkDrag","",3,"ngClass","cdkDragStarted","cdkDragEnded",4,"ngIf"],["cdkDrag","",1,"bitstream-row",3,"cdkDragStarted","cdkDragEnded","ngClass"],["scope","row",3,"id","headers"],["tabindex","0","cdkDragHandle","",1,"drag-handle","text-muted","float-left","p-1","mr-2",3,"keydown.enter","keydown.space","click"],[1,"fas","fa-grip-vertical","fa-fw",3,"title"],[3,"headers"],[1,"text-center","w-100"],[1,"btn-group","relationship-action-buttons"],[1,"btn","btn-outline-primary","btn-sm",3,"href","title"],[1,"fas","fa-download","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm",3,"click","dsBtnDisabled","title"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"click","dsBtnDisabled","title"],[1,"fas","fa-undo-alt","fa-fw"]],template:function(i,n){1&i&&t.DNE(0,Ce,2,3,"ng-template",null,0,t.C5r)},dependencies:[h.MD,h.YU,h.Sq,h.bT,h.Jj,g.h,g.D9,v.Wk,vt.e,T.n8,T.md,Lt.O7,T.zH,T.tg,T.do,T.U0,Lt.T1,he.L,q.A],styles:[".drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}.table-border[_ngcontent-%COMP%]{border:1px solid #dee2e6}[_nghost-%COMP%]     .pagination{padding-top:.5rem}.scrollable-table[_ngcontent-%COMP%]{overflow-x:auto}.disabled-overlay[_ngcontent-%COMP%]{opacity:.6}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%}",".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-bg)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.bitstream-name[_ngcontent-%COMP%]{font-weight:400}.table[_ngcontent-%COMP%]{margin-bottom:0}"]})}}return s})();const Be=s=>[s,"bitstreams","new"],De=s=>({"disabled-overlay":s});function Fe(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",18),t.nI1(1,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.reinstate())}),t.nrm(2,"i",19),t.j41(3,"span",8),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}2&s&&(t.BMQ("aria-label",t.bMT(1,2,"item.edit.bitstreams.reinstate-button")),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.bitstreams.reinstate-button"),""))}function je(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",20),t.nI1(1,"async"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.discard())}),t.nrm(3,"i",21),t.j41(4,"span",8),t.EFF(5),t.nI1(6,"translate"),t.k0s()()}if(2&s){const e=t.XpG(2);t.Y8G("dsBtnDisabled",!0!==t.bMT(1,3,e.hasChanges$)||e.submitting),t.BMQ("aria-label",t.bMT(2,5,"item.edit.bitstreams.discard-button")),t.R7$(5),t.SpI("\xa0",t.bMT(6,7,"item.edit.bitstreams.discard-button"),"")}}function Ee(s,l){if(1&s&&t.nrm(0,"ds-item-edit-bitstream-bundle",25),2&s){const e=l.$implicit,i=l.first,n=t.XpG(3);t.Y8G("bundle",e)("item",n.item)("columnSizes",n.columnSizes)("isFirstTable",i)}}function ke(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",26)(1,"button",27),t.bIt("click",function(){t.eBV(e);const n=t.XpG(3);return t.Njj(n.loadBundles())}),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}2&s&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"item.edit.bitstreams.load-more.link"),""))}function Oe(s,l){if(1&s&&(t.j41(0,"div",22),t.nI1(1,"async"),t.DNE(2,Ee,1,4,"ds-item-edit-bitstream-bundle",23)(3,ke,4,3,"div",24),t.nI1(4,"async"),t.k0s()),2&s){const e=t.XpG().ngVar,i=t.XpG();t.Y8G("ngClass",t.eq3(7,De,t.bMT(1,3,i.isProcessingMoveRequest))),t.R7$(2),t.Y8G("ngForOf",e),t.R7$(),t.Y8G("ngIf",t.bMT(4,5,i.showLoadMoreLink$))}}function Ge(s,l){1&s&&(t.j41(0,"div",28),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"item.edit.bitstreams.empty")," "))}function Pe(s,l){1&s&&(t.nrm(0,"ds-loading",29),t.nI1(1,"translate")),2&s&&t.FS9("message",t.bMT(1,1,"loading.bitstreams"))}function Ue(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",18),t.nI1(1,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.reinstate())}),t.nrm(2,"i",19),t.j41(3,"span",8),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}2&s&&(t.BMQ("aria-label",t.bMT(1,2,"item.edit.bitstreams.reinstate-button")),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.bitstreams.reinstate-button"),""))}function xe(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",20),t.nI1(1,"async"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.discard())}),t.nrm(3,"i",21),t.j41(4,"span",8),t.EFF(5),t.nI1(6,"translate"),t.k0s()()}if(2&s){const e=t.XpG(2);t.Y8G("dsBtnDisabled",!0!==t.bMT(1,3,e.hasChanges$)||e.submitting),t.BMQ("aria-label",t.bMT(2,5,"item.edit.bitstreams.discard-button")),t.R7$(5),t.SpI("\xa0",t.bMT(6,7,"item.edit.bitstreams.discard-button"),"")}}function Ve(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",2)(1,"div",3),t.nrm(2,"ds-alert",4),t.k0s(),t.j41(3,"div",5)(4,"button",6),t.nI1(5,"translate"),t.nrm(6,"i",7),t.j41(7,"span",8),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.DNE(10,Fe,6,6,"button",9),t.nI1(11,"async"),t.j41(12,"button",10),t.nI1(13,"async"),t.nI1(14,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.nrm(15,"i",11),t.j41(16,"span",8),t.EFF(17),t.nI1(18,"translate"),t.k0s()(),t.DNE(19,je,7,9,"button",12),t.nI1(20,"async"),t.k0s(),t.DNE(21,Oe,5,9,"div",13)(22,Ge,3,3,"div",14)(23,Pe,2,3,"ds-loading",15),t.j41(24,"div",16)(25,"div",17),t.DNE(26,Ue,6,6,"button",9),t.nI1(27,"async"),t.j41(28,"button",10),t.nI1(29,"async"),t.nI1(30,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.nrm(31,"i",11),t.j41(32,"span",8),t.EFF(33),t.nI1(34,"translate"),t.k0s()(),t.DNE(35,xe,7,9,"button",12),t.nI1(36,"async"),t.k0s()()()}if(2&s){const e=l.ngVar,i=t.XpG();t.R7$(2),t.Y8G("content","item.edit.bitstreams.info-alert")("type",i.AlertType.Info),t.R7$(2),t.Y8G("routerLink",t.eq3(42,Be,i.itemPageRoute)),t.BMQ("aria-label",t.bMT(5,18,"item.edit.bitstreams.upload-button")),t.R7$(4),t.SpI("\xa0",t.bMT(9,20,"item.edit.bitstreams.upload-button"),""),t.R7$(2),t.Y8G("ngIf",t.bMT(11,22,i.isReinstatable$)),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(13,24,i.hasChanges$)||i.submitting),t.BMQ("aria-label",t.bMT(14,26,"item.edit.bitstreams.save-button")),t.R7$(5),t.SpI("\xa0",t.bMT(18,28,"item.edit.bitstreams.save-button"),""),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(20,30,i.isReinstatable$)),t.R7$(2),t.Y8G("ngIf",i.item&&(null==e?null:e.length)>0),t.R7$(),t.Y8G("ngIf",0===(null==e?null:e.length)),t.R7$(),t.Y8G("ngIf",!e),t.R7$(3),t.Y8G("ngIf",t.bMT(27,32,i.isReinstatable$)),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(29,34,i.hasChanges$)||i.submitting),t.BMQ("aria-label",t.bMT(30,36,"item.edit.bitstreams.save-button")),t.R7$(5),t.SpI("\xa0",t.bMT(34,38,"item.edit.bitstreams.save-button"),""),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(36,40,i.isReinstatable$))}}function Xe(s,l){1&s&&t.nrm(0,"ds-loading",30)}let Ne=(()=>{class s extends Nt{get bundles$(){return this.bundlesSubject.asObservable()}constructor(e,i,n,a,o,d,_,C,x,K,H,Pt,Ut){super(e,i,n,a,o,d),this.itemService=e,this.objectUpdatesService=i,this.router=n,this.notificationsService=a,this.translateService=o,this.route=d,this.bitstreamService=_,this.objectCache=C,this.requestService=x,this.cdRef=K,this.bundleService=H,this.zone=Pt,this.itemBitstreamsService=Ut,this.AlertType=Ct.v,this.bundlesSubject=new I.t([]),this.bundlesOptions=Object.assign(new dt.W,{id:"bundles-pagination-options",currentPage:1,pageSize:10}),this.submitting=!1,this.showLoadMoreLink$=new I.t(!0),this.columnSizes=this.itemBitstreamsService.getColumnSizes()}postItemInit(){this.loadBundles(1)}moveUp(e){this.itemBitstreamsService.hasSelectedBitstream()&&(e.preventDefault(),this.itemBitstreamsService.moveSelectedBitstreamUp())}moveDown(e){this.itemBitstreamsService.hasSelectedBitstream()&&(e.preventDefault(),this.itemBitstreamsService.moveSelectedBitstreamDown())}cancelSelection(e){this.itemBitstreamsService.hasSelectedBitstream()&&(e.preventDefault(),this.itemBitstreamsService.cancelSelection())}clearSelection(e){this.itemBitstreamsService.hasSelectedBitstream()&&e.target instanceof Element&&"BODY"===e.target.tagName&&(e.preventDefault(),this.itemBitstreamsService.clearSelection())}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.bitstreams.notifications."}loadBundles(e){this.bundlesOptions=Object.assign(new dt.W,this.bundlesOptions,{currentPage:e||this.bundlesOptions.currentPage+1}),this.itemService.getBundles(this.item.id,new Bt.C({pagination:this.bundlesOptions})).pipe((0,m.yd)(),(0,m.Bo)(),(0,at.M)(i=>this.showLoadMoreLink$.next(i.pageInfo.currentPage<i.pageInfo.totalPages)),(0,u.T)(i=>i.page)).subscribe(i=>{this.bundlesSubject.next([...this.bundlesSubject.getValue(),...i])})}submit(){this.submitting=!0,this.itemBitstreamsService.removeMarkedBitstreams(this.bundles$.pipe((0,S.s)(1))).subscribe(i=>{this.itemBitstreamsService.displayNotifications("item.edit.bitstreams.notifications.remove",[i]),this.submitting=!1})}dropBitstream(e,i){this.zone.runOutsideAngular(()=>{(0,p.a4)(i)&&(0,p.a4)(i.fromIndex)&&(0,p.a4)(i.toIndex)&&(0,p.a4)(i.finish)&&this.bundleService.patch(e,[{op:"move",from:`/_links/bitstreams/${i.fromIndex}/href`,path:`/_links/bitstreams/${i.toIndex}/href`}]).pipe((0,S.s)(1)).subscribe(a=>{this.zone.run(()=>{this.displayNotifications("item.edit.bitstreams.notifications.move",[a]),this.requestService.removeByHrefSubstring(e.self).pipe((0,f.p)(o=>o),(0,S.s)(1)).subscribe(()=>i.finish())})})})}displayNotifications(e,i){if((0,p.hj)(i)){const n=i.filter(o=>(0,p.a4)(o)&&o.hasFailed),a=i.filter(o=>(0,p.a4)(o)&&o.hasSucceeded);n.forEach(o=>{this.notificationsService.error(this.translateService.instant(`${e}.failed.title`),o.errorMessage)}),a.length>0&&this.notificationsService.success(this.translateService.instant(`${e}.saved.title`),this.translateService.instant(`${e}.saved.content`))}}discard(){const e=this.notificationsService.info(this.getNotificationTitle("discarded"),this.getNotificationContent("discarded"),{timeOut:this.discardTimeOut});this.objectUpdatesService.discardAllFieldUpdates(this.url,e)}reinstate(){this.bundles$.pipe((0,S.s)(1)).subscribe(e=>{e.forEach(i=>{this.objectUpdatesService.reinstateFieldUpdates(i.self)})})}isReinstatable(){return this.bundles$.pipe((0,y.n)(e=>(0,R.z)(e.map(i=>this.objectUpdatesService.isReinstatable(i.self)))),(0,u.T)(e=>e.includes(!0)))}hasChanges(){return this.bundles$.pipe((0,y.n)(e=>(0,R.z)(e.map(i=>this.objectUpdatesService.hasUpdates(i.self)))),(0,u.T)(e=>e.includes(!0)))}ngOnDestroy(){this.itemUpdateSubscription&&this.itemUpdateSubscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(X.ItemDataService),t.rXU(A.F),t.rXU(v.Ix),t.rXU(G.I),t.rXU(g.c$),t.rXU(v.nX),t.rXU(Vt.BitstreamDataService),t.rXU(xt.$),t.rXU(ct.B),t.rXU(t.gRc),t.rXU(Mt.BundleDataService),t.rXU(t.SKi),t.rXU(wt))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-bitstreams"]],hostBindings:function(i,n){1&i&&t.bIt("keydown.arrowUp",function(o){return n.moveUp(o)},!1,t.EBC)("keydown.arrowDown",function(o){return n.moveDown(o)},!1,t.EBC)("keyup.escape",function(o){return n.cancelSelection(o)},!1,t.EBC)("keydown.enter",function(o){return n.clearSelection(o)},!1,t.EBC)("keydown.space",function(o){return n.clearSelection(o)},!1,t.EBC)},standalone:!0,features:[t.Jv_([Xt]),t.Vt3,t.aNF],decls:4,vars:6,consts:[["class","item-bitstreams",4,"ngVar"],["class","loading-overlay",4,"ngIf"],[1,"item-bitstreams"],["id","reorder-description",1,"mt-2"],[3,"content","type"],[1,"button-row","top","d-flex","mt-2","space-children-mr"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-upload"],[1,"d-none","d-sm-inline"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"],[1,"fas","fa-save"],["class","btn btn-danger",3,"dsBtnDisabled","click",4,"ngIf"],["class","mt-4 table-border scrollable-table",3,"ngClass",4,"ngIf"],["class","alert alert-info w-100 d-inline-block mt-4","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],[1,"button-row","bottom"],[1,"mt-4","float-right","space-children-mr","ml-gap"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"btn","btn-danger",3,"click","dsBtnDisabled"],[1,"fas","fa-times"],[1,"mt-4","table-border","scrollable-table",3,"ngClass"],["aria-describedby","reorder-description",3,"bundle","item","columnSizes","isFirstTable",4,"ngFor","ngForOf"],["class","d-flex justify-content-center",4,"ngIf"],["aria-describedby","reorder-description",3,"bundle","item","columnSizes","isFirstTable"],[1,"d-flex","justify-content-center"],[1,"btn","btn-link","my-3",3,"click"],["role","alert",1,"alert","alert-info","w-100","d-inline-block","mt-4"],[3,"message"],[1,"loading-overlay"]],template:function(i,n){1&i&&(t.DNE(0,Ve,37,44,"div",0),t.nI1(1,"async"),t.DNE(2,Xe,1,0,"ds-loading",1),t.nI1(3,"async")),2&i&&(t.Y8G("ngVar",t.bMT(1,2,n.bundles$)),t.R7$(2),t.Y8G("ngIf",t.bMT(3,4,n.isProcessingMoveRequest)))},dependencies:[h.MD,h.YU,h.Sq,h.bT,h.Jj,g.h,g.D9,Me,v.Wk,ot.r,bt.v,j.C,q.A],styles:[".drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}.table-border[_ngcontent-%COMP%]{border:1px solid #dee2e6}[_nghost-%COMP%]     .pagination{padding-top:.5rem}.scrollable-table[_ngcontent-%COMP%]{overflow-x:auto}.disabled-overlay[_ngcontent-%COMP%]{opacity:.6}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%}"]})}}return s})();var At=r(99172),we=r(6983),Ft=r(13864),Wt=r(78655),Le=r(39012),tt=r(89417),Ye=r(64611),ze=r(79632),Ae=r(79666),We=r(95054);const Ke=(s,l)=>({"btn-danger":s,"btn-primary":l});function He(s,l){if(1&s){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"input",12,0),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"translate"),t.bIt("change",function(){const n=t.eBV(e).$implicit,a=t.XpG(3);return t.Njj(a.switch(n.dso.id))}),t.k0s()(),t.j41(7,"td")(8,"a",13),t.EFF(9),t.k0s()()()}if(2&s){const e=l.$implicit,i=t.sdS(3),n=t.XpG(3);t.R7$(2),t.FS9("name",e.dso.id),t.Y8G("disabled",!1===t.bMT(4,6,e.canSelect$))("ngModel",t.bMT(5,8,e.selected$)),t.BMQ("aria-label",t.bMT(6,10,i.checked?"collection.select.table.deselect":"collection.select.table.select")),t.R7$(6),t.Y8G("routerLink",e.route),t.R7$(),t.JRh(n.dsoNameService.getName(e.dso))}}function Je(s,l){if(1&s&&(t.j41(0,"ds-pagination",6)(1,"div",7)(2,"table",8)(3,"thead")(4,"tr")(5,"th")(6,"span",9),t.EFF(7),t.nI1(8,"translate"),t.k0s()(),t.j41(9,"th",10),t.EFF(10),t.nI1(11,"translate"),t.k0s()()(),t.j41(12,"tbody"),t.DNE(13,He,10,12,"tr",11),t.nI1(14,"async"),t.k0s()()()()),2&s){const e=t.XpG().ngVar,i=t.XpG();t.Y8G("paginationOptions",i.paginationOptions)("sortOptions",i.sortOptions)("collectionSize",null==e||null==e.payload?null:e.payload.totalElements)("hidePagerWhenSinglePage",!0)("hideGear",!0),t.R7$(7),t.JRh(t.bMT(8,8,"collection.select.table.selected")),t.R7$(3),t.JRh(t.bMT(11,10,"collection.select.table.title")),t.R7$(3),t.Y8G("ngForOf",t.bMT(14,12,i.selectCollections$))}}function Qe(s,l){1&s&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"collection.select.empty")," "))}function Ze(s,l){1&s&&(t.nrm(0,"ds-error",15),t.nI1(1,"translate")),2&s&&t.FS9("message",t.bMT(1,1,"error.collections"))}function qe(s,l){1&s&&(t.nrm(0,"ds-loading",15),t.nI1(1,"translate")),2&s&&t.FS9("message",t.bMT(1,1,"loading.collections"))}function ti(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",16)(1,"button",17),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.onCancel())}),t.nrm(2,"i",18),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"button",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.confirmSelected())}),t.nrm(6,"i",20),t.EFF(7),t.nI1(8,"translate"),t.k0s()()}if(2&s){const e=l.ngVar,i=t.XpG(2);t.R7$(3),t.SpI(" ",t.bMT(4,4,i.cancelButton)," "),t.R7$(2),t.Y8G("ngClass",t.l_i(8,Ke,i.dangerConfirm,!i.dangerConfirm))("dsBtnDisabled",0===(null==e?null:e.length)),t.R7$(2),t.SpI(" ",t.bMT(8,6,i.confirmButton)," ")}}function ei(s,l){if(1&s&&(t.qex(0),t.DNE(1,Je,15,14,"ds-pagination",2)(2,Qe,3,3,"div",3)(3,Ze,2,3,"ds-error",4)(4,qe,2,3,"ds-loading",4)(5,ti,9,11,"div",5),t.nI1(6,"async"),t.bVm()),2&s){const e=l.ngVar,i=t.XpG();t.R7$(),t.Y8G("ngIf",(null==e||null==e.payload?null:e.payload.totalElements)>0||(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)>0),t.R7$(),t.Y8G("ngIf",0===(null==e||null==e.payload?null:e.payload.totalElements)||0===(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)),t.R7$(),t.Y8G("ngIf",null==e?null:e.hasFailed),t.R7$(),t.Y8G("ngIf",!e||(null==e?null:e.isLoading)),t.R7$(),t.Y8G("ngVar",t.bMT(6,5,i.selectedIds$))}}let ii=(()=>{class s extends We.h{ngOnInit(){super.ngOnInit(),(0,p.hj)(this.confirmButton)||(this.confirmButton="collection.select.confirm"),this.selectCollections$=this.dsoRD$.pipe((0,p.Az)(),(0,m.Hz)(),(0,u.T)(e=>e.page.map(i=>Object.assign(new Ae.A,{dso:i,canSelect$:this.canSelect(i),selected$:this.getSelected(i.id),route:(0,Ye.JW)(i.id)}))))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=t.xGo(s)))(n||s)}})()}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-collection-select"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["selectCollectionBtn",""],[4,"ngVar"],[3,"paginationOptions","sortOptions","collectionSize","hidePagerWhenSinglePage","hideGear",4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],["class","space-children-mr float-right",4,"ngVar"],[3,"paginationOptions","sortOptions","collectionSize","hidePagerWhenSinglePage","hideGear"],[1,"table-responsive","mt-2"],["id","collection-select",1,"table","table-striped","table-hover"],[1,"sr-only"],["scope","col"],[4,"ngFor","ngForOf"],["type","checkbox",1,"collection-checkbox",3,"change","disabled","ngModel","name"],[3,"routerLink"],["role","alert",1,"alert","alert-info","w-100"],[3,"message"],[1,"space-children-mr","float-right"],[1,"btn","btn-outline-secondary","collection-cancel",3,"click"],[1,"fas","fa-times"],[1,"btn","collection-confirm",3,"click","ngClass","dsBtnDisabled"],[1,"fas","fa-trash"]],template:function(i,n){1&i&&(t.DNE(0,ei,7,7,"ng-container",1),t.nI1(1,"async")),2&i&&t.Y8G("ngVar",t.bMT(1,1,n.dsoRD$))},dependencies:[ot.r,h.bT,vt.e,h.pM,tt.YN,tt.Zm,tt.BC,tt.vS,v.Wk,ze.A,bt.v,h.YU,h.Jj,g.h,g.D9,q.A],styles:["table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type, table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type{width:1rem!important}"]})}}return s})();var ni=r(18016);const si=["tabs"],ai=s=>({name:s});function oi(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",11)(1,"ds-collection-select",12),t.nI1(2,"async"),t.bIt("confirm",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.removeMappings(n))})("cancel",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onCancel())}),t.k0s()()}if(2&s){let e;const i=t.XpG();t.R7$(),t.Y8G("key","browse")("dsoRD$",i.itemCollectionsRD$)("paginationOptions",null==(e=t.bMT(2,6,i.searchOptions$))?null:e.pagination)("confirmButton","item.edit.item-mapper.buttons.remove")("cancelButton","item.edit.item-mapper.cancel")("dangerConfirm",!0)}}function ri(s,l){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"ds-collection-select",18),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("confirm",function(n){t.eBV(e);const a=t.XpG(2);return t.Njj(a.mapCollections(n))})("cancel",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.onCancel())}),t.k0s()()}if(2&s){let e,i;const n=t.XpG(2);t.R7$(),t.Y8G("key","map")("dsoRD$",n.mappedCollectionsRD$)("paginationOptions",null==(e=t.bMT(2,6,n.searchOptions$))?null:e.pagination)("sortOptions",null==(i=t.bMT(3,8,n.searchOptions$))?null:i.sort)("confirmButton","item.edit.item-mapper.buttons.add")("cancelButton","item.edit.item-mapper.cancel")}}function li(s,l){1&s&&(t.j41(0,"div",19),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"item.edit.item-mapper.no-search")," "))}function ci(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"ds-search-form",15),t.nI1(3,"async"),t.nI1(4,"translate"),t.bIt("submitSearch",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.performedSearch=!0)}),t.k0s()()(),t.DNE(5,ri,4,10,"div",16)(6,li,3,3,"div",17)}if(2&s){let e;const i=t.XpG();t.R7$(2),t.Y8G("query",null==(e=t.bMT(3,6,i.searchOptions$))?null:e.query)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",t.bMT(4,8,"item.edit.item-mapper.search-form.placeholder")),t.R7$(3),t.Y8G("ngIf",i.performedSearch),t.R7$(),t.Y8G("ngIf",!i.performedSearch)}}let Kt=(()=>{class s{constructor(e,i,n,a,o,d,_,C,x){this.route=e,this.router=i,this.searchConfigService=n,this.searchService=a,this.notificationsService=o,this.itemDataService=d,this.collectionDataService=_,this.translateService=C,this.dsoNameService=x,this.performedSearch=!1}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,S.s)(1),(0,u.T)(e=>e.dso)),this.itemName$=this.itemRD$.pipe((0,f.p)(e=>(0,p.a4)(e)),(0,u.T)(e=>this.dsoNameService.getName(e.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadCollectionLists()}loadCollectionLists(){this.shouldUpdate$=new I.t(!0),this.itemCollectionsRD$=(0,R.z)(this.itemRD$.pipe((0,m.ak)()),this.shouldUpdate$).pipe((0,y.n)(([n,a])=>(!0===a&&this.shouldUpdate$.next(!1),this.collectionDataService.findListByHref(this.itemDataService.getMappedCollectionsEndpoint(n.id),void 0,!a,!1).pipe((0,m.v7)()))));const e=this.itemRD$.pipe((0,m.ak)(),(0,y.n)(n=>this.collectionDataService.findOwningCollectionFor(n)),(0,m.v7)()),i=(0,R.z)(this.itemCollectionsRD$,e,this.searchOptions$);this.mappedCollectionsRD$=i.pipe((0,y.n)(([n,a,o])=>this.searchService.search(Object.assign(new Bt.C(o),{query:this.buildQuery([...n.payload.page,a.payload],o.query),dsoTypes:[Ft.W.COLLECTION]}),1e4).pipe((0,m.jY)(),(0,At.Z)(void 0))))}mapCollections(e){const n=(0,R.z)([this.itemRD$.pipe((0,m.yd)(),(0,u.T)(a=>a.payload),(0,u.T)(a=>a.id)),this.itemCollectionsRD$.pipe((0,m.yd)(),(0,u.T)(a=>a.payload.page),(0,u.T)(a=>a.map(o=>o.id)))]).pipe((0,y.n)(([a,o])=>(0,R.z)(this.filterIds(e,o).map(d=>this.itemDataService.mapToCollection(a,d).pipe((0,m.qD)())))));this.showNotifications(n,"item.edit.item-mapper.notifications.add")}removeMappings(e){const i=this.itemRD$.pipe((0,m.yd)(),(0,u.T)(n=>n.payload.id),(0,y.n)(n=>(0,R.z)(e.map(a=>this.itemDataService.removeMappingFromCollection(n,a).pipe((0,m.qD)())))));this.showNotifications(i,"item.edit.item-mapper.notifications.remove")}filterIds(e,i){return e.filter(n=>i.indexOf(n)<0)}showNotifications(e,i){e.subscribe(n=>{const a=n.filter(d=>d.hasSucceeded),o=n.filter(d=>d.hasFailed);a.length>0&&((0,R.z)([this.translateService.get(`${i}.success.head`),this.translateService.get(`${i}.success.content`,{amount:a.length})]).subscribe(([_,C])=>{this.notificationsService.success(_,C)}),this.shouldUpdate$.next(!0)),o.length>0&&(0,R.z)([this.translateService.get(`${i}.error.head`),this.translateService.get(`${i}.error.content`,{amount:o.length})]).subscribe(([_,C])=>{this.notificationsService.error(_,C)}),this.switchToFirstTab()})}tabChange(e){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(e,i){let n=i;for(const a of e)n=this.addExcludeCollection(a.id,n);return n}addExcludeCollection(e,i){const n=`-search.resourceid:${e}`;return(0,p.hj)(i)?`${i} AND ${n}`:n}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.itemRD$.pipe((0,m.yd)(),(0,m.Bo)(),(0,S.s)(1)).subscribe(e=>{this.router.navigate([(0,V._o)(e)])})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(Le.g),t.rXU(Wt.S),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(we.CollectionDataService),t.rXU(g.c$),t.rXU(z.f))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-collection-mapper"]],viewQuery:function(i,n){if(1&i&&t.GBs(si,5),2&i){let a;t.mGM(a=t.lsd())&&(n.tabs=a.first)}},standalone:!0,features:[t.aNF],decls:25,vars:24,consts:[["tabs","ngbNav"],[1,"container","mt-2"],[1,"row"],[1,"col-12"],["id","item-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"navChange","destroyOnHide"],["role","presentation","data-test","browseTab",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],["role","presentation","data-test","mapTab",3,"ngbNavItem"],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"submitSearch","query","currentUrl","inPlaceSearch","searchPlaceholder"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","sortOptions","confirmButton","cancelButton"],["role","alert",1,"alert","alert-info","w-100"]],template:function(i,n){if(1&i){const a=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"p",4),t.nI1(7,"async"),t.nI1(8,"translate"),t.j41(9,"p"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"ul",5,0),t.bIt("navChange",function(d){return t.eBV(a),t.Njj(n.tabChange(d))}),t.j41(14,"li",6)(15,"a",7),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.DNE(18,oi,3,8,"ng-template",8),t.k0s(),t.j41(19,"li",9)(20,"a",7),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.DNE(23,ci,7,10,"ng-template",8),t.k0s()(),t.nrm(24,"div",10),t.k0s()()()}if(2&i){const a=t.sdS(13);t.R7$(4),t.JRh(t.bMT(5,9,"item.edit.item-mapper.head")),t.R7$(2),t.Y8G("innerHTML",t.i5U(8,13,"item.edit.item-mapper.item",t.eq3(22,ai,t.bMT(7,11,n.itemName$))),t.npT),t.R7$(4),t.JRh(t.bMT(11,16,"item.edit.item-mapper.description")),t.R7$(2),t.Y8G("destroyOnHide",!0),t.R7$(2),t.Y8G("ngbNavItem","browseTab"),t.R7$(2),t.JRh(t.bMT(17,18,"item.edit.item-mapper.tabs.browse")),t.R7$(3),t.Y8G("ngbNavItem","mapTab"),t.R7$(2),t.JRh(t.bMT(22,20,"item.edit.item-mapper.tabs.map")),t.R7$(3),t.Y8G("ngbNavOutlet",a)}},dependencies:[T.Pv,T.Um,T.X9,T.sy,T.Ri,T.m_,ii,ni.d,h.Jj,g.h,g.D9,h.bT],data:{animation:[it.qG,it.Ws]},changeDetection:0})}}return s})();var di=r(3040);const mi=s=>({item:s});function pi(s,l){if(1&s&&t.nrm(0,"ds-curation-form",2),2&s){const e=l.ngIf;t.Y8G("dsoHandle",null==e?null:e.payload.handle)}}let ui=(()=>{class s{constructor(e,i){this.route=e,this.dsoNameService=i}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,S.s)(1),(0,u.T)(e=>e.dso)),this.itemName$=this.dsoRD$.pipe((0,f.p)(e=>(0,p.a4)(e)),(0,u.T)(e=>this.dsoNameService.getName(e.payload)))}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(z.f))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-curate"]],standalone:!0,features:[t.aNF],decls:7,vars:11,consts:[[1,"container","mt-3"],[3,"dsoHandle",4,"ngIf"],[3,"dsoHandle"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"h2"),t.EFF(2),t.nI1(3,"async"),t.nI1(4,"translate"),t.k0s(),t.DNE(5,pi,1,1,"ds-curation-form",1),t.nI1(6,"async"),t.k0s()),2&i&&(t.R7$(2),t.JRh(t.i5U(4,4,"item.edit.curate.title",t.eq3(9,mi,t.bMT(3,2,n.itemName$)))),t.R7$(3),t.Y8G("ngIf",t.bMT(6,7,n.dsoRD$)))},dependencies:[di.X,h.bT,g.h,g.D9,h.Jj],encapsulation:2})}}return s})();var jt=r(39901),Et=r(30077),_t=r(48833),Ht=r(78448),kt=r(17191),et=r(13933);const gi=s=>({id:s}),fi=s=>[s,"edit"];let rt=(()=>{class s{constructor(e,i,n,a,o){this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.translateService=o}ngOnInit(){this.itemRD$=this.route.data.pipe((0,u.T)(e=>e.dso),(0,m.yd)()),this.itemRD$.pipe((0,E.$)()).subscribe(e=>{this.item=e.payload,this.itemPageRoute=(0,V._o)(this.item)}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){}processRestResponse(e){e.hasSucceeded?this.itemDataService.findById(this.item.id).pipe((s=>l=>l.pipe((0,m.v7)(),(0,E.$)(s)))(i=>this.predicate(i))).subscribe(()=>{this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([(0,V.$r)(this.item)])}):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,V.$r)(this.item)]))}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(g.c$))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-simple-action"]],standalone:!0,features:[t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return n.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,n.headerMessage,t.eq3(15,gi,n.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,n.descriptionMessage)),t.R7$(2),t.Y8G("item",n.item),t.R7$(3),t.SpI("",t.bMT(13,11,n.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,fi,n.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,n.cancelMessage)," "))},dependencies:[et.W,g.h,g.D9,v.Wk],encapsulation:2})}}return s})();const bi=s=>({id:s}),vi=s=>[s,"edit"];function _i(s,l){if(1&s&&t.nrm(0,"ds-listable-object-component-loader",24),2&s){const e=t.XpG().ngVar,i=t.XpG(6);t.Y8G("object",e)("viewMode",i.viewMode)}}function Ii(s,l){if(1&s&&t.nrm(0,"ds-listable-object-component-loader",24),2&s){const e=t.XpG(2).ngVar,i=t.XpG(6);t.Y8G("object",e)("viewMode",i.viewMode)}}function Ti(s,l){if(1&s&&(t.j41(0,"div")(1,"div")(2,"div",31),t.EFF(3),t.k0s(),t.j41(4,"div"),t.EFF(5),t.k0s()()()),2&s){const e=l.$implicit;t.R7$(3),t.SpI(" ",e.metadataField," "),t.R7$(2),t.SpI(" ",e.metadataValue.value," ")}}function yi(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",25)(1,"div",26),t.EFF(2),t.nI1(3,"translate"),t.j41(4,"button",27),t.bIt("click",function(){t.eBV(e);const n=t.XpG(7);return t.Njj(n.closeVirtualMetadataModal())}),t.j41(5,"span",28),t.EFF(6,"\xd7"),t.k0s()()(),t.j41(7,"div",29),t.DNE(8,Ii,1,2,"ds-listable-object-component-loader",19)(9,Ti,6,2,"div",30),t.nI1(10,"async"),t.k0s()()}if(2&s){const e=t.XpG().ngVar,i=t.XpG().$implicit;t.R7$(2),t.SpI(" ",t.bMT(3,3,"virtual-metadata.delete-item.modal-head")," "),t.R7$(6),t.Y8G("ngIf",e),t.R7$(),t.Y8G("ngForOf",t.bMT(10,5,i.virtualMetadata$))}}function Si(s,l){if(1&s){const e=t.RV6();t.qex(0),t.DNE(1,_i,1,2,"ds-listable-object-component-loader",19),t.j41(2,"div",20)(3,"div",21)(4,"button",22),t.bIt("click",function(){t.eBV(e);const n=t.sdS(7),a=t.XpG(6);return t.Njj(a.openVirtualMetadataModal(n))}),t.nrm(5,"i",23),t.k0s()()(),t.DNE(6,yi,11,7,"ng-template",null,0,t.C5r),t.bVm()}if(2&s){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e)}}function $i(s,l){if(1&s&&(t.j41(0,"div",13),t.DNE(1,Si,8,1,"ng-container",5),t.nI1(2,"async"),t.k0s()),2&s){const e=l.$implicit;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.relatedItem$))}}function Ri(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",13)(1,"div",14),t.bIt("click",function(){const n=t.eBV(e).ngVar,a=t.XpG().$implicit,o=t.XpG(3);return t.Njj(o.setSelected(a.relationshipType,!n))}),t.j41(2,"label"),t.nrm(3,"input",15),t.nI1(4,"async"),t.k0s()(),t.j41(5,"div",16)(6,"h5",17),t.bIt("click",function(){const n=t.eBV(e).ngVar,a=t.XpG().$implicit,o=t.XpG(3);return t.Njj(o.setSelected(a.relationshipType,!n))}),t.EFF(7),t.nI1(8,"async"),t.nI1(9,"translate"),t.k0s(),t.DNE(10,$i,3,3,"div",18),t.nI1(11,"async"),t.k0s()()}if(2&s){const e=l.ngVar,i=t.XpG().$implicit,n=t.XpG(3);t.R7$(3),t.Y8G("checked",e)("disabled",t.bMT(4,4,n.isDeleting$)),t.R7$(4),t.SpI(" ",t.bMT(9,8,n.getRelationshipMessageKey(t.bMT(8,6,i.label$)))," "),t.R7$(3),t.Y8G("ngForOf",t.bMT(11,10,i.relationshipDTOs$))}}function Ci(s,l){if(1&s&&(t.j41(0,"div",10),t.DNE(1,Ri,12,12,"div",12),t.nI1(2,"async"),t.k0s()),2&s){const e=l.$implicit;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.isSelected$))}}function Mi(s,l){if(1&s&&(t.j41(0,"div",10),t.EFF(1),t.nI1(2,"translate"),t.DNE(3,Ci,3,3,"div",11),t.k0s()),2&s){const e=t.XpG().ngVar;t.R7$(),t.SpI(" ",t.bMT(2,2,"virtual-metadata.delete-item.info")," "),t.R7$(2),t.Y8G("ngForOf",e)}}function Bi(s,l){if(1&s&&(t.qex(0),t.DNE(1,Mi,4,4,"div",9),t.bVm()),2&s){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e&&e.length>0)}}class Di{}class Fi{}let ji=(()=>{class s extends rt{constructor(e,i,n,a,o,d,_,C,x,K){super(e,i,n,a,o),this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.translateService=o,this.modalService=d,this.objectUpdatesService=_,this.relationshipService=C,this.entityTypeService=x,this.linkService=K,this.messageKey="delete",this.viewMode=Ht.n.ListElement,this.typeDTOs$=new I.t([]),this.relationships$=new Map,this.relatedItems$=new Map,this.virtualMetadata$=new Map,this.subs=[],this.isDeleting$=new I.t(!1)}ngOnInit(){super.ngOnInit(),this.url=this.router.url;const e=this.item.firstMetadataValue("dspace.entity.type");(0,p.hj)(e)&&this.subs.push(this.entityTypeService.getEntityTypeByLabel(e).pipe((0,m.yd)(),(0,m.Bo)(),(0,y.n)(i=>this.entityTypeService.getEntityTypeRelationships(i.id)),(0,m.yd)(),(0,m.Bo)(),(0,u.T)(i=>i.page),(0,y.n)(i=>0===i.length?(0,$.of)(i):(0,R.z)(i.map(n=>this.getRelationships(n))).pipe((0,u.T)(n=>i.reduce((a,o,d)=>a.some(_=>_.id===o.id)||0===n[d].length?a:[...a,o],[]))))).subscribe(i=>this.typeDTOs$.next(i.map(n=>Object.assign(new Di,{relationshipType:n,isSelected$:this.isSelected(n),label$:this.getLabel(n),relationshipDTOs$:this.getRelationships(n).pipe((0,u.T)(a=>a.map(o=>Object.assign(new Fi,{relationship:o,relatedItem$:this.getRelatedItem(o),virtualMetadata$:this.getVirtualMetadata(o)}))))}))))),this.subs.push(this.typeDTOs$.pipe((0,S.s)(1)).subscribe(i=>this.objectUpdatesService.initialize(this.url,i.map(n=>n.relationshipType),this.item.lastModified)))}openVirtualMetadataModal(e){this.modalRef=this.modalService.open(e)}closeVirtualMetadataModal(){this.modalRef.close()}getRelationshipMessageKey(e){return(0,p.a4)(e)&&e.indexOf("Of")>-1?`relationships.${e.substring(0,e.indexOf("Of")+2)}`:e}getLabel(e){return this.getRelationships(e).pipe((0,y.n)(i=>this.isLeftItem(i[0]).pipe((0,u.T)(n=>n?e.leftwardType:e.rightwardType))))}getRelationships(e){return this.relationships$.has(e)||this.relationships$.set(e,this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,y.n)(i=>(0,R.z)(i.map(n=>this.getRelationshipType(n))).pipe((0,jt.U)([]),(0,u.T)(n=>i.filter((a,o)=>e.id===n[o].id)))))),this.relationships$.get(e)}getRelationshipType(e){return this.linkService.resolveLinks(e,(0,k.s)("relationshipType"),(0,k.s)("leftItem",void 0,(0,k.s)("accessStatus")),(0,k.s)("rightItem",void 0,(0,k.s)("accessStatus"))),e.relationshipType.pipe((0,m.yd)(),(0,m.Bo)(),(0,f.p)(i=>(0,p.a4)(i)&&(0,p.hj)(i.uuid)))}getRelatedItem(e){return this.relatedItems$.has(e)||this.relatedItems$.set(e,this.isLeftItem(e).pipe((0,y.n)(i=>i?e.rightItem:e.leftItem),(0,m.yd)(),(0,m.Bo)())),this.relatedItems$.get(e)}getVirtualMetadata(e){return this.virtualMetadata$.has(e)||this.virtualMetadata$.set(e,this.getRelatedItem(e).pipe((0,u.T)(i=>Object.entries(i.metadata).map(([n,a])=>a.filter(o=>o.authority&&o.authority.endsWith(e.id)).map(o=>({metadataField:n,metadataValue:o}))).reduce((n,a)=>n.concat(a))))),this.virtualMetadata$.get(e)}isLeftItem(e){return e.leftItem.pipe((0,m.yd)(),(0,m.Bo)(),(0,f.p)(i=>(0,p.a4)(i)&&(0,p.hj)(i.uuid)),(0,u.T)(i=>i.uuid===this.item.uuid))}isSelected(e){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.item.uuid,e.uuid)}setSelected(e,i){!1===this.isDeleting$.value&&this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.item.uuid,e.uuid,i)}performAction(){this.isDeleting$.next(!0),this.subs.push(this.typeDTOs$.pipe((0,y.n)(e=>(0,R.z)(e.map(i=>i.isSelected$)).pipe((0,jt.U)([]),(0,u.T)(i=>e.filter((n,a)=>i[a])),(0,u.T)(i=>i.map(n=>n.relationshipType.id)))),(0,y.n)(e=>this.itemDataService.delete(this.item.id,e)),(0,m.qD)()).subscribe(e=>{this.notify(e.hasSucceeded)}))}notify(e){e?(this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([""])):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,V.$r)(this.item)]))}ngOnDestroy(){this.subs.filter(e=>(0,p.a4)(e)).forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(g.c$),t.rXU(T.Bq),t.rXU(A.F),t.rXU(_t.RelationshipDataService),t.rXU(Et.f),t.rXU(nt._))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-delete"]],inputs:{url:"url"},standalone:!0,features:[t.Vt3,t.aNF],decls:21,vars:28,consts:[["virtualMetadataModal",""],[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[4,"ngVar"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click","dsBtnDisabled"],[1,"btn","btn-outline-secondary","cancel",3,"dsBtnDisabled","routerLink"],["class","mb-4",4,"ngIf"],[1,"mb-4"],["class","mb-4",4,"ngFor","ngForOf"],["class","d-flex flex-row",4,"ngVar"],[1,"d-flex","flex-row"],[1,"m-2",3,"click"],["type","checkbox",3,"checked","disabled"],[1,"flex-column","flex-grow-1"],[3,"click"],["class","d-flex flex-row",4,"ngFor","ngForOf"],[3,"object","viewMode",4,"ngIf"],[1,"ml-auto"],[1,"btn-group"],[1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"fas","fa-info","fa-fw"],[3,"object","viewMode"],[1,"thumb-font-1"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(i,n){1&i&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",4),t.DNE(10,Bi,2,1,"ng-container",5),t.nI1(11,"async"),t.j41(12,"div",6)(13,"button",7),t.nI1(14,"async"),t.bIt("click",function(){return n.performAction()}),t.EFF(15),t.nI1(16,"translate"),t.k0s(),t.j41(17,"button",8),t.nI1(18,"async"),t.EFF(19),t.nI1(20,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,9,n.headerMessage,t.eq3(24,bi,n.item.handle))),t.R7$(3),t.JRh(t.bMT(8,12,n.descriptionMessage)),t.R7$(2),t.Y8G("item",n.item),t.R7$(),t.Y8G("ngVar",t.bMT(11,14,n.typeDTOs$)),t.R7$(3),t.Y8G("dsBtnDisabled",t.bMT(14,16,n.isDeleting$)),t.R7$(2),t.SpI("",t.bMT(16,18,n.confirmMessage)," "),t.R7$(2),t.Y8G("dsBtnDisabled",t.bMT(18,20,n.isDeleting$))("routerLink",t.eq3(26,vi,n.itemPageRoute)),t.R7$(2),t.SpI(" ",t.bMT(20,22,n.cancelMessage)," "))},dependencies:[g.h,g.D9,kt.v,h.bT,et.W,h.Jj,ot.r,h.Sq,v.Wk,q.A],encapsulation:2})}}return s})();var Ei=r(76052);const ki=s=>({id:s}),Oi=s=>({type:s}),Gi=s=>[s,"edit"];function Pi(s,l){1&s&&(t.EFF(0),t.nI1(1,"translate")),2&s&&t.SpI(" ",t.bMT(1,1,"item.edit.move.inheritpolicies.tooltip")," ")}function Ui(s,l){1&s&&(t.j41(0,"span"),t.nrm(1,"i",18),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&s&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"item.edit.move.save-button")," "))}function xi(s,l){1&s&&(t.j41(0,"span"),t.nrm(1,"i",19),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&s&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"item.edit.move.processing")," "))}let Vi=(()=>{class s{constructor(e,i,n,a,o,d,_,C){this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.searchService=o,this.translateService=d,this.requestService=_,this.dsoNameService=C,this.selectorType=Ft.W.COLLECTION,this.inheritPolicies=!1,this.canSubmit=!1,this.processing=!1,this.COLLECTIONS=[Ft.W.COLLECTION]}ngOnInit(){this.itemRD$=this.route.data.pipe((0,u.T)(e=>e.dso),(0,m.yd)()),this.itemPageRoute$=this.itemRD$.pipe((0,m.Hz)(),(0,u.T)(e=>(0,V._o)(e))),this.itemRD$.subscribe(e=>{this.item=e.payload}),this.itemRD$.pipe((0,m.yd)(),(0,m.Bo)(),(0,y.n)(e=>e.owningCollection),(0,m.yd)(),(0,m.Bo)()).subscribe(e=>{this.originalCollection=e})}selectDso(e){this.selectedCollection=e,this.selectedCollectionName=this.dsoNameService.getName(e),this.canSubmit=!0}getCurrentUrl(){return this.router.url}moveToCollection(){this.processing=!0;const e=this.itemDataService.moveToCollection(this.item.id,this.selectedCollection,this.inheritPolicies).pipe((0,m.qD)());e.subscribe(i=>{i.hasSucceeded?this.notificationsService.success(this.translateService.get("item.edit.move.success")):this.notificationsService.error(this.translateService.get("item.edit.move.error"))}),e.pipe((0,y.n)(()=>this.requestService.setStaleByHrefSubstring(this.item.id)),(0,y.n)(()=>this.itemDataService.findById(this.item.id,!1,!0,(0,k.s)("owningCollection"))),(0,m.qD)()).subscribe(()=>{this.processing=!1,this.router.navigate([(0,V.$r)(this.item)])})}discard(){this.selectedCollection=null,this.canSubmit=!1}get canMove(){return this.canSubmit&&this.selectedCollection?.id!==this.originalCollection.id}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(Wt.S),t.rXU(g.c$),t.rXU(ct.B),t.rXU(z.f))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-move"]],standalone:!0,features:[t.aNF],decls:46,vars:44,consts:[["tooltipContent",""],[1,"container"],[1,"row"],[1,"col-12"],[1,"card","mb-3"],[1,"card-header"],[1,"card-body"],[3,"onSelect","types","currentDSOId"],["for","inheritPoliciesCheckbox"],["type","checkbox","name","tc","id","inheritPoliciesCheckbox",3,"ngModelChange","ngModel","ngbTooltip"],[1,"button-row","bottom"],[1,"float-right","space-children-mr"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"],[4,"ngIf"],[1,"btn","btn-danger",3,"click","dsBtnDisabled"],[1,"fas","fa-times"],[1,"fas","fa-save"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(i,n){if(1&i){const a=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1"),t.EFF(4),t.nI1(5,"async"),t.nI1(6,"translate"),t.k0s(),t.j41(7,"p"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",2)(11,"div",3)(12,"div",4)(13,"div",5),t.EFF(14),t.nI1(15,"translate"),t.nI1(16,"translate"),t.k0s(),t.j41(17,"div",6)(18,"ds-authorized-collection-selector",7),t.bIt("onSelect",function(d){return t.eBV(a),t.Njj(n.selectDso(d))}),t.k0s()(),t.nrm(19,"div"),t.k0s()()(),t.j41(20,"div",2)(21,"div",3)(22,"p")(23,"label",8),t.DNE(24,Pi,2,3,"ng-template",null,0,t.C5r),t.j41(26,"input",9),t.mxI("ngModelChange",function(d){return t.eBV(a),t.DH7(n.inheritPolicies,d)||(n.inheritPolicies=d),t.Njj(d)}),t.k0s(),t.EFF(27),t.nI1(28,"translate"),t.k0s()(),t.j41(29,"p"),t.EFF(30),t.nI1(31,"translate"),t.k0s()()(),t.j41(32,"div",10)(33,"div",11)(34,"button",12),t.nI1(35,"async"),t.nrm(36,"i",13),t.EFF(37),t.nI1(38,"translate"),t.k0s(),t.j41(39,"button",14),t.bIt("click",function(){return t.eBV(a),t.Njj(n.moveToCollection())}),t.DNE(40,Ui,4,3,"span",15)(41,xi,4,3,"span",15),t.k0s(),t.j41(42,"button",16),t.bIt("click",function(){return t.eBV(a),t.Njj(n.discard())}),t.nrm(43,"i",17),t.EFF(44),t.nI1(45,"translate"),t.k0s()()()()()()}if(2&i){let a;const o=t.sdS(25);t.R7$(4),t.JRh(t.i5U(6,18,"item.edit.move.head",t.eq3(38,ki,null==(a=t.bMT(5,16,n.itemRD$))||null==a.payload?null:a.payload.handle))),t.R7$(4),t.JRh(t.bMT(9,21,"item.edit.move.description")),t.R7$(6),t.JRh(t.i5U(16,25,"dso-selector.placeholder",t.eq3(40,Oi,t.bMT(15,23,"dso-selector.placeholder.type.collection")))),t.R7$(4),t.Y8G("types",n.COLLECTIONS)("currentDSOId",n.selectedCollection?n.selectedCollection.id:n.originalCollection.id),t.R7$(8),t.R50("ngModel",n.inheritPolicies),t.Y8G("ngbTooltip",o),t.R7$(),t.SpI(" ",t.bMT(28,28,"item.edit.move.inheritpolicies.checkbox")," "),t.R7$(3),t.SpI(" ",t.bMT(31,30,"item.edit.move.inheritpolicies.description")," "),t.R7$(4),t.Y8G("routerLink",t.eq3(42,Gi,t.bMT(35,32,n.itemPageRoute$))),t.R7$(3),t.SpI(" ",t.bMT(38,34,"item.edit.move.cancel")," "),t.R7$(2),t.Y8G("dsBtnDisabled",!n.canMove),t.R7$(),t.Y8G("ngIf",!n.processing),t.R7$(),t.Y8G("ngIf",n.processing),t.R7$(),t.Y8G("dsBtnDisabled",!n.canSubmit),t.R7$(2),t.SpI(" ",t.bMT(45,36,"item.edit.move.discard-button")," ")}},dependencies:[g.h,g.D9,T.UN,T.md,tt.YN,tt.Zm,tt.BC,tt.vS,v.Wk,h.Jj,Ei.e,h.bT,q.A],encapsulation:2})}}return s})();var U=r(6056),D=r(3970),O=r(35925);const Xi=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.AdministratorOf)),Ni=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanManageBitstreamBundles)),wi=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanManageMappings)),Li=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.AdministratorOf)),Yi=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanDelete)),zi=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanManagePolicies)),Ai=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanEditMetadata)),Wi=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanMove)),Ki=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanMakePrivate)),Hi=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanRegisterDOI)),Ji=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.ReinstateItem)),Qi=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanManageRelationships)),qi=(0,r(17024).FO)(()=>O.Z,()=>(0,$.of)([D._.CanManageMappings,D._.WithdrawItem,D._.ReinstateItem,D._.CanManagePolicies,D._.CanMakePrivate,D._.CanDelete,D._.CanMove,D._.CanRegisterDOI])),tn=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.CanManageVersions)),en=(0,U.L)(()=>O.Z,()=>(0,$.of)(D._.WithdrawItem)),nn=s=>({id:s}),sn=s=>[s,"edit"];let an=(()=>{class s extends rt{constructor(e,i,n,a,o){super(e,i,n,a,o),this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.translateService=o,this.messageKey="private",this.predicate=d=>!d.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!1).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(g.c$))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-private"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return n.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,n.headerMessage,t.eq3(15,nn,n.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,n.descriptionMessage)),t.R7$(2),t.Y8G("item",n.item),t.R7$(3),t.SpI("",t.bMT(13,11,n.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,sn,n.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,n.cancelMessage)," "))},dependencies:[et.W,g.h,g.D9,v.Wk],encapsulation:2})}}return s})();const on=s=>({id:s}),rn=s=>[s,"edit"];let ln=(()=>{class s extends rt{constructor(e,i,n,a,o){super(e,i,n,a,o),this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.translateService=o,this.messageKey="public",this.predicate=d=>d.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!0).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(g.c$))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-public"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return n.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,n.headerMessage,t.eq3(15,on,n.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,n.descriptionMessage)),t.R7$(2),t.Y8G("item",n.item),t.R7$(3),t.SpI("",t.bMT(13,11,n.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,rn,n.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,n.cancelMessage)," "))},dependencies:[et.W,g.h,g.D9,v.Wk],encapsulation:2})}}return s})();var cn=r(90378);const dn=s=>({id:s}),mn=s=>[s,"edit"];function pn(s,l){if(1&s&&(t.j41(0,"div")(1,"p",10),t.EFF(2),t.nI1(3,"translate"),t.nI1(4,"translate"),t.k0s()()),2&s){const e=t.XpG().$implicit,i=t.XpG();t.R7$(2),t.E5c("",t.bMT(3,3,i.doiToUpdateMessage),": ",e.value," (",t.bMT(4,5,"item.edit.identifiers.doi.status."+e.identifierStatus),") ")}}function un(s,l){if(1&s&&(t.j41(0,"div",8),t.DNE(1,pn,5,7,"div",9),t.k0s()),2&s){const e=l.$implicit;t.R7$(),t.Y8G("ngIf","doi"===e.identifierType)}}let hn=(()=>{class s extends rt{constructor(e,i,n,a,o,d){super(e,i,n,a,o),this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.translateService=o,this.identifierDataService=d,this.messageKey="register-doi",this.doiToUpdateMessage="item.edit."+this.messageKey+".to-update",this.processing=!1}ngOnInit(){this.itemRD$=this.route.data.pipe((0,u.T)(e=>e.dso),(0,m.yd)()),this.itemRD$.pipe((0,E.$)()).subscribe(e=>{this.item=e.payload,this.itemPageRoute=(0,V._o)(this.item),this.identifiers$=this.identifierDataService.getIdentifierDataFor(this.item).pipe((0,u.T)(i=>401!==i.statusCode&&(0,p.a4)(i.payload)?i.payload.identifiers:null))}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){this.registerDoi()}registerDoi(){this.processing=!0,this.identifierDataService.registerIdentifier(this.item,"doi").subscribe(e=>{e.hasCompleted&&(this.processing=!1,this.processRestResponse(e))})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(g.c$),t.rXU(cn.IdentifierDataService))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-register-doi"]],standalone:!0,features:[t.Vt3,t.aNF],decls:19,vars:22,consts:[[1,"container"],[1,"row"],[1,"col-12"],["class","w-100 p",4,"ngFor","ngForOf"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"],[1,"w-100","p"],[4,"ngIf"],[1,"float-left"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.DNE(9,un,2,1,"div",3),t.nI1(10,"async"),t.nrm(11,"ds-modify-item-overview",4),t.j41(12,"div",5)(13,"button",6),t.bIt("click",function(){return n.performAction()}),t.EFF(14),t.nI1(15,"translate"),t.k0s(),t.j41(16,"button",7),t.EFF(17),t.nI1(18,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,7,n.headerMessage,t.eq3(18,dn,n.item.handle))),t.R7$(3),t.JRh(t.bMT(8,10,n.descriptionMessage)),t.R7$(2),t.Y8G("ngForOf",t.bMT(10,12,n.identifiers$)),t.R7$(2),t.Y8G("item",n.item),t.R7$(3),t.SpI("",t.bMT(15,14,n.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(20,mn,n.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(18,16,n.cancelMessage)," "))},dependencies:[et.W,v.Wk,g.h,g.D9,h.Jj,h.bT,h.Sq],encapsulation:2})}}return s})();const gn=s=>({id:s}),fn=s=>[s,"edit"];let bn=(()=>{class s extends rt{constructor(e,i,n,a,o){super(e,i,n,a,o),this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.translateService=o,this.messageKey="reinstate",this.predicate=d=>!d.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!1).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(g.c$))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-reinstate"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return n.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,n.headerMessage,t.eq3(15,gn,n.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,n.descriptionMessage)),t.R7$(2),t.Y8G("item",n.item),t.R7$(3),t.SpI("",t.bMT(13,11,n.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,fn,n.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,n.cancelMessage)," "))},dependencies:[et.W,g.h,g.D9,v.Wk],encapsulation:2})}}return s})();var vn=r(23294),_n=r(38096),In=r(46588),Jt=r(983),Qt=r(70274),Ot=r(56594);let Gt=(()=>{class s{constructor(e,i,n,a,o,d,_){this.itemService=e,this.objectUpdatesService=i,this.notificationsService=n,this.modalService=a,this.relationshipService=o,this.entityTypeService=d,this.translateService=_,this.notificationsPrefix="item.edit.relationships.notifications.",this.isSaving$=new I.t(!1)}submit(e,i){this.isSaving$.next(!0),this.objectUpdatesService.getFieldUpdates(i,[],!0).pipe((0,u.T)(n=>Object.values(n).filter(a=>(0,p.a4)(a)).filter(a=>a.changeType===P.B.ADD||a.changeType===P.B.REMOVE)),(0,S.s)(1),(0,y.n)(n=>n),(0,Qt.H)(n=>n.changeType===P.B.REMOVE?this.deleteRelationship(n.field).pipe((0,S.s)(1),(0,y.n)(a=>a.hasSucceeded?this.itemService.invalidateByHref(n.field.relatedItem._links.self.href).pipe((0,u.T)(()=>a)):[a])):n.changeType===P.B.ADD?this.addRelationship(n.field).pipe((0,S.s)(1),(0,y.n)(a=>{if(a.hasSucceeded){const{leftItem:o,rightItem:d}=a.payload._links;return o.href===e.self?this.itemService.invalidateByHref(d.href).pipe((0,u.T)(()=>a)):this.itemService.invalidateByHref(o.href).pipe((0,u.T)(()=>a))}return[a]})):Jt.w),(0,Ot.$)(),(0,y.n)(n=>this.itemService.invalidateByHref(e.self).pipe((0,u.T)(()=>n)))).subscribe(n=>{n.length>0&&(this.initializeOriginalFields(e,i),this.displayNotifications(n),this.modalService.dismissAll(),this.isSaving$.next(!1))})}initializeOriginalFields(e,i){return this.relationshipService.getRelatedItems(e).pipe((0,S.s)(1)).subscribe(n=>{this.objectUpdatesService.initialize(i,n,e.lastModified)})}deleteRelationship(e){let i;return i=e.keepLeftVirtualMetadata&&e.keepRightVirtualMetadata?"all":e.keepLeftVirtualMetadata?"left":e.keepRightVirtualMetadata?"right":"none",this.relationshipService.deleteRelationship(e.uuid,i,!1)}addRelationship(e){let i,n,a,o;return e.originalIsLeft?(i=e.originalItem,n=e.relatedItem,a=null,o=e.nameVariant):(i=e.relatedItem,n=e.originalItem,a=e.nameVariant,o=null),this.relationshipService.addRelationship(e.type.id,i,n,a,o,!1)}displayNotifications(e){const i=e.filter(a=>a.hasFailed),n=e.filter(a=>a.hasSucceeded);i.forEach(a=>{this.notificationsService.error(this.getNotificationTitle("failed"),a.errorMessage)}),n.length>0&&this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved"))}isProvidedItemTypeLeftType(e,i,n){return this.getRelationshipLeftAndRightType(e).pipe((0,u.T)(([a,o])=>a.id===i.id||o.id!==i.id&&void console.warn(`The item ${n.uuid} is not on the right or the left side of relationship type ${e.uuid}`)))}shouldDisplayBothRelationshipSides(e,i){return this.getRelationshipLeftAndRightType(e).pipe((0,u.T)(([n,a])=>n.id===i.id&&a.id===i.id&&e.leftwardType!==e.rightwardType))}getRelationshipLeftAndRightType(e){const i=e.leftType.pipe((0,m.yd)(),(0,m.Bo)()),n=e.rightType.pipe((0,m.yd)(),(0,m.Bo)());return(0,R.z)([i,n])}getNotificationTitle(e){return this.translateService.instant(this.notificationsPrefix+e+".title")}getNotificationContent(e){return this.translateService.instant(this.notificationsPrefix+e+".content")}static{this.\u0275fac=function(i){return new(i||s)(t.KVO(X.ItemDataService),t.KVO(A.F),t.KVO(G.I),t.KVO(T.Bq),t.KVO(_t.RelationshipDataService),t.KVO(Et.f),t.KVO(g.c$))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();r(23881),r(59854);var Zt=r(22806),qt=r(82640),Tn=r(53954),yn=r(6011),Sn=r(56568),$n=r(13329),Rn=r(49656);function Cn(s,l){if(1&s&&(t.j41(0,"div")(1,"div",16),t.EFF(2),t.k0s(),t.j41(3,"div"),t.EFF(4),t.k0s()()),2&s){const e=l.$implicit;t.R7$(2),t.SpI(" ",e.metadataField," "),t.R7$(2),t.SpI(" ",e.metadataValue.value," ")}}function Mn(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",10),t.bIt("click",function(){const n=t.eBV(e).ngVar,a=t.XpG().$implicit,o=t.XpG();return t.Njj(o.setSelectedVirtualMetadataItem(a.item,!n))}),t.j41(1,"div",11)(2,"label"),t.nrm(3,"input",12),t.k0s()(),t.j41(4,"div",13),t.nrm(5,"ds-listable-object-component-loader",14),t.DNE(6,Cn,5,2,"div",15),t.k0s()()}if(2&s){const e=l.ngVar,i=t.XpG().$implicit,n=t.XpG();t.R7$(3),t.Y8G("checked",e),t.R7$(2),t.Y8G("object",i.item),t.R7$(),t.Y8G("ngForOf",n.virtualMetadata.get(i.item.uuid))}}function Bn(s,l){if(1&s&&(t.qex(0),t.DNE(1,Mn,7,3,"div",9),t.nI1(2,"async"),t.bVm()),2&s){const e=l.$implicit;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.isSelectedVirtualMetadataItem$))}}let Dn=(()=>{class s{constructor(e,i){this.objectUpdatesService=e,this.appConfig=i,this.close=new t.bkB,this.save=new t.bkB,this.itemDTOs$=new I.t([]),this.subs=[],this.virtualMetadata=new Map,this.showThumbnails=this.appConfig.browseBy.showThumbnails}getVirtualMetadata(e){return Object.entries(e.metadata).map(([i,n])=>n.filter(a=>!i.startsWith("relation")&&a.authority&&a.authority.endsWith(this.relationshipId)).map(a=>({metadataField:i,metadataValue:a}))).reduce((i,n)=>i.concat(n),[])}setSelectedVirtualMetadataItem(e,i){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.relationshipId,e.uuid,i)}isSelectedVirtualMetadataItem(e){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationshipId,e.uuid)}trackItemDTO(e,i){return i?.item?.uuid}ngOnInit(){this.subs.push(this.itemDTOs$.subscribe(e=>{e.forEach(i=>this.virtualMetadata.set(i.item.uuid,this.getVirtualMetadata(i.item)))}))}ngOnChanges(){(0,p.a4)(this.leftItem)&&(0,p.a4)(this.rightItem)&&this.itemDTOs$.next([{item:this.leftItem,isSelectedVirtualMetadataItem$:this.isSelectedVirtualMetadataItem(this.leftItem)},{item:this.rightItem,isSelectedVirtualMetadataItem$:this.isSelectedVirtualMetadataItem(this.rightItem)}])}ngOnDestroy(){this.subs.forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(A.F),t.rXU(qt.vQ))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-virtual-metadata"]],inputs:{url:"url",relationshipId:"relationshipId",leftItem:"leftItem",rightItem:"rightItem"},outputs:{close:"close",save:"save"},standalone:!0,features:[t.OA$,t.aNF],decls:15,vars:11,consts:[[3,"ngClass"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","flex-row-reverse","m-2"],[1,"btn","btn-primary","save",3,"click"],["aria-hidden","true",1,"fas","fa-save"],["class","item d-flex flex-row",3,"click",4,"ngVar"],[1,"item","d-flex","flex-row",3,"click"],[1,"m-2"],["type","checkbox",1,"select",3,"checked"],[1,"flex-column"],[3,"object"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2),t.nI1(3,"translate"),t.j41(4,"button",2),t.bIt("click",function(){return n.close.emit()}),t.j41(5,"span",3),t.EFF(6,"\xd7"),t.k0s()()(),t.j41(7,"div",4),t.DNE(8,Bn,3,3,"ng-container",5),t.nI1(9,"async"),t.j41(10,"div",6)(11,"button",7),t.bIt("click",function(){return n.save.emit()}),t.nrm(12,"i",8),t.EFF(13),t.nI1(14,"translate"),t.k0s()()()()),2&i&&(t.Y8G("ngClass",n.showThumbnails?"hide-modal-thumbnail-column":""),t.R7$(2),t.SpI("",t.bMT(3,5,"virtual-metadata.delete-relationship.modal-head")," "),t.R7$(6),t.Y8G("ngForOf",t.bMT(9,7,n.itemDTOs$))("ngForTrackBy",n.trackItemDTO),t.R7$(5),t.SpI(" ",t.bMT(14,9,"item.edit.metadata.save-button")," "))},dependencies:[h.YU,g.h,g.D9,h.Sq,ot.r,h.Jj,kt.v],encapsulation:2})}}return s})();function Fn(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",2)(1,"div",3),t.nrm(2,"ds-listable-object-component-loader",4),t.nI1(3,"async"),t.k0s(),t.j41(4,"div",5)(5,"div",6)(6,"button",7),t.nI1(7,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG(),a=t.sdS(3);return t.Njj(n.openVirtualMetadataModal(a))}),t.nrm(8,"i",8),t.k0s(),t.j41(9,"button",9),t.nI1(10,"translate"),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.undo())}),t.nrm(11,"i",10),t.k0s()()()()}if(2&s){const e=t.XpG();t.R7$(2),t.Y8G("object",t.bMT(3,7,e.relatedItem$))("viewMode",e.viewMode)("value",e.nameVariant),t.R7$(4),t.FS9("title",t.bMT(7,9,"item.edit.metadata.edit.buttons.remove")),t.Y8G("dsBtnDisabled",!e.canRemove()),t.R7$(3),t.FS9("title",t.bMT(10,11,"item.edit.metadata.edit.buttons.undo")),t.Y8G("dsBtnDisabled",!e.canUndo())}}function jn(s,l){if(1&s){const e=t.RV6();t.j41(0,"ds-virtual-metadata",11),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("close",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeVirtualMetadataModal())})("save",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.remove())}),t.k0s()}if(2&s){const e=t.XpG();t.Y8G("relationshipId",e.relationship.id)("leftItem",t.bMT(1,4,e.leftItem$))("rightItem",t.bMT(2,6,e.rightItem$))("url",e.url)}}let En=(()=>{class s{get relationship(){return this.update.relationship}get update(){return this.fieldUpdate.field}get nameVariant(){return this.update.nameVariant}constructor(e,i){this.objectUpdatesService=e,this.modalService=i,this.relatedItem$=new I.t(null),this.viewMode=Ht.n.ListElement}ngOnChanges(){this.relationship&&(this.relationship.leftItem||this.relationship.rightItem)?(this.leftItem$=this.relationship.leftItem.pipe((0,m.yd)(),(0,m.Bo)(),(0,f.p)(e=>(0,p.a4)(e)&&(0,p.hj)(e.uuid))),this.rightItem$=this.relationship.rightItem.pipe((0,m.yd)(),(0,m.Bo)(),(0,f.p)(e=>(0,p.a4)(e)&&(0,p.hj)(e.uuid))),(0,R.z)([this.leftItem$,this.rightItem$]).pipe((0,u.T)(([e,i])=>e.uuid===this.editItem.uuid?i:e),(0,S.s)(1)).subscribe(e=>{this.relatedItem$.next(e)})):this.relatedItem$.next(this.update.relatedItem)}remove(){this.closeVirtualMetadataModal(),(0,R.z)([this.leftItem$,this.rightItem$]).pipe((0,u.T)(e=>e.map(i=>this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationship.id,i.uuid))),(0,y.n)(e=>(0,R.z)(e)),(0,u.T)(e=>Object.assign({},this.fieldUpdate.field,{keepLeftVirtualMetadata:!0===e[0],keepRightVirtualMetadata:!0===e[1]})),(0,S.s)(1)).subscribe(e=>{this.objectUpdatesService.saveRemoveFieldUpdate(this.url,e)})}openVirtualMetadataModal(e){this.modalRef=this.modalService.open(e)}closeVirtualMetadataModal(){this.modalRef.close()}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.url,this.fieldUpdate.field.uuid)}canRemove(){return this.fieldUpdate.changeType!==P.B.REMOVE&&this.fieldUpdate.changeType!==P.B.ADD}canUndo(){return this.fieldUpdate.changeType?.valueOf()>=0}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(A.F),t.rXU(T.Bq))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-edit-relationship"]],inputs:{fieldUpdate:"fieldUpdate",url:"url",editItem:"editItem"},standalone:!0,features:[t.OA$,t.aNF],decls:4,vars:3,consts:[["virtualMetadataModal",""],["class","row",4,"ngIf"],[1,"row"],[1,"col-10","relationship"],[3,"object","viewMode","value"],[1,"col-2"],[1,"btn-group","relationship-action-buttons"],[1,"btn","btn-outline-danger","btn-sm",3,"click","dsBtnDisabled","title"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"click","dsBtnDisabled","title"],[1,"fas","fa-undo-alt","fa-fw"],[3,"close","save","relationshipId","leftItem","rightItem","url"]],template:function(i,n){1&i&&(t.DNE(0,Fn,12,13,"div",1),t.nI1(1,"async"),t.DNE(2,jn,3,8,"ng-template",null,0,t.C5r)),2&i&&t.Y8G("ngIf",t.bMT(1,1,n.relatedItem$))},dependencies:[kt.v,h.Jj,h.bT,g.h,g.D9,Dn,q.A],styles:[".btn[disabled][_ngcontent-%COMP%]{color:var(--bs-gray-600);border-color:var(--bs-gray-600);z-index:0}.relationship-action-buttons[_ngcontent-%COMP%]{margin:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}"]})}}return s})();const kn=()=>({}),On=(s,l,e)=>({"alert-success":s,"alert-warning":l,"alert-danger":e});function Gn(s,l){if(1&s&&t.nrm(0,"ds-edit-relationship",9),2&s){const e=l.$implicit,i=t.XpG(4);t.Y8G("fieldUpdate",e||t.lJ4(4,kn))("url",i.url)("editItem",i.item)("ngClass",t.sMw(5,On,1===e.changeType,0===e.changeType,2===e.changeType))}}function Pn(s,l){1&s&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.JRh(t.bMT(2,1,"item.edit.relationships.no-relationships")))}function Un(s,l){if(1&s&&(t.qex(0),t.j41(1,"ds-pagination",6),t.nI1(2,"async"),t.nI1(3,"async"),t.j41(4,"div",7),t.DNE(5,Gn,1,9,"ds-edit-relationship",8),t.k0s()(),t.DNE(6,Pn,3,3,"div",5),t.bVm()),2&s){let e;const i=l.ngVar,n=t.XpG(3);t.R7$(),t.Y8G("paginationOptions",n.paginationConfig)("collectionSize",(null==(e=t.bMT(2,7,n.relationshipsRd$))||null==e.payload?null:e.payload.totalElements)+t.bMT(3,9,n.nbAddedFields$))("hideGear",!0)("hidePagerWhenSinglePage",!0),t.R7$(4),t.Y8G("ngForOf",i)("ngForTrackBy",n.trackUpdate),t.R7$(),t.Y8G("ngIf",0===i.length)}}function xn(s,l){if(1&s&&(t.qex(0),t.DNE(1,Un,7,11,"ng-container",4),t.nI1(2,"dsObjectValues"),t.bVm()),2&s){const e=t.XpG().ngVar;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e))}}function Vn(s,l){1&s&&t.nrm(0,"ds-loading")}function Xn(s,l){if(1&s&&(t.qex(0),t.DNE(1,xn,3,3,"ng-container",5),t.nI1(2,"async"),t.DNE(3,Vn,1,0,"ds-loading",5),t.nI1(4,"async"),t.bVm()),2&s){const e=l.ngVar,i=t.XpG();t.R7$(),t.Y8G("ngIf",e&&!0!==t.bMT(2,2,i.loading$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,4,i.loading$))}}let Nn=(()=>{class s{constructor(e,i,n,a,o,d,_,C){this.objectUpdatesService=e,this.linkService=i,this.relationshipService=n,this.modalService=a,this.paginationService=o,this.selectableListService=d,this.editItemRelationshipsService=_,this.appConfig=C,this.submitModal=new t.bkB,this.currentItemIsLeftItem$=new I.t(void 0),this.updates$=new I.t(void 0),this.relationshipsRd$=new I.t(void 0),this.isLastPage$=new I.t(!0),this.loading$=new I.t(!0),this.nbAddedFields$=new I.t(0),this.subs=[],this.fetchThumbnail=this.appConfig.browseBy.showThumbnails}getRelationshipMessageKey(){return(0,R.z)([this.getLabel(),this.relatedEntityType$]).pipe((0,u.T)(([e,i])=>{if((0,p.a4)(e)&&e.indexOf("is")>-1&&e.indexOf("Of")>-1){const n=`${e.substring(2,e.indexOf("Of"))}`;return n!==i.label?`relationships.is${n}Of.${i.label}`:`relationships.is${n}Of`}return e}))}getLabel(){return this.currentItemIsLeftItem$.pipe((0,u.T)(e=>e?this.relationshipType.leftwardType:this.relationshipType.rightwardType))}trackUpdate(e,i){return i&&i.field?i.field.uuid:void 0}isRepeatable(){if(this.currentItemIsLeftItem$.getValue()){const i=this.relationshipType.leftMaxCardinality;return(0,p.Tn)(i)||i>1}{const i=this.relationshipType.rightMaxCardinality;return(0,p.Tn)(i)||i>1}}openLookup(){this.modalRef=this.modalService.open(yn.d,{size:"lg"});const e=this.modalRef.componentInstance;e.repeatable=!0,e.isEditRelationship=!0,e.listId=this.listId,e.item=this.item,e.relationshipType=this.relationshipType,e.currentItemIsLeftItem$=this.currentItemIsLeftItem$,e.toAdd=[],e.toRemove=[],e.isPending=!1,e.repeatable=this.isRepeatable(),e.hiddenQuery="-search.resourceid:"+this.item.uuid,this.item.owningCollection.pipe((0,m.ak)()).subscribe(i=>{e.collection=i}),e.select=(...i)=>{i.forEach(n=>{const a=n.indexableObject,o=e.toRemove.findIndex(d=>d.indexableObject.uuid===a.uuid);-1!==o?e.toRemove.splice(o,1):this.getRelationFromId(a).subscribe(d=>{if(d){const _=e.toRemove.findIndex(C=>C.indexableObject.uuid===a.uuid);-1!==_&&e.toRemove.splice(_,1)}else e.toAdd.push(n);this.loading$.next((0,p.hj)(e.toAdd)||(0,p.hj)(e.toRemove)),this.relationshipsRd$.next(this.relationshipsRd$.getValue())})})},e.deselect=(...i)=>{i.forEach(n=>{const a=n.indexableObject,o=e.toAdd.findIndex(d=>d.indexableObject.uuid===a.uuid);-1!==o?e.toAdd.splice(o,1):e.toRemove.push(n),this.loading$.next((0,p.hj)(e.toAdd)||(0,p.hj)(e.toRemove))})},e.submitEv=()=>{e.isPending=!0;const i=this.currentItemIsLeftItem$.getValue(),n=e.toAdd.map(o=>({type:"add",searchResult:o})),a=e.toRemove.map(o=>({type:"remove",searchResult:o}));(0,Zt.H)([...n,...a]).pipe((0,Qt.H)(({type:o,searchResult:d})=>{const _=d.indexableObject;return"add"===o?this.relationshipService.getNameVariant(this.listId,_.uuid).pipe((0,y.n)(C=>this.objectUpdatesService.saveAddFieldUpdate(this.url,{uuid:`${this.relationshipType.id}-${_.uuid}`,nameVariant:C,type:this.relationshipType,originalIsLeft:i,originalItem:this.item,relatedItem:_})),(0,S.s)(1)):"remove"===o?this.relationshipService.getNameVariant(this.listId,_.uuid).pipe((0,y.n)(C=>this.getRelationFromId(d.indexableObject).pipe((0,u.T)(x=>this.objectUpdatesService.saveRemoveFieldUpdate(this.url,{uuid:x.id,nameVariant:C,type:this.relationshipType,originalIsLeft:i,originalItem:this.item,relatedItem:_,relationship:x})))),(0,S.s)(1)):Jt.w}),(0,Ot.$)()).subscribe({complete:()=>{this.editItemRelationshipsService.submit(this.item,this.url),this.submitModal.emit()}})},e.discardEv=()=>{e.toAdd.forEach(i=>{this.selectableListService.deselectSingle(this.listId,i)}),e.toRemove.forEach(i=>{this.selectableListService.selectSingle(this.listId,i)}),e.toAdd=[],e.toRemove=[],this.loading$.next(!1)},e.closeEv=()=>{this.loading$.next(!1)},this.relatedEntityType$.pipe((0,S.s)(1)).subscribe(i=>{e.relationshipOptions=Object.assign(new Sn.j,{relationshipType:i.label,searchConfiguration:i.label.toLowerCase(),nameVariants:"true"})}),this.selectableListService.deselectAll(this.listId)}getRelationFromId(e){const i=this.currentItemIsLeftItem$.getValue()?this.relationshipType.leftwardType:this.relationshipType.rightwardType;return this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,i,[e.id]).pipe((0,m.yd)(),(0,m.Bo)(),(0,u.T)(n=>n.page[0]))}ngOnInit(){this.relationshipLeftAndRightType$=(0,R.z)([this.relationshipType.leftType,this.relationshipType.rightType].map(n=>n.pipe((0,m.yd)(),(0,m.Bo)()))),this.relatedEntityType$=this.relationshipLeftAndRightType$.pipe((0,u.T)(([n,a])=>n.uuid!==this.itemType.uuid?n:a),(0,p.Az)()),this.relatedEntityType$.pipe((0,S.s)(1)).subscribe(n=>this.listId=`edit-relationship-${this.itemType.id}-${n.id}`),this.relationshipMessageKey$=this.getRelationshipMessageKey(),this.paginationConfig=new dt.W,this.paginationConfig.id=`er${this.relationshipType.id}`,this.paginationConfig.pageSize=5,this.paginationConfig.currentPage=1;const e=this.paginationService.getCurrentPagination(this.paginationConfig.id,this.paginationConfig).pipe((0,at.M)(()=>this.loading$.next(!0))),i=(0,Rn.nW)(this.fetchThumbnail,this.appConfig.item.showAccessStatuses);this.subs.push((0,R.z)([e,this.currentItemIsLeftItem$,this.relatedEntityType$]).pipe((0,y.n)(([n,a,o])=>this.relationshipService.getItemRelationshipsByLabel(this.item,a?this.relationshipType.leftwardType:this.relationshipType.rightwardType,{elementsPerPage:n.pageSize,currentPage:n.currentPage,searchParams:[new Tn.x("relatedEntityType",o.label)]},!0,!0,...i)),(0,at.M)(n=>{this.relationshipsRd$.next(n)}),(0,m.v7)(),(0,m.Bo)()).subscribe(n=>{this.objectUpdatesService.initialize(this.url,n.page,new Date)})),this.subs.push(this.relationshipsRd$.pipe((0,p.Az)(),(0,m.v7)()).subscribe(n=>{this.isLastPage$.next((0,p.Tn)(n.payload._links.next))})),this.subs.push(this.relationshipsRd$.pipe((0,p.Az)(),(0,m.v7)(),(0,y.n)(n=>(0,Zt.H)(n.payload.page).pipe((0,F.Z)(a=>this.relationshipService.isLeftItem(a,this.item).pipe((0,y.n)(o=>o?a.rightItem.pipe((0,m.qD)(),(0,m.Bo)(),(0,u.T)(d=>[a,o,d])):a.leftItem.pipe((0,m.qD)(),(0,m.Bo)(),(0,u.T)(d=>[a,o,d]))))),(0,u.T)(([a,o,d])=>({uuid:a.id,type:this.relationshipType,relationship:a,originalIsLeft:o,originalItem:this.item,relatedItem:d,nameVariant:o?a.rightwardValue:a.leftwardValue})),(0,Ot.$)(),(0,jt.U)([]))),(0,y.n)(n=>this.objectUpdatesService.getFieldUpdates(this.url,n).pipe((0,u.T)(a=>{const o={};return this.nbAddedFields$.next(0),Object.keys(a).forEach(d=>{(0,p.a4)(a[d])&&a[d].field.type.id===this.relationshipType.id&&(a[d].changeType===P.B.ADD?(this.nbAddedFields$.next(this.nbAddedFields$.getValue()+1),!0===this.isLastPage$.getValue()&&(o[d]=a[d])):o[d]=a[d])}),o}))),(0,At.Z)({})).subscribe(n=>{this.loading$.next(!1),this.updates$.next(n)}))}ngOnDestroy(){this.subs.filter(e=>(0,p.a4)(e)).forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(A.F),t.rXU(nt._),t.rXU(_t.RelationshipDataService),t.rXU(T.Bq),t.rXU(Yt.m),t.rXU($n.K),t.rXU(Gt),t.rXU(qt.vQ))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-edit-relationship-list"]],inputs:{item:"item",itemType:"itemType",url:"url",relationshipType:"relationshipType",hasChanges:"hasChanges",currentItemIsLeftItem$:"currentItemIsLeftItem$"},outputs:{submitModal:"submitModal"},standalone:!0,features:[t.aNF],decls:12,vars:14,consts:[[1,"h4"],[1,"ml-2","btn","btn-success",3,"click","dsBtnDisabled"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[4,"ngVar"],[4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"my-2"],["class","relationship-row d-block alert",3,"fieldUpdate","url","editItem","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"relationship-row","d-block","alert",3,"fieldUpdate","url","editItem","ngClass"]],template:function(i,n){1&i&&(t.j41(0,"h2",0),t.EFF(1),t.nI1(2,"async"),t.nI1(3,"translate"),t.j41(4,"button",1),t.nI1(5,"async"),t.bIt("click",function(){return n.openLookup()}),t.nrm(6,"i",2),t.j41(7,"span",3),t.EFF(8),t.nI1(9,"translate"),t.k0s()()(),t.DNE(10,Xn,5,6,"ng-container",4),t.nI1(11,"async")),2&i&&(t.R7$(),t.SpI(" ",t.bMT(3,6,t.bMT(2,4,n.relationshipMessageKey$))," "),t.R7$(3),t.Y8G("dsBtnDisabled",t.bMT(5,8,n.hasChanges)),t.R7$(4),t.SpI("\xa0",t.bMT(9,10,"item.edit.relationships.edit.buttons.add"),""),t.R7$(2),t.Y8G("ngVar",t.bMT(11,12,n.updates$)))},dependencies:[En,vt.e,h.Jj,Xt,ot.r,h.bT,h.pM,g.h,g.D9,h.YU,bt.v,q.A],styles:[".relationship-row[_ngcontent-%COMP%]:not(.alert){padding:var(--bs-alert-padding-y) 0}.relationship-row.alert[_ngcontent-%COMP%]{margin-left:calc(-1 * var(--bs-alert-padding-x));margin-right:calc(-1 * var(--bs-alert-padding-x));margin-top:-1px;margin-bottom:-1px}"]})}}return s})();function wn(s,l){if(1&s&&(t.qex(0),t.nrm(1,"ds-edit-relationship-list",1)(2,"ds-edit-relationship-list",2),t.bVm()),2&s){const e=t.XpG();t.R7$(),t.Y8G("url",e.url)("item",e.item)("itemType",e.itemType)("relationshipType",e.relationshipType)("hasChanges",e.hasChanges)("currentItemIsLeftItem$",e.isLeftItem$),t.R7$(),t.Y8G("url",e.url)("item",e.item)("itemType",e.itemType)("relationshipType",e.relationshipType)("hasChanges",e.hasChanges)("currentItemIsLeftItem$",e.isRightItem$)}}function Ln(s,l){if(1&s&&(t.qex(0),t.nrm(1,"ds-edit-relationship-list",2),t.bVm()),2&s){const e=t.XpG();t.R7$(),t.Y8G("url",e.url)("item",e.item)("itemType",e.itemType)("relationshipType",e.relationshipType)("hasChanges",e.hasChanges)("currentItemIsLeftItem$",e.currentItemIsLeftItem$)}}let Yn=(()=>{class s{constructor(e){this.editItemRelationshipsService=e,this.submitModal=new t.bkB,this.currentItemIsLeftItem$=new I.t(void 0),this.isLeftItem$=new I.t(!0),this.isRightItem$=new I.t(!1),this.subs=[]}ngOnInit(){this.subs.push(this.editItemRelationshipsService.isProvidedItemTypeLeftType(this.relationshipType,this.itemType,this.item).subscribe(e=>{this.currentItemIsLeftItem$.next(e)})),this.shouldDisplayBothRelationshipSides$=this.editItemRelationshipsService.shouldDisplayBothRelationshipSides(this.relationshipType,this.itemType)}ngOnDestroy(){this.subs.filter(e=>(0,p.a4)(e)).forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(Gt))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-edit-relationship-list-wrapper"]],inputs:{item:"item",itemType:"itemType",url:"url",relationshipType:"relationshipType",hasChanges:"hasChanges"},outputs:{submitModal:"submitModal"},standalone:!0,features:[t.aNF],decls:4,vars:6,consts:[[4,"ngIf"],[1,"d-block","mb-4",3,"url","item","itemType","relationshipType","hasChanges","currentItemIsLeftItem$"],[3,"url","item","itemType","relationshipType","hasChanges","currentItemIsLeftItem$"]],template:function(i,n){1&i&&(t.DNE(0,wn,3,12,"ng-container",0),t.nI1(1,"async"),t.DNE(2,Ln,2,6,"ng-container",0),t.nI1(3,"async")),2&i&&(t.Y8G("ngIf",t.bMT(1,2,n.shouldDisplayBothRelationshipSides$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(3,4,n.shouldDisplayBothRelationshipSides$)))},dependencies:[h.Jj,Nn,h.bT]})}}return s})();function zn(s,l){1&s&&t.eu8(0)}function An(s,l){if(1&s&&(t.j41(0,"div",10),t.nrm(1,"ds-edit-relationship-list-wrapper",12),t.k0s()),2&s){const e=l.$implicit,i=t.XpG(2).ngIf,n=t.XpG();t.R7$(),t.Y8G("url",n.url)("item",n.item)("itemType",i)("relationshipType",e)("hasChanges",n.hasChanges$)}}function Wn(s,l){if(1&s&&(t.j41(0,"div",10),t.DNE(1,An,2,5,"div",11),t.k0s()),2&s){const e=l.ngIf,i=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e)("ngForTrackBy",i.trackById)}}function Kn(s,l){1&s&&t.eu8(0)}function Hn(s,l){if(1&s&&(t.qex(0),t.j41(1,"div",5),t.DNE(2,zn,1,0,"ng-container",6),t.k0s(),t.DNE(3,Wn,2,2,"div",7),t.nI1(4,"async"),t.j41(5,"div",8)(6,"div",9),t.DNE(7,Kn,1,0,"ng-container",6),t.k0s()(),t.bVm()),2&s){const e=t.XpG(),i=t.sdS(6),n=t.sdS(8);t.R7$(2),t.Y8G("ngTemplateOutlet",n),t.R7$(),t.Y8G("ngIf",t.bMT(4,4,e.relationshipTypes$))("ngIfElse",i),t.R7$(4),t.Y8G("ngTemplateOutlet",n)}}function Jn(s,l){if(1&s&&(t.j41(0,"ds-alert",13),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const e=t.XpG();t.Y8G("type",e.AlertType.Info),t.R7$(),t.SpI(" ",t.bMT(2,2,"item.edit.relationships.no-entity-type")," ")}}function Qn(s,l){1&s&&t.nrm(0,"ds-loading")}function Zn(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",21),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.discard())}),t.nrm(2,"i",22),t.j41(3,"span",20),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}if(2&s){const e=t.XpG(2);t.Y8G("dsBtnDisabled",!0!==t.bMT(1,2,e.hasChanges$)),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.metadata.discard-button"),"")}}function qn(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.reinstate())}),t.nrm(1,"i",24),t.j41(2,"span",20),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&s&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"item.edit.metadata.reinstate-button"),""))}function ts(s,l){1&s&&t.nrm(0,"span",25)}function es(s,l){1&s&&t.nrm(0,"i",26)}function is(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",14),t.DNE(1,Zn,6,6,"button",15),t.nI1(2,"async"),t.DNE(3,qn,5,3,"button",16),t.nI1(4,"async"),t.j41(5,"button",17),t.nI1(6,"async"),t.nI1(7,"async"),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.DNE(8,ts,1,0,"span",18),t.nI1(9,"async"),t.DNE(10,es,1,0,"i",19),t.nI1(11,"async"),t.j41(12,"span",20),t.EFF(13),t.nI1(14,"translate"),t.k0s()()()}if(2&s){const e=t.XpG();t.R7$(),t.Y8G("ngIf",!0!==t.bMT(2,6,e.isReinstatable$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,8,e.isReinstatable$)),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(6,10,e.hasChanges$)||!0===t.bMT(7,12,e.isSaving$)),t.R7$(3),t.Y8G("ngIf",t.bMT(9,14,e.isSaving$)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(11,16,e.isSaving$)),t.R7$(3),t.SpI("\xa0",t.bMT(14,18,"item.edit.metadata.save-button"),"")}}let ns=(()=>{class s extends Nt{get isSaving$(){return this.editItemRelationshipsService.isSaving$}constructor(e,i,n,a,o,d,_,C,x,K,H,Pt,Ut,fs){super(e,i,n,a,o,d),this.itemService=e,this.objectUpdatesService=i,this.router=n,this.notificationsService=a,this.translateService=o,this.route=d,this.relationshipService=_,this.objectCache=C,this.requestService=x,this.entityTypeService=K,this.relationshipTypeService=H,this.cdr=Pt,this.modalService=Ut,this.editItemRelationshipsService=fs,this.entityType$=new I.t(void 0),this.AlertType=Ct.v}initializeUpdates(){const e=this.item.firstMetadataValue("dspace.entity.type");void 0!==e?(this.relationshipTypes$=this.relationshipTypeService.searchByEntityType(e,!0,!0,...this.getRelationshipTypeFollowLinks()).pipe((0,u.T)(i=>i.page),(0,vn.F)((0,In.W2)())),this.entityTypeService.getEntityTypeByLabel(e).pipe((0,m.yd)(),(0,m.Bo)()).subscribe(i=>this.entityType$.next(i))):this.entityType$.next(void 0)}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.relationships.notifications."}submit(){this.editItemRelationshipsService.submit(this.item,this.url)}initializeOriginalFields(){return this.editItemRelationshipsService.initializeOriginalFields(this.item,this.url)}trackById(e,i){return i.id}getRelationshipTypeFollowLinks(){return[(0,k.s)("leftType"),(0,k.s)("rightType")]}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(X.ItemDataService),t.rXU(A.F),t.rXU(v.Ix),t.rXU(G.I),t.rXU(g.c$),t.rXU(v.nX),t.rXU(_t.RelationshipDataService),t.rXU(xt.$),t.rXU(ct.B),t.rXU(Et.f),t.rXU(_n.RelationshipTypeDataService),t.rXU(t.gRc),t.rXU(T.Bq),t.rXU(Gt))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-relationships"]],standalone:!0,features:[t.Vt3,t.aNF],decls:9,vars:4,consts:[["noEntityType",""],["loading",""],["buttons",""],[1,"item-relationships"],[4,"ngIf","ngIfElse"],[1,"button-row","top","d-flex","justify-content-end"],[4,"ngTemplateOutlet"],["class","mb-4",4,"ngIf","ngIfElse"],[1,"button-row","bottom"],[1,"float-right","ml-gap"],[1,"mb-4"],["class","mb-4",4,"ngFor","ngForOf","ngForTrackBy"],[3,"url","item","itemType","relationshipType","hasChanges"],[1,"d-block","mt-2",3,"type"],[1,"d-flex","space-children-mr","justify-content-end"],["class","btn btn-danger",3,"dsBtnDisabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"],["aria-hidden","true","class","spinner-border spinner-border-sm","role","status",4,"ngIf"],["aria-hidden","true","class","fas fa-save",4,"ngIf"],[1,"d-none","d-sm-inline"],[1,"btn","btn-danger",3,"click","dsBtnDisabled"],["aria-hidden","true",1,"fas","fa-times"],[1,"btn","btn-warning",3,"click"],["aria-hidden","true",1,"fas","fa-undo-alt"],["aria-hidden","true","role","status",1,"spinner-border","spinner-border-sm"],["aria-hidden","true",1,"fas","fa-save"]],template:function(i,n){if(1&i&&(t.j41(0,"div",3),t.DNE(1,Hn,8,6,"ng-container",4),t.nI1(2,"async"),t.k0s(),t.DNE(3,Jn,3,4,"ng-template",null,0,t.C5r)(5,Qn,1,0,"ng-template",null,1,t.C5r)(7,is,15,20,"ng-template",null,2,t.C5r)),2&i){const a=t.sdS(4);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.entityType$))("ngIfElse",a)}},dependencies:[j.C,h.Jj,h.Sq,h.bT,h.T3,bt.v,g.h,g.D9,Yn,q.A],styles:[".button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:var(--ds-gap)}.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media screen and (min-width: 576px){.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:var(--ds-edit-item-button-min-width)}}.button-row.top[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:calc(var(--bs-spacer) / 2);margin-bottom:calc(var(--bs-spacer) / 2)}"]})}}return s})();var ss=r(8886);r(74274);const as=["*"];function os(s,l){}let rs=(()=>{class s extends ss.J{getComponentName(){return"ItemStatusComponent"}importThemedComponent(e){return r(52529)(`./${e}/app/item-page/edit-item-page/item-status/item-status.component`)}importUnthemedComponent(){return Promise.resolve().then(r.bind(r,74274))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=t.xGo(s)))(n||s)}})()}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-status"]],standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:as,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(i,n){1&i&&(t.NAR(),t.DNE(0,os,0,0,"ng-template",null,0,t.C5r),t.j41(2,"div",null,1),t.SdG(4),t.k0s())},encapsulation:2})}}return s})();var ls=r(72976);function cs(s,l){if(1&s&&t.nrm(0,"ds-item-versions",3),2&s){const e=t.XpG().ngVar;t.Y8G("item",e)("displayWhenEmpty",!0)("displayTitle",!1)("displayActions",!0)}}function ds(s,l){if(1&s&&(t.j41(0,"div",1),t.DNE(1,cs,1,4,"ds-item-versions",2),t.k0s()),2&s){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e)}}const ps=s=>({id:s}),us=s=>[s,"edit"],gs=[{path:"",resolve:{breadcrumb:N.S},data:{breadcrumbKey:"item.edit"},children:[{path:"",component:w,children:[{path:"",redirectTo:"status",pathMatch:"full"},{path:"status",component:rs,data:{title:"item.edit.tabs.status.title",showBreadcrumbs:!0},canActivate:[qi]},{path:"bitstreams",component:Ne,data:{title:"item.edit.tabs.bitstreams.title",showBreadcrumbs:!0},canActivate:[Ni]},{path:"metadata",component:Y.Q,data:{title:"item.edit.tabs.metadata.title",showBreadcrumbs:!0},canActivate:[Ai]},{path:"curate",component:ui,data:{title:"item.edit.tabs.curate.title",showBreadcrumbs:!0},canActivate:[Li]},{path:"relationships",component:ns,data:{title:"item.edit.tabs.relationships.title",showBreadcrumbs:!0},canActivate:[Qi]},{path:"versionhistory",component:(()=>{class s{constructor(e){this.route=e,this.AlertTypeEnum=Ct.v}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,u.T)(e=>e.dso)).pipe((0,m.yd)())}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-version-history"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["class","mt-2",4,"ngVar"],[1,"mt-2"],[3,"item","displayWhenEmpty","displayTitle","displayActions",4,"ngIf"],[3,"item","displayWhenEmpty","displayTitle","displayActions"]],template:function(i,n){if(1&i&&(t.DNE(0,ds,2,1,"div",0),t.nI1(1,"async")),2&i){let a;t.Y8G("ngVar",null==(a=t.bMT(1,1,n.itemRD$))?null:a.payload)}},dependencies:[ls.I,ot.r,h.bT,h.Jj],encapsulation:2})}}return s})(),data:{title:"item.edit.tabs.versionhistory.title",showBreadcrumbs:!0},canActivate:[tn]},{path:"access-control",component:$t,data:{title:"item.edit.tabs.access-control.title",showBreadcrumbs:!0},canActivate:[Xi]},{path:"mapper",component:Kt,data:{title:"item.edit.tabs.item-mapper.title",showBreadcrumbs:!0},canActivate:[wi]}]},{path:"mapper",component:Kt},{path:c.kH,component:(()=>{class s extends rt{constructor(e,i,n,a,o){super(e,i,n,a,o),this.route=e,this.router=i,this.notificationsService=n,this.itemDataService=a,this.translateService=o,this.messageKey="withdraw",this.predicate=d=>d.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!0).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(v.nX),t.rXU(v.Ix),t.rXU(G.I),t.rXU(X.ItemDataService),t.rXU(g.c$))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-item-withdraw"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return n.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,n.headerMessage,t.eq3(15,ps,n.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,n.descriptionMessage)),t.R7$(2),t.Y8G("item",n.item),t.R7$(3),t.SpI("",t.bMT(13,11,n.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,us,n.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,n.cancelMessage)," "))},dependencies:[et.W,g.h,g.D9,v.Wk],encapsulation:2})}}return s})(),canActivate:[en]},{path:c.Pg,component:bn,canActivate:[Ji]},{path:c.$2,component:an,canActivate:[Ki]},{path:c.RS,component:ln},{path:c.Jr,component:ji,canActivate:[Yi]},{path:c.Bw,component:Vi,data:{title:"item.edit.move.title"},canActivate:[Wi]},{path:c.KY,component:hn,canActivate:[Hi],data:{title:"item.edit.register-doi.title"}},{path:c.K4,children:[{path:"create",resolve:{resourcePolicyTarget:b.Q},component:L.m,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:Q.n},component:W._,data:{title:"resource-policies.edit.page.title"}},{path:"",component:ae,data:{title:"item.edit.authorizations.title"}}],canActivate:[zi]}]}]},37223:(pt,J,r)=>{"use strict";r.d(J,{k:()=>v});var N=r(60177),Y=r(7901),L=r(52149),W=r(41780),Q=r(60456),b=r(54438);function h(T,g){if(1&T&&(b.j41(0,"span")(1,"button",5),b.nI1(2,"translate"),b.EFF(3),b.nI1(4,"translate"),b.k0s()()),2&T){const $=b.XpG();b.R7$(),b.Y8G("dsBtnDisabled",$.operation.disabled)("routerLink",$.operation.operationUrl),b.BMQ("aria-label",b.bMT(2,4,"item.edit.tabs.status.buttons."+$.operation.operationKey+".button")),b.R7$(2),b.SpI(" ",b.bMT(4,6,"item.edit.tabs.status.buttons."+$.operation.operationKey+".button")," ")}}function t(T,g){if(1&T&&(b.j41(0,"span",6),b.nI1(1,"translate"),b.j41(2,"button",7),b.nI1(3,"translate"),b.EFF(4),b.nI1(5,"translate"),b.k0s()()),2&T){const $=b.XpG();b.Y8G("ngbTooltip",b.bMT(1,4,"item.edit.tabs.status.buttons.unauthorized")),b.R7$(2),b.Y8G("dsBtnDisabled",!0),b.BMQ("aria-label",b.bMT(3,6,"item.edit.tabs.status.buttons."+$.operation.operationKey+".button")),b.R7$(2),b.SpI(" ",b.bMT(5,8,"item.edit.tabs.status.buttons."+$.operation.operationKey+".button")," ")}}let v=(()=>{class T{static{this.\u0275fac=function(R){return new(R||T)}}static{this.\u0275cmp=b.VBU({type:T,selectors:[["ds-item-operation"]],inputs:{operation:"operation"},standalone:!0,features:[b.aNF],decls:7,vars:5,consts:[[1,"col-12","col-md-3","h-auto","float-left","d-flex","action-label"],[1,"justify-content-center","align-self-center","font-weight-bold"],[1,"col-12","col-md-9","float-left","action-button"],[4,"ngIf"],[3,"ngbTooltip",4,"ngIf"],[1,"btn","btn-outline-primary",3,"dsBtnDisabled","routerLink"],[3,"ngbTooltip"],[1,"btn","btn-outline-primary",3,"dsBtnDisabled"]],template:function(R,u){1&R&&(b.j41(0,"div",0)(1,"span",1),b.EFF(2),b.nI1(3,"translate"),b.k0s()(),b.j41(4,"div",2),b.DNE(5,h,5,8,"span",3)(6,t,6,10,"span",4),b.k0s()),2&R&&(b.R7$(2),b.SpI(" ",b.bMT(3,3,"item.edit.tabs.status.buttons."+u.operation.operationKey+".label")," "),b.R7$(3),b.Y8G("ngIf",u.operation.authorized),b.R7$(),b.Y8G("ngIf",!u.operation.authorized))},dependencies:[W.h,W.D9,Y.Wk,L.n8,L.md,N.bT,Q.A],encapsulation:2})}}return T})()},74274:(pt,J,r)=>{"use strict";r.r(J),r.d(J,{ItemStatusComponent:()=>gt});var N=r(60177),Y=r(7901),L=r(41780),W=r(84412),Q=r(7673),b=r(84572),h=r(96354),t=r(61594),v=r(25558),T=r(73028),g=r(70274),$=r(23294),R=r(56594),u=r(8917),it=r(65007),p=r(3970),V=r(90378),It=r(89147),lt=r(80183),ut=r(50332),Z=r(82777),ht=r(90887),Tt=r(37223);class w{constructor(E,f,F,M=!1,S=!0){this.operationKey=E,this.operationUrl=f,this.featureID=F,this.authorized=S,this.setDisabled(M)}setDisabled(E){this.disabled=E}setAuthorized(E){this.authorized=E}}var c=r(54438);const m=I=>({"pt-3":I});function yt(I,E){if(1&I&&(c.j41(0,"div",7)(1,"div",3),c.EFF(2),c.nI1(3,"translate"),c.k0s(),c.j41(4,"div",8),c.EFF(5),c.k0s()()),2&I){const f=E.$implicit,F=c.XpG();c.R7$(2),c.SpI(" ",c.bMT(3,4,"item.edit.tabs.status.labels."+f),": "),c.R7$(2),c.Mz_("id","status-",f,""),c.R7$(),c.SpI(" ",F.statusData[f]," ")}}function St(I,E){if(1&I&&(c.j41(0,"div")(1,"div",3),c.EFF(2),c.k0s(),c.j41(3,"div",10),c.EFF(4),c.nI1(5,"translate"),c.k0s()()),2&I){const f=c.XpG().$implicit;c.R7$(2),c.SpI(" ",f.identifierType.toLocaleUpperCase()," "),c.R7$(2),c.Lme("",f.value," (",c.bMT(5,3,"item.edit.identifiers.doi.status."+f.identifierStatus),")")}}function $t(I,E){if(1&I&&(c.j41(0,"div",7),c.DNE(1,St,6,5,"div",9),c.k0s()),2&I){const f=E.$implicit;c.R7$(),c.Y8G("ngIf","doi"===f.identifierType)}}function Rt(I,E){if(1&I&&(c.j41(0,"div",11),c.nrm(1,"ds-item-operation",12),c.k0s()),2&I){const f=E.$implicit;c.Y8G("ngClass",c.eq3(2,m,f)),c.R7$(),c.Y8G("operation",f)}}let gt=(()=>{class I{constructor(f,F,M,S,z){this.route=f,this.authorizationService=F,this.identifierDataService=M,this.configurationService=S,this.orcidAuthService=z,this.operations$=new W.t([]),this.subs=[]}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,h.T)(f=>f.dso)),this.itemRD$.pipe((0,t.$)(),(0,h.T)(f=>f.payload)).pipe((0,v.n)(f=>{this.statusData=Object.assign({id:f.id,handle:f.handle,lastModified:f.lastModified}),this.statusDataKeys=Object.keys(this.statusData),this.identifiers$=this.identifierDataService.getIdentifierDataFor(f).pipe((0,h.T)(B=>401!==B.statusCode&&(0,Z.a4)(B.payload)?B.payload.identifiers:null));const F=this.configurationService.findByPropertyName("identifiers.item-status.register-doi").pipe((0,lt.qD)(),(0,h.T)(B=>{if(B.hasSucceeded){const j=B.payload;return!!(j.values.length>0&&(0,Z.a4)(j.values[0]))&&"true"===j.values[0]}return!1})),M=this.getCurrentUrl(f),S=[new w("authorizations",`${M}/authorizations`,p._.CanManagePolicies,!0),new w("mappedCollections",`${M}/mapper`,p._.CanManageMappings,!0),f.isWithdrawn?new w("reinstate",`${M}/reinstate`,p._.ReinstateItem,!0):new w("withdraw",`${M}/withdraw`,p._.WithdrawItem,!0),f.isDiscoverable?new w("private",`${M}/private`,p._.CanMakePrivate,!0):new w("public",`${M}/public`,p._.CanMakePrivate,!0),new w("move",`${M}/move`,p._.CanMove,!0),new w("delete",`${M}/delete`,p._.CanDelete,!0)];this.operations$.next(S);const z=this.identifierDataService.getIdentifierDataFor(f).pipe((0,lt.qD)(),(0,T.Z)(B=>{if(B.hasSucceeded){const j=B.payload.identifiers;let st=!0,ft=!1;return j?.forEach(k=>{(0,Z.a4)(k)&&"doi"===k.identifierType&&(st=!1,["PENDING","MINTED",null].includes(k.identifierStatus)&&(ft=!0))}),F.pipe((0,h.T)(k=>k&&(ft||st)))}return(0,Q.of)(!1)}),(0,v.n)(B=>{const j=[...S];if(B){const st=new w("register-doi",`${M}/register-doi`,p._.CanRegisterDOI,!0);j.splice(j.length-1,0,st)}return j}),(0,g.H)(B=>(0,Z.a4)(B.featureID)?this.authorizationService.isAuthorized(B.featureID,f.self).pipe((0,$.F)(),(0,h.T)(j=>(B.setDisabled(!j),B.setAuthorized(j),B))):[B]),(0,R.$)());let nt=(0,Q.of)([]);return this.orcidAuthService.isLinkedToOrcid(f)&&(nt=this.orcidAuthService.onlyAdminCanDisconnectProfileFromOrcid().pipe((0,h.T)(B=>B?[new w("unlinkOrcid",`${M}/unlink-orcid`)]:[]))),(0,b.z)([z,nt])}),(0,h.T)(([f,F])=>[...f,...F])).subscribe(f=>this.operations$.next(f)),this.itemPageRoute$=this.itemRD$.pipe((0,lt.Hz)(),(0,h.T)(f=>(0,ht._o)(f)))}getCurrentUrl(f){return(0,ht.$r)(f)}trackOperation(f,F){return(0,Z.a4)(F)?F.operationKey:void 0}ngOnDestroy(){this.subs.filter(f=>(0,Z.a4)(f)).forEach(f=>f.unsubscribe())}static{this.\u0275fac=function(F){return new(F||I)(c.rXU(Y.nX),c.rXU(it.AuthorizationDataService),c.rXU(V.IdentifierDataService),c.rXU(u.ConfigurationDataService),c.rXU(It.r))}}static{this.\u0275cmp=c.VBU({type:I,selectors:[["ds-base-item-status"]],standalone:!0,features:[c.aNF],decls:17,vars:19,consts:[[1,"mt-2"],[1,"row"],["class","w-100 pt-1",4,"ngFor","ngForOf"],[1,"col-12","col-md-3","float-left","status-label","font-weight-bold"],["id","status-itemPage",1,"col-12","col-md-9","float-left","status-data"],[3,"routerLink"],["class","w-100",3,"ngClass",4,"ngFor","ngForOf"],[1,"w-100","pt-1"],[1,"col-12","col-md-9","float-left","status-data",3,"id"],[4,"ngIf"],[1,"col-12","col-md-9","float-left","status-label","font-weight-bold"],[1,"w-100",3,"ngClass"],[3,"operation"]],template:function(F,M){1&F&&(c.j41(0,"p",0),c.EFF(1),c.nI1(2,"translate"),c.k0s(),c.j41(3,"div",1),c.DNE(4,yt,6,6,"div",2)(5,$t,2,1,"div",2),c.nI1(6,"async"),c.j41(7,"div",3),c.EFF(8),c.nI1(9,"translate"),c.k0s(),c.j41(10,"div",4)(11,"a",5),c.nI1(12,"async"),c.EFF(13),c.nI1(14,"async"),c.k0s()(),c.DNE(15,Rt,2,4,"div",6),c.nI1(16,"async"),c.k0s()),2&F&&(c.R7$(),c.JRh(c.bMT(2,7,"item.edit.tabs.status.description")),c.R7$(3),c.Y8G("ngForOf",M.statusDataKeys),c.R7$(),c.Y8G("ngForOf",c.bMT(6,9,M.identifiers$)),c.R7$(3),c.SpI(" ",c.bMT(9,11,"item.edit.tabs.status.labels.itemPage"),": "),c.R7$(3),c.Y8G("routerLink",c.bMT(12,13,M.itemPageRoute$)),c.R7$(2),c.JRh(c.bMT(14,15,M.itemPageRoute$)),c.R7$(2),c.Y8G("ngForOf",c.bMT(16,17,M.operations$)))},dependencies:[L.h,L.D9,N.Sq,N.Jj,N.bT,Y.Wk,Tt.k,N.YU],encapsulation:2,data:{animation:[ut.qG,ut.Ws]}})}}return I})()},52529:(pt,J,r)=>{var N={"./custom/app/item-page/edit-item-page/item-status/item-status.component":[13382,3382]};function Y(L){if(!r.o(N,L))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+L+"'");throw b.code="MODULE_NOT_FOUND",b});var W=N[L],Q=W[0];return r.e(W[1]).then(()=>r(Q))}Y.keys=()=>Object.keys(N),Y.id=52529,pt.exports=Y}}]);