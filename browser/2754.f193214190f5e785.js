"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[2754,5521],{25521:(J,S,s)=>{s.r(S),s.d(S,{ResourcePolicyDataService:()=>Q});var m=s(21626),t=s(96354),R=s(61594),P=s(82777),F=s(39806),A=s(72734),y=s(53954),L=s(41684),N=s(39280),W=s(13617),d=s(63897),j=s(87158),p=s(35108),$=s(37419),K=s(41023),E=s(43052),O=s(32473),h=s(14410),f=s(74449),T=s(44494),D=s(4910),e=s(80183),C=s(54438);let Q=(()=>{class G extends d.W{constructor(n,l,M,I,U,b,V,Y){super("resourcepolicies",n,l,M,I),this.requestService=n,this.rdbService=l,this.objectCache=M,this.halService=I,this.notificationsService=U,this.comparator=b,this.ePersonService=V,this.groupService=Y,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new N.V(this.linkPath,n,l,M,I,U,this.responseMsToLive),this.searchData=new p.X(this.linkPath,n,l,M,I,this.responseMsToLive),this.patchData=new j.n(this.linkPath,n,l,M,I,b,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new W.I(this.linkPath,n,l,M,I,U,this.responseMsToLive,this.constructIdEndpoint)}create(n,l,M,I){const U=[];return U.push(new y.x("resource",l)),(0,P.hj)(M)?U.push(new y.x("eperson",M)):(0,P.hj)(I)&&U.push(new y.x("group",I)),this.createData.create(n,...U)}delete(n){return this.deleteData.delete(n).pipe((0,e.qD)(),(0,t.T)(l=>l.hasSucceeded))}update(n){return this.patchData.update(n)}getDefaultAccessConditionsFor(n,l){return this.findListByHref(n._links.defaultAccessConditions.href,l)}searchByEPerson(n,l,M=!0,I=!0,...U){const b=new K._;return b.searchParams=[new y.x("uuid",n)],(0,P.hj)(l)&&b.searchParams.push(new y.x("resource",l)),this.searchData.searchBy(this.searchByEPersonMethod,b,M,I,...U)}searchByGroup(n,l,M=!0,I=!0,...U){const b=new K._;return b.searchParams=[new y.x("uuid",n)],(0,P.hj)(l)&&b.searchParams.push(new y.x("resource",l)),this.searchData.searchBy(this.searchByGroupMethod,b,M,I,...U)}searchByResource(n,l,M=!0,I=!0,...U){const b=new K._;return b.searchParams=[new y.x("uuid",n)],(0,P.hj)(l)&&b.searchParams.push(new y.x("action",l)),this.searchData.searchBy(this.searchByResourceMethod,b,M,I,...U)}updateTarget(n,l,M,I){const b=("eperson"===I?this.ePersonService:this.groupService).getIDHrefObs(M),V=Object.create({});let Y=new m.Lr;Y=Y.append("Content-Type","text/uri-list"),V.headers=Y;const z=this.requestService.generateRequestId();return b.pipe((0,R.$)()).subscribe(Z=>{const u=new E.v_(z,l+"/"+I,Z,V);Object.assign(u,{getResponseParser:()=>h.M}),this.requestService.send(u)}),this.rdbService.buildFromRequestUUIDAndAwait(z,()=>this.invalidateByHref(l))}static{this.\u0275fac=function(l){return new(l||G)(C.KVO(O.B),C.KVO(A.o),C.KVO(L.$),C.KVO(D.Y),C.KVO(F.I),C.KVO($.Y),C.KVO(f.EPersonDataService),C.KVO(T.GroupDataService))}}static{this.\u0275prov=C.jDH({token:G,factory:G.\u0275fac,providedIn:"root"})}}return G})()},55584:(J,S,s)=>{s.d(S,{m:()=>p});var m=s(41780),t=s(84412),R=s(96354),P=s(96697),F=s(96526),A=s(25521),y=s(80183),L=s(4436),N=s(39806),W=s(12884),d=s(54438),j=s(7901);let p=(()=>{class ${constructor(E,O,h,f,T,D){this.dsoNameService=E,this.notificationsService=O,this.resourcePolicyService=h,this.route=f,this.router=T,this.translate=D,this.processing$=new t.t(!1)}ngOnInit(){this.route.data.pipe((0,R.T)(E=>E),(0,P.s)(1)).subscribe(E=>{this.targetResourceUUID=E.resourcePolicyTarget.payload.id,this.targetResourceName=this.dsoNameService.getName(E.resourcePolicyTarget.payload)})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${L.K4}`],{relativeTo:this.route})}createResourcePolicy(E){let O;this.processing$.next(!0),O="eperson"===E.target.type?this.resourcePolicyService.create(E.object,this.targetResourceUUID,E.target.uuid):this.resourcePolicyService.create(E.object,this.targetResourceUUID,null,E.target.uuid),O.pipe((0,y.qD)()).subscribe(h=>{this.processing$.next(!1),h.hasSucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.create.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get("resource-policies.create.page.failure.content"))})}static{this.\u0275fac=function(O){return new(O||$)(d.rXU(F.f),d.rXU(N.I),d.rXU(A.ResourcePolicyDataService),d.rXU(j.nX),d.rXU(j.Ix),d.rXU(m.c$))}}static{this.\u0275cmp=d.VBU({type:$,selectors:[["ds-resource-policy-create"]],standalone:!0,features:[d.aNF],decls:5,vars:5,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","isProcessing"]],template:function(O,h){1&O&&(d.j41(0,"div",0)(1,"h4",1),d.EFF(2),d.nI1(3,"translate"),d.k0s(),d.j41(4,"ds-resource-policy-form",2),d.bIt("reset",function(){return h.redirectToAuthorizationsPage()})("submit",function(T){return h.createResourcePolicy(T)}),d.k0s()()),2&O&&(d.R7$(2),d.Lme("",d.bMT(3,3,"resource-policies.create.page.heading")," ",h.targetResourceName,""),d.R7$(2),d.Y8G("isProcessing",h.isProcessing()))},dependencies:[W.y,m.h,m.D9],encapsulation:2})}}return $})()},10676:(J,S,s)=>{s.d(S,{_:()=>K});var m=s(41780),t=s(84412),R=s(7673),P=s(84572),F=s(96354),A=s(96697),y=s(88985),L=s(25521),N=s(80183),W=s(4436),d=s(39806),j=s(12884),p=s(54438),$=s(7901);let K=(()=>{class E{constructor(h,f,T,D,e){this.notificationsService=h,this.resourcePolicyService=f,this.route=T,this.router=D,this.translate=e,this.processing$=new t.t(!1)}ngOnInit(){this.route.data.pipe((0,F.T)(h=>h),(0,A.s)(1)).subscribe(h=>{this.resourcePolicy=h.resourcePolicy.payload})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${W.K4}`],{relativeTo:this.route})}updateResourcePolicy(h){this.processing$.next(!0);const f=Object.assign({},h.object,{id:this.resourcePolicy.id,type:y.O.value,_links:this.resourcePolicy._links}),T=h.updateTarget?this.resourcePolicyService.updateTarget(this.resourcePolicy.id,this.resourcePolicy._links.self.href,h.target.uuid,h.target.type).pipe((0,N.qD)(),(0,F.T)(e=>e&&e.hasSucceeded)):(0,R.of)(!0),D=this.resourcePolicyService.update(f).pipe((0,N.qD)(),(0,F.T)(e=>e&&e.hasSucceeded));(0,P.z)([T,D]).subscribe(([e,C])=>{this.processing$.next(!1),e&&C?(this.notificationsService.success(null,this.translate.get("resource-policies.edit.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get(C?"resource-policies.edit.page.target-failure.content":e?"resource-policies.edit.page.other-failure.content":"resource-policies.edit.page.failure.content"))})}static{this.\u0275fac=function(f){return new(f||E)(p.rXU(d.I),p.rXU(L.ResourcePolicyDataService),p.rXU($.nX),p.rXU($.Ix),p.rXU(m.c$))}}static{this.\u0275cmp=p.VBU({type:E,selectors:[["ds-resource-policy-edit"]],standalone:!0,features:[p.aNF],decls:5,vars:6,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","resourcePolicy","isProcessing"]],template:function(f,T){1&f&&(p.j41(0,"div",0)(1,"h1",1),p.EFF(2),p.nI1(3,"translate"),p.k0s(),p.j41(4,"ds-resource-policy-form",2),p.bIt("reset",function(){return T.redirectToAuthorizationsPage()})("submit",function(e){return T.updateResourcePolicy(e)}),p.k0s()()),2&f&&(p.R7$(2),p.Lme("",p.bMT(3,4,"resource-policies.edit.page.heading")," ",T.resourcePolicy.id,""),p.R7$(2),p.Y8G("resourcePolicy",T.resourcePolicy)("isProcessing",T.isProcessing()))},dependencies:[j.y,m.h,m.D9],encapsulation:2})}}return E})()},12884:(J,S,s)=>{s.d(S,{y:()=>oe});var m=s(60177),t=s(54438),R=s(52149),P=s(1473),F=s(41780),A=s(7673),y=s(84412),L=s(84572),N=s(96354),W=s(5964),d=s(96697),j=s(96526),p=s(32473),$=s(74449),K=s(44494),E=s(28235),O=s(88985),h=s(80183),f=s(60456),T=s(12866),D=s(82777),e=s(50518),C=s(66733),Q=s(77485),G=s(13143),ee=s(54002),n=s(46355),l=s(46251);const M=[{label:l.t.TYPE_SUBMISSION,value:l.t.TYPE_SUBMISSION},{label:l.t.TYPE_WORKFLOW,value:l.t.TYPE_WORKFLOW},{label:l.t.TYPE_INHERITED,value:l.t.TYPE_INHERITED},{label:l.t.TYPE_CUSTOM,value:l.t.TYPE_CUSTOM}],I=[{label:n.X.READ.toString(),value:n.X.READ},{label:n.X.WRITE.toString(),value:n.X.WRITE},{label:n.X.REMOVE.toString(),value:n.X.REMOVE},{label:n.X.ADMIN.toString(),value:n.X.ADMIN},{label:n.X.DELETE.toString(),value:n.X.DELETE},{label:n.X.WITHDRAWN_READ.toString(),value:n.X.WITHDRAWN_READ},{label:n.X.DEFAULT_BITSTREAM_READ.toString(),value:n.X.DEFAULT_BITSTREAM_READ},{label:n.X.DEFAULT_ITEM_READ.toString(),value:n.X.DEFAULT_ITEM_READ}],U={id:"name",label:"resource-policies.form.name.label",maxLength:30,hint:"resource-policies.form.name.hint",metadataFields:[],repeatable:!1,submissionId:"",hasSelectableMetadata:!1},b={id:"description",label:"resource-policies.form.description.label",metadataFields:[],repeatable:!1,rows:10,submissionId:"",hasSelectableMetadata:!1},V={id:"policyType",label:"resource-policies.form.policy-type.label",options:M,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.policy-type.required"}},Y={id:"action",label:"resource-policies.form.action-type.label",options:I,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.action-type.required"}},z={id:"date",group:[]},Z={element:{control:"form-row"}},w={id:"start",label:"resource-policies.form.date.start.label",placeholder:"resource-policies.form.date.start.label",inline:!1,toggleIcon:"far fa-calendar-alt"},u={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},x={id:"end",label:"resource-policies.form.date.end.label",placeholder:"resource-policies.form.date.end.label",inline:!1,toggleIcon:"far fa-calendar-alt"},i={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},a=["content"];function o(g,q){if(1&g&&t.nrm(0,"ds-form",17,2),2&g){const r=t.XpG();t.Y8G("formId",r.formId)("formModel",r.formModel)("displaySubmit",!1)("displayCancel",!1)}}function B(g,q){if(1&g){const r=t.RV6();t.j41(0,"ds-eperson-group-list",18),t.bIt("select",function(_){t.eBV(r);const v=t.XpG();return t.Njj(v.updateObjectSelected(_,!0))}),t.k0s()}}function X(g,q){if(1&g){const r=t.RV6();t.j41(0,"ds-eperson-group-list",19),t.bIt("select",function(_){t.eBV(r);const v=t.XpG();return t.Njj(v.updateObjectSelected(_,!1))}),t.k0s()}2&g&&t.Y8G("isListOfEPerson",!1)}function te(g,q){1&g&&(t.j41(0,"span"),t.nrm(1,"i",20),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&g&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function se(g,q){1&g&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&g&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"form.submit")," "))}function re(g,q){if(1&g){const r=t.RV6();t.j41(0,"div",21)(1,"h4",22),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",23),t.bIt("click",function(){const _=t.eBV(r).$implicit;return t.Njj(_.close())}),t.j41(5,"span",24),t.EFF(6,"\xd7"),t.k0s()()(),t.j41(7,"div",25)(8,"div",26)(9,"div",27),t.nrm(10,"i",28),t.k0s(),t.j41(11,"div"),t.nrm(12,"p",29),t.nI1(13,"translate"),t.nrm(14,"p",30),t.nI1(15,"translate"),t.k0s()()(),t.j41(16,"div",31)(17,"button",32),t.bIt("click",function(){const _=t.eBV(r).$implicit;return t.Njj(_.close())}),t.EFF(18),t.nI1(19,"translate"),t.k0s()()}if(2&g){const r=t.XpG();t.R7$(2),t.JRh(t.bMT(3,4,"resource-policies.form.eperson-group-list.modal.header")),t.R7$(10),t.Y8G("innerHTML",t.bMT(13,6,"eperson"===r.navActiveId?"resource-policies.form.eperson-group-list.modal.text1.toGroup":"resource-policies.form.eperson-group-list.modal.text1.toEPerson"),t.npT),t.R7$(2),t.Y8G("innerHTML",t.bMT(15,8,"resource-policies.form.eperson-group-list.modal.text2"),t.npT),t.R7$(4),t.JRh(t.bMT(19,10,"resource-policies.form.eperson-group-list.modal.close"))}}let oe=(()=>{class g{constructor(r,c,_,v,k,H){this.dsoNameService=r,this.ePersonService=c,this.formService=_,this.groupService=v,this.requestService=k,this.modalService=H,this.isProcessing=(0,A.of)(!1),this.reset=new t.bkB,this.submit=new t.bkB,this.resourcePolicyTargetName$=new y.t(""),this.subs=[],this.resourcePolicyTargetUpdated=!1}ngOnInit(){if(this.isActive=!0,this.formId=this.formService.getUniqueId("resource-policy-form"),this.formModel=this.buildResourcePolicyForm(),this.isBeingEdited()){const r=this.ePersonService.findByHref(this.resourcePolicy._links.eperson.href,!1).pipe((0,h.yd)()),c=this.groupService.findByHref(this.resourcePolicy._links.group.href,!1).pipe((0,h.yd)()),_=(0,L.z)([r,c]).pipe((0,N.T)(v=>v.find(k=>(0,D.hj)(k.payload))),(0,D.Az)());this.subs.push(_.pipe((0,W.p)(()=>this.isActive)).subscribe(v=>{this.resourcePolicyGrant=v.payload,this.navActiveId=String(v.payload.type),this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}))}}isFormValid(){return this.formService.isValid(this.formId).pipe((0,N.T)(r=>r&&(0,D.hj)(this.resourcePolicyGrant)))}buildResourcePolicyForm(){const r=[];r.push(new C.C(U),new Q.E(b),new P.z4z(V),new P.z4z(Y));const c=new P.dku(w,u),_=new P.dku(x,i),v=Object.assign({},z,{group:[]});return v.group.push(c,_),r.push(new P.iO5(v,Z)),this.initModelsValue(r),r}initModelsValue(r){return this.resourcePolicy&&r.forEach(c=>{"date"===c.id?((0,D.a4)(this.resourcePolicy.startDate)&&(c.get(0).value=(0,T.PR)(this.resourcePolicy.startDate)),(0,D.a4)(this.resourcePolicy.endDate)&&(c.get(1).value=(0,T.PR)(this.resourcePolicy.endDate))):this.resourcePolicy.hasOwnProperty(c.id)&&this.resourcePolicy[c.id]&&(c.value=this.resourcePolicy[c.id])}),r}isBeingEdited(){return!(0,D.Im)(this.resourcePolicy)}getResourcePolicyTargetName(){return(0,D.hj)(this.resourcePolicyGrant)?this.dsoNameService.getName(this.resourcePolicyGrant):""}updateObjectSelected(r,c){this.resourcePolicyTargetUpdated=!0,this.resourcePolicyGrant=r,this.resourcePolicyGrantType=c?"eperson":"group",this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}onReset(){this.reset.emit()}onSubmit(){this.formService.getFormData(this.formId).pipe((0,d.s)(1)).subscribe(r=>{const c=Object.create({});c.object=this.createResourcePolicyByFormData(r),c.target={type:this.resourcePolicyGrantType,uuid:this.resourcePolicyGrant.id},c.updateTarget=this.resourcePolicyTargetUpdated,this.submit.emit(c)})}createResourcePolicyByFormData(r){const c=new E.h;return c.name=r.name?r.name[0].value:null,c.description=r.description?r.description[0].value:null,c.policyType=r.policyType?r.policyType[0].value:null,c.action=r.action?r.action[0].value:null,c.startDate=r.date&&r.date.start?(0,T.Sd)(r.date.start[0].value):null,c.endDate=r.date&&r.date.end?(0,T.Sd)(r.date.end[0].value):null,c.type=O.O,c}ngOnDestroy(){this.isActive=!1,this.formModel=null,this.subs.filter(r=>(0,D.a4)(r)).forEach(r=>r.unsubscribe())}onNavChange(r){this.isBeingEdited()&&(r.preventDefault(),this.modalService.open(this.content))}static{this.\u0275fac=function(c){return new(c||g)(t.rXU(j.f),t.rXU($.EPersonDataService),t.rXU(ee.u),t.rXU(K.GroupDataService),t.rXU(p.B),t.rXU(R.Bq))}}static{this.\u0275cmp=t.VBU({type:g,selectors:[["ds-resource-policy-form"]],viewQuery:function(c,_){if(1&c&&t.GBs(a,5),2&c){let v;t.mGM(v=t.lsd())&&(_.content=v.first)}},inputs:{resourcePolicy:"resourcePolicy",isProcessing:"isProcessing"},outputs:{reset:"reset",submit:"submit"},standalone:!0,features:[t.aNF],decls:38,vars:34,consts:[["nav","ngbNav"],["content",""],["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel",4,"ngIf"],[1,"container-fluid"],["for","ResourcePolicyObject"],["id","ResourcePolicyObject","type","text",1,"form-control","mb-3",3,"value"],["ngbNav","",1,"nav-pills",3,"activeIdChange","navChange","activeId"],["role","presentation",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"form-group","row"],[1,"col","text-right"],["type","reset",1,"btn","btn-default",3,"click","dsBtnDisabled"],["type","button",1,"btn","btn-primary",3,"click","dsBtnDisabled"],[4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel"],[3,"select"],[3,"select","isListOfEPerson"],[1,"fas","fa-circle-notch","fa-spin"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"d-flex","flex-row"],[1,"mr-3"],[1,"fas","fa-info-circle","fa-2x","text-info"],[1,"font-weight-bold",3,"innerHTML"],[3,"innerHTML"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(c,_){if(1&c){const v=t.RV6();t.j41(0,"div"),t.DNE(1,o,2,4,"ds-form",3),t.j41(2,"div",4)(3,"label",5),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"input",6),t.nI1(7,"async"),t.j41(8,"ul",7,0),t.mxI("activeIdChange",function(H){return t.eBV(v),t.DH7(_.navActiveId,H)||(_.navActiveId=H),t.Njj(H)}),t.bIt("navChange",function(H){return t.eBV(v),t.Njj(_.onNavChange(H))}),t.j41(10,"li",8)(11,"a",9),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.DNE(14,B,1,0,"ng-template",10),t.k0s(),t.j41(15,"li",8)(16,"a",9),t.EFF(17),t.nI1(18,"translate"),t.k0s(),t.DNE(19,X,1,1,"ng-template",10),t.k0s()(),t.nrm(20,"div",11),t.j41(21,"div"),t.nrm(22,"hr"),t.j41(23,"div",12)(24,"div",13)(25,"button",14),t.nI1(26,"async"),t.bIt("click",function(){return t.eBV(v),t.Njj(_.onReset())}),t.EFF(27),t.nI1(28,"translate"),t.k0s(),t.j41(29,"button",15),t.nI1(30,"async"),t.nI1(31,"async"),t.bIt("click",function(){return t.eBV(v),t.Njj(_.onSubmit())}),t.DNE(32,te,4,3,"span",16),t.nI1(33,"async"),t.DNE(34,se,3,3,"span",16),t.nI1(35,"async"),t.k0s()()()()()(),t.DNE(36,re,20,12,"ng-template",null,1,t.C5r)}if(2&c){const v=t.sdS(9);t.R7$(),t.Y8G("ngIf",_.formModel),t.R7$(3),t.JRh(t.bMT(5,14,"resource-policies.form.eperson-group-list.label")),t.R7$(2),t.Y8G("value",t.bMT(7,16,_.resourcePolicyTargetName$)),t.R7$(2),t.R50("activeId",_.navActiveId),t.R7$(2),t.Y8G("ngbNavItem","eperson"),t.R7$(2),t.JRh(t.bMT(13,18,"resource-policies.form.eperson-group-list.tab.eperson")),t.R7$(3),t.Y8G("ngbNavItem","group"),t.R7$(2),t.JRh(t.bMT(18,20,"resource-policies.form.eperson-group-list.tab.group")),t.R7$(3),t.Y8G("ngbNavOutlet",v),t.R7$(5),t.Y8G("dsBtnDisabled",t.bMT(26,22,_.isProcessing)),t.R7$(2),t.JRh(t.bMT(28,24,"form.cancel")),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(30,26,_.isFormValid())||t.bMT(31,28,_.isProcessing)),t.R7$(3),t.Y8G("ngIf",t.bMT(33,30,_.isProcessing)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(35,32,_.isProcessing))}},dependencies:[G.s,R.Pv,R.Um,R.X9,R.sy,R.Ri,R.m_,e.T,F.h,F.D9,m.Jj,m.bT,f.A],encapsulation:2})}}return g})()},45539:(J,S,s)=>{s.d(S,{Q:()=>N});var m=s(54438),t=s(7901),R=s(25558),P=s(82640),F=s(4047),A=s(80183),y=s(42547),L=s(82777);const N=(W,d,j=(0,m.WQX)(P.l9),p=(0,m.WQX)(m.zZn),$=(0,m.WQX)(t.Ix))=>{const K=W.queryParamMap.get("targetType"),E=W.queryParamMap.get("policyTargetId");((0,L.Im)(K)||(0,L.Im)(E))&&$.navigateByUrl("/404",{skipLocationChange:!0});const O=new y.v(K);return(0,F.M)(j,O.value,p).pipe((0,R.n)(f=>f.findById(E)),(0,A.qD)())}},92117:(J,S,s)=>{s.d(S,{n:()=>y});var m=s(54438),t=s(7901),R=s(25521),P=s(80183),F=s(82777),A=s(67600);const y=(L,N,W=(0,m.WQX)(t.Ix),d=(0,m.WQX)(R.ResourcePolicyDataService))=>{const j=L.queryParamMap.get("policyId");return(0,F.Im)(j)&&W.navigateByUrl("/404",{skipLocationChange:!0}),d.findById(j,!0,!1,(0,A.s)("eperson"),(0,A.s)("group")).pipe((0,P.qD)())}},92772:(J,S,s)=>{s.d(S,{e:()=>w});var m=s(60177),t=s(41780),R=s(84412),P=s(22806),F=s(5964),A=s(19852),y=s(96354),L=s(23294),N=s(70274),W=s(31943),d=s(96697),j=s(96526),p=s(32473),$=s(74449),K=s(44494),E=s(25521),O=s(80183),h=s(60456),f=s(82777),T=s(39806),D=s(67600),e=s(54438),C=s(89417),Q=s(25093),G=s(12866),ee=s(93120),n=s(7901);const l=["ds-resource-policy-entry",""];function M(u,x){if(1&u){const i=e.RV6();e.j41(0,"button",7),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.redirectToGroupEditPage())}),e.nrm(2,"i",10),e.k0s()}2&u&&e.Y8G("title",e.bMT(1,1,"resource-policies.table.headers.edit.group"))}let I=(()=>{class u{constructor(i,a,o,B){this.dsoNameService=i,this.groupService=a,this.route=o,this.router=B,this.toggleCheckbox=new e.bkB}ngOnInit(){this.epersonName$=this.getName$(this.entry.policy.eperson),this.groupName$=this.getName$(this.entry.policy.group)}getName$(i){return i.pipe((0,O.v7)(),(0,y.T)(a=>{if((0,f.a4)(a?.payload))return this.dsoNameService.getName(a.payload)}))}formatDate(i){return(0,f.hj)(i)?(0,G.$T)((0,G.PR)(i)):""}redirectToResourcePolicyEditPage(){this.router.navigate(["./edit"],{relativeTo:this.route,queryParams:{policyId:this.entry.policy.id}})}redirectToGroupEditPage(){this.groupService.findByHref(this.entry.policy._links.group.href,!1).pipe((0,O.ak)(),(0,y.T)(i=>i.id)).subscribe(i=>{this.router.navigate([(0,Q.xl)(i)])})}static{this.\u0275fac=function(a){return new(a||u)(e.rXU(j.f),e.rXU(K.GroupDataService),e.rXU(n.nX),e.rXU(n.Ix))}}static{this.\u0275cmp=e.VBU({type:u,selectors:[["tr","ds-resource-policy-entry",""]],inputs:{entry:"entry"},outputs:{toggleCheckbox:"toggleCheckbox"},standalone:!0,features:[e.aNF],attrs:l,decls:33,vars:26,consts:[[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"ngModelChange","id","ngModel"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["scope","row"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm",3,"click","title"],["aria-hidden","true",1,"fas","fa-edit","fa-fw"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],["aria-hidden","true",1,"fas","fa-users","fa-fw"]],template:function(a,o){1&a&&(e.j41(0,"td",0)(1,"div",1)(2,"input",2),e.bIt("ngModelChange",function(X){return o.toggleCheckbox.emit(X)}),e.k0s(),e.j41(3,"label",3)(4,"span",4),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()(),e.j41(7,"th",5),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td"),e.EFF(16),e.nI1(17,"async"),e.k0s(),e.j41(18,"td"),e.EFF(19),e.nI1(20,"async"),e.k0s(),e.j41(21,"td"),e.EFF(22),e.k0s(),e.j41(23,"td"),e.EFF(24),e.k0s(),e.j41(25,"td",0)(26,"div",6)(27,"button",7),e.nI1(28,"translate"),e.bIt("click",function(){return o.redirectToResourcePolicyEditPage()}),e.nrm(29,"i",8),e.k0s(),e.DNE(30,M,3,3,"button",9),e.nI1(31,"async"),e.nI1(32,"dsHasValue"),e.k0s()()),2&a&&(e.R7$(2),e.Y8G("id",o.entry.id)("ngModel",o.entry.checked),e.R7$(),e.Y8G("for",o.entry.id),e.R7$(2),e.JRh(e.bMT(6,14,o.entry.checked?"resource-policies.table.headers.deselect":"resource-policies.table.headers.select")),e.R7$(3),e.SpI(" ",o.entry.id,"\n"),e.R7$(2),e.JRh(o.entry.policy.name),e.R7$(2),e.JRh(o.entry.policy.policyType),e.R7$(2),e.JRh(o.entry.policy.action),e.R7$(2),e.SpI(" ",e.bMT(17,16,o.epersonName$),"\n"),e.R7$(3),e.SpI(" ",e.bMT(20,18,o.groupName$),"\n"),e.R7$(3),e.JRh(o.formatDate(o.entry.policy.startDate)),e.R7$(2),e.JRh(o.formatDate(o.entry.policy.endDate)),e.R7$(3),e.Y8G("title",e.bMT(28,20,"resource-policies.table.headers.edit.policy")),e.R7$(3),e.Y8G("ngIf",e.bMT(32,24,e.bMT(31,22,o.groupName$))))},dependencies:[m.Jj,t.h,t.D9,C.YN,C.Zm,C.BC,C.vS,m.bT,ee.a],encapsulation:2})}}return u})();function U(u,x){if(1&u&&(e.qex(0),e.EFF(1),e.bVm()),2&u){const i=e.XpG();e.R7$(),e.SpI(" (",i.resourceUUID,") ")}}function b(u,x){1&u&&(e.j41(0,"span"),e.nrm(1,"i",12),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&u&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function V(u,x){1&u&&(e.j41(0,"span"),e.nrm(1,"i",13),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&u&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"resource-policies.delete.btn")," "))}function Y(u,x){if(1&u){const i=e.RV6();e.j41(0,"tr",14)(1,"th")(2,"div",15)(3,"input",16,0),e.bIt("change",function(o){e.eBV(i);const B=e.XpG();return e.Njj(B.selectAllCheckbox(o))}),e.k0s(),e.j41(5,"label",17)(6,"span",18),e.EFF(7),e.nI1(8,"translate"),e.k0s()()()(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th"),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"th"),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"th"),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"th"),e.EFF(25),e.nI1(26,"translate"),e.k0s(),e.j41(27,"th"),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"th"),e.EFF(31),e.nI1(32,"translate"),e.k0s(),e.j41(33,"th"),e.EFF(34),e.nI1(35,"translate"),e.k0s()()}if(2&u){const i=e.sdS(4),a=e.XpG();e.R7$(3),e.Y8G("id","selectAll_"+a.resourceUUID),e.R7$(2),e.Y8G("for","selectAll_"+a.resourceUUID),e.R7$(2),e.JRh(e.bMT(8,12,i.checked?"resource-policies.table.headers.deselect-all":"resource-policies.table.headers.select-all")),e.R7$(3),e.JRh(e.bMT(11,14,"resource-policies.table.headers.id")),e.R7$(3),e.JRh(e.bMT(14,16,"resource-policies.table.headers.name")),e.R7$(3),e.JRh(e.bMT(17,18,"resource-policies.table.headers.policyType")),e.R7$(3),e.JRh(e.bMT(20,20,"resource-policies.table.headers.action")),e.R7$(3),e.JRh(e.bMT(23,22,"resource-policies.table.headers.eperson")),e.R7$(3),e.JRh(e.bMT(26,24,"resource-policies.table.headers.group")),e.R7$(3),e.JRh(e.bMT(29,26,"resource-policies.table.headers.date.start")),e.R7$(3),e.JRh(e.bMT(32,28,"resource-policies.table.headers.date.end")),e.R7$(3),e.JRh(e.bMT(35,30,"resource-policies.table.headers.edit"))}}function z(u,x){if(1&u){const i=e.RV6();e.j41(0,"tr",20),e.bIt("toggleCheckbox",function(o){const B=e.eBV(i).$implicit,X=e.XpG(2);return e.Njj(X.selectCheckbox(B,o))}),e.k0s()}2&u&&e.Y8G("entry",x.$implicit)}function Z(u,x){if(1&u&&(e.j41(0,"tbody"),e.DNE(1,z,1,1,"tr",19),e.nI1(2,"async"),e.k0s()),2&u){const i=e.XpG();e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,i.getResourcePolicies()))}}let w=(()=>{class u{constructor(i,a,o,B,X,te,se,re,oe,g){this.cdr=i,this.dsoNameService=a,this.ePersonService=o,this.groupService=B,this.notificationsService=X,this.requestService=te,this.resourcePolicyService=se,this.route=re,this.router=oe,this.translate=g,this.processingDelete$=new R.t(!1),this.resourcePoliciesEntries$=new R.t([]),this.subs=[]}ngOnInit(){this.isActive=!0,this.initResourcePolicyList()}canDelete(){return(0,P.H)(this.resourcePoliciesEntries$.value).pipe((0,F.p)(i=>i.checked),(0,A.T)((i,a)=>[...i,a],[]),(0,y.T)(i=>(0,f.hj)(i)),(0,L.F)())}deleteSelectedResourcePolicies(){this.processingDelete$.next(!0);const i=this.resourcePoliciesEntries$.value.filter(a=>a.checked);this.subs.push((0,P.H)(i).pipe((0,N.H)(a=>this.resourcePolicyService.delete(a.policy.id)),(0,W.S)((a,o)=>[...a,o],[]),(0,F.p)(a=>a.length===i.length),(0,d.s)(1)).subscribe(a=>{const o=a.filter(B=>!B);(0,f.Im)(o)?this.notificationsService.success(null,this.translate.get("resource-policies.delete.success.content")):this.notificationsService.error(null,this.translate.get("resource-policies.delete.failure.content")),this.processingDelete$.next(!1)}))}getResourcePolicies(){return this.resourcePoliciesEntries$.asObservable()}initResourcePolicyList(){this.subs.push(this.resourcePolicyService.searchByResource(this.resourceUUID,null,!1,!0,(0,D.s)("eperson"),(0,D.s)("group")).pipe((0,F.p)(()=>this.isActive),(0,O.v7)()).subscribe(i=>{const a=i.payload.page.map(o=>({id:o.id,policy:o,checked:!1}));this.resourcePoliciesEntries$.next(a),this.cdr.detectChanges()}))}isProcessingDelete(){return this.processingDelete$.asObservable()}redirectToResourcePolicyCreatePage(){this.router.navigate(["./create"],{relativeTo:this.route,queryParams:{policyTargetId:this.resourceUUID,targetType:this.resourceType}})}selectAllCheckbox(i){const a=i.target.checked;this.resourcePoliciesEntries$.value.forEach(o=>o.checked=a)}selectCheckbox(i,a){i.checked=a}ngOnDestroy(){this.isActive=!1,this.resourcePoliciesEntries$=null,this.subs.filter(i=>(0,f.a4)(i)).forEach(i=>i.unsubscribe())}static{this.\u0275fac=function(a){return new(a||u)(e.rXU(e.gRc),e.rXU(j.f),e.rXU($.EPersonDataService),e.rXU(K.GroupDataService),e.rXU(T.I),e.rXU(p.B),e.rXU(E.ResourcePolicyDataService),e.rXU(n.nX),e.rXU(n.Ix),e.rXU(t.c$))}}static{this.\u0275cmp=e.VBU({type:u,selectors:[["ds-resource-policies"]],inputs:{resourceUUID:"resourceUUID",resourceType:"resourceType",resourceName:"resourceName"},standalone:!0,features:[e.aNF],decls:31,vars:34,consts:[["selectAllBtn",""],[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],["colspan","10"],[1,"d-flex","justify-content-between","align-items-center","m-0"],[1,"text-info"],[4,"ngIf"],[1,"space-children-mr","flex-shrink-0"],[1,"btn","btn-danger","p-1",3,"click","dsBtnDisabled","title"],[1,"btn","btn-success","p-1",3,"click","dsBtnDisabled","title"],["aria-hidden","true",1,"fas","fa-plus"],["class","text-center",4,"ngIf"],["aria-hidden","true",1,"fas","fa-circle-notch","fa-spin"],["aria-hidden","true",1,"fas","fa-trash-alt","fa-fw"],[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"change","id"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["ds-resource-policy-entry","",3,"entry","toggleCheckbox",4,"ngFor","ngForOf"],["ds-resource-policy-entry","",3,"toggleCheckbox","entry"]],template:function(a,o){if(1&a&&(e.j41(0,"div",1)(1,"table",2)(2,"thead")(3,"tr")(4,"th",3)(5,"div",4)(6,"span"),e.EFF(7),e.nI1(8,"translate"),e.j41(9,"span",5),e.EFF(10),e.k0s(),e.DNE(11,U,2,1,"ng-container",6),e.k0s(),e.j41(12,"div",7)(13,"button",8),e.nI1(14,"async"),e.nI1(15,"async"),e.nI1(16,"translate"),e.bIt("click",function(){return o.deleteSelectedResourcePolicies()}),e.DNE(17,b,4,3,"span",6),e.nI1(18,"async"),e.DNE(19,V,4,3,"span",6),e.nI1(20,"async"),e.k0s(),e.j41(21,"button",9),e.nI1(22,"async"),e.nI1(23,"translate"),e.bIt("click",function(){return o.redirectToResourcePolicyCreatePage()}),e.nrm(24,"i",10),e.EFF(25),e.nI1(26,"translate"),e.k0s()()()()(),e.DNE(27,Y,36,32,"tr",11),e.nI1(28,"async"),e.k0s(),e.DNE(29,Z,3,3,"tbody",6),e.nI1(30,"async"),e.k0s()()),2&a){let B,X;e.R7$(7),e.SpI(" ",e.bMT(8,12,"resource-policies.table.headers.title.for."+o.resourceType)," "),e.R7$(3),e.SpI(" ",o.resourceName," "),e.R7$(),e.Y8G("ngIf","item"!==o.resourceType),e.R7$(2),e.Y8G("dsBtnDisabled",!0!==e.bMT(14,14,o.canDelete())||e.bMT(15,16,o.isProcessingDelete()))("title",e.bMT(16,18,"resource-policies.delete.btn.title")),e.R7$(4),e.Y8G("ngIf",e.bMT(18,20,o.isProcessingDelete())),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(20,22,o.isProcessingDelete())),e.R7$(2),e.Y8G("dsBtnDisabled",e.bMT(22,24,o.isProcessingDelete()))("title",e.bMT(23,26,"resource-policies.add.for."+o.resourceType)),e.R7$(4),e.SpI(" ",e.bMT(26,28,"resource-policies.add.button")," "),e.R7$(2),e.Y8G("ngIf",(null==(B=e.bMT(28,30,o.getResourcePolicies()))?null:B.length)>0),e.R7$(2),e.Y8G("ngIf",(null==(X=e.bMT(30,32,o.getResourcePolicies()))?null:X.length)>0)}},dependencies:[I,t.h,t.D9,m.bT,m.Jj,m.Sq,h.A],styles:["td[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:focus{box-shadow:none!important}"]})}}return u})()},93120:(J,S,s)=>{s.d(S,{a:()=>R});var m=s(82777),t=s(54438);let R=(()=>{class P{transform(A){return(0,m.a4)(A)}static{this.\u0275fac=function(y){return new(y||P)}}static{this.\u0275pipe=t.EJ8({name:"dsHasValue",type:P,pure:!0,standalone:!0})}}return P})()}}]);