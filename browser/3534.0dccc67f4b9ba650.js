"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[3534],{59033:(j,U,a)=>{a.d(U,{F:()=>P});var l=a(25499),h=a(25558),d=a(96354),m=a(5964),O=a(23294),S=a(96697),u=a(82777),C=a(47797),o=a(25103),p=a(16105),E=a(66898),s=a(54438);function g(c){return(0,l.Mz)(function M(){return(0,l.Mz)(C.N,c=>c["cache/object-updates"])}(),n=>n[c])}let P=(()=>{class c{constructor(e,t){this.store=e,this.injector=t}initialize(e,t,i,r){this.store.dispatch(new p.g$(e,t,i,r))}saveFieldUpdate(e,t,i){this.store.dispatch(new p.XO(e,t,i))}getObjectEntry(e){return this.store.pipe((0,l.Lt)(g(e)))}getFieldState(e,t){return this.store.pipe((0,l.Lt)(function b(c,n){return(0,l.Mz)(g(c),e=>e.fieldStates[n])}(e,t)))}getFieldUpdates(e,t,i){return this.getObjectEntry(e).pipe((0,h.n)(v=>{const _={};return(0,u.a4)(v)&&Object.keys(i?v.fieldUpdates:v.fieldStates).forEach(f=>{_[f]=v.fieldUpdates[f]}),this.getFieldUpdatesExclusive(e,t).pipe((0,d.T)(f=>(Object.keys(f).forEach(D=>{_[D]=f[D]}),_)))}))}getFieldUpdatesExclusive(e,t){return this.getObjectEntry(e).pipe((0,u.Az)(),(0,d.T)(r=>{const v={};for(const _ of t){let f=r.fieldUpdates[_.uuid];(0,u.Im)(f)&&(f={field:_,changeType:void 0}),v[_.uuid]=f}return v}))}isEditable(e,t){return this.getFieldState(e,t).pipe((0,m.p)(r=>(0,u.a4)(r)),(0,d.T)(r=>r.editable),(0,O.F)())}isValid(e,t){return this.getFieldState(e,t).pipe((0,m.p)(r=>(0,u.a4)(r)),(0,d.T)(r=>r.isValid),(0,O.F)())}isValidPage(e){return this.getObjectEntry(e).pipe((0,d.T)(i=>Object.values(i.fieldStates).findIndex(r=>!r.isValid)<0),(0,O.F)())}saveAddFieldUpdate(e,t){const i=this.getFieldUpdatesExclusive(e,[t]).pipe((0,m.p)(r=>r[t.uuid].changeType===o.B.ADD),(0,S.s)(1),(0,d.T)(()=>!0));return this.saveFieldUpdate(e,t,o.B.ADD),i}saveRemoveFieldUpdate(e,t){const i=this.getFieldUpdatesExclusive(e,[t]).pipe((0,m.p)(r=>r[t.uuid].changeType===o.B.REMOVE),(0,S.s)(1),(0,d.T)(()=>!0));return this.saveFieldUpdate(e,t,o.B.REMOVE),i}saveChangeFieldUpdate(e,t){this.saveFieldUpdate(e,t,o.B.UPDATE)}isSelectedVirtualMetadata(e,t,i){return this.store.pipe((0,l.Lt)(function T(c,n){return(0,l.Mz)(g(c),e=>e.virtualMetadataSources[n])}(e,t)),(0,d.T)(r=>r&&r[i]))}setSelectedVirtualMetadata(e,t,i,r){this.store.dispatch(new p.nY(e,t,i,r))}setEditableFieldUpdate(e,t,i){this.store.dispatch(new p.KD(e,t,i))}setValidFieldUpdate(e,t,i){this.store.dispatch(new p.wS(e,t,i))}discardFieldUpdates(e,t){this.store.dispatch(new p.Y8(e,t))}discardAllFieldUpdates(e,t){this.store.dispatch(new p.Y8(e,t,!0))}reinstateFieldUpdates(e){this.store.dispatch(new p.jX(e))}removeSingleFieldUpdate(e,t){this.store.dispatch(new p.mW(e,t))}getUpdatedFields(e,t){return this.getObjectEntry(e).pipe((0,d.T)(r=>{const v=[];return Object.keys(r.fieldStates).forEach(_=>{const f=r.fieldUpdates[_];if((0,u.Tn)(f)||f.changeType!==o.B.REMOVE){let D;D=(0,u.hj)(f)?f.field:t.find(I=>I.uuid===_),v.push(D)}}),v}))}hasUpdates(e){return this.getObjectEntry(e).pipe((0,d.T)(t=>(0,u.a4)(t)&&(0,u.hj)(t.fieldUpdates)))}isReinstatable(e){return this.hasUpdates(e+E.U)}getLastModified(e){return this.getObjectEntry(e).pipe((0,d.T)(t=>t.lastModified))}createPatch(e){return this.getObjectEntry(e).pipe((0,d.T)(t=>{let i=[];return(0,u.a4)(t.patchOperationService)&&(i=this.injector.get(t.patchOperationService).fieldUpdatesToPatchOperations(t.fieldUpdates)),i}))}static{this.\u0275fac=function(t){return new(t||c)(s.KVO(l.il),s.KVO(s.zZn))}}static{this.\u0275prov=s.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},3040:(j,U,a)=>{a.d(U,{X:()=>P});var l=a(60177),h=a(89417),d=a(41780),m=a(96354),O=a(8917),S=a(32736),u=a(80183),C=a(1504),o=a(82777),p=a(73335),E=a(39806),s=a(54438),M=a(7901);function g(c,n){if(1&c&&(s.j41(0,"option",9),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&c){const e=n.$implicit;s.Y8G("value",e),s.R7$(),s.SpI(" ",s.bMT(2,2,"curation-task.task."+e+".label")," ")}}function b(c,n){1&c&&(s.j41(0,"div",3)(1,"label",10),s.EFF(2),s.nI1(3,"translate"),s.k0s(),s.nrm(4,"input",11),s.j41(5,"small",12),s.EFF(6),s.nI1(7,"translate"),s.k0s()()),2&c&&(s.R7$(2),s.JRh(s.bMT(3,2,"curation.form.handle.label")),s.R7$(4),s.JRh(s.bMT(7,4,"curation.form.handle.hint")))}let P=(()=>{class c{constructor(e,t,i,r,v,_,f){this.scriptDataService=e,this.configurationDataService=t,this.notificationsService=i,this.translateService=r,this.handleService=v,this.router=_,this.cdr=f,this.subs=[]}ngOnDestroy(){this.subs.forEach(e=>e.unsubscribe())}ngOnInit(){this.form=new h.J3({task:new h.hs(""),handle:new h.hs("")}),this.config=this.configurationDataService.findByPropertyName("plugin.named.org.dspace.curate.CurationTask"),this.subs.push(this.config.pipe((0,u.ak)()).subscribe(e=>{this.tasks=e.values.filter(t=>(0,o.hj)(t)&&t.includes("=")).map(t=>t.split("=")[1].trim()),this.form.get("task").patchValue(this.tasks[0]),this.cdr.detectChanges()}))}hasHandleValue(){return(0,o.a4)(this.dsoHandle)}submit(){const e=this.form.get("task").value;let t;t=this.hasHandleValue()?this.handleService.normalizeHandle(this.dsoHandle).pipe((0,m.T)(i=>((0,o.Im)(i)&&this.notificationsService.error(this.translateService.get("curation.form.submit.error.head"),this.translateService.get("curation.form.submit.error.invalid-handle")),i))):this.handleService.normalizeHandle(this.form.get("handle").value).pipe((0,m.T)(i=>(0,o.Im)(i)?"all":i)),this.subs.push(t.subscribe(i=>{(0,o.a4)(i)&&this.subs.push(this.scriptDataService.invoke("curate",[{name:"-t",value:e},{name:"-i",value:i}],[]).pipe((0,u.qD)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get("curation.form.submit.success.head"),this.translateService.get("curation.form.submit.success.content")),this.router.navigateByUrl((0,C.yJ)(r.payload.processId))):this.notificationsService.error(this.translateService.get("curation.form.submit.error.head"),this.translateService.get("curation.form.submit.error.content"))}))}))}static{this.\u0275fac=function(t){return new(t||c)(s.rXU(S.ScriptDataService),s.rXU(O.ConfigurationDataService),s.rXU(E.I),s.rXU(d.c$),s.rXU(p.e),s.rXU(M.Ix),s.rXU(s.gRc))}}static{this.\u0275cmp=s.VBU({type:c,selectors:[["ds-curation-form"]],inputs:{dsoHandle:"dsoHandle"},standalone:!0,features:[s.aNF],decls:13,vars:9,consts:[[3,"ngSubmit","formGroup"],[1,"form-group"],[1,"row","mb-2"],[1,"col-12","col-sm-6"],["for","task",1,"font-weight-bold"],["id","task","formControlName","task",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","col-12 col-sm-6",4,"ngIf"],["type","submit",1,"btn","btn-default","btn-primary"],[3,"value"],["for","handle",1,"font-weight-bold"],["id","handle","formControlName","handle",1,"form-control"],[1,"text-muted"]],template:function(t,i){1&t&&(s.j41(0,"form",0),s.bIt("ngSubmit",function(){return i.submit()}),s.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),s.EFF(5),s.nI1(6,"translate"),s.k0s(),s.j41(7,"select",5),s.DNE(8,g,3,4,"option",6),s.k0s()(),s.DNE(9,b,8,6,"div",7),s.k0s(),s.j41(10,"button",8),s.EFF(11),s.nI1(12,"translate"),s.k0s()()()),2&t&&(s.Y8G("formGroup",i.form),s.R7$(5),s.JRh(s.bMT(6,5,"curation.form.task-select.label")),s.R7$(3),s.Y8G("ngForOf",i.tasks),s.R7$(),s.Y8G("ngIf",!i.hasHandleValue()),s.R7$(2),s.JRh(s.bMT(12,7,"curation.form.submit")))},dependencies:[h.YN,h.qT,h.xH,h.y7,h.me,h.wz,h.BC,h.cb,h.X1,h.j4,h.JD,l.pM,l.bT,d.h,d.D9],encapsulation:2})}}return c})()},79666:(j,U,a)=>{a.d(U,{A:()=>l});class l{}},95054:(j,U,a)=>{a.d(U,{h:()=>c});var l=a(54438),h=a(7673),d=a(99172),m=a(96697),O=a(96526),u=(a(6238),a(65007)),o=(a(3970),a(25499)),p=a(96354),E=a(82777),s=a(65580);const M=n=>n.objectSelection,g=n=>n.objectSelection;let b=(()=>{class n{constructor(t,i){this.store=t,this.appStore=i}getSelected(t,i){return this.store.select(function T(n,e){return function P(n,e){return(0,o.Mz)(M,t=>{if((0,E.a4)(t)&&(0,E.a4)(t[n]))return t[n][e]})}(n,e)}(t,i)).pipe((0,p.T)(r=>!!r&&r.checked))}getAllSelected(t){return this.appStore.select(g).pipe((0,p.T)(i=>(0,E.a4)(i[t])?Object.keys(i[t]).filter(r=>i[t][r].checked):[]))}initialSelect(t,i){this.store.dispatch(new s.u7(t,i))}initialDeselect(t,i){this.store.dispatch(new s.NE(t,i))}select(t,i){this.store.dispatch(new s.AS(t,i))}deselect(t,i){this.store.dispatch(new s.Vu(t,i))}switch(t,i){this.store.dispatch(new s.YE(t,i))}reset(t){this.store.dispatch(new s.bx(t,null))}static{this.\u0275fac=function(i){return new(i||n)(l.KVO(o.il),l.KVO(o.il))}}static{this.\u0275prov=l.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),c=(()=>{class n{constructor(t,i,r){this.objectSelectService=t,this.authorizationService=i,this.dsoNameService=r,this.cancel=new l.bkB,this.confirm=new l.bkB,this.dangerConfirm=!1}ngOnInit(){this.selectedIds$=this.objectSelectService.getAllSelected(this.key)}ngOnDestroy(){this.objectSelectService.reset(this.key)}switch(t){this.objectSelectService.switch(this.key,t)}getSelected(t){return this.objectSelectService.getSelected(this.key,t)}canSelect(t){return this.featureId?this.authorizationService.isAuthorized(this.featureId,t.self).pipe((0,d.Z)(!1)):(0,h.of)(!0)}confirmSelected(){this.selectedIds$.pipe((0,m.s)(1)).subscribe(t=>{this.confirm.emit(t),this.objectSelectService.reset(this.key)})}onCancel(){this.cancel.emit()}static{this.\u0275fac=function(i){return new(i||n)(l.rXU(b),l.rXU(u.AuthorizationDataService),l.rXU(O.f))}}static{this.\u0275cmp=l.VBU({type:n,selectors:[["ds-object-select-abstract"]],inputs:{key:"key",dsoRD$:"dsoRD$",paginationOptions:"paginationOptions",sortOptions:"sortOptions",confirmButton:"confirmButton",featureId:"featureId",cancelButton:"cancelButton",dangerConfirm:"dangerConfirm"},outputs:{cancel:"cancel",confirm:"confirm"},decls:0,vars:0,template:function(i,r){},encapsulation:2})}}return n})()},45969:(j,U,a)=>{a.d(U,{F:()=>S});var l=a(59033),h=a(39806),d=a(54438),m=a(41780),O=a(7901);let S=(()=>{class u{constructor(o,p,E,s){this.objectUpdatesService=o,this.notificationsService=p,this.translateService=E,this.router=s,this.notificationsPrefix="static-pages.form.notification"}ngOnInit(){this.url=this.router.url.split("?")[0],this.hasChanges$=this.hasChanges(),this.isReinstatable$=this.isReinstatable()}discard(){const o=this.notificationsService.info(this.getNotificationTitle("discarded"),this.getNotificationContent("discarded"),{timeOut:this.discardTimeOut});this.objectUpdatesService.discardFieldUpdates(this.url,o)}reinstate(){this.objectUpdatesService.reinstateFieldUpdates(this.url)}isReinstatable(){return this.objectUpdatesService.isReinstatable(this.url)}hasChanges(){return this.objectUpdatesService.hasUpdates(this.url)}getNotificationTitle(o){return this.translateService.instant(this.notificationsPrefix+o+".title")}getNotificationContent(o){return this.translateService.instant(this.notificationsPrefix+o+".content")}static{this.\u0275fac=function(p){return new(p||u)(d.rXU(l.F),d.rXU(h.I),d.rXU(m.c$),d.rXU(O.Ix))}}static{this.\u0275cmp=d.VBU({type:u,selectors:[["ds-abstract-trackable"]],standalone:!0,features:[d.aNF],decls:0,vars:0,template:function(p,E){},encapsulation:2})}}return u})()}}]);