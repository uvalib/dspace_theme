"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[3860,1783],{81783:(W,M,t)=>{t.r(M),t.d(M,{VersionDataService:()=>A});var L=t(983),f=t(25558),P=t(96354),h=t(82777),l=t(67600),c=t(72734),K=t(41684),T=t(4910),v=t(80183),g=t(63897),C=t(87158),p=t(37419),U=t(32473),d=t(54438);let A=(()=>{class i extends g.W{constructor(r,a,D,o,I){super("versions",r,a,D,o),this.requestService=r,this.rdbService=a,this.objectCache=D,this.halService=o,this.comparator=I,this.patchData=new C.n(this.linkPath,r,a,D,o,I,this.responseMsToLive,this.constructIdEndpoint)}getHistoryFromVersion(r,a=!1,D=!0){return(0,h.hj)(r)?this.findById(r.id,a,D,(0,l.s)("versionhistory")).pipe((0,v.ak)(),(0,f.n)(o=>o.versionhistory),(0,v.ak)()):L.w}getHistoryIdFromVersion(r){return this.getHistoryFromVersion(r).pipe((0,P.T)(a=>a.id))}patch(r,a){return this.patchData.patch(r,a)}update(r){return this.patchData.update(r)}commitUpdates(r){this.patchData.commitUpdates(r)}createPatchFromCache(r){return this.patchData.createPatchFromCache(r)}static{this.\u0275fac=function(a){return new(a||i)(d.KVO(U.B),d.KVO(c.o),d.KVO(K.$),d.KVO(T.Y),d.KVO(p.Y))}}static{this.\u0275prov=d.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},93860:(W,M,t)=>{t.r(M),t.d(M,{VersionHistoryDataService:()=>I});var L=t(21626),f=t(84572),P=t(7673),h=t(25558),l=t(96354),c=t(96697),K=t(47677),T=t(5964),v=t(82777),g=t(23401),C=t(33550),p=t(67600),U=t(72734),d=t(41684),A=t(4910),i=t(80183),y=t(63897),r=t(43052),a=t(32473),D=t(81783),o=t(54438);let I=(()=>{class u extends y.W{constructor(e,s,n,_,O){super("versionhistories",e,s,n,_),this.requestService=e,this.rdbService=s,this.objectCache=n,this.halService=_,this.versionDataService=O,this.versionsEndpoint="versions"}getBrowseEndpoint(e={},s){return this.halService.getEndpoint(this.linkPath)}getVersionsEndpoint(e){return this.getBrowseEndpoint().pipe((0,h.n)(s=>this.halService.getEndpoint(this.versionsEndpoint,`${s}/${e}`)))}getVersions(e,s,n=!0,_=!0,...O){const E=this.getVersionsEndpoint(e).pipe((0,l.T)(B=>s?s.toRestUrl(B):B));return this.versionDataService.findListByHref(E,void 0,n,_,...O)}createVersion(e,s){const n=this.requestService.generateRequestId(),_=Object.create({});let O=new L.Lr;return O=O.append("Content-Type","text/uri-list"),_.headers=O,this.halService.getEndpoint(this.versionsEndpoint).pipe((0,c.s)(1),(0,l.T)(E=>s?.length>0?`${E}?summary=${s}`:`${E}`),(0,K.I)(E=>(0,v.a4)(E))).subscribe(E=>{const B=new r.Qf(n,E,e,_);(0,v.a4)(this.responseMsToLive)&&(B.responseMsToLive=this.responseMsToLive),this.requestService.send(B)}),this.rdbService.buildFromRequestUUIDAndAwait(n,E=>(0,f.z)([this.requestService.setStaleByHrefSubstring(E.payload._links.self.href),this.requestService.setStaleByHrefSubstring(E.payload._links.versionhistory.href)])).pipe((0,i.qD)())}getLatestVersionFromHistory$(e){const s=Object.assign(new g.W,{id:"item-newest-version-options",currentPage:1,pageSize:1}),n=new C.C({pagination:s});return this.getVersions(e.id,n,!1,!0,(0,p.s)("item")).pipe((0,i.v7)(),(0,i.Bo)(),(0,v.Az)(),(0,T.p)(_=>_.page.length>0),(0,l.T)(_=>_.page[0]))}getLatestVersion$(e){return e.id?this.versionDataService.findById(e.id,!1,!0,(0,p.s)("versionhistory")).pipe((0,i.ak)(),(0,h.n)(s=>s.versionhistory),(0,i.ak)(),(0,h.n)(s=>this.getLatestVersionFromHistory$(s))):(0,P.of)(null)}isLatest$(e){return e?this.getLatestVersion$(e).pipe((0,c.s)(1),(0,h.n)(s=>(0,P.of)(e.version===s.version))):(0,P.of)(null)}hasDraftVersion$(e){return this.versionDataService.findByHref(e,!1,!0,(0,p.s)("versionhistory")).pipe((0,i.qD)(),(0,h.n)(s=>s.hasSucceeded&&!s.hasNoContent&&(0,v.a4)(s.payload)?s.payload.versionhistory.pipe((0,i.qD)(),(0,l.T)(n=>!(!n.hasSucceeded||n.hasNoContent)&&n.payload.draftVersion)):(0,P.of)(!1)))}getLatestVersionItemFromHistory$(e){return this.getLatestVersionFromHistory$(e).pipe((0,h.n)(s=>s.item),(0,i.ak)())}getVersionHistoryFromVersion$(e){return this.versionDataService.getHistoryIdFromVersion(e).pipe((0,c.s)(1),(0,h.n)(s=>this.findById(s)),(0,i.ak)())}invalidateVersionHistoryCache(e){this.requestService.setStaleByHrefSubstring("versioning/versionhistories/"+e)}static{this.\u0275fac=function(s){return new(s||u)(o.KVO(a.B),o.KVO(U.o),o.KVO(d.$),o.KVO(A.Y),o.KVO(D.VersionDataService))}}static{this.\u0275prov=o.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()}}]);