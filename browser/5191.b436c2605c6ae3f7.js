"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5191],{75191:(K,N,o)=>{o.r(N),o.d(N,{ROUTES:()=>wn,ValidateEmailErrorStateMatcher:()=>ve});var I=o(1473),x=o(70379),D=o(36673),$=o(36329),v=o(25093),m=o(41780),y=o(84412),Y=o(23294),d=o(96354),te=o(54028),M=o(60456),F=o(13329),h=o(60177),b=o(52149),e=o(54438);class ne{constructor(){this.change=new e.bkB,this.instances={},this.DEFAULT_ID="DEFAULT_PAGINATION_ID"}defaultId(){return this.DEFAULT_ID}register(s){return null==s.id&&(s.id=this.DEFAULT_ID),this.instances[s.id]?this.updateInstance(s):(this.instances[s.id]=s,!0)}updateInstance(s){let t=!1;for(let n in this.instances[s.id])s[n]!==this.instances[s.id][n]&&(this.instances[s.id][n]=s[n],t=!0);return t}getCurrentPage(s){return this.instances[s]?this.instances[s].currentPage:1}setCurrentPage(s,t){if(this.instances[s]){let n=this.instances[s];t<=Math.ceil(n.totalItems/n.itemsPerPage)&&1<=t&&(this.instances[s].currentPage=t,this.change.emit(s))}}setTotalItems(s,t){this.instances[s]&&0<=t&&(this.instances[s].totalItems=t,this.change.emit(s))}setItemsPerPage(s,t){this.instances[s]&&(this.instances[s].itemsPerPage=t,this.change.emit(s))}getInstance(s=this.DEFAULT_ID){return this.instances[s]?this.clone(this.instances[s]):{}}clone(s){var t={};for(var n in s)s.hasOwnProperty(n)&&(t[n]=s[n]);return t}}const Te=Number.MAX_SAFE_INTEGER;let ke=(()=>{class a{constructor(t){this.service=t,this.state={}}transform(t,n){if(!(t instanceof Array)){let _=n.id||this.service.defaultId();return this.state[_]?this.state[_].slice:t}let u,f,i=n.totalItems&&n.totalItems!==t.length,r=this.createInstance(t,n),l=r.id,S=r.itemsPerPage,C=this.service.register(r);if(!i&&t instanceof Array){if(S=+S||Te,u=(r.currentPage-1)*S,f=u+S,this.stateIsIdentical(l,t,u,f))return this.state[l].slice;{let j=t.slice(u,f);return this.saveState(l,t,j,u,f),this.service.change.emit(l),j}}return C&&this.service.change.emit(l),this.saveState(l,t,t,u,f),t}createInstance(t,n){return this.checkConfig(n),{id:null!=n.id?n.id:this.service.defaultId(),itemsPerPage:+n.itemsPerPage||0,currentPage:+n.currentPage||1,totalItems:+n.totalItems||t.length}}checkConfig(t){const i=["itemsPerPage","currentPage"].filter(r=>!(r in t));if(0<i.length)throw new Error(`PaginatePipe: Argument is missing the following required properties: ${i.join(", ")}`)}saveState(t,n,i,r,l){this.state[t]={collection:n,size:n.length,slice:i,start:r,end:l}}stateIsIdentical(t,n,i,r){let l=this.state[t];return!(!l||l.size!==n.length||l.start!==i||l.end!==r)&&l.slice.every((f,S)=>f===n[i+S])}}return a.\u0275fac=function(t){return new(t||a)(e.rXU(ne,16))},a.\u0275pipe=e.EJ8({name:"paginate",type:a,pure:!1}),a})(),je=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({providers:[ne],imports:[[h.MD]]}),a})();var X=o(96820),ie=o(32089),Ne=o(39012),De=o(13955),c=o(82777),Me=o(17191),Be=o(35323),A=o(5682),T=o(23401),Le=o(43404),we=o(54992),Xe=o(75465);const Ae=a=>({number:a}),ae=a=>({repeatable:!0,listId:a}),Oe=(a,s,t)=>({itemsPerPage:a,currentPage:s,totalItems:t});function Ve(a,s){1&a&&e.nrm(0,"span",12)}function Ue(a,s){1&a&&e.nrm(0,"span",13)}function Ye(a,s){if(1&a){const t=e.RV6();e.j41(0,"div",6),e.bIt("click",function(){e.eBV(t),e.XpG();const i=e.sdS(1);return e.Njj(i.toggle("browse"))}),e.j41(1,"button",7),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.preventDefault())}),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",8)(5,"div",9),e.DNE(6,Ve,1,0,"span",10)(7,Ue,1,0,"span",11),e.k0s()()()}if(2&a){e.XpG();const t=e.sdS(1);e.R7$(),e.BMQ("aria-expanded",t.isExpanded("browse")),e.R7$(),e.SpI(" ",e.bMT(3,4,"admin.access-control.bulk-access-browse.header")," "),e.R7$(4),e.Y8G("ngIf",t.isExpanded("browse")),e.R7$(),e.Y8G("ngIf",!t.isExpanded("browse"))}}function ze(a,s){if(1&a&&(e.j41(0,"div",20),e.nrm(1,"ds-search",21),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("configuration","administrativeBulkAccess")("selectable",!0)("selectionConfig",e.eq3(4,ae,t.listId))("showThumbnails",!1)}}function Je(a,s){if(1&a&&(e.j41(0,"li",26),e.nI1(1,"dsBrowserOnly"),e.nrm(2,"ds-selectable-list-item-control",27)(3,"ds-listable-object-component-loader",28),e.k0s()),2&a){const t=s.$implicit,n=s.index,i=e.XpG(4);e.BMQ("data-test",e.bMT(1,9,"list-object")),e.R7$(2),e.Y8G("index",n)("object",t)("selectionConfig",e.eq3(11,ae,i.listId)),e.R7$(),e.Y8G("listID",i.listId)("index",n)("object",t)("showThumbnails",!1)("viewMode","list")}}function We(a,s){if(1&a&&(e.j41(0,"ul",24),e.DNE(1,Je,4,13,"li",25),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"paginate"),e.k0s()),2&a){let t;const n=e.XpG(3);e.R7$(),e.Y8G("ngForOf",e.i5U(6,9,null==(t=e.bMT(2,1,n.objectsSelected$))||null==t.payload?null:t.payload.page,e.sMw(12,Oe,e.bMT(3,3,n.paginationOptions$).pageSize,e.bMT(4,5,n.paginationOptions$).currentPage,null==(t=e.bMT(5,7,n.objectsSelected$))||null==t.payload?null:t.payload.page.length)))}}function He(a,s){if(1&a){const t=e.RV6();e.j41(0,"ds-pagination",22),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.bIt("prev",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.pagePrev())})("next",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.pageNext())}),e.DNE(4,We,7,16,"ul",23),e.nI1(5,"async"),e.k0s()}if(2&a){let t,n;const i=e.XpG(2);e.Y8G("paginationOptions",e.bMT(1,5,i.paginationOptions$))("collectionSize",null==(t=e.bMT(2,7,i.objectsSelected$))||null==t.payload?null:t.payload.totalElements)("objects",e.bMT(3,9,i.objectsSelected$))("showPaginator",!1),e.R7$(4),e.Y8G("ngIf",null==(n=e.bMT(5,11,i.objectsSelected$))?null:n.hasSucceeded)}}function Qe(a,s){if(1&a){const t=e.RV6();e.j41(0,"div",14)(1,"ul",15,1),e.mxI("activeIdChange",function(i){e.eBV(t);const r=e.XpG();return e.DH7(r.activateId,i)||(r.activateId=i),e.Njj(i)}),e.j41(3,"li",16)(4,"a",17),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,ze,2,6,"ng-template",18),e.k0s(),e.j41(8,"li",16)(9,"a",17),e.EFF(10),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"translate"),e.k0s(),e.DNE(14,He,6,13,"ng-template",18),e.k0s()(),e.nrm(15,"div",19),e.k0s()}if(2&a){let t;const n=e.sdS(2),i=e.XpG();e.R7$(),e.R50("activeId",i.activateId),e.R7$(2),e.Y8G("ngbNavItem","search"),e.R7$(2),e.JRh(e.bMT(6,6,"admin.access-control.bulk-access-browse.search.header")),e.R7$(3),e.Y8G("ngbNavItem","selected"),e.R7$(2),e.SpI(" ",e.i5U(13,12,"admin.access-control.bulk-access-browse.selected.header",e.eq3(15,Ae,null!=(t=e.bMT(11,8,i.objectsSelected$))&&null!=t.payload&&t.payload.totalElements?null==(t=e.bMT(12,10,i.objectsSelected$))||null==t.payload?null:t.payload.totalElements:"0"))," "),e.R7$(5),e.Y8G("ngbNavOutlet",n)}}let qe=(()=>{class a{constructor(t){this.selectableListService=t,this.activateId="search",this.objectsSelected$=new y.t(null),this.paginationOptions$=new y.t(Object.assign(new T.W,{id:"bas",pageSize:5,currentPage:1})),this.subs=[]}ngOnInit(){this.subs.push(this.selectableListService.getSelectableList(this.listId).pipe((0,Y.F)(),(0,d.T)(t=>this.generatePaginatedListBySelectedElements(t))).subscribe(this.objectsSelected$))}pageNext(){this.paginationOptions$.next(Object.assign(new T.W,this.paginationOptions$.value,{currentPage:this.paginationOptions$.value.currentPage+1}))}pagePrev(){this.paginationOptions$.next(Object.assign(new T.W,this.paginationOptions$.value,{currentPage:this.paginationOptions$.value.currentPage-1}))}calculatePageCount(t,n=0){return n<t?1:Math.ceil(n/t)}generatePaginatedListBySelectedElements(t){const n=new ie.Q({elementsPerPage:this.paginationOptions$.value.pageSize,totalElements:t?.selection.length,totalPages:this.calculatePageCount(this.paginationOptions$.value.pageSize,t?.selection.length),currentPage:this.paginationOptions$.value.currentPage});return n.currentPage>n.totalPages&&(n.currentPage=n.totalPages,this.paginationOptions$.next(Object.assign(new T.W,this.paginationOptions$.value,{currentPage:n.currentPage}))),(0,Le.SP)((0,X.g)(n,t?.selection||[]))}ngOnDestroy(){this.subs.filter(t=>(0,c.a4)(t)).forEach(t=>t.unsubscribe()),this.selectableListService.deselectAll(this.listId)}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(F.K))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-bulk-access-browse"]],inputs:{listId:"listId"},standalone:!0,features:[e.Jv_([{provide:De.EN,useClass:Ne.g}]),e.aNF],decls:5,vars:2,consts:[["acc","ngbAccordion"],["nav","ngbNav"],[3,"activeIds"],[3,"id"],["ngbPanelHeader",""],["ngbPanelContent",""],["ngbPanelToggle","","data-test","browse",1,"w-100","d-flex","gap-3","justify-content-between","collapse-toggle",3,"click"],["type","button","aria-controls","bulk-access-browse-panel-content",1,"btn","btn-link","p-0",3,"click"],[1,"text-right","d-flex","gap-2"],[1,"d-flex","my-auto"],["class","fas fa-chevron-up fa-fw",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],[1,"fas","fa-chevron-up","fa-fw"],[1,"fas","fa-chevron-down","fa-fw"],["id","bulk-access-browse-panel-content"],["ngbNav","",1,"nav-pills",3,"activeIdChange","activeId"],["role","presentation",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[1,"mt-5",3,"ngbNavOutlet"],[1,"mx-n3"],[3,"configuration","selectable","selectionConfig","showThumbnails"],[3,"prev","next","paginationOptions","collectionSize","objects","showPaginator"],["class","list-unstyled ml-4",4,"ngIf"],[1,"list-unstyled","ml-4"],["class","mt-4 mb-4 d-flex",4,"ngFor","ngForOf"],[1,"mt-4","mb-4","d-flex"],[3,"index","object","selectionConfig"],[3,"listID","index","object","showThumbnails","viewMode"]],template:function(n,i){1&n&&(e.j41(0,"ngb-accordion",2,0)(2,"ngb-panel",3),e.DNE(3,Ye,8,6,"ng-template",4)(4,Qe,16,17,"ng-template",5),e.k0s()()),2&n&&(e.Y8G("activeIds","browse"),e.R7$(2),e.Y8G("id","browse"))},dependencies:[A.e,h.Jj,b._f,b.W1,b.CT,b.t3,b.Xc,m.h,m.D9,h.bT,b.Pv,b.Um,b.X9,b.sy,b.Ri,b.m_,we.N,Xe.L,h.Sq,je,ke,Be.Y,Me.v]})}}return a})();var Ke=o(89366);const Ze=["dsAccessControlForm"];function et(a,s){1&a&&e.nrm(0,"span",12)}function tt(a,s){1&a&&e.nrm(0,"span",13)}function nt(a,s){if(1&a){const t=e.RV6();e.j41(0,"div",6),e.bIt("click",function(){e.eBV(t),e.XpG();const i=e.sdS(1);return e.Njj(i.toggle("settings"))}),e.j41(1,"button",7),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.preventDefault())}),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",8)(5,"div",9),e.DNE(6,et,1,0,"span",10)(7,tt,1,0,"span",11),e.k0s()()()}if(2&a){e.XpG();const t=e.sdS(1);e.R7$(),e.BMQ("aria-expanded",t.isExpanded("settings")),e.R7$(),e.SpI(" ",e.bMT(3,4,"admin.access-control.bulk-access-settings.header")," "),e.R7$(4),e.Y8G("ngIf",t.isExpanded("settings")),e.R7$(),e.Y8G("ngIf",!t.isExpanded("settings"))}}function it(a,s){1&a&&e.nrm(0,"ds-access-control-form-container",14,1),2&a&&e.Y8G("showSubmit",!1)}let at=(()=>{class a{getValue(){return this.controlForm.getFormValue()}reset(){this.controlForm.reset()}static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-bulk-access-settings"]],viewQuery:function(n,i){if(1&n&&e.GBs(Ze,5),2&n){let r;e.mGM(r=e.lsd())&&(i.controlForm=r.first)}},exportAs:["dsBulkSettings"],standalone:!0,features:[e.aNF],decls:5,vars:2,consts:[["acc","ngbAccordion"],["dsAccessControlForm",""],[3,"activeIds"],[3,"id"],["ngbPanelHeader",""],["ngbPanelContent",""],["ngbPanelToggle","","data-test","settings",1,"w-100","d-flex","gap-3","justify-content-between","collapse-toggle",3,"click"],["type","button","aria-controls","bulk-access-settings-panel-content",1,"btn","btn-link","p-0",3,"click"],[1,"text-right","d-flex","gap-2"],[1,"d-flex","my-auto"],["class","fas fa-chevron-up fa-fw",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],[1,"fas","fa-chevron-up","fa-fw"],[1,"fas","fa-chevron-down","fa-fw"],["id","bulk-access-settings-panel-content",3,"showSubmit"]],template:function(n,i){1&n&&(e.j41(0,"ngb-accordion",2,0)(2,"ngb-panel",3),e.DNE(3,nt,8,6,"ng-template",4)(4,it,2,1,"ng-template",5),e.k0s()()),2&n&&(e.Y8G("activeIds","settings"),e.R7$(2),e.Y8G("id","settings"))},dependencies:[b._f,b.W1,b.CT,b.t3,b.Xc,m.h,m.D9,h.bT,Ke.o]})}}return a})();const st=["dsBulkSettings"];let rt=(()=>{class a{constructor(t,n){this.bulkAccessControlService=t,this.selectableListService=n,this.listId="bulk-access-list",this.objectsSelected$=new y.t([]),this.subs=[]}ngOnInit(){this.subs.push(this.selectableListService.getSelectableList(this.listId).pipe((0,Y.F)(),(0,d.T)(t=>this.generateIdListBySelectedElements(t))).subscribe(this.objectsSelected$))}canExport(){return this.objectsSelected$.value?.length>0}reset(){this.settings.reset()}submit(){const t=this.settings.getValue(),n=t.bitstream,i=t.item,{file:r}=this.bulkAccessControlService.createPayloadFile({bitstreamAccess:n,itemAccess:i,state:t.state});this.bulkAccessControlService.executeScript(this.objectsSelected$.value||[],r).subscribe()}generateIdListBySelectedElements(t){return t?.selection?.map(n=>n.indexableObject.uuid)}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(te.r),e.rXU(F.K))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-bulk-access"]],viewQuery:function(n,i){if(1&n&&e.GBs(st,5),2&n){let r;e.mGM(r=e.lsd())&&(i.settings=r.first)}},standalone:!0,features:[e.aNF],decls:16,vars:11,consts:[["dsBulkSettings",""],[1,"container"],[3,"listId"],[1,"clearfix","mb-3"],[1,"d-flex","justify-content-end"],[1,"btn","btn-outline-primary","mr-3",3,"click"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"]],template:function(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",1)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"ds-bulk-access-browse",2)(5,"div",3)(6,"ds-bulk-access-settings",null,0)(8,"hr"),e.j41(9,"div",4)(10,"button",5),e.bIt("click",function(){return e.eBV(r),e.Njj(i.reset())}),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"button",6),e.bIt("click",function(){return e.eBV(r),e.Njj(i.submit())}),e.EFF(14),e.nI1(15,"translate"),e.k0s()()()}2&n&&(e.R7$(2),e.JRh(e.bMT(3,5,"admin.access-control.bulk-access.title")),e.R7$(2),e.Y8G("listId",i.listId),e.R7$(7),e.SpI(" ",e.bMT(12,7,"access-control-cancel")," "),e.R7$(2),e.Y8G("dsBtnDisabled",!i.canExport()),e.R7$(),e.SpI(" ",e.bMT(15,9,"access-control-execute")," "))},dependencies:[m.h,m.D9,at,qe,M.A]})}}return a})();var g=o(89417),E=o(7901),O=o(84572),P=o(25558),G=o(96697),V=o(96526),z=o(65007),B=o(3970),J=o(32473),W=o(74449),ot=o(79145),H=o(22978),p=o(80183),Z=o(9284),ee=o(82394),U=o(39806);const lt=a=>({"table-primary":a}),se=a=>({name:a});function ct(a,s){1&a&&e.nrm(0,"ds-loading")}function pt(a,s){if(1&a){const t=e.RV6();e.j41(0,"button",33),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.deleteEPerson(i.eperson))}),e.nrm(2,"i",34),e.k0s()}if(2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.FS9("title",e.i5U(1,1,n.labelPrefix+"table.edit.buttons.remove",e.eq3(4,se,n.dsoNameService.getName(t.eperson))))}}function ut(a,s){if(1&a&&(e.j41(0,"tr",28),e.nI1(1,"async"),e.j41(2,"td"),e.EFF(3),e.k0s(),e.j41(4,"td"),e.EFF(5),e.k0s(),e.j41(6,"td"),e.EFF(7),e.k0s(),e.j41(8,"td")(9,"div",29)(10,"button",30),e.nI1(11,"translate"),e.nrm(12,"i",31),e.k0s(),e.DNE(13,pt,3,6,"button",32),e.k0s()()()),2&a){const t=s.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(12,lt,e.bMT(1,7,n.activeEPerson$)===t.eperson)),e.R7$(3),e.JRh(t.eperson.id),e.R7$(2),e.JRh(n.dsoNameService.getName(t.eperson)),e.R7$(2),e.JRh(t.eperson.email),e.R7$(3),e.FS9("title",e.i5U(11,9,n.labelPrefix+"table.edit.buttons.edit",e.eq3(14,se,n.dsoNameService.getName(t.eperson)))),e.Y8G("routerLink",n.getEditEPeoplePage(t.eperson.id)),e.R7$(3),e.Y8G("ngIf",t.ableToDelete)}}function gt(a,s){if(1&a&&(e.j41(0,"ds-pagination",23),e.nI1(1,"async"),e.j41(2,"div",24)(3,"table",25)(4,"thead")(5,"tr")(6,"th",26),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",26),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",26),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,ut,14,16,"tr",27),e.nI1(20,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,9,i.pageInfoState$))?null:t.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,11,i.labelPrefix+"table.id")),e.R7$(3),e.JRh(e.bMT(11,13,i.labelPrefix+"table.name")),e.R7$(3),e.JRh(e.bMT(14,15,i.labelPrefix+"table.email")),e.R7$(3),e.JRh(e.bMT(17,17,i.labelPrefix+"table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(20,19,i.ePeopleDto$))?null:n.page)}}function dt(a,s){if(1&a&&(e.j41(0,"div",35),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.labelPrefix+"no-items")," ")}}let mt=(()=>{class a{constructor(t,n,i,r,l,u,f,S,C,_){this.epersonService=t,this.translateService=n,this.notificationsService=i,this.authorizationService=r,this.formBuilder=l,this.router=u,this.modalService=f,this.paginationService=S,this.requestService=C,this.dsoNameService=_,this.labelPrefix="admin.access-control.epeople.",this.ePeople$=new y.t((0,X.g)(new ie.Q,[])),this.ePeopleDto$=new y.t({}),this.pageInfoState$=new y.t(void 0),this.searching$=new y.t(!1),this.config=Object.assign(new T.W,{id:"elp",pageSize:5,currentPage:1}),this.subs=[],this.currentSearchQuery="",this.currentSearchScope="metadata",this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}ngOnInit(){this.initialisePage()}initialisePage(){this.searching$.next(!0),this.search({scope:this.currentSearchScope,query:this.currentSearchQuery}),this.activeEPerson$=this.epersonService.getActiveEPerson(),this.subs.push(this.ePeople$.pipe((0,P.n)(t=>t.pageInfo.totalElements>0?(0,O.z)(t.page.map(n=>this.authorizationService.isAuthorized(B._.CanDelete,(0,c.a4)(n)?n.self:void 0).pipe((0,d.T)(i=>{const r=new ot.h;return r.ableToDelete=i,r.eperson=n,r})))).pipe((0,d.T)(n=>(0,X.g)(t.pageInfo,n))):[t])).subscribe(t=>{this.searching$.next(!1),this.ePeopleDto$.next(t),this.pageInfoState$.next(t.pageInfo)}))}search(t){this.searching$.next(!0),(0,c.a4)(this.findListOptionsSub)&&this.findListOptionsSub.unsubscribe(),this.findListOptionsSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,P.n)(n=>{const i=t.query,r=t.scope;return null!=i&&this.currentSearchQuery!==i&&(this.router.navigate([(0,v.bL)()],{queryParamsHandling:"merge"}),this.currentSearchQuery=i,this.paginationService.resetPage(this.config.id)),null!=r&&this.currentSearchScope!==r&&(this.router.navigate([(0,v.bL)()],{queryParamsHandling:"merge"}),this.currentSearchScope=r,this.paginationService.resetPage(this.config.id)),this.epersonService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,p.v7)()).subscribe(n=>{this.ePeople$.next(n.payload),this.pageInfoState$.next(n.payload.pageInfo)})}deleteEPerson(t){if((0,c.a4)(t.id)){const n=this.modalService.open(Z.M);n.componentInstance.name=this.dsoNameService.getName(t),n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,G.s)(1)).subscribe(i=>{i&&(0,c.a4)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,p.qD)()).subscribe(r=>{r.hasSucceeded?this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:this.dsoNameService.getName(t)})):this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.deleted.success",{id:t.id,statusCode:r.statusCode,errorMessage:r.errorMessage}))})})}}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){this.subs.filter(t=>(0,c.a4)(t)).forEach(t=>t.unsubscribe())}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}getEditEPeoplePage(t){return(0,v.Ax)(t)}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(W.EPersonDataService),e.rXU(m.c$),e.rXU(U.I),e.rXU(z.AuthorizationDataService),e.rXU(g.ze),e.rXU(E.Ix),e.rXU(b.Bq),e.rXU(H.m),e.rXU(J.B),e.rXU(V.f))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-epeople-registry"]],standalone:!0,features:[e.aNF],decls:46,vars:40,consts:[[1,"container"],[1,"epeople-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success","addEPerson-button",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline","ml-1"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"ngSubmit","formGroup"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"search-button","btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epeople",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm","access-control-editEPersonButton",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["class","delete-button btn btn-outline-danger btn-sm access-control-deleteEPersonButton",3,"title","click",4,"ngIf"],[1,"delete-button","btn","btn-outline-danger","btn-sm","access-control-deleteEPersonButton",3,"click","title"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(n,i){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"div")(8,"button",5),e.nrm(9,"i",6),e.j41(10,"span",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"h2",8),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"form",9),e.bIt("ngSubmit",function(){return i.search(i.searchForm.value)}),e.j41(17,"div")(18,"select",10)(19,"option",11),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"option",12),e.EFF(23),e.nI1(24,"translate"),e.k0s()()(),e.j41(25,"div",13)(26,"div",14),e.nrm(27,"input",15),e.nI1(28,"translate"),e.nI1(29,"translate"),e.j41(30,"span",16)(31,"button",17),e.nrm(32,"i",18),e.EFF(33),e.nI1(34,"translate"),e.k0s()()()(),e.j41(35,"div")(36,"button",19),e.bIt("click",function(){return i.clearFormAndResetResult()}),e.EFF(37),e.nI1(38,"translate"),e.k0s()()(),e.DNE(39,ct,1,0,"ds-loading",20),e.nI1(40,"async"),e.DNE(41,gt,21,21,"ds-pagination",21),e.nI1(42,"async"),e.nI1(43,"async"),e.DNE(44,dt,3,3,"div",22),e.nI1(45,"async"),e.k0s()()()),2&n){let r,l;e.R7$(5),e.JRh(e.bMT(6,14,i.labelPrefix+"head")),e.R7$(3),e.Y8G("routerLink","create"),e.R7$(3),e.JRh(e.bMT(12,16,i.labelPrefix+"button.add")),e.R7$(3),e.SpI(" ",e.bMT(15,18,i.labelPrefix+"search.head")," "),e.R7$(2),e.Y8G("formGroup",i.searchForm),e.R7$(4),e.JRh(e.bMT(21,20,i.labelPrefix+"search.scope.metadata")),e.R7$(3),e.JRh(e.bMT(24,22,i.labelPrefix+"search.scope.email")),e.R7$(4),e.Y8G("placeholder",e.bMT(28,24,i.labelPrefix+"search.placeholder")),e.BMQ("aria-label",e.bMT(29,26,i.labelPrefix+"search.placeholder")),e.R7$(6),e.SpI(" ",e.bMT(34,28,i.labelPrefix+"search.button")," "),e.R7$(4),e.JRh(e.bMT(38,30,i.labelPrefix+"button.see-all")),e.R7$(2),e.Y8G("ngIf",e.bMT(40,32,i.searching$)),e.R7$(2),e.Y8G("ngIf",(null==(r=e.bMT(42,34,i.pageInfoState$))?null:r.totalElements)>0&&!0!==e.bMT(43,36,i.searching$)),e.R7$(3),e.Y8G("ngIf",0===(null==(l=e.bMT(45,38,i.pageInfoState$))?null:l.totalElements))}},dependencies:[m.h,m.D9,E.iI,E.Wk,h.Jj,h.bT,g.X1,g.qT,g.xH,g.y7,g.me,g.wz,g.BC,g.cb,g.j4,g.JD,ee.v,A.e,h.YU,h.Sq],encapsulation:2})}}return a})();var R=o(7673),re=o(70152),ht=o(70980),ft=o(67116),bt=o(48156),Q=o(44494),oe=o(26349),vt=o(48500),le=o(33126),ce=o(13143),k=o(67600),_t=o(22198);class St{static createValidator(s){return t=>s.getEPersonByEmail(t.value).pipe((0,p.yd)(),(0,d.T)(n=>n.payload?{emailTaken:!0}:null))}}const pe=a=>[a];function It(a,s){1&a&&e.nrm(0,"div")}function Pt(a,s){if(1&a&&(e.j41(0,"h1",14),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,1,t.messagePrefix+".create"))}}function yt(a,s){if(1&a&&(e.j41(0,"h1",14),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,1,t.messagePrefix+".edit"))}}function xt(a,s){if(1&a){const t=e.RV6();e.j41(0,"div",15)(1,"button",16),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.resetPassword())}),e.nrm(3,"i",17),e.EFF(4),e.nI1(5,"translate"),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(),e.Y8G("dsBtnDisabled",!0!==e.bMT(2,2,t.canReset$)),e.R7$(3),e.SpI(" ",e.bMT(5,4,"admin.access-control.epeople.actions.reset")," ")}}function Ct(a,s){if(1&a){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.impersonate())}),e.nrm(1,"i",20),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"admin.access-control.epeople.actions.impersonate")," "))}function Et(a,s){if(1&a){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.stopImpersonating())}),e.nrm(1,"i",20),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"admin.access-control.epeople.actions.stop-impersonating")," "))}function Rt(a,s){if(1&a&&(e.j41(0,"div",15),e.DNE(1,Ct,4,3,"button",18)(2,Et,4,3,"button",18),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Y8G("ngIf",!t.isImpersonated),e.R7$(),e.Y8G("ngIf",t.isImpersonated)}}function Gt(a,s){if(1&a){const t=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.delete())}),e.nrm(1,"i",22),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"admin.access-control.epeople.actions.delete")," "))}function $t(a,s){1&a&&e.nrm(0,"ds-loading",23),2&a&&e.Y8G("showMessage",!1)}function Ft(a,s){1&a&&e.nrm(0,"ds-loading",23),2&a&&e.Y8G("showMessage",!1)}function Tt(a,s){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td",31),e.EFF(2),e.k0s(),e.j41(3,"td",31)(4,"a",32),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.groupsDataService.startEditingNewGroup(i))}),e.EFF(5),e.k0s()(),e.j41(6,"td",31),e.EFF(7),e.nI1(8,"async"),e.k0s()()}if(2&a){let t;const n=s.$implicit,i=e.XpG(3);e.R7$(2),e.JRh(n.id),e.R7$(2),e.Y8G("routerLink",e.eq3(6,pe,i.groupsDataService.getGroupEditPageRouterLink(n))),e.R7$(),e.SpI(" ",i.dsoNameService.getName(n)," "),e.R7$(2),e.SpI(" ",i.dsoNameService.getName(null==(t=e.bMT(8,4,n.object))?null:t.payload)," ")}}function kt(a,s){if(1&a){const t=e.RV6();e.j41(0,"ds-pagination",26),e.nI1(1,"async"),e.bIt("pageChange",function(i){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onPageChange(i))}),e.j41(2,"div",27)(3,"table",28)(4,"thead")(5,"tr")(6,"th",29),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",29),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",29),e.EFF(13),e.nI1(14,"translate"),e.k0s()()(),e.j41(15,"tbody"),e.DNE(16,Tt,9,8,"tr",30),e.nI1(17,"async"),e.k0s()()()()}if(2&a){let t,n;const i=e.XpG(2);e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,8,i.groups$))||null==t.payload?null:t.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,10,i.messagePrefix+".table.id")),e.R7$(3),e.JRh(e.bMT(11,12,i.messagePrefix+".table.name")),e.R7$(3),e.JRh(e.bMT(14,14,i.messagePrefix+".table.collectionOrCommunity")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(17,16,i.groups$))||null==n.payload?null:n.payload.page)}}function jt(a,s){if(1&a&&(e.j41(0,"div",33)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div")(5,"button",34),e.EFF(6),e.nI1(7,"translate"),e.k0s()()()),2&a){const t=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,3,t.messagePrefix+".memberOfNoGroups")),e.R7$(3),e.Y8G("routerLink",e.eq3(7,pe,t.groupsDataService.getGroupRegistryRouterLink())),e.R7$(),e.JRh(e.bMT(7,5,t.messagePrefix+".goToGroups"))}}function Nt(a,s){if(1&a&&(e.j41(0,"div")(1,"h2"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Ft,1,1,"ds-loading",12),e.nI1(5,"async"),e.nI1(6,"dsHasNoValue"),e.DNE(7,kt,18,18,"ds-pagination",24),e.nI1(8,"async"),e.DNE(9,jt,8,9,"div",25),e.nI1(10,"async"),e.k0s()),2&a){let t,n;const i=e.XpG();e.R7$(2),e.JRh(e.bMT(3,4,i.messagePrefix+".groupsEPersonIsMemberOf")),e.R7$(2),e.Y8G("ngIf",e.bMT(6,8,e.bMT(5,6,i.groups$))),e.R7$(3),e.Y8G("ngIf",(null==(t=e.bMT(8,10,i.groups$))||null==t.payload?null:t.payload.totalElements)>0),e.R7$(2),e.Y8G("ngIf",0===(null==(n=e.bMT(10,12,i.groups$))||null==n.payload?null:n.payload.totalElements))}}let ue=(()=>{class a{constructor(t,n,i,r,l,u,f,S,C,_,j,q,_e,Se,Ie){this.changeDetectorRef=t,this.epersonService=n,this.groupsDataService=i,this.formBuilderService=r,this.translateService=l,this.notificationsService=u,this.authService=f,this.authorizationService=S,this.modalService=C,this.paginationService=_,this.requestService=j,this.epersonRegistrationService=q,this.dsoNameService=_e,this.route=Se,this.router=Ie,this.labelPrefix="admin.access-control.epeople.form.",this.formId="eperson-form",this.messagePrefix="admin.access-control.epeople.form",this.formLayout={firstName:{grid:{host:"row"}},lastName:{grid:{host:"row"}},email:{grid:{host:"row"}},canLogIn:{grid:{host:"col col-sm-6 d-inline-block"}},requireCertificate:{grid:{host:"col col-sm-6 d-inline-block"}}},this.submitForm=new e.bkB,this.cancelForm=new e.bkB,this.subs=[],this.config=Object.assign(new T.W,{id:"gem",pageSize:5,currentPage:1}),this.isImpersonated=!1,this.displayResetPassword=!1,this.submitLabel="form.create"}ngOnInit(){this.activeEPerson$=this.epersonService.getActiveEPerson(),this.subs.push(this.activeEPerson$.subscribe(t=>{this.epersonInitial=t,(0,c.a4)(t)&&(this.isImpersonated=this.authService.isImpersonatingUser(t.id),this.displayResetPassword=!0,this.submitLabel="form.submit")})),this.initialisePage()}initialisePage(){this.route.snapshot.params.id&&this.subs.push(this.epersonService.findById(this.route.snapshot.params.id).subscribe(t=>{this.epersonService.editEPerson(t.payload)})),this.firstName=new I.rA_({id:"firstName",label:this.translateService.instant(`${this.messagePrefix}.firstName`),name:"firstName",validators:{required:null},required:!0}),this.lastName=new I.rA_({id:"lastName",label:this.translateService.instant(`${this.messagePrefix}.lastName`),name:"lastName",validators:{required:null},required:!0}),this.email=new I.rA_({id:"email",label:this.translateService.instant(`${this.messagePrefix}.email`),name:"email",validators:{required:null,pattern:"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"},required:!0,errorMessages:{emailTaken:"error.validation.emailTaken",pattern:"error.validation.NotValidEmail"},hint:this.translateService.instant(`${this.messagePrefix}.emailHint`)}),this.canLogIn=new I.M7d({id:"canLogIn",label:this.translateService.instant(`${this.messagePrefix}.canLogIn`),name:"canLogIn",value:null==this.epersonInitial||this.epersonInitial.canLogIn}),this.requireCertificate=new I.M7d({id:"requireCertificate",label:this.translateService.instant(`${this.messagePrefix}.requireCertificate`),name:"requireCertificate",value:null!=this.epersonInitial&&this.epersonInitial.requireCertificate}),this.formModel=[this.firstName,this.lastName,this.email,this.canLogIn,this.requireCertificate],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.subs.push(this.activeEPerson$.subscribe(t=>{null!=t&&(this.groups$=this.groupsDataService.findListByHref(t._links.groups.href,{currentPage:1,elementsPerPage:this.config.pageSize},void 0,void 0,(0,k.s)("object"))),this.formGroup.patchValue({firstName:null!=t?t.firstMetadataValue("eperson.firstname"):"",lastName:null!=t?t.firstMetadataValue("eperson.lastname"):"",email:null!=t?t.email:"",canLogIn:null==t||t.canLogIn,requireCertificate:null!=t&&t.requireCertificate}),null===t&&this.formGroup.controls.email&&(this.formGroup.controls.email.setAsyncValidators(St.createValidator(this.epersonService)),this.emailValueChangeSubscribe=this.email.valueChanges.pipe((0,re.B)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()}))})),this.groups$=this.activeEPerson$.pipe((0,P.n)(t=>(0,O.z)([(0,R.of)(t),this.paginationService.getFindListOptions(this.config.id,{currentPage:1,elementsPerPage:this.config.pageSize})])),(0,P.n)(([t,n])=>null!=t?this.groupsDataService.findListByHref(t._links.groups.href,n,!0,!0,(0,k.s)("object")):(0,R.of)(void 0))),this.groupsPageInfoState$=this.groups$.pipe((0,d.T)(t=>t.payload.pageInfo)),this.canImpersonate$=this.activeEPerson$.pipe((0,P.n)(t=>(0,c.a4)(t)?this.authorizationService.isAuthorized(B._.LoginOnBehalfOf,t.self):(0,R.of)(!1))),this.canDelete$=this.activeEPerson$.pipe((0,P.n)(t=>this.authorizationService.isAuthorized(B._.CanDelete,(0,c.a4)(t)?t.self:void 0))),this.canReset$=(0,R.of)(!0)}onCancel(){this.epersonService.cancelEditEPerson(),this.cancelForm.emit(),this.router.navigate([(0,v.bL)()])}onSubmit(){this.activeEPerson$.pipe((0,G.s)(1)).subscribe(t=>{const n={metadata:{"eperson.firstname":[{value:this.firstName.value}],"eperson.lastname":[{value:this.lastName.value}]},email:this.email.value,canLogIn:this.canLogIn.value,requireCertificate:this.requireCertificate.value};null==t?this.createNewEPerson(n):this.editEPerson(t,n)})}createNewEPerson(t){const n=Object.assign(new oe.f,t);this.epersonService.create(n).pipe((0,p.qD)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.created.success",{name:this.dsoNameService.getName(n)})),this.submitForm.emit(n),this.epersonService.clearEPersonRequests(),this.router.navigateByUrl((0,v.bL)())):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.created.failure",{name:this.dsoNameService.getName(n)})),this.cancelForm.emit())}),this.showNotificationIfEmailInUse(n,"created")}editEPerson(t,n){const i=Object.assign(new oe.f,{id:t.id,metadata:{"eperson.firstname":[{value:this.firstName.value?this.firstName.value:t.firstMetadataValue("eperson.firstname")}],"eperson.lastname":[{value:this.lastName.value?this.lastName.value:t.firstMetadataValue("eperson.lastname")}]},email:(0,c.a4)(n.email)?n.email:t.email,canLogIn:(0,c.a4)(n.canLogIn)?n.canLogIn:t.canLogIn,requireCertificate:(0,c.a4)(n.requireCertificate)?n.requireCertificate:t.requireCertificate,_links:t._links});this.epersonService.updateEPerson(i).pipe((0,p.qD)()).subscribe(l=>{l.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.edited.success",{name:this.dsoNameService.getName(i)})),this.submitForm.emit(i),this.router.navigateByUrl((0,v.bL)())):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.edited.failure",{name:this.dsoNameService.getName(i)})),this.cancelForm.emit())}),null!=n.email&&n.email!==t.email&&this.showNotificationIfEmailInUse(i,"edited")}onPageChange(t){this.updateGroups({currentPage:t,elementsPerPage:this.config.pageSize})}impersonate(){this.authService.impersonate(this.epersonInitial.id),this.isImpersonated=!0}delete(){this.activeEPerson$.pipe((0,G.s)(1),(0,P.n)(t=>{const n=this.modalService.open(Z.M);return n.componentInstance.name=this.dsoNameService.getName(t),n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,G.s)(1),(0,P.n)(i=>i&&(0,c.a4)(t.id)?(this.canDelete$=(0,R.of)(!1),this.epersonService.deleteEPerson(t).pipe((0,p.qD)(),(0,d.T)(r=>({restResponse:r,eperson:t})))):(0,R.of)(null)),(0,ht.j)(()=>this.canDelete$=(0,R.of)(!0)))})).subscribe(({restResponse:t,eperson:n})=>{t?.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:this.dsoNameService.getName(n)})),this.router.navigate([(0,v.bL)()])):this.notificationsService.error(`Error occurred when trying to delete EPerson with id: ${n?.id} with code: ${t?.statusCode} and message: ${t?.errorMessage}`),this.cancelForm.emit()})}stopImpersonating(){this.authService.stopImpersonatingAndRefresh(),this.isImpersonated=!1}resetPassword(){(0,c.a4)(this.epersonInitial.email)&&this.epersonRegistrationService.registerEmail(this.epersonInitial.email,null,vt.TYPE_REQUEST_FORGOT).pipe((0,p.qD)()).subscribe(t=>{t.hasSucceeded?this.notificationsService.success(this.translateService.get("admin.access-control.epeople.actions.reset"),this.translateService.get("forgot-email.form.success.content",{email:this.epersonInitial.email})):this.notificationsService.error(this.translateService.get("forgot-email.form.error.head"),this.translateService.get("forgot-email.form.error.content",{email:this.epersonInitial.email}))})}ngOnDestroy(){this.subs.filter(t=>(0,c.a4)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id),(0,c.a4)(this.emailValueChangeSubscribe)&&this.emailValueChangeSubscribe.unsubscribe()}showNotificationIfEmailInUse(t,n){this.subs.push(this.epersonService.searchByScope("email",t.email,{currentPage:1,elementsPerPage:0}).pipe((0,p.yd)(),(0,p.Bo)()).subscribe(i=>{i.totalElements>0&&this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification."+n+".failure.emailInUse",{name:this.dsoNameService.getName(t),email:t.email}))}))}updateGroups(t){this.subs.push(this.activeEPerson$.subscribe(n=>{this.groups$=this.groupsDataService.findListByHref(n._links.groups.href,t)}))}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(e.gRc),e.rXU(W.EPersonDataService),e.rXU(Q.GroupDataService),e.rXU(le.j),e.rXU(m.c$),e.rXU(U.I),e.rXU(ft.uR),e.rXU(z.AuthorizationDataService),e.rXU(b.Bq),e.rXU(H.m),e.rXU(J.B),e.rXU(bt.f),e.rXU(V.f),e.rXU(E.nX),e.rXU(E.Ix))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-eperson-form"]],outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},standalone:!0,features:[e.aNF],decls:23,vars:25,consts:[["createHeader",""],["editHeader",""],[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],[3,"submitForm","formId","formModel","formGroup","formLayout","displayCancel","submitLabel"],["before","",1,"btn-group"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["between","","class","btn-group",4,"ngIf"],["after","","class","btn btn-danger delete-button","type","button",3,"click",4,"ngIf"],[3,"showMessage",4,"ngIf"],[4,"ngIf"],[1,"border-bottom","pb-2"],["between","",1,"btn-group"],["type","button",1,"btn","btn-primary",3,"click","dsBtnDisabled"],[1,"fa","fa-key"],["class","btn btn-primary","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-user-secret"],["after","","type","button",1,"btn","btn-danger","delete-button",3,"click"],[1,"fas","fa-trash"],[3,"showMessage"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"pageChange","paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"click","routerLink"],["role","alert",1,"alert","alert-info","w-100","mb-2"],[1,"btn","btn-primary",3,"routerLink"]],template:function(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4),e.DNE(3,It,1,0,"div",5),e.nI1(4,"async"),e.DNE(5,Pt,3,3,"ng-template",null,0,e.C5r)(7,yt,3,3,"ng-template",null,1,e.C5r),e.j41(9,"ds-form",6),e.bIt("submitForm",function(){return e.eBV(r),e.Njj(i.onSubmit())}),e.j41(10,"div",7)(11,"button",8),e.bIt("click",function(){return e.eBV(r),e.Njj(i.onCancel())}),e.nrm(12,"i",9),e.EFF(13),e.nI1(14,"translate"),e.k0s()(),e.DNE(15,xt,6,6,"div",10)(16,Rt,3,2,"div",10),e.nI1(17,"async"),e.DNE(18,Gt,4,3,"button",11),e.nI1(19,"async"),e.k0s(),e.DNE(20,$t,1,1,"ds-loading",12)(21,Nt,11,14,"div",13),e.nI1(22,"async"),e.k0s()()()}if(2&n){const r=e.sdS(6),l=e.sdS(8);e.R7$(3),e.Y8G("ngIf",e.bMT(4,15,i.activeEPerson$))("ngIfThen",l)("ngIfElse",r),e.R7$(6),e.Y8G("formId",i.formId)("formModel",i.formModel)("formGroup",i.formGroup)("formLayout",i.formLayout)("displayCancel",!1)("submitLabel",i.submitLabel),e.R7$(4),e.SpI(" ",e.bMT(14,17,i.messagePrefix+".return")," "),e.R7$(2),e.Y8G("ngIf",i.displayResetPassword),e.R7$(),e.Y8G("ngIf",e.bMT(17,19,i.canImpersonate$)),e.R7$(2),e.Y8G("ngIf",e.bMT(19,21,i.canDelete$)),e.R7$(2),e.Y8G("ngIf",!i.formGroup),e.R7$(),e.Y8G("ngIf",e.bMT(22,23,i.activeEPerson$))}},dependencies:[ce.s,h.bT,h.pM,h.Jj,m.h,m.D9,ee.v,A.e,E.Wk,_t.n,M.A],encapsulation:2})}}return a})();var Dt=o(81225),Mt=o(25499);const Bt=[(0,k.s)("groups")];let Lt=(()=>{class a{constructor(t,n){this.ePersonService=t,this.store=n}resolve(t,n){const i=this.ePersonService.findById(t.params.id,!0,!1,...Bt).pipe((0,p.qD)());return i.subscribe(r=>{this.store.dispatch(new Dt.j(n.url,r.payload))}),i}static{this.\u0275fac=function(n){return new(n||a)(e.KVO(W.EPersonDataService),e.KVO(Mt.il))}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var wt=o(88280),Xt=o(64611),At=o(54671),ge=o(13989),Ot=o(31924),Vt=o(6041),Ut=o(10046),Yt=o(16292),zt=o(47978),de=o(48674),Jt=o(72796);const Wt=()=>["top","right","bottom"],Ht=a=>({content:"admin.access-control.groups.form.tooltip.editGroup.addSubgroups",id:"edit-group-add-subgroups",iconPlacement:"right",tooltipPlacement:a}),me=a=>[a],he=a=>({name:a});function Qt(a,s){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td",18),e.EFF(2),e.k0s(),e.j41(3,"td",18)(4,"a",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.groupDataService.startEditingNewGroup(i))}),e.EFF(5),e.k0s()(),e.j41(6,"td",18),e.EFF(7),e.nI1(8,"async"),e.k0s(),e.j41(9,"td",18)(10,"div",20)(11,"button",21),e.nI1(12,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.deleteSubgroupFromGroup(i))}),e.nrm(13,"i",22),e.k0s()()()()}if(2&a){let t;const n=s.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(n.id),e.R7$(2),e.Y8G("routerLink",e.eq3(10,me,i.groupDataService.getGroupEditPageRouterLink(n))),e.R7$(),e.SpI(" ",i.dsoNameService.getName(n)," "),e.R7$(2),e.JRh(i.dsoNameService.getName(null==(t=e.bMT(8,5,n.object))?null:t.payload)),e.R7$(4),e.FS9("title",e.i5U(12,7,i.messagePrefix+".table.edit.buttons.remove",e.eq3(12,he,i.dsoNameService.getName(n))))}}function qt(a,s){if(1&a&&(e.j41(0,"ds-pagination",13),e.nI1(1,"async"),e.j41(2,"div",14)(3,"table",15)(4,"thead")(5,"tr")(6,"th",16),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",16),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",16),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,Qt,14,14,"tr",17),e.nI1(20,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,9,i.subGroups$))||null==t.payload?null:t.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,11,i.messagePrefix+".table.id")),e.R7$(3),e.JRh(e.bMT(11,13,i.messagePrefix+".table.name")),e.R7$(3),e.JRh(e.bMT(14,15,i.messagePrefix+".table.collectionOrCommunity")),e.R7$(3),e.JRh(e.bMT(17,17,i.messagePrefix+".table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(20,19,i.subGroups$))||null==n.payload?null:n.payload.page)}}function Kt(a,s){if(1&a&&(e.j41(0,"div",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".no-subgroups-yet")," ")}}function Zt(a,s){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".search.head")," ")}}function en(a,s){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td",18),e.EFF(2),e.k0s(),e.j41(3,"td",18)(4,"a",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.groupDataService.startEditingNewGroup(i))}),e.EFF(5),e.k0s()(),e.j41(6,"td",18),e.EFF(7),e.nI1(8,"async"),e.k0s(),e.j41(9,"td",18)(10,"div",20)(11,"button",25),e.nI1(12,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.addSubgroupToGroup(i))}),e.nrm(13,"i",26),e.k0s()()()()}if(2&a){let t;const n=s.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(n.id),e.R7$(2),e.Y8G("routerLink",e.eq3(10,me,i.groupDataService.getGroupEditPageRouterLink(n))),e.R7$(),e.SpI(" ",i.dsoNameService.getName(n)," "),e.R7$(2),e.JRh(i.dsoNameService.getName(null==(t=e.bMT(8,5,n.object))?null:t.payload)),e.R7$(4),e.FS9("title",e.i5U(12,7,i.messagePrefix+".table.edit.buttons.add",e.eq3(12,he,i.dsoNameService.getName(n))))}}function tn(a,s){if(1&a&&(e.j41(0,"ds-pagination",13),e.nI1(1,"async"),e.j41(2,"div",14)(3,"table",24)(4,"thead")(5,"tr")(6,"th",16),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",16),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",16),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th",18),e.EFF(16),e.nI1(17,"translate"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,en,14,14,"tr",17),e.nI1(20,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.configSearch)("collectionSize",null==(t=e.bMT(1,9,i.searchResults$))||null==t.payload?null:t.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,11,i.messagePrefix+".table.id")),e.R7$(3),e.JRh(e.bMT(11,13,i.messagePrefix+".table.name")),e.R7$(3),e.JRh(e.bMT(14,15,i.messagePrefix+".table.collectionOrCommunity")),e.R7$(3),e.JRh(e.bMT(17,17,i.messagePrefix+".table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(20,19,i.searchResults$))||null==n.payload?null:n.payload.page)}}function nn(a,s){if(1&a&&(e.j41(0,"div",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".no-items")," ")}}var L=function(a){return a[a.Members=0]="Members",a[a.ActiveGroup=1]="ActiveGroup",a[a.SearchResults=2]="SearchResults",a}(L||{});let an=(()=>{class a{constructor(t,n,i,r,l,u,f){this.groupDataService=t,this.translateService=n,this.notificationsService=i,this.formBuilder=r,this.paginationService=l,this.router=u,this.dsoNameService=f,this.searchResults$=new y.t(void 0),this.subGroups$=new y.t(void 0),this.subs=new Map,this.configSearch=Object.assign(new T.W,{id:"ssgl",pageSize:5,currentPage:1}),this.config=Object.assign(new T.W,{id:"sgl",pageSize:5,currentPage:1}),this.currentSearchQuery=""}ngOnInit(){this.searchForm=this.formBuilder.group({query:""}),this.subs.set(L.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveSubGroups(),this.search({query:""}))})),this.subGroupsPageInfoState$=this.subGroups$.pipe((0,d.T)(t=>t?.payload?.pageInfo))}retrieveSubGroups(){this.unsubFrom(L.Members),this.subs.set(L.Members,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,P.n)(t=>this.groupDataService.findListByHref(this.groupBeingEdited._links.subgroups.href,{currentPage:t.currentPage,elementsPerPage:t.pageSize},!0,!0,(0,k.s)("object")))).subscribe(t=>{this.subGroups$.next(t)}))}deleteSubgroupFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,G.s)(1)).subscribe(n=>{if(null!=n){const i=this.groupDataService.deleteSubGroupFromGroup(n,t);this.showNotifications("deleteSubgroup",i,this.dsoNameService.getName(t),n),null!=this.currentSearchQuery&&this.search({query:this.currentSearchQuery})}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addSubgroupToGroup(t){this.groupDataService.getActiveGroup().pipe((0,G.s)(1)).subscribe(n=>{if(null!=n)if(n.uuid!==t.uuid){const i=this.groupDataService.addSubGroupToGroup(n,t);this.showNotifications("addSubgroup",i,this.dsoNameService.getName(t),n),null!=this.currentSearchQuery&&this.search({query:this.currentSearchQuery})}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.subgroupToAddIsActiveGroup"));else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){this.unsubFrom(L.SearchResults),this.subs.set(L.SearchResults,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,P.n)(n=>{const i=t.query;return null!=i&&this.currentSearchQuery!==i&&this.groupBeingEdited&&(this.currentSearchQuery=i,this.paginationService.resetPage(this.configSearch.id)),this.searchDone=!0,this.groupDataService.searchNonMemberGroups(this.currentSearchQuery,this.groupBeingEdited.id,{currentPage:n.currentPage,elementsPerPage:n.pageSize},!1,!0,(0,k.s)("object"))}),(0,p.bD)(),(0,d.T)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))})).subscribe(n=>{this.searchResults$.next(n)}))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,i,r){n.pipe((0,p.qD)()).subscribe(l=>{l.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:i})),this.groupDataService.clearGroupLinkRequests(r._links.subgroups.href)):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:i}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(Q.GroupDataService),e.rXU(m.c$),e.rXU(U.I),e.rXU(g.ze),e.rXU(H.m),e.rXU(E.Ix),e.rXU(V.f))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-subgroups-list"]],inputs:{messagePrefix:"messagePrefix"},standalone:!0,features:[e.aNF],decls:30,vars:29,consts:[[1,"border-bottom","pb-2"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],["id","search",1,"border-bottom","pb-2"],[4,"dsContextHelp"],[1,"d-flex","justify-content-between",3,"ngSubmit","formGroup"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group","mr-3"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary","float-right",3,"click"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","subgroupsOfGroup",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"click","routerLink"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-danger","btn-sm","deleteButton",3,"click","title"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","groupsSearch",1,"table","table-striped","table-hover","table-bordered"],[1,"btn","btn-outline-primary","btn-sm","addButton",3,"click","title"],[1,"fas","fa-plus","fa-fw"]],template:function(n,i){if(1&n&&(e.qex(0),e.j41(1,"h3",0),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"h4"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,qt,21,21,"ds-pagination",1),e.nI1(8,"async"),e.DNE(9,Kt,3,3,"div",2),e.nI1(10,"async"),e.j41(11,"h4",3),e.DNE(12,Zt,3,3,"span",4),e.k0s(),e.j41(13,"form",5),e.bIt("ngSubmit",function(){return i.search(i.searchForm.value)}),e.j41(14,"div",6)(15,"div",7),e.nrm(16,"input",8),e.j41(17,"span",9)(18,"button",10),e.nrm(19,"i",11),e.EFF(20),e.nI1(21,"translate"),e.k0s()()()(),e.j41(22,"div")(23,"button",12),e.bIt("click",function(){return i.clearFormAndResetResult()}),e.EFF(24),e.nI1(25,"translate"),e.k0s()()(),e.DNE(26,tn,21,21,"ds-pagination",1),e.nI1(27,"async"),e.DNE(28,nn,3,3,"div",2),e.nI1(29,"async"),e.bVm()),2&n){let r,l,u,f;e.R7$(2),e.JRh(e.bMT(3,10,i.messagePrefix+".head")),e.R7$(3),e.JRh(e.bMT(6,12,i.messagePrefix+".headSubgroups")),e.R7$(2),e.Y8G("ngIf",(null==(r=e.bMT(8,14,i.subGroups$))||null==r.payload?null:r.payload.totalElements)>0),e.R7$(2),e.Y8G("ngIf",0===(null==(l=e.bMT(10,16,i.subGroups$))||null==l.payload?null:l.payload.totalElements)),e.R7$(3),e.Y8G("dsContextHelp",e.eq3(27,Ht,e.lJ4(26,Wt))),e.R7$(),e.Y8G("formGroup",i.searchForm),e.R7$(7),e.SpI(" ",e.bMT(21,18,i.messagePrefix+".search.button")," "),e.R7$(4),e.SpI(" ",e.bMT(25,20,i.messagePrefix+".button.see-all")," "),e.R7$(2),e.Y8G("ngIf",(null==(u=e.bMT(27,22,i.searchResults$))||null==u.payload?null:u.payload.totalElements)>0),e.R7$(2),e.Y8G("ngIf",0===(null==(f=e.bMT(29,24,i.searchResults$))||null==f.payload?null:f.payload.totalElements)&&i.searchDone)}},dependencies:[E.Wk,h.Jj,h.Sq,de.G,m.h,m.D9,g.X1,g.qT,g.me,g.BC,g.cb,g.j4,g.JD,A.e,h.bT],encapsulation:2})}}return a})();class sn{static createValidator(s){return t=>s.searchGroups(t.value,{currentPage:1,elementsPerPage:100}).pipe((0,p.Ar)(),(0,d.T)(n=>n.filter(i=>i.name===t.value)),(0,d.T)(n=>n.length>0?{groupExists:!0}:null))}}const rn=()=>["right","bottom"],on=a=>({content:"admin.access-control.groups.form.tooltip.editGroupPage",id:"edit-group-page",iconPlacement:"right",tooltipPlacement:a}),ln=(a,s,t)=>({name:a,comcol:s,comcolEditRolesRoute:t});function cn(a,s){1&a&&e.nrm(0,"div")}function pn(a,s){if(1&a&&(e.j41(0,"h1",12),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,1,t.messagePrefix+".head.create"))}}function un(a,s){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".head.edit")," ")}}function gn(a,s){1&a&&(e.j41(0,"h1",12),e.DNE(1,un,3,3,"span",13),e.k0s()),2&a&&(e.R7$(),e.Y8G("dsContextHelp",e.eq3(2,on,e.lJ4(1,rn))))}function dn(a,s){if(1&a&&e.nrm(0,"ds-alert",15),2&a){const t=e.XpG(2);e.Y8G("type",t.AlertType.Warning)("content",t.messagePrefix+".alert.permanent")}}function mn(a,s){if(1&a&&(e.nrm(0,"ds-alert",15),e.nI1(1,"async"),e.nI1(2,"translate")),2&a){const t=e.XpG().ngIf,n=e.XpG(2);e.Y8G("type",n.AlertType.Warning)("content",e.i5U(2,4,n.messagePrefix+".alert.workflowGroup",e.sMw(7,ln,n.dsoNameService.getName(t),t.type,e.bMT(1,2,n.linkedEditRolesRoute$))))}}function hn(a,s){if(1&a&&(e.qex(0),e.DNE(1,mn,3,11,"ds-alert",14),e.nI1(2,"async"),e.bVm()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",!0!==e.bMT(2,1,t.canEdit$))}}function fn(a,s){if(1&a&&(e.qex(0),e.DNE(1,dn,1,2,"ds-alert",14)(2,hn,3,3,"ng-container",6),e.nI1(3,"async"),e.bVm()),2&a){const t=s.ngIf,n=e.XpG();e.R7$(),e.Y8G("ngIf",null==t?null:t.permanent),e.R7$(),e.Y8G("ngIf",e.bMT(3,2,n.activeGroupLinkedDSO$))}}function bn(a,s){if(1&a){const t=e.RV6();e.j41(0,"div",16)(1,"button",17),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.delete())}),e.nrm(2,"i",18),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(3),e.SpI(" ",e.bMT(4,1,t.messagePrefix+".actions.delete")," ")}}function vn(a,s){if(1&a&&e.nrm(0,"ds-members-list",21),2&a){const t=e.XpG(2);e.Y8G("messagePrefix",t.messagePrefix+".members-list")}}function _n(a,s){if(1&a&&e.nrm(0,"ds-subgroups-list",21),2&a){const t=e.XpG(2);e.Y8G("messagePrefix",t.messagePrefix+".subgroups-list")}}function Sn(a,s){if(1&a&&(e.qex(0),e.j41(1,"div",19),e.DNE(2,vn,1,1,"ds-members-list",20),e.k0s(),e.DNE(3,_n,1,1,"ds-subgroups-list",20),e.bVm()),2&a){const t=s.ngIf;e.R7$(2),e.Y8G("ngIf",void 0!==t),e.R7$(),e.Y8G("ngIf",void 0!==t)}}let fe=(()=>{class a{constructor(t,n,i,r,l,u,f,S,C,_,j,q){this.groupDataService=t,this.dSpaceObjectDataService=n,this.formBuilderService=i,this.translateService=r,this.notificationsService=l,this.route=u,this.router=f,this.authorizationService=S,this.modalService=C,this.requestService=_,this.changeDetectorRef=j,this.dsoNameService=q,this.messagePrefix="admin.access-control.groups.form",this.formId="group-form",this.formLayout={groupName:{grid:{host:"row"}},groupDescription:{grid:{host:"row"}}},this.submitForm=new e.bkB,this.cancelForm=new e.bkB,this.subs=[],this.AlertType=zt.v}ngOnInit(){"newGroup"!==this.route.snapshot.params.groupId&&this.setActiveGroup(this.route.snapshot.params.groupId),this.activeGroup$=this.groupDataService.getActiveGroup(),this.activeGroupLinkedDSO$=this.getActiveGroupLinkedDSO(),this.linkedEditRolesRoute$=this.getLinkedEditRolesRoute(),this.canEdit$=this.activeGroupLinkedDSO$.pipe((0,P.n)(t=>(0,c.a4)(t)?[!1]:this.activeGroup$.pipe((0,c.Az)(),(0,P.n)(n=>this.authorizationService.isAuthorized(B._.CanDelete,n.self))))),this.initialisePage()}initialisePage(){const t=new I.rA_({id:"groupName",label:this.translateService.instant(`${this.messagePrefix}.groupName`),name:"groupName",validators:{required:null},required:!0}),n=new I.rA_({id:"groupCommunity",label:this.translateService.instant(`${this.messagePrefix}.groupCommunity`),name:"groupCommunity",required:!1,readOnly:!0}),i=new I.Zex({id:"groupDescription",label:this.translateService.instant(`${this.messagePrefix}.groupDescription`),name:"groupDescription",required:!1,spellCheck:wt.c.form.spellCheck});this.formModel=[t,i],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.groupName=this.formGroup.get("groupName"),this.groupDescription=this.formGroup.get("groupDescription"),(0,c.a4)(this.groupName)&&(this.groupName.setAsyncValidators(sn.createValidator(this.groupDataService)),this.groupNameValueChangeSubscribe=this.groupName.valueChanges.pipe((0,re.B)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()})),this.subs.push((0,O.z)([this.activeGroup$,this.canEdit$,this.activeGroupLinkedDSO$]).subscribe(([r,l,u])=>{null!=r&&(this.formGroup.controls.groupName.clearAsyncValidators(),(0,c.hj)(u?.name)?(this.formGroup.controls.groupCommunity||(this.formBuilderService.insertFormGroupControl(1,this.formGroup,this.formModel,n),this.groupDescription=this.formGroup.get("groupCommunity")),this.formGroup.patchValue({groupName:r.name,groupCommunity:u?.name??"",groupDescription:r.firstMetadataValue("dc.description")})):(this.formModel=[t,i],this.formGroup.patchValue({groupName:r.name,groupDescription:r.firstMetadataValue("dc.description")})),!l||r.permanent?this.formGroup.disable():this.formGroup.enable())}))}onCancel(){this.groupDataService.cancelEditGroup(),this.cancelForm.emit(),this.router.navigate([(0,v.mK)()])}onSubmit(){this.activeGroup$.pipe((0,G.s)(1)).subscribe(t=>{null===t?this.createNewGroup({name:this.groupName.value,metadata:{"dc.description":[{value:this.groupDescription.value}]}}):this.editGroup(t)})}createNewGroup(t){const n=Object.assign(new Ot.Y,t);this.groupDataService.create(n).pipe((0,p.qD)()).subscribe(i=>{i.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.created.success",{name:n.name})),this.submitForm.emit(n),(0,c.hj)(i.payload)&&(this.setActiveGroupWithLink(i.payload._links.self.href),this.groupDataService.clearGroupsRequests(),this.router.navigateByUrl((0,v.xl)(i.payload.uuid)))):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.created.failure",{name:n.name})),this.showNotificationIfNameInUse(n,"created"),this.cancelForm.emit())})}showNotificationIfNameInUse(t,n){this.subs.push(this.groupDataService.searchGroups(t.name,{currentPage:1,elementsPerPage:0}).pipe((0,p.yd)(),(0,p.Bo)()).subscribe(i=>{i.totalElements>0&&this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification."+n+".failure.groupNameInUse",{name:this.dsoNameService.getName(t)}))}))}editGroup(t){let n=[];(0,c.a4)(this.groupDescription.value)&&(n=[...n,{op:"add",path:"/metadata/dc.description",value:this.groupDescription.value}]),(0,c.a4)(this.groupName.value)&&(n=[...n,{op:"replace",path:"/name",value:this.groupName.value}]),this.groupDataService.patch(t,n).pipe((0,p.qD)()).subscribe(i=>{i.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.edited.success",{name:this.dsoNameService.getName(i.payload)})),this.submitForm.emit(i.payload)):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.edited.failure",{name:this.dsoNameService.getName(t)})),this.cancelForm.emit())})}setActiveGroup(t){this.groupDataService.cancelEditGroup(),this.groupDataService.findById(t).pipe((0,p.yd)(),(0,p.Bo)()).subscribe(n=>{this.groupDataService.editGroup(n)})}setActiveGroupWithLink(t){this.activeGroup$.pipe((0,G.s)(1)).subscribe(n=>{null===n&&(this.groupDataService.cancelEditGroup(),this.groupDataService.findByHref(t,!1,!1,(0,k.s)("subgroups"),(0,k.s)("epersons"),(0,k.s)("object")).pipe((0,p.yd)(),(0,p.Bo)()).subscribe(i=>{this.groupDataService.editGroup(i)}))})}delete(){this.activeGroup$.pipe((0,G.s)(1)).subscribe(t=>{const n=this.modalService.open(Z.M);n.componentInstance.name=this.dsoNameService.getName(t),n.componentInstance.headerLabel=this.messagePrefix+".delete-group.modal.header",n.componentInstance.infoLabel=this.messagePrefix+".delete-group.modal.info",n.componentInstance.cancelLabel=this.messagePrefix+".delete-group.modal.cancel",n.componentInstance.confirmLabel=this.messagePrefix+".delete-group.modal.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,G.s)(1)).subscribe(i=>{i&&(0,c.a4)(t.id)&&this.groupDataService.delete(t.id).pipe((0,p.qD)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.deleted.success",{name:this.dsoNameService.getName(t)})),this.onCancel()):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.deleted.failure.title",{name:this.dsoNameService.getName(t)}),this.translateService.get(this.messagePrefix+".notification.deleted.failure.content",{cause:r.errorMessage}))})})})}ngOnDestroy(){this.groupDataService.cancelEditGroup(),this.subs.filter(t=>(0,c.a4)(t)).forEach(t=>t.unsubscribe()),(0,c.a4)(this.groupNameValueChangeSubscribe)&&this.groupNameValueChangeSubscribe.unsubscribe()}getActiveGroupLinkedDSO(){return this.activeGroup$.pipe((0,c.Az)(),(0,P.n)(t=>void 0===t.object?this.dSpaceObjectDataService.findByHref(t._links.object.href):t.object),(0,p.bD)(),(0,p.Bo)())}getLinkedEditRolesRoute(){return this.activeGroupLinkedDSO$.pipe((0,c.Az)(),(0,d.T)(t=>{switch(t.type){case Ut.E.type.value:return(0,At.EU)(t.id);case Vt.p.type.value:return(0,Xt.BW)(t.id)}}))}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(Q.GroupDataService),e.rXU(ge.DSpaceObjectDataService),e.rXU(le.j),e.rXU(m.c$),e.rXU(U.I),e.rXU(E.nX),e.rXU(E.Ix),e.rXU(z.AuthorizationDataService),e.rXU(b.Bq),e.rXU(J.B),e.rXU(e.gRc),e.rXU(V.f))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-group-form"]],hostBindings:function(n,i){1&n&&e.bIt("beforeunload",function(){return i.ngOnDestroy()},!1,e.tSv)},outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},standalone:!0,features:[e.aNF],decls:22,vars:24,consts:[["createHeader",""],["editHeader",""],[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],[4,"ngIf"],[3,"submitForm","formId","formModel","formGroup","formLayout","displayCancel"],["before","",1,"btn-group"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["after","","class","btn-group",4,"ngIf"],[1,"border-bottom","pb-2"],[4,"dsContextHelp"],[3,"type","content",4,"ngIf"],[3,"type","content"],["after","",1,"btn-group"],["type","button",1,"btn","btn-danger","delete-button",3,"click"],[1,"fa","fa-trash"],[1,"mb-5"],[3,"messagePrefix",4,"ngIf"],[3,"messagePrefix"]],template:function(n,i){if(1&n){const r=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4),e.DNE(3,cn,1,0,"div",5),e.nI1(4,"async"),e.DNE(5,pn,3,3,"ng-template",null,0,e.C5r)(7,gn,2,4,"ng-template",null,1,e.C5r)(9,fn,4,4,"ng-container",6),e.nI1(10,"async"),e.j41(11,"ds-form",7),e.bIt("submitForm",function(){return e.eBV(r),e.Njj(i.onSubmit())}),e.j41(12,"div",8)(13,"button",9),e.bIt("click",function(){return e.eBV(r),e.Njj(i.onCancel())}),e.nrm(14,"i",10),e.EFF(15),e.nI1(16,"translate"),e.k0s()(),e.DNE(17,bn,5,3,"div",11),e.nI1(18,"async"),e.nI1(19,"async"),e.k0s(),e.DNE(20,Sn,4,2,"ng-container",6),e.nI1(21,"async"),e.k0s()()()}if(2&n){let r;const l=e.sdS(6),u=e.sdS(8);e.R7$(3),e.Y8G("ngIf",e.bMT(4,12,i.activeGroup$))("ngIfThen",u)("ngIfElse",l),e.R7$(6),e.Y8G("ngIf",e.bMT(10,14,i.activeGroup$)),e.R7$(2),e.Y8G("formId",i.formId)("formModel",i.formModel)("formGroup",i.formGroup)("formLayout",i.formLayout)("displayCancel",!1),e.R7$(4),e.SpI(" ",e.bMT(16,16,i.messagePrefix+".return"),""),e.R7$(2),e.Y8G("ngIf",e.bMT(18,18,i.canEdit$)&&!(null!=(r=e.bMT(19,20,i.activeGroup$))&&r.permanent)),e.R7$(3),e.Y8G("ngIf",e.bMT(21,22,i.activeGroup$))}},dependencies:[ce.s,Yt.C,h.bT,h.Jj,m.h,m.D9,de.G,Jt.v,an],encapsulation:2})}}return a})();var In=o(51581),Pn=o(4910);const yn=(a,s)=>(0,e.WQX)(Pn.Y).getEndpoint("groups").pipe((0,d.T)(i=>`${i}/${a?.params?.groupId}`));var Cn=o(983),En=o(88141),Rn=o(39901),Gn=o(99437);class $n{}var Fn=o(56760);const be=a=>({name:a});function Tn(a,s){1&a&&e.nrm(0,"ds-loading")}function kn(a,s){if(1&a&&(e.j41(0,"button",30),e.nI1(1,"translate"),e.nrm(2,"i",31),e.k0s()),2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.FS9("title",e.i5U(1,2,n.messagePrefix+"table.edit.buttons.edit",e.eq3(5,be,n.dsoNameService.getName(t.group)))),e.Y8G("routerLink",n.groupService.getGroupEditPageRouterLink(t.group))}}function jn(a,s){1&a&&(e.j41(0,"button",32),e.nI1(1,"translate"),e.nrm(2,"i",31),e.k0s()),2&a&&e.Y8G("dsBtnDisabled",!0)("ngbTooltip",e.bMT(1,2,"admin.access-control.epeople.table.edit.buttons.edit-disabled"))}function Nn(a,s){if(1&a){const t=e.RV6();e.j41(0,"button",33),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.deleteGroup(i))}),e.nrm(2,"i",34),e.k0s()}if(2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.FS9("title",e.i5U(1,1,n.messagePrefix+"table.edit.buttons.remove",e.eq3(4,be,n.dsoNameService.getName(t.group))))}}function Dn(a,s){if(1&a&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.nI1(7,"async"),e.k0s(),e.j41(8,"td"),e.EFF(9),e.k0s(),e.j41(10,"td")(11,"div",25),e.qex(12,26),e.DNE(13,kn,3,7,"button",27)(14,jn,3,4,"button",28),e.bVm(),e.DNE(15,Nn,3,6,"button",29),e.k0s()()()),2&a){let t;const n=s.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(n.group.id),e.R7$(2),e.JRh(i.dsoNameService.getName(n.group)),e.R7$(2),e.JRh(i.dsoNameService.getName(null==(t=e.bMT(7,8,n.group.object))?null:t.payload)),e.R7$(3),e.JRh((null==n.epersons?null:n.epersons.totalElements)+(null==n.subgroups?null:n.subgroups.totalElements)),e.R7$(3),e.Y8G("ngSwitch",n.ableToEdit),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1),e.R7$(),e.Y8G("ngIf",!(null!=n.group&&n.group.permanent)&&n.ableToDelete)}}function Mn(a,s){if(1&a&&(e.j41(0,"ds-pagination",20),e.nI1(1,"async"),e.j41(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th",23),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",23),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",23),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th",23),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"th"),e.EFF(19),e.nI1(20,"translate"),e.k0s()()(),e.j41(21,"tbody"),e.DNE(22,Dn,16,10,"tr",24),e.nI1(23,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,10,i.pageInfoState$))?null:t.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,12,i.messagePrefix+"table.id")),e.R7$(3),e.JRh(e.bMT(11,14,i.messagePrefix+"table.name")),e.R7$(3),e.JRh(e.bMT(14,16,i.messagePrefix+"table.collectionOrCommunity")),e.R7$(3),e.JRh(e.bMT(17,18,i.messagePrefix+"table.members")),e.R7$(3),e.JRh(e.bMT(20,20,i.messagePrefix+"table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(23,22,i.groupsDto$))?null:n.page)}}function Bn(a,s){if(1&a&&(e.j41(0,"div",35),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+"no-items")," ")}}const ve=(a,s,t)=>a.touched&&!t||a.errors?.emailTaken&&t,w=[{provide:I.P3,useValue:ve}],wn=[{path:v.P5,component:mt,resolve:{breadcrumb:x.S},providers:w,data:{title:"admin.access-control.epeople.title",breadcrumbKey:"admin.access-control.epeople"},canActivate:[$.Y]},{path:`${v.P5}/create`,component:ue,resolve:{breadcrumb:x.S},providers:w,data:{title:"admin.access-control.epeople.add.title",breadcrumbKey:"admin.access-control.epeople.add"},canActivate:[$.Y]},{path:`${v.P5}/:id/edit`,component:ue,resolve:{breadcrumb:x.S,ePerson:Lt},providers:w,data:{title:"admin.access-control.epeople.edit.title",breadcrumbKey:"admin.access-control.epeople.edit"},canActivate:[$.Y]},{path:v.w4,component:(()=>{class a{constructor(t,n,i,r,l,u,f,S,C,_,j){this.groupService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=i,this.translateService=r,this.notificationsService=l,this.formBuilder=u,this.routeService=f,this.authorizationService=S,this.paginationService=C,this.requestService=_,this.dsoNameService=j,this.messagePrefix="admin.access-control.groups.",this.config=Object.assign(new T.W,{id:"gl",pageSize:5,currentPage:1}),this.groupsDto$=new y.t({}),this.deletedGroupsIds=[],this.pageInfoState$=new y.t(void 0),this.loading$=new y.t(!1),this.subs=[],this.currentSearchQuery="",this.searchForm=this.formBuilder.group({query:this.currentSearchQuery})}ngOnInit(){this.search({query:this.currentSearchQuery})}search(t){(0,c.a4)(this.searchSub)&&(this.searchSub.unsubscribe(),this.subs=this.subs.filter(n=>n!==this.searchSub)),this.searchSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,En.M)(()=>this.loading$.next(!0)),(0,P.n)(n=>{const i=t.query;return null!=i&&this.currentSearchQuery!==i&&(this.currentSearchQuery=i,this.paginationService.updateRouteWithUrl(this.config.id,[],{page:1})),this.groupService.searchGroups(this.currentSearchQuery.trim(),{currentPage:n.currentPage,elementsPerPage:n.pageSize},!0,!0,(0,k.s)("object"))}),(0,p.v7)(),(0,p.Bo)(),(0,P.n)(n=>0===n.page.length?(0,R.of)((0,X.g)(n.pageInfo,[])):this.authorizationService.isAuthorized(B._.AdministratorOf).pipe((0,P.n)(i=>(0,O.z)([...n.page.map(r=>(0,c.a4)(r)&&!this.deletedGroupsIds.includes(r.id)?(0,O.z)([this.authorizationService.isAuthorized(B._.CanDelete,r.self),this.canManageGroup$(i,r),this.hasLinkedDSO(r),this.getSubgroups(r),this.getMembers(r)]).pipe((0,d.T)(([l,u,f,S,C])=>{const _=new $n;return _.ableToDelete=l&&!f,_.ableToEdit=u,_.group=r,_.subgroups=S.payload,_.epersons=C.payload,_})):Cn.w)]).pipe((0,Rn.U)([]),(0,d.T)(r=>(0,X.g)(n.pageInfo,r))))))).subscribe(n=>{this.groupsDto$.next(n),this.pageInfoState$.next(n.pageInfo),this.loading$.next(!1)}),this.subs.push(this.searchSub)}canManageGroup$(t,n){return t?(0,R.of)(!0):this.authorizationService.isAuthorized(B._.CanManageGroup,n.self)}deleteGroup(t){(0,c.a4)(t.group.id)&&this.groupService.delete(t.group.id).pipe((0,p.qD)()).subscribe(n=>{n.hasSucceeded?(this.deletedGroupsIds=[...this.deletedGroupsIds,t.group.id],this.notificationsService.success(this.translateService.get(this.messagePrefix+"notification.deleted.success",{name:this.dsoNameService.getName(t.group)}))):this.notificationsService.error(this.translateService.get(this.messagePrefix+"notification.deleted.failure.title",{name:this.dsoNameService.getName(t.group)}),this.translateService.get(this.messagePrefix+"notification.deleted.failure.content",{cause:n.errorMessage}))})}getMembers(t){return this.ePersonDataService.findListByHref(t._links.epersons.href,{currentPage:1,elementsPerPage:1}).pipe((0,p.yd)())}getSubgroups(t){return this.groupService.findListByHref(t._links.subgroups.href,{currentPage:1,elementsPerPage:1}).pipe((0,p.yd)())}hasLinkedDSO(t){return this.dSpaceObjectDataService.findByHref(t._links.object.href).pipe((0,p.yd)(),(0,d.T)(n=>(0,c.a4)(n)&&(0,c.a4)(n.payload)),(0,Gn.W)(()=>(0,R.of)(!1)))}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){(0,c.a4)(this.paginationSub)&&this.paginationSub.unsubscribe(),this.subs.filter(t=>(0,c.a4)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id)}static{this.\u0275fac=function(n){return new(n||a)(e.rXU(Q.GroupDataService),e.rXU(W.EPersonDataService),e.rXU(ge.DSpaceObjectDataService),e.rXU(m.c$),e.rXU(U.I),e.rXU(g.ze),e.rXU(Fn.v$),e.rXU(z.AuthorizationDataService),e.rXU(H.m),e.rXU(J.B),e.rXU(V.f))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["ds-groups-registry"]],standalone:!0,features:[e.aNF],decls:38,vars:34,consts:[[1,"container"],[1,"groups-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline","ml-1"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"ngSubmit","formGroup"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn-group","edit-field"],[3,"ngSwitch"],["class","btn btn-outline-primary btn-sm btn-edit",3,"routerLink","title",4,"ngSwitchCase"],["class","btn btn-outline-primary btn-sm btn-edit","placement","left",3,"dsBtnDisabled","ngbTooltip",4,"ngSwitchCase"],["class","btn btn-outline-danger btn-sm btn-delete",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["placement","left",1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"dsBtnDisabled","ngbTooltip"],[1,"btn","btn-outline-danger","btn-sm","btn-delete",3,"click","title"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(n,i){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"div")(8,"button",5),e.nrm(9,"i",6),e.j41(10,"span",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"h2",8),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"form",9),e.bIt("ngSubmit",function(){return i.search(i.searchForm.value)}),e.j41(17,"div",10)(18,"div",11),e.nrm(19,"input",12),e.nI1(20,"translate"),e.nI1(21,"translate"),e.j41(22,"span",13)(23,"button",14),e.nrm(24,"i",15),e.EFF(25),e.nI1(26,"translate"),e.k0s()()()(),e.j41(27,"div")(28,"button",16),e.bIt("click",function(){return i.clearFormAndResetResult()}),e.EFF(29),e.nI1(30,"translate"),e.k0s()()(),e.DNE(31,Tn,1,0,"ds-loading",17),e.nI1(32,"async"),e.DNE(33,Mn,24,24,"ds-pagination",18),e.nI1(34,"async"),e.nI1(35,"async"),e.DNE(36,Bn,3,3,"div",19),e.nI1(37,"async"),e.k0s()()()),2&n){let r,l;e.R7$(5),e.JRh(e.bMT(6,12,i.messagePrefix+"head")),e.R7$(3),e.Y8G("routerLink","create"),e.R7$(3),e.JRh(e.bMT(12,14,i.messagePrefix+"button.add")),e.R7$(3),e.JRh(e.bMT(15,16,i.messagePrefix+"search.head")),e.R7$(2),e.Y8G("formGroup",i.searchForm),e.R7$(3),e.Y8G("placeholder",e.bMT(20,18,i.messagePrefix+"search.placeholder")),e.BMQ("aria-label",e.bMT(21,20,i.messagePrefix+"search.placeholder")),e.R7$(6),e.SpI(" ",e.bMT(26,22,i.messagePrefix+"search.button")," "),e.R7$(4),e.SpI(" ",e.bMT(30,24,i.messagePrefix+"button.see-all")," "),e.R7$(2),e.Y8G("ngIf",e.bMT(32,26,i.loading$)),e.R7$(2),e.Y8G("ngIf",(null==(r=e.bMT(34,28,i.pageInfoState$))?null:r.totalElements)>0&&!0!==e.bMT(35,30,i.loading$)),e.R7$(3),e.Y8G("ngIf",0===(null==(l=e.bMT(37,32,i.pageInfoState$))?null:l.totalElements))}},dependencies:[ee.v,m.h,m.D9,E.Wk,g.X1,g.qT,g.me,g.BC,g.cb,g.j4,g.JD,h.Jj,h.bT,A.e,h.ux,h.e1,b.n8,b.md,h.Sq,M.A],encapsulation:2})}}return a})(),resolve:{breadcrumb:x.S},providers:w,data:{title:"admin.access-control.groups.title",breadcrumbKey:"admin.access-control.groups"},canActivate:[D.i]},{path:`${v.w4}/create`,component:fe,resolve:{breadcrumb:x.S},providers:w,data:{title:"admin.access-control.groups.title.addGroup",breadcrumbKey:"admin.access-control.groups.addGroup"},canActivate:[D.i]},{path:`${v.w4}/:groupId/edit`,component:fe,resolve:{breadcrumb:x.S},providers:w,data:{title:"admin.access-control.groups.title.singleGroup",breadcrumbKey:"admin.access-control.groups.singleGroup"},canActivate:[(a=yn,s)=>(0,In.h)(()=>(0,R.of)([B._.CanManageGroup]),a,s)]},{path:"bulk-access",component:rt,resolve:{breadcrumb:x.S},data:{title:"admin.access-control.bulk-access.title",breadcrumbKey:"admin.access-control.bulk-access"},canActivate:[$.Y]}]},90839:(K,N,o)=>{o.d(N,{Q:()=>I});class I{constructor(D,$){this.text=D,this.url=$}}},70379:(K,N,o)=>{o.d(N,{S:()=>Y});var I=o(54438),x=o(82777),D=o(30506),$=o(7673),v=o(90839);let y=(()=>{class d{getBreadcrumbs(M,F){return(0,$.of)([new v.Q(M+".breadcrumbs",F)])}static{this.\u0275fac=function(F){return new(F||d)}}static{this.\u0275prov=I.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();const Y=(d,te,M=(0,I.WQX)(y))=>{const F=d.data.breadcrumbKey;if((0,x.Tn)(F))throw new Error('You provided an i18nBreadcrumbResolver for url "'+d.url+"\" but no breadcrumbKey in the route's data");return{provider:M,key:F,url:(0,D.F)(d)}}},81225:(K,N,o)=>{o.d(N,{j:()=>D});const x={RESOLVED:(0,o(91e3).N)("dspace/resolver/RESOLVED")};class D{constructor(v,m){this.type=x.RESOLVED,this.payload={url:v,dso:m}}}}}]);