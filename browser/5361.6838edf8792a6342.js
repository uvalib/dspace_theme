(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5361],{90839:(S,R,r)=>{"use strict";r.d(R,{Q:()=>a});class a{constructor(v,d){this.text=v,this.url=d}}},70379:(S,R,r)=>{"use strict";r.d(R,{S:()=>O});var a=r(54438),m=r(82777),v=r(30506),d=r(7673),T=r(90839);let M=(()=>{class p{getBreadcrumbs(g,o){return(0,d.of)([new T.Q(g+".breadcrumbs",o)])}static{this.\u0275fac=function(o){return new(o||p)}}static{this.\u0275prov=a.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();const O=(p,u,g=(0,a.WQX)(M))=>{const o=p.data.breadcrumbKey;if((0,m.Tn)(o))throw new Error('You provided an i18nBreadcrumbResolver for url "'+p.url+"\" but no breadcrumbKey in the route's data");return{provider:g,key:o,url:(0,v.F)(p)}}},82932:(S,R,r)=>{"use strict";r.r(R),r.d(R,{ProfilePageMetadataFormComponent:()=>F});var a=r(60177),m=r(1473),v=r(84418),d=r.n(v),T=r(88280),b=r(74449),O=(r(26349),r(80183)),p=r(82777),u=r(33126),g=r(13143),o=r(39806),l=r(54438),D=r(41780);function B(y,A){if(1&y&&l.nrm(0,"ds-form",1),2&y){const _=l.XpG();l.Y8G("formId","profile-page-metadata-form-id")("formModel",_.formModel)("formGroup",_.formGroup)("displaySubmit",!1)("displayCancel",!1)}}let F=(()=>{class y{constructor(_,P,C,U){this.formBuilderService=_,this.translate=P,this.epersonService=C,this.notificationsService=U,this.formModel=[new m.rA_({id:"email",name:"email",readOnly:!0,disabled:!0}),new m.rA_({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"},autoComplete:"given-name"}),new m.rA_({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"},autoComplete:"family-name"}),new m.rA_({id:"phone",name:"eperson.phone",autoComplete:"tel"}),new m.z4z({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}ngOnInit(){this.activeLangs=T.c.languages.filter(_=>!0===_.active),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}setFormValues(){this.formModel.forEach(_=>{_.value="email"===_.name?this.user.email:this.user.firstMetadataValue(_.name),"language"===_.id&&(_.options=this.activeLangs.map(P=>Object.assign({value:P.code,label:P.label})))}),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}updateFieldTranslations(){this.formModel.forEach(_=>{_.label=this.translate.instant(this.LABEL_PREFIX+_.id),(0,p.hj)(_.validators)&&(_.errorMessages={},Object.keys(_.validators).forEach(P=>{_.errorMessages[P]=this.translate.instant(this.ERROR_PREFIX+_.id+"."+P)}))})}updateProfile(){if(!this.formGroup.valid)return!1;const _=d()(this.user.metadata);let P=!1;return this.formModel.filter(C=>"email"!==C.id).forEach(C=>{_.hasOwnProperty(C.name)&&_[C.name].length>0?(0,p.a4)(C.value)?_[C.name][0].value!==C.value&&(_[C.name][0].value=C.value,P=!0):(_[C.name]=[],P=!0):(0,p.a4)(C.value)&&(_[C.name]=[{value:C.value,language:null}],P=!0)}),P&&this.epersonService.update(Object.assign(d()(this.user),{metadata:_})).pipe((0,O.yd)(),(0,O.Bo)()).subscribe(C=>{this.user=C,this.setFormValues(),this.notificationsService.success(this.translate.instant(this.NOTIFICATION_PREFIX+"success.title"),this.translate.instant(this.NOTIFICATION_PREFIX+"success.content"))}),P}static{this.\u0275fac=function(P){return new(P||y)(l.rXU(u.j),l.rXU(D.c$),l.rXU(b.EPersonDataService),l.rXU(o.I))}}static{this.\u0275cmp=l.VBU({type:y,selectors:[["ds-base-profile-page-metadata-form"]],inputs:{user:"user"},standalone:!0,features:[l.aNF],decls:1,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:function(P,C){1&P&&l.DNE(0,B,1,5,"ds-form",0),2&P&&l.Y8G("ngIf",C.formModel)},dependencies:[g.s,a.bT],encapsulation:2})}}return y})()},87370:(S,R,r)=>{"use strict";r.d(R,{O:()=>M}),r(26349);var m=r(8886),d=(r(82932),r(54438));const T=["*"];function b(O,p){}let M=(()=>{class O extends m.J{constructor(){super(...arguments),this.inAndOutputNames=["user"]}getComponentName(){return"ProfilePageMetadataFormComponent"}importThemedComponent(u){return r(46020)(`./${u}/app/profile-page/profile-page-metadata-form/profile-page-metadata-form.component`)}importUnthemedComponent(){return Promise.resolve().then(r.bind(r,82932))}static{this.\u0275fac=(()=>{let u;return function(o){return(u||(u=d.xGo(O)))(o||O)}})()}static{this.\u0275cmp=d.VBU({type:O,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},standalone:!0,features:[d.Vt3,d.aNF],ngContentSelectors:T,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(g,o){1&g&&(d.NAR(),d.DNE(0,b,0,0,"ng-template",null,0,d.C5r),d.j41(2,"div",null,1),d.SdG(4),d.k0s())},encapsulation:2})}}return O})()},49587:(S,R,r)=>{"use strict";r.d(R,{g:()=>E});var a=r(60177),m=r(41780),v=r(63172),d=r(84412),T=r(96697),b=r(25558),M=r(96354),O=r(88141),p=r(73028),u=r(67116),o=(r(26349),r(98926)),l=r(80183),D=r(60456),B=r(9284),F=r(82777),y=r(39806),A=r(67600),_=r(18226),P=r(7673),C=r(78655),U=r(43404),x=r(33550),e=r(54438);let j=(()=>{class n{constructor(i){this.searchService=i}hasProfilesToSuggest(i){return this.searchForSuggestions(i).pipe((0,l.qD)(),(0,M.T)(s=>(0,F.hj)(s)&&s.hasSucceeded&&s.payload?.page?.length>0))}searchForSuggestions(i){const s=this.personQueryData(i);return(0,F.Im)(s)?(0,P.of)((0,U.Wh)()):this.lookup(s)}lookup(i){return(0,F.Im)(i)?(0,P.of)((0,U.Wh)()):this.searchService.search(new x.C({configuration:"eperson_claims",query:i}),null,!1,!0)}personQueryData(i){return i&&i.email?"person.email:"+i.email:null}static{this.\u0275fac=function(s){return new(s||n)(e.KVO(C.S))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var L=r(96526),N=(r(76829),r(78448)),X=r(90887),V=r(54705),W=r(7581),K=r(17191),k=r(52149),G=r(7901);function Y(n,h){if(1&n){const i=e.RV6();e.j41(0,"div",9)(1,"button",16,0),e.bIt("click",function(){const f=e.eBV(i).$implicit,I=e.XpG();return e.Njj(I.selectItem(f.indexableObject))}),e.nrm(3,"ds-listable-object-component-loader",17),e.k0s()()}if(2&n){const i=h.$implicit,s=e.XpG();e.R7$(),e.FS9("title",s.dsoNameService.getName(i.indexableObject)),e.R7$(2),e.Y8G("object",i)("viewMode",s.viewMode)("linkType",s.linkTypes.None)}}let w=(()=>{class n extends V.${constructor(i,s,f,I,$){super(i,s),this.activeModal=i,this.route=s,this.router=f,this.profileClaimService=I,this.dsoNameService=$,this.listEntries$=new d.t(null),this.viewMode=N.n.ListElement,this.linkTypes=W.n,this.checked=!1,this.create=new e.bkB}ngOnInit(){this.profileClaimService.searchForSuggestions(this.dso).pipe((0,l.qD)()).subscribe(i=>this.listEntries$.next(i))}selectItem(i){this.close(),this.navigate(i)}navigate(i){this.router.navigate([(0,X._o)(i)])}toggleCheckbox(){this.checked=!this.checked}createFromScratch(){this.create.emit(),this.close()}static{this.\u0275fac=function(s){return new(s||n)(e.rXU(k.Lw),e.rXU(G.nX),e.rXU(G.Ix),e.rXU(j),e.rXU(L.f))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["ds-profile-claim-item-modal"]],inputs:{dso:"dso"},outputs:{create:"create"},standalone:!0,features:[e.Vt3,e.aNF],decls:27,vars:17,consts:[["listEntryElement",""],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["role","alert",1,"alert","alert-info"],[1,"dropdown-divider"],[1,"scrollable-menu","list-group","container"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md","mt-2"],[1,"modal-footer"],[1,"mr-5"],["type","checkbox",3,"change","checked"],["type","submit",1,"btn","btn-primary","ml-5","mr-2",3,"click","dsBtnDisabled"],[1,"fas","fa-plus"],[1,"list-group-item","list-group-item-action","border-0","list-entry",3,"click","title"],[3,"object","viewMode","linkType"]],template:function(s,f){if(1&s&&(e.j41(0,"div")(1,"div",1)(2,"h4"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"button",2),e.bIt("click",function(){return f.close()}),e.j41(6,"span",3),e.EFF(7,"\xd7"),e.k0s()()(),e.j41(8,"div",4)(9,"div",5),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.nrm(12,"div",6),e.j41(13,"div",7),e.DNE(14,Y,4,4,"div",8),e.nI1(15,"async"),e.j41(16,"div",9),e.nrm(17,"div",10),e.k0s()()(),e.j41(18,"div",11)(19,"div",12)(20,"input",13),e.bIt("change",function(){return f.toggleCheckbox()}),e.k0s(),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.j41(23,"button",14),e.bIt("click",function(){return f.createFromScratch()}),e.nrm(24,"i",15),e.EFF(25),e.nI1(26,"translate"),e.k0s()()()),2&s){let I;e.R7$(3),e.JRh(e.bMT(4,7,"dso-selector.claim.item.head")),e.R7$(7),e.SpI(" ",e.bMT(11,9,"dso-selector.claim.item.body")," "),e.R7$(4),e.Y8G("ngForOf",null==(I=e.bMT(15,11,f.listEntries$))?null:I.payload.page),e.R7$(6),e.Y8G("checked",f.checked),e.R7$(),e.SpI(" ",e.bMT(22,13,"dso-selector.claim.item.not-mine-label")," "),e.R7$(2),e.Y8G("dsBtnDisabled",!f.checked),e.R7$(2),e.SpI(" ",e.bMT(26,15,"dso-selector.claim.item.create-from-scratch")," ")}},dependencies:[K.v,a.Jj,m.h,m.D9,a.Sq,D.A],encapsulation:2})}}return n})();function z(n,h){if(1&n){const i=e.RV6();e.j41(0,"div")(1,"p"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"p",3)(5,"span",4),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ui-switch",5),e.nI1(9,"translate"),e.nI1(10,"translate"),e.bIt("change",function(){e.eBV(i);const f=e.XpG().ngVar,I=e.XpG();return e.Njj(I.toggleProfileVisibility(f))}),e.k0s()()()}if(2&n){const i=e.XpG().ngVar;e.R7$(2),e.JRh(e.bMT(3,5,"researcher.profile.associated")),e.R7$(4),e.JRh(e.bMT(7,7,"researcher.profile.status")),e.R7$(2),e.Y8G("checkedLabel",e.bMT(9,9,"researcher.profile.public.visibility"))("uncheckedLabel",e.bMT(10,11,"researcher.profile.private.visibility"))("checked",i.visible)}}function J(n,h){1&n&&(e.j41(0,"div")(1,"p"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,1,"researcher.profile.not.associated")))}function Q(n,h){1&n&&(e.j41(0,"span"),e.nrm(1,"i",7),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&n&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"researcher.profile.action.processing")," "))}function H(n,h){1&n&&(e.j41(0,"span"),e.nrm(1,"i",8),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&n&&(e.R7$(2),e.SpI(" \xa0",e.bMT(3,1,"researcher.profile.create.new")," "))}function Z(n,h){if(1&n){const i=e.RV6();e.j41(0,"button",6),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(i);const f=e.XpG(2);return e.Njj(f.createProfile())}),e.DNE(2,Q,4,3,"span",1),e.nI1(3,"async"),e.DNE(4,H,4,3,"span",1),e.nI1(5,"async"),e.k0s()}if(2&n){const i=e.XpG(2);e.Y8G("dsBtnDisabled",e.bMT(1,3,i.isProcessingCreate())),e.R7$(2),e.Y8G("ngIf",e.bMT(3,5,i.isProcessingCreate())),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(5,7,i.isProcessingCreate()))}}function q(n,h){1&n&&(e.j41(0,"span"),e.nrm(1,"i",7),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&n&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"researcher.profile.action.processing")," "))}function ee(n,h){1&n&&(e.j41(0,"span"),e.nrm(1,"i",11),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&n&&(e.R7$(2),e.SpI(" \xa0",e.bMT(3,1,"researcher.profile.delete")," "))}function te(n,h){if(1&n){const i=e.RV6();e.qex(0),e.j41(1,"button",6),e.bIt("click",function(){e.eBV(i);const f=e.XpG().ngVar,I=e.XpG();return e.Njj(I.viewProfile(f))}),e.nrm(2,"i",9),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"button",10),e.bIt("click",function(){e.eBV(i);const f=e.XpG().ngVar,I=e.XpG();return e.Njj(I.deleteProfile(f))}),e.DNE(6,q,4,3,"span",1),e.nI1(7,"async"),e.DNE(8,ee,4,3,"span",1),e.nI1(9,"async"),e.k0s(),e.bVm()}if(2&n){const i=e.XpG().ngVar,s=e.XpG();e.R7$(),e.Y8G("dsBtnDisabled",!i),e.R7$(2),e.SpI(" ",e.bMT(4,5,"researcher.profile.view")," "),e.R7$(2),e.Y8G("dsBtnDisabled",!i),e.R7$(),e.Y8G("ngIf",e.bMT(7,7,s.isProcessingDelete())),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(9,9,s.isProcessingDelete()))}}function c(n,h){if(1&n&&(e.j41(0,"div"),e.DNE(1,z,11,13,"div",1)(2,J,4,3,"div",1)(3,Z,6,9,"button",2)(4,te,10,11,"ng-container",1),e.k0s()),2&n){const i=h.ngVar;e.R7$(),e.Y8G("ngIf",i),e.R7$(),e.Y8G("ngIf",!i),e.R7$(),e.Y8G("ngIf",!i),e.R7$(),e.Y8G("ngIf",i)}}let E=(()=>{class n{constructor(i,s,f,I,$,ne,re){this.researcherProfileService=i,this.profileClaimService=s,this.translationService=f,this.notificationService=I,this.authService=$,this.router=ne,this.modalService=re,this.researcherProfile$=new d.t(null),this.processingDelete$=new d.t(!1),this.processingCreate$=new d.t(!1)}ngOnInit(){this.initResearchProfile()}createProfile(){this.processingCreate$.next(!0),this.authService.getAuthenticatedUserFromStore().pipe((0,T.s)(1),(0,b.n)(i=>this.profileClaimService.hasProfilesToSuggest(i))).subscribe(i=>{if(i){this.processingCreate$.next(!1);const s=this.modalService.open(w);s.componentInstance.dso=this.user,s.componentInstance.create.pipe((0,T.s)(1)).subscribe(()=>{this.createProfileFromScratch()})}else this.createProfileFromScratch()})}viewProfile(i){null!=this.researcherProfileItemId&&this.router.navigate(["items",this.researcherProfileItemId])}deleteProfile(i){const s=this.modalService.open(B.M);s.componentInstance.headerLabel="confirmation-modal.delete-profile.header",s.componentInstance.infoLabel="confirmation-modal.delete-profile.info",s.componentInstance.cancelLabel="confirmation-modal.delete-profile.cancel",s.componentInstance.confirmLabel="confirmation-modal.delete-profile.confirm",s.componentInstance.brandColor="danger",s.componentInstance.confirmIcon="fas fa-trash",s.componentInstance.response.pipe((0,T.s)(1)).subscribe(f=>{f&&(this.processingDelete$.next(!0),this.researcherProfileService.delete(i.id).pipe((0,l.qD)(),(0,M.T)(I=>I.isSuccess)).subscribe(I=>{I&&(this.researcherProfile$.next(null),this.researcherProfileItemId=null),this.processingDelete$.next(!1)}))})}toggleProfileVisibility(i){this.researcherProfileService.setVisibility(i,!i.visible).pipe((0,l.qD)()).subscribe(s=>{s.hasSucceeded?this.researcherProfile$.next(s.payload):this.notificationService.error(null,this.translationService.get("researcher.profile.change-visibility.fail"))})}isProcessingDelete(){return this.processingDelete$.asObservable()}isProcessingCreate(){return this.processingCreate$.asObservable()}createProfileFromScratch(){this.processingCreate$.next(!0),this.researcherProfileService.create().pipe((0,l.qD)()).subscribe(i=>{this.processingCreate$.next(!1),i.isSuccess?(this.initResearchProfile(),this.notificationService.success(null,this.translationService.get("researcher.profile.create.success"))):this.notificationService.error(null,this.translationService.get("researcher.profile.create.fail"))})}initResearchProfile(){this.researcherProfileService.findById(this.user.id,!1,!0,(0,A.s)("item")).pipe((0,l.ak)(),(0,O.M)(i=>this.researcherProfile$.next(i)),(0,p.Z)(i=>this.researcherProfileService.findRelatedItemId(i))).subscribe(i=>{(0,F.hj)(i)&&(this.researcherProfileItemId=i)})}static{this.\u0275fac=function(s){return new(s||n)(e.rXU(o.ResearcherProfileDataService),e.rXU(j),e.rXU(m.c$),e.rXU(y.I),e.rXU(u.uR),e.rXU(G.Ix),e.rXU(k.Bq))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["ds-profile-page-researcher-form"]],inputs:{user:"user"},standalone:!0,features:[e.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],["class","btn btn-primary mr-2",3,"dsBtnDisabled","click",4,"ngIf"],[1,"align-items-center","researcher-profile-switch"],[1,"mr-3"],[3,"change","checkedLabel","uncheckedLabel","checked"],[1,"btn","btn-primary","mr-2",3,"click","dsBtnDisabled"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-plus"],[1,"fas","fa-info-circle"],[1,"btn","btn-danger",3,"click","dsBtnDisabled"],[1,"fas","fa-trash-alt"]],template:function(s,f){1&s&&(e.DNE(0,c,5,4,"div",0),e.nI1(1,"async")),2&s&&e.Y8G("ngVar",e.bMT(1,1,f.researcherProfile$))},dependencies:[a.bT,a.Jj,m.h,m.D9,v.z,v.S,_.r,D.A],encapsulation:2})}}return n})()},65361:(S,R,r)=>{"use strict";r.r(R),r.d(R,{ROUTES:()=>O});var a=r(70379),m=r(8886),d=(r(60676),r(54438));const T=["*"];function b(p,u){}const O=[{path:"",pathMatch:"full",component:(()=>{class p extends m.J{getComponentName(){return"ProfilePageComponent"}importThemedComponent(g){return r(86930)(`./${g}/app/profile-page/profile-page.component`)}importUnthemedComponent(){return Promise.resolve().then(r.bind(r,60676))}static{this.\u0275fac=(()=>{let g;return function(l){return(g||(g=d.xGo(p)))(l||p)}})()}static{this.\u0275cmp=d.VBU({type:p,selectors:[["ds-profile-page"]],standalone:!0,features:[d.Vt3,d.aNF],ngContentSelectors:T,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(o,l){1&o&&(d.NAR(),d.DNE(0,b,0,0,"ng-template",null,0,d.C5r),d.j41(2,"div",null,1),d.SdG(4),d.k0s())},encapsulation:2})}}return p})(),resolve:{breadcrumb:a.S},data:{breadcrumbKey:"profile",title:"profile.title"}}]},60676:(S,R,r)=>{"use strict";r.r(R),r.d(R,{ProfilePageComponent:()=>te});var a=r(60177),m=r(41780),v=r(84412),d=r(5964),T=r(25558),b=r(88141),M=r(67116),O=r(96526),p=r(8917),u=r(65007),g=r(3970),o=r(74449),l=r(22978),D=r(80183),B=r(7724),F=r(82777),y=r(79632),A=r(82394),_=r(39806),P=r(5682),C=r(23401),U=r(67600),x=r(18226),e=r(87370),j=r(49587),L=r(13738),t=r(54438);function N(c,E){if(1&c&&(t.qex(0),t.j41(1,"div",6)(2,"div",7),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",8)(6,"div",14),t.nrm(7,"ds-profile-page-researcher-form",9),t.k0s(),t.nrm(8,"ds-suggestions-notification"),t.k0s()(),t.bVm()),2&c){const n=t.XpG(2).ngVar;t.R7$(3),t.JRh(t.bMT(4,2,"profile.card.researcher")),t.R7$(4),t.Y8G("user",n)}}function X(c,E){if(1&c){const n=t.RV6();t.j41(0,"div",15)(1,"div",7),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",8)(5,"ds-profile-page-security-form",16),t.bIt("isInvalid",function(i){t.eBV(n);const s=t.XpG(3);return t.Njj(s.setInvalid(i))})("passwordValue",function(i){t.eBV(n);const s=t.XpG(3);return t.Njj(s.setPasswordValue(i))})("currentPasswordValue",function(i){t.eBV(n);const s=t.XpG(3);return t.Njj(s.setCurrentPasswordValue(i))}),t.k0s()()()}2&c&&(t.R7$(2),t.JRh(t.bMT(3,2,"profile.card.security")),t.R7$(3),t.Y8G("FORM_PREFIX","profile.security.form."))}function V(c,E){1&c&&t.eu8(0)}function W(c,E){if(1&c&&(t.j41(0,"li",24),t.EFF(1),t.k0s()),2&c){const n=E.$implicit,h=t.XpG(8);t.R7$(),t.JRh(h.dsoNameService.getName(n))}}function K(c,E){if(1&c&&(t.j41(0,"div")(1,"h2",21),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",22),t.DNE(5,W,2,1,"li",23),t.k0s()()),2&c){const n=t.XpG().ngIf;t.R7$(2),t.JRh(t.bMT(3,2,"profile.groups.head")),t.R7$(3),t.Y8G("ngForOf",n)}}function k(c,E){if(1&c&&(t.qex(0),t.DNE(1,K,6,4,"div",5),t.bVm()),2&c){const n=E.ngIf;t.R7$(),t.Y8G("ngIf",(null==n?null:n.length)>0)}}function G(c,E){if(1&c&&(t.j41(0,"ds-pagination",20),t.DNE(1,k,2,1,"ng-container",5),t.k0s()),2&c){const n=t.XpG(2).ngIf,h=t.XpG(3);t.Y8G("hideGear",!0)("hidePagerWhenSinglePage",!0)("hidePaginationDetail",!0)("paginationOptions",h.optionsGroupsPagination)("collectionSize",null==n||null==n.payload?null:n.payload.totalElements),t.R7$(),t.Y8G("ngIf",null==n||null==n.payload?null:n.payload.page)}}function Y(c,E){if(1&c&&t.DNE(0,G,2,6,"ds-pagination",19),2&c){const n=t.XpG().ngIf;t.Y8G("ngIf",null==n?null:n.payload)}}function w(c,E){1&c&&t.nrm(0,"ds-loading",25),2&c&&t.Y8G("showMessage",!1)}function z(c,E){1&c&&(t.nrm(0,"ds-error",26),t.nI1(1,"translate")),2&c&&t.FS9("message",t.bMT(1,1,"error.profile-groups"))}function J(c,E){if(1&c&&(t.qex(0),t.DNE(1,V,1,0,"ng-container",17)(2,Y,1,1,"ng-template",null,0,t.C5r)(4,w,1,1,"ng-template",null,1,t.C5r)(6,z,2,3,"ds-error",18),t.bVm()),2&c){const n=E.ngIf,h=t.sdS(3),i=t.sdS(5);t.R7$(),t.Y8G("ngTemplateOutlet",null!=n&&n.isLoading?i:h),t.R7$(5),t.Y8G("ngIf",null==n?null:n.hasFailed)}}function Q(c,E){if(1&c&&(t.j41(0,"li",24),t.EFF(1),t.k0s()),2&c){const n=E.$implicit,h=t.XpG(5);t.R7$(),t.SpI(" ",h.dsoNameService.getName(n)," ")}}function H(c,E){if(1&c&&(t.j41(0,"div",28)(1,"h2",21),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",22),t.DNE(5,Q,2,1,"li",23),t.k0s()()),2&c){const n=t.XpG().ngVar;t.R7$(2),t.JRh(t.bMT(3,2,"profile.special.groups.head")),t.R7$(3),t.Y8G("ngForOf",n)}}function Z(c,E){if(1&c&&(t.qex(0),t.DNE(1,H,6,4,"div",27),t.bVm()),2&c){const n=E.ngVar;t.R7$(),t.Y8G("ngIf",(null==n?null:n.length)>0)}}function q(c,E){if(1&c){const n=t.RV6();t.j41(0,"div",4)(1,"h1"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.DNE(4,N,9,4,"ng-container",5),t.nI1(5,"async"),t.j41(6,"div",6)(7,"div",7),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",8),t.nrm(11,"ds-profile-page-metadata-form",9),t.k0s()(),t.DNE(12,X,6,4,"div",10),t.nI1(13,"async"),t.j41(14,"div",11)(15,"button",12),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.updateProfile())}),t.nrm(16,"i",13),t.EFF(17),t.nI1(18,"translate"),t.k0s()(),t.DNE(19,J,7,2,"ng-container",5),t.nI1(20,"async"),t.DNE(21,Z,2,1,"ng-container",2),t.nI1(22,"async"),t.k0s()}if(2&c){let n;const h=t.XpG().ngVar,i=t.XpG();t.R7$(2),t.JRh(t.bMT(3,8,"profile.title")),t.R7$(2),t.Y8G("ngIf",t.bMT(5,10,i.isResearcherProfileEnabled$)),t.R7$(4),t.JRh(t.bMT(9,12,"profile.card.identify")),t.R7$(3),t.Y8G("user",h),t.R7$(),t.Y8G("ngIf",t.bMT(13,14,i.canChangePassword$)),t.R7$(5),t.SpI(" ",t.bMT(18,16,"profile.form.submit"),""),t.R7$(2),t.Y8G("ngIf",t.bMT(20,18,i.groupsRD$)),t.R7$(2),t.Y8G("ngVar",null==(n=t.bMT(22,20,i.specialGroupsRD$))||null==n.payload?null:n.payload.page)}}function ee(c,E){if(1&c&&(t.qex(0),t.DNE(1,q,23,22,"div",3),t.bVm()),2&c){const n=E.ngVar;t.R7$(),t.Y8G("ngIf",n)}}let te=(()=>{class c{constructor(n,h,i,s,f,I,$,ne){this.authService=n,this.notificationsService=h,this.translate=i,this.epersonService=s,this.authorizationService=f,this.configurationService=I,this.dsoNameService=$,this.paginationService=ne,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications.",this.optionsGroupsPagination=Object.assign(new C.W,{id:"page_groups",currentPage:1,pageSize:20}),this.isResearcherProfileEnabled$=new v.t(!1)}ngOnInit(){this.user$=this.authService.getAuthenticatedUserFromStore().pipe((0,d.p)(n=>(0,F.a4)(n.id)),(0,T.n)(n=>this.epersonService.findById(n.id,!0,!0,(0,U.s)("groups"))),(0,D.v7)(),(0,D.Bo)(),(0,b.M)(n=>this.currentUser=n)),this.groupsRD$=this.paginationService.getCurrentPagination(this.optionsGroupsPagination.id,this.optionsGroupsPagination).pipe((0,T.n)(n=>this.epersonService.findById(this.currentUser.id,!0,!0,(0,U.s)("groups",{findListOptions:{elementsPerPage:n.pageSize,currentPage:n.currentPage}}))),(0,D.bD)(),(0,D.Bo)(),(0,T.n)(n=>n?.groups)),this.canChangePassword$=this.user$.pipe((0,T.n)(n=>this.authorizationService.isAuthorized(g._.CanChangePassword,n._links.self.href))),this.specialGroupsRD$=this.authService.getSpecialGroupsFromAuthStatus(),this.configurationService.findByPropertyName("researcher-profile.entity-type").pipe((0,D.qD)()).subscribe(n=>{this.isResearcherProfileEnabled$.next(n.hasSucceeded&&n.payload.values.length>0)})}updateProfile(){const n=this.metadataForm.compRef.instance.updateProfile(),h=this.updateSecurity();!n&&!h&&this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}setInvalid(n){this.invalidSecurity=n}updateSecurity(){const n=(0,F.hj)(this.password);return(0,F.hj)(this.currentPassword)&&!n&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&n&&this.epersonService.patch(this.currentUser,[{op:"add",path:"/password",value:{new_password:this.password,current_password:this.currentPassword}}]).pipe((0,D.qD)()).subscribe(s=>{s.hasSucceeded?this.notificationsService.success(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),this.getPasswordErrorMessage(s))}),n}setPasswordValue(n){this.password=n}setCurrentPasswordValue(n){this.currentPassword=n}submit(){this.updateProfile()}getPasswordErrorMessage(n){return n.hasFailed&&(0,F.hj)(n.errorMessage)?this.translate.instant(n.errorMessage):this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.change-failed")}static{this.\u0275fac=function(h){return new(h||c)(t.rXU(M.uR),t.rXU(_.I),t.rXU(m.c$),t.rXU(o.EPersonDataService),t.rXU(u.AuthorizationDataService),t.rXU(p.ConfigurationDataService),t.rXU(O.f),t.rXU(l.m))}}static{this.\u0275cmp=t.VBU({type:c,selectors:[["ds-base-profile-page"]],viewQuery:function(h,i){if(1&h&&t.GBs(e.O,5),2&h){let s;t.mGM(s=t.lsd())&&(i.metadataForm=s.first)}},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["content",""],["loader",""],[4,"ngVar"],["class","container",4,"ngIf"],[1,"container"],[4,"ngIf"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[3,"user"],["class","card mb-4 security-section",4,"ngIf"],[1,"col-12","text-right","pr-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[1,"mb-4"],[1,"card","mb-4","security-section"],[3,"isInvalid","passwordValue","currentPasswordValue","FORM_PREFIX"],[4,"ngTemplateOutlet"],[3,"message",4,"ngIf"],[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","collectionSize",4,"ngIf"],[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","collectionSize"],[1,"mt-4"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[3,"showMessage"],[3,"message"],["data-test","specialGroups",4,"ngIf"],["data-test","specialGroups"]],template:function(h,i){1&h&&(t.DNE(0,ee,2,1,"ng-container",2),t.nI1(1,"async")),2&h&&t.Y8G("ngVar",t.bMT(1,1,i.user$))},dependencies:[e.O,L.q,a.Jj,m.h,m.D9,j.g,x.r,a.bT,a.Sq,B.w,a.T3,P.e,A.v,y.A]})}}return c})()},46020:(S,R,r)=>{var a={"./custom/app/profile-page/profile-page-metadata-form/profile-page-metadata-form.component":[22961,2961]};function m(v){if(!r.o(a,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var d=a[v],T=d[0];return r.e(d[1]).then(()=>r(T))}m.keys=()=>Object.keys(a),m.id=46020,S.exports=m},86930:(S,R,r)=>{var a={"./custom/app/profile-page/profile-page.component":[37879,7879]};function m(v){if(!r.o(a,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var d=a[v],T=d[0];return r.e(d[1]).then(()=>r(T))}m.keys=()=>Object.keys(a),m.id=86930,S.exports=m},63172:(S,R,r)=>{"use strict";r.d(R,{S:()=>O,z:()=>p});var a=r(54438),m=r(89417),v=r(60177);const d=["*"];function T(u,g){if(1&u&&(a.j41(0,"label",2)(1,"span",3),a.EFF(2),a.k0s(),a.j41(3,"span",4),a.EFF(4),a.k0s()()),2&u){const o=a.XpG();a.R7$(),a.xc7("color",o.getColor("checkedTextColor")),a.BMQ("aria-label",o.checkedLabel),a.R7$(),a.JRh(o.checkedLabel),a.R7$(),a.xc7("color",o.getColor("uncheckedTextColor")),a.BMQ("aria-label",o.uncheckedLabel),a.R7$(),a.JRh(o.uncheckedLabel)}}const b=new a.nKC("UI_SWITCH_OPTIONS"),M={provide:m.kq,useExisting:(0,a.Rfq)(()=>O),multi:!0};let O=(()=>{class u{constructor(o={},l){this.cdr=l,this.change=new a.bkB,this.changeEvent=new a.bkB,this.valueChange=new a.bkB,this.onTouchedCallback=D=>{},this.onChangeCallback=D=>{},this.size=o&&o.size||"medium",this.color=o&&o.color,this.switchOffColor=o&&o.switchOffColor,this.switchColor=o&&o.switchColor,this.defaultBgColor=o&&o.defaultBgColor,this.defaultBoColor=o&&o.defaultBoColor,this.checkedLabel=o&&o.checkedLabel,this.uncheckedLabel=o&&o.uncheckedLabel,this.checkedTextColor=o&&o.checkedTextColor,this.uncheckedTextColor=o&&o.uncheckedTextColor}set checked(o){this._checked=!1!==o}get checked(){return this._checked}set disabled(o){this._disabled=!1!==o}get disabled(){return this._disabled}set reverse(o){this._reverse=!1!==o}get reverse(){return this._reverse}set loading(o){this._loading=!1!==o}get loading(){return this._loading}getColor(o=""){return"borderColor"===o?this.defaultBoColor:"switchColor"===o?this.reverse?this.checked&&this.switchOffColor||this.switchColor:this.checked?this.switchColor:this.switchOffColor||this.switchColor:"checkedTextColor"===o?this.reverse?this.uncheckedTextColor:this.checkedTextColor:"uncheckedTextColor"===o?this.reverse?this.checkedTextColor:this.uncheckedTextColor:this.reverse?this.checked?this.defaultBgColor:this.color:this.checked?this.color:this.defaultBgColor}onClick(o){this.disabled||(this.checked=!this.checked,this.change.emit(this.checked),this.valueChange.emit(this.checked),this.changeEvent.emit(o),this.onChangeCallback(this.checked),this.onTouchedCallback(this.checked),this.cdr.markForCheck())}onToggle(o){this.disabled||(this.beforeChange?this._beforeChange=this.beforeChange.subscribe(l=>{l&&this.onClick(o)}):this.onClick(o))}writeValue(o){o!==this.checked&&(this.checked=!!o),this.onChangeCallback(this.checked),this.cdr&&this.cdr.markForCheck()}registerOnChange(o){this.onChangeCallback=o}registerOnTouched(o){this.onTouchedCallback=o}setDisabledState(o){this.disabled=o}ngOnDestroy(){this._beforeChange&&this._beforeChange.unsubscribe()}}return u.\u0275fac=function(o){return new(o||u)(a.rXU(b,8),a.rXU(a.gRc))},u.\u0275cmp=a.VBU({type:u,selectors:[["ui-switch"]],hostBindings:function(o,l){1&o&&a.bIt("click",function(B){return l.onToggle(B)})},inputs:{size:"size",color:"color",switchOffColor:"switchOffColor",switchColor:"switchColor",defaultBgColor:"defaultBgColor",defaultBoColor:"defaultBoColor",checkedLabel:"checkedLabel",uncheckedLabel:"uncheckedLabel",checkedTextColor:"checkedTextColor",uncheckedTextColor:"uncheckedTextColor",beforeChange:"beforeChange",ariaLabel:"ariaLabel",checked:"checked",disabled:"disabled",reverse:"reverse",loading:"loading"},outputs:{change:"change",changeEvent:"changeEvent",valueChange:"valueChange"},features:[a.Jv_([M])],ngContentSelectors:d,decls:4,vars:21,consts:[["type","button","role","switch",1,"switch"],["class","switch-pane",4,"ngIf"],[1,"switch-pane"],[1,"switch-label-checked"],[1,"switch-label-unchecked"]],template:function(o,l){1&o&&(a.NAR(),a.j41(0,"button",0),a.DNE(1,T,5,8,"label",1),a.j41(2,"small"),a.SdG(3),a.k0s()()),2&o&&(a.xc7("background-color",l.getColor())("border-color",l.getColor("borderColor")),a.AVh("checked",l.checked)("disabled",l.disabled)("loading",l.loading)("switch-large","large"===l.size)("switch-medium","medium"===l.size)("switch-small","small"===l.size),a.BMQ("aria-checked",l.checked)("aria-label",l.ariaLabel),a.R7$(),a.Y8G("ngIf",l.checkedLabel||l.uncheckedLabel),a.R7$(),a.xc7("background",l.getColor("switchColor")))},dependencies:[v.bT],encapsulation:2}),u})(),p=(()=>{class u{static forRoot(o){return{ngModule:u,providers:[{provide:b,useValue:o||{}}]}}}return u.\u0275fac=function(o){return new(o||u)},u.\u0275mod=a.$C({type:u}),u.\u0275inj=a.G2t({imports:[v.MD,m.YN,m.YN]}),u})()}}]);