"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[7341],{7341:(x,h,r)=>{r.r(h),r.d(h,{ROUTES:()=>U});var w=r(36329),p=r(60177),o=r(89417),d=r(52149),c=r(41780),v=r(56106),f=r(63172),T=r(84412),u=r(96354),M=r(5964),F=r(32473),I=r(27795),g=r(80183),S=r(60456),y=r(82777),_=r(39806),b=r(30398),e=r(54438),D=r(7901);const C=i=>({days:i}),A=i=>({hours:i}),R=i=>({minutes:i});function k(i,l){1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"system-wide-alert.form.error.message")," "))}function j(i,l){if(1&i&&(e.j41(0,"div",23),e.DNE(1,k,3,3,"span",15),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.formMessage.errors)}}function $(i,l){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",8)(2,"div",24)(3,"div",25)(4,"input",26,0),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.date,n)||(a.date=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.updatePreviewTime())}),e.k0s(),e.j41(6,"button",27),e.nI1(7,"translate"),e.bIt("click",function(){e.eBV(t);const n=e.sdS(5);return e.Njj(n.toggle())}),e.k0s()()(),e.j41(8,"div",28)(9,"div",25)(10,"ngb-timepicker",29),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.time,n)||(a.time=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.updatePreviewTime())}),e.k0s()()(),e.j41(11,"div",30)(12,"div",25)(13,"ngb-timepicker",29),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.time,n)||(a.time=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.updatePreviewTime())}),e.k0s()()()()()}if(2&i){const t=e.XpG();e.R7$(4),e.R50("ngModel",t.date),e.Y8G("minDate",t.minDate),e.R7$(2),e.BMQ("aria-label",e.bMT(7,5,"system-wide-alert-form.select-date-by-calendar")),e.R7$(4),e.R50("ngModel",t.time),e.R7$(3),e.R50("ngModel",t.time)}}function G(i,l){1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"system-wide-alert-banner.countdown.prefix")," "))}function E(i,l){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.i5U(2,1,"system-wide-alert-banner.countdown.days",e.eq3(4,C,t.previewDays))," ")}}function W(i,l){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.i5U(2,1,"system-wide-alert-banner.countdown.hours",e.eq3(4,A,t.previewHours))," ")}}function Y(i,l){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.i5U(2,1,"system-wide-alert-banner.countdown.minutes",e.eq3(4,R,t.previewMinutes))," ")}}function X(i,l){if(1&i&&(e.j41(0,"div")(1,"div",8)(2,"div",6)(3,"label"),e.EFF(4),e.nI1(5,"translate"),e.k0s()()(),e.j41(6,"div",31)(7,"span",32),e.DNE(8,G,3,3,"span",15)(9,E,3,6,"span",15)(10,W,3,6,"span",15)(11,Y,3,6,"span",15),e.k0s(),e.nrm(12,"span",33),e.k0s()()),2&i){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,6,"system-wide-alert.form.label.preview")),e.R7$(4),e.Y8G("ngIf",t.previewDays>0||t.previewHours>0||t.previewMinutes>0),e.R7$(),e.Y8G("ngIf",t.previewDays>0),e.R7$(),e.Y8G("ngIf",t.previewDays>0||t.previewHours>0),e.R7$(),e.Y8G("ngIf",t.previewDays>0||t.previewHours>0||t.previewMinutes>0),e.R7$(),e.Y8G("innerHTML",t.formMessage.value,e.npT)}}const U=[{path:"",canActivate:[w.Y],component:(()=>{class i{constructor(t,s,n,a,m){this.systemWideAlertDataService=t,this.notificationsService=s,this.router=n,this.requestService=a,this.translateService=m,this.counterEnabled$=new T.t(!1)}ngOnInit(){this.systemWideAlert$=this.systemWideAlertDataService.findAll().pipe((0,g.qD)(),(0,u.T)(s=>{if(s.hasSucceeded)return s.payload;this.notificationsService.error("system-wide-alert-form.retrieval.error")}),(0,u.T)(s=>s.page),(0,M.p)(s=>(0,y.hj)(s)),(0,u.T)(s=>s[0])),this.createForm();const t=new Date;this.minDate={year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},this.systemWideAlert$.subscribe(s=>{this.currentAlert=s,this.initFormValues(s)})}createForm(){this.alertForm=(new o.ze).group({formMessage:new o.hs("",{validators:[o.k0.required]}),formActive:new o.hs(!1)}),this.setDateTime(new Date)}initFormValues(t){this.formMessage.patchValue(t.message),this.formActive.patchValue(t.active);const s=(0,v.zonedTimeToUtc)(t.countdownTo,"UTC");s.getTime()-(new Date).getTime()>0&&(this.counterEnabled$.next(!0),this.setDateTime(s))}setActive(t){this.formActive.patchValue(t),this.save(!1)}setCounterEnabled(t){this.counterEnabled$.next(t),t?this.updatePreviewTime():(this.previewMinutes=0,this.previewHours=0,this.previewDays=0)}setDateTime(t){this.time={hour:t.getHours(),minute:t.getMinutes()},this.date={year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},this.updatePreviewTime()}updatePreviewTime(){const s=new Date(this.date.year,this.date.month-1,this.date.day,this.time.hour,this.time.minute).getTime()-(new Date).getTime();this.allocateTimeUnits(s)}allocateTimeUnits(t){this.previewMinutes=Math.floor(t/6e4%60),this.previewHours=Math.floor(t/36e5%24),this.previewDays=Math.floor(t/864e5)}get formMessage(){return this.alertForm.get("formMessage")}get formActive(){return this.alertForm.get("formActive")}save(t=!0){const s=new b.$;if(s.message=this.formMessage.value,s.active=this.formActive.value,this.counterEnabled$.getValue()){const n=new Date(this.date.year,this.date.month-1,this.date.day,this.time.hour,this.time.minute);s.countdownTo=(0,v.utcToZonedTime)(n,"UTC").toUTCString()}else s.countdownTo=null;if(this.alertForm.valid)if((0,y.a4)(this.currentAlert)){const n=Object.assign(new b.$,this.currentAlert,s);this.handleResponse(this.systemWideAlertDataService.put(n),"system-wide-alert.form.update",t)}else this.handleResponse(this.systemWideAlertDataService.create(s),"system-wide-alert.form.create",t)}handleResponse(t,s,n){t.pipe((0,g.qD)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(`${s}.success`)),this.requestService.setStaleByHrefSubstring("systemwidealerts"),n&&this.back()):this.notificationsService.error(this.translateService.get(`${s}.error`,a.errorMessage))})}back(){this.router.navigate(["/home"])}static{this.\u0275fac=function(s){return new(s||i)(e.rXU(I.SystemWideAlertDataService),e.rXU(_.I),e.rXU(D.Ix),e.rXU(F.B),e.rXU(c.c$))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["ds-system-wide-alert-form"]],standalone:!0,features:[e.aNF],decls:43,vars:41,consts:[["d","ngbDatepicker"],[1,"container"],["id","header"],[3,"formGroup"],[1,"form-group"],[1,"row","mb-2"],[1,"col"],[3,"change","checkedLabel","uncheckedLabel","checked"],[1,"row"],["for","formMessage"],["id","formMessage","rows","5","formControlName","formMessage",3,"className"],["class","invalid-feedback show-feedback",4,"ngIf"],[1,"col","mb-2","d-flex","align-items-end"],["size","small",3,"change","ariaLabel","checked"],[1,"ml-2"],[4,"ngIf"],[1,"mb-2"],[1,"text-muted"],[1,"btn-row","float-right","space-children-mr","mt-2"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"],[1,"fa","fa-save"],[1,"invalid-feedback","show-feedback"],[1,"col-sm-12","col-md-6"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","",1,"form-control",3,"ngModelChange","ngModel","minDate"],["type","button",1,"btn","btn-outline-secondary","fas","fa-calendar",3,"click"],[1,"col-12","d-md-none"],[3,"ngModelChange","ngModel"],[1,"d-none","d-md-block","col-md-6","timepicker-margin"],[1,"rounded-0","alert","alert-warning"],[1,"font-weight-bold"],[3,"innerHTML"]],template:function(s,n){1&s&&(e.j41(0,"div",1)(1,"h1",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"ui-switch",7),e.nI1(9,"translate"),e.nI1(10,"translate"),e.bIt("change",function(m){return n.setActive(m)}),e.k0s()()(),e.j41(11,"div",8)(12,"div",6)(13,"label",9),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"textarea",10),e.EFF(17,"                "),e.k0s(),e.DNE(18,j,2,1,"div",11),e.k0s()()()(),e.j41(19,"div",8)(20,"div",12)(21,"ui-switch",13),e.nI1(22,"translate"),e.nI1(23,"async"),e.bIt("change",function(m){return n.setCounterEnabled(m)}),e.k0s(),e.j41(24,"span",14),e.EFF(25),e.nI1(26,"translate"),e.k0s()()(),e.DNE(27,$,14,7,"div",15),e.nI1(28,"async"),e.j41(29,"div",16)(30,"span",17),e.EFF(31),e.nI1(32,"translate"),e.k0s()(),e.DNE(33,X,13,8,"div",15),e.j41(34,"div",18)(35,"button",19),e.bIt("click",function(){return n.back()}),e.nrm(36,"i",20),e.EFF(37),e.nI1(38,"translate"),e.k0s(),e.j41(39,"button",21),e.bIt("click",function(){return n.save()}),e.nrm(40,"i",22),e.EFF(41),e.nI1(42,"translate"),e.k0s()()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,19,"system-wide-alert.form.header")),e.R7$(2),e.HbH("ng-invalid"),e.Y8G("formGroup",n.alertForm),e.R7$(4),e.Y8G("checkedLabel",e.bMT(9,21,"system-wide-alert.form.label.active"))("uncheckedLabel",e.bMT(10,23,"system-wide-alert.form.label.inactive"))("checked",n.formActive.value),e.R7$(6),e.JRh(e.bMT(15,25,"system-wide-alert.form.label.message")),e.R7$(2),e.Y8G("className",n.formMessage.invalid&&(n.formMessage.dirty||n.formMessage.touched)?"form-control is-invalid":"form-control"),e.R7$(2),e.Y8G("ngIf",n.formMessage.invalid&&(n.formMessage.dirty||n.formMessage.touched)),e.R7$(3),e.Y8G("ariaLabel",e.bMT(22,27,"system-wide-alert.form.label.countdownTo.enable"))("checked",e.bMT(23,29,n.counterEnabled$)),e.R7$(4),e.JRh(e.bMT(26,31,"system-wide-alert.form.label.countdownTo.enable")),e.R7$(2),e.Y8G("ngIf",e.bMT(28,33,n.counterEnabled$)),e.R7$(4),e.JRh(e.bMT(32,35,"system-wide-alert.form.label.countdownTo.hint")),e.R7$(2),e.Y8G("ngIf",n.formMessage.value),e.R7$(4),e.SpI(" ",e.bMT(38,37,"system-wide-alert.form.cancel")," "),e.R7$(2),e.Y8G("dsBtnDisabled",n.alertForm.invalid),e.R7$(2),e.SpI(" ",e.bMT(42,39,"system-wide-alert.form.save")," "))},dependencies:[o.YN,o.me,o.BC,o.cb,o.vS,o.X1,o.j4,o.JD,f.z,f.S,p.bT,d.IQ,d.cw,d.tJ,d.Pe,p.Jj,c.h,c.D9,S.A],styles:[".timepicker-margin[_ngcontent-%COMP%]{margin-top:-38px}"]})}}return i})()}]}}]);