(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[7652],{67652:(P,B,t)=>{"use strict";t.r(B),t.d(B,{ROUTES:()=>c});var E=t(49347),e=t(54438),h=t(42578),u=t(80183),F=t(67600);const b=[(0,F.s)("bundle",{},(0,F.s)("primaryBitstream"),(0,F.s)("item")),(0,F.s)("format")],M=(o,O,a=(0,e.WQX)(h.BitstreamDataService))=>a.findById(o.params.id,!0,!1,...b).pipe((0,u.qD)());var f=t(7673),m=t(25558),p=t(96354),g=t(69799),y=t(90839),I=t(82777),_=t(1321),U=t(67045),L=t(96526);let V=(()=>{class o extends U.U{constructor(a,r,n){super(r,n),this.bitstreamService=a,this.linkService=r,this.dsoNameService=n}getBreadcrumbs(a,r){const n=this.dsoNameService.getName(a),l=new y.Q(n,r);return this.getOwningItem(a.uuid).pipe((0,m.n)(D=>{if((0,I.hj)(D)&&(0,I.a4)(D.payload)){const T=D.payload;return super.getBreadcrumbs(T,(0,g.wN)(T))}return(0,f.of)([])}),(0,p.T)(D=>[...D,l]))}getOwningItem(a){return this.bitstreamService.findById(a,!0,!0,...b).pipe((0,u.qD)(),(0,u.Bo)(),(0,m.n)(r=>(0,I.a4)(r)?r.bundle.pipe((0,u.qD)(),(0,u.Bo)(),(0,m.n)(n=>(0,I.a4)(n)?n.item.pipe((0,u.qD)()):(0,f.of)(void 0))):(0,f.of)(void 0)))}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(h.BitstreamDataService),e.KVO(_._),e.KVO(L.f))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var K=t(70025);const W=(o,O,a=(0,e.WQX)(V),r=(0,e.WQX)(h.BitstreamDataService))=>(0,K.G)(o,O,a,r,...b);var S=t(70379),X=t(55584),A=t(10676),k=t(92117),j=t(45539),G=t(60177),i=t(7901),H=t(41780),q=t(61594),tt=t(92772);const J=o=>["/bitstreams",o,"edit"];let R=(()=>{class o{constructor(a){this.route=a}ngOnInit(){this.dsoRD$=this.route.data.pipe((0,q.$)(),(0,p.T)(a=>a.bitstream))}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(i.nX))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["ds-bitstream-authorizations"]],standalone:!0,features:[e.aNF],decls:10,vars:12,consts:[[1,"container"],[3,"resourceType","resourceUUID"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary","mr-1",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(r,n){if(1&r&&(e.j41(0,"div",0),e.nrm(1,"ds-resource-policies",1),e.nI1(2,"async"),e.j41(3,"div",2)(4,"div",3)(5,"a",4),e.nI1(6,"async"),e.nrm(7,"i",5),e.EFF(8),e.nI1(9,"translate"),e.k0s()()()()),2&r){let l,D;e.R7$(),e.Y8G("resourceType","bitstream")("resourceUUID",null==(l=e.bMT(2,4,n.dsoRD$))||null==l.payload?null:l.payload.id),e.R7$(4),e.Y8G("routerLink",e.eq3(10,J,null==(D=e.bMT(6,6,n.dsoRD$))||null==D.payload?null:D.payload.id)),e.R7$(3),e.SpI(" ",e.bMT(9,8,"bitstream.edit.return")," ")}},dependencies:[tt.e,G.Jj,H.h,H.D9,i.Wk],encapsulation:2})}}return o})();var et=t(84572),C=t(5964),x=t(96697),it=t(67116),$=t(65007),Z=t(3970),st=t(15927),at=t(7337),rt=t(308),nt=t(89269),w=t(59752);const ot=o=>({bitstream:o});let z=(()=>{class o{constructor(a,r,n,l,D,T,Y,Q,ft,pt,vt){this.route=a,this.router=r,this.authorizationService=n,this.auth=l,this.fileService=D,this.hardRedirectService=T,this.location=Y,this.dsoNameService=Q,this.signpostingDataService=ft,this.responseService=pt,this.platformId=vt,this.initPageLinks()}back(){this.location.back()}ngOnInit(){this.bitstreamRD$=this.route.data.pipe((0,p.T)(a=>a.bitstream)),this.bitstream$=this.bitstreamRD$.pipe((0,rt.QD)(this.router,this.auth),(0,u.Bo)()),this.bitstream$.pipe((0,m.n)(a=>{const r=this.authorizationService.isAuthorized(Z._.CanDownload,(0,I.hj)(a)?a.self:void 0),n=this.auth.isAuthenticated();return(0,et.z)([r,n,(0,f.of)(a)])}),(0,C.p)(([a,r,n])=>(0,I.a4)(a)&&(0,I.a4)(r)),(0,x.s)(1),(0,m.n)(([a,r,n])=>a&&r?this.fileService.retrieveFileDownloadLink(n._links.content.href).pipe((0,C.p)(l=>(0,I.a4)(l)),(0,x.s)(1),(0,p.T)(l=>[a,r,n,l])):[[a,r,n,""]])).subscribe(([a,r,n,l])=>{a&&r&&(0,I.hj)(l)?this.hardRedirectService.redirect(l):a&&!r?this.hardRedirectService.redirect(n._links.content.href):!a&&r?this.router.navigateByUrl((0,g.bZ)(),{skipLocationChange:!0}):!a&&!r&&(this.auth.setRedirectUrl(this.router.url),this.router.navigateByUrl("login"))})}initPageLinks(){(0,G.Vy)(this.platformId)&&this.route.params.subscribe(a=>{this.signpostingDataService.getLinks(a.id).pipe((0,x.s)(1)).subscribe(r=>{let n="";r.forEach(l=>{n=n+((0,I.hj)(n)?", ":"")+`<${l.href}> ; rel="${l.rel}"`+((0,I.hj)(l.type)?` ; type="${l.type}" `:" ")}),this.responseService.setHeader("Link",n)})})}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(i.nX),e.rXU(i.Ix),e.rXU($.AuthorizationDataService),e.rXU(it.uR),e.rXU(nt.E),e.rXU(w.$),e.rXU(G.aZ),e.rXU(L.f),e.rXU(st.z),e.rXU(at.w),e.rXU(e.Agw))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["ds-bitstream-download-page"]],standalone:!0,features:[e.aNF],decls:10,vars:11,consts:[[1,"container"],[1,"h2"],[1,"pt-3"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"]],template:function(r,n){1&r&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2),e.nI1(3,"async"),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",2)(6,"button",3),e.bIt("click",function(){return n.back()}),e.nrm(7,"i",4),e.EFF(8),e.nI1(9,"translate"),e.k0s()()()),2&r&&(e.R7$(2),e.JRh(e.i5U(4,4,"bitstream.download.page",e.eq3(9,ot,n.dsoNameService.getName(e.bMT(3,2,n.bitstream$))))),e.R7$(6),e.SpI(" ",e.bMT(9,7,"bitstream.download.page.back")," "))},dependencies:[G.Jj,H.h,H.D9],encapsulation:2})}}return o})();const lt=(0,t(6056).L)(()=>M,()=>(0,f.of)(Z._.CanManagePolicies));var mt=t(8886);t(75119);const ct=["*"];function ht(o,O){}const N=(o,O,a=(0,e.WQX)(h.BitstreamDataService),r=(0,e.WQX)(w.$),n=(0,e.WQX)(i.Ix))=>{const l=o.params.prefix,D=o.params.suffix,T=o.params.filename;let Y=o.params.sequence_id;return(0,I.Tn)(Y)&&(Y=o.queryParams.sequenceId),a.findByItemHandle(`${l}/${D}`,Y,T).pipe((0,u.qD)(),(0,p.T)(Q=>Q.hasSucceeded&&!Q.hasNoContent?(r.redirect(new URL(`/bitstreams/${Q.payload.uuid}/download`,r.getCurrentOrigin()).href,301),!1):n.createUrlTree([g.RD])))},c=[{path:"handle/:prefix/:suffix/:filename",component:z,canActivate:[N]},{path:":prefix/:suffix/:sequence_id/:filename",component:z,canActivate:[N]},{path:":id/download",component:z,resolve:{bitstream:M}},{path:":id/edit",component:(()=>{class o extends mt.J{getComponentName(){return"EditBitstreamPageComponent"}importThemedComponent(a){return t(13170)(`./${a}/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component`)}importUnthemedComponent(){return Promise.resolve().then(t.bind(t,75119))}static{this.\u0275fac=(()=>{let a;return function(n){return(a||(a=e.xGo(o)))(n||o)}})()}static{this.\u0275cmp=e.VBU({type:o,selectors:[["ds-edit-bitstream-page"]],standalone:!0,features:[e.Vt3,e.aNF],ngContentSelectors:ct,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(r,n){1&r&&(e.NAR(),e.DNE(0,ht,0,0,"ng-template",null,0,e.C5r),e.j41(2,"div",null,1),e.SdG(4),e.k0s())},encapsulation:2})}}return o})(),resolve:{bitstream:M,breadcrumb:W},canActivate:[E.t]},{path:":id/authorizations",canActivate:[lt],children:[{path:"create",resolve:{resourcePolicyTarget:j.Q},component:X.m,data:{title:"resource-policies.create.page.title",showBreadcrumbs:!0}},{path:"edit",resolve:{breadcrumb:S.S,resourcePolicy:k.n},component:A._,data:{breadcrumbKey:"item.edit",title:"resource-policies.edit.page.title",showBreadcrumbs:!0}},{path:"",resolve:{bitstream:M,breadcrumb:W},component:R,data:{title:"bitstream.edit.authorizations.title",showBreadcrumbs:!0}}]}]},75119:(P,B,t)=>{"use strict";t.r(B),t.d(B,{EditBitstreamPageComponent:()=>ht});var E=t(60177),e=t(7901),h=t(1473),u=t(41780),F=t(84418),b=t.n(F),M=t(84572),f=t(7673),m=t(96354),p=t(25558),g=t(96697),y=t(5964),I=t(88141),_=t(96526),U=t(42578),L=t(4856),V=t(21626),K=t(39806),W=t(72734),S=t(41684),X=t(4910),A=t(80183),k=t(81443),j=t(43052),G=t(32473),i=t(54438);let H=(()=>{class v{constructor(s,d,c,o,O,a){this.requestService=s,this.rdbService=d,this.objectCache=c,this.halService=o,this.notificationsService=O,this.bundleDataService=a}getHttpOptions(){const s=Object.create({});let d=new V.Lr;return d=d.append("Content-Type","text/uri-list"),s.headers=d,s}createAndSendRequest(s,d,c){const o=this.requestService.generateRequestId(),O=new s(o,d,c,this.getHttpOptions());return this.requestService.send(O),this.rdbService.buildFromRequestUUID(o)}create(s,d){return this.createAndSendRequest(j.Qf,d._links.primaryBitstream.href,s.self)}put(s,d){return this.createAndSendRequest(j.v_,d._links.primaryBitstream.href,s.self)}delete(s){return this.createAndSendRequest(j.$,s._links.primaryBitstream.href).pipe((0,A.bD)(),(0,p.n)(d=>this.bundleDataService.findByHref(s.self,d.hasFailed)))}static{this.\u0275fac=function(d){return new(d||v)(i.KVO(G.B),i.KVO(W.o),i.KVO(S.$),i.KVO(X.Y),i.KVO(K.I),i.KVO(k.BundleDataService))}}static{this.\u0275prov=i.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}}return v})();var q=t(760),tt=t(92174),J=t(70334),R=t(39552),et=t(90887),C=t(82777),x=t(79632),it=t(37636),$=t(66733),Z=t(77485),st=t(11220),at=t(13143),rt=t(82394),nt=t(43525),w=t(18226),ot=t(97402);const z=v=>["/bitstreams",v,"authorizations"];function dt(v,N){if(1&v){const s=i.RV6();i.j41(0,"ds-form",12),i.bIt("submitForm",function(){i.eBV(s);const c=i.XpG(3);return i.Njj(c.onSubmit())})("cancel",function(){i.eBV(s);const c=i.XpG(3);return i.Njj(c.onCancel())})("dfChange",function(c){i.eBV(s);const o=i.XpG(3);return i.Njj(o.onChange(c))}),i.j41(1,"div",13)(2,"a",14),i.EFF(3),i.nI1(4,"translate"),i.k0s()()()}if(2&v){const s=i.XpG(2).ngVar,d=i.XpG();i.Y8G("formId","edit-bitstream-form-id")("formGroup",d.formGroup)("formModel",d.formModel)("formLayout",d.formLayout)("submitLabel","form.save"),i.R7$(2),i.Y8G("routerLink",i.eq3(9,z,null==s||null==s.payload?null:s.payload.id)),i.R7$(),i.JRh(i.bMT(4,7,"bitstream.edit.authorizations.link"))}}function lt(v,N){if(1&v&&(i.j41(0,"div",4)(1,"div",5),i.nrm(2,"ds-thumbnail",6),i.k0s(),i.j41(3,"div",7)(4,"div",1)(5,"div",4)(6,"div",8)(7,"h1",9),i.EFF(8),i.j41(9,"span",10),i.EFF(10),i.nI1(11,"dsFileSize"),i.k0s()()()()(),i.DNE(12,dt,5,11,"ds-form",11),i.k0s()()),2&v){const s=i.XpG().ngVar,d=i.XpG();i.R7$(2),i.Y8G("thumbnail",null==s?null:s.payload),i.R7$(6),i.SpI("",d.dsoNameService.getName(null==s?null:s.payload)," "),i.R7$(2),i.SpI("(",i.bMT(11,4,null==s||null==s.payload?null:s.payload.sizeBytes),")"),i.R7$(2),i.Y8G("ngIf",d.formGroup)}}function mt(v,N){1&v&&(i.nrm(0,"ds-error",15),i.nI1(1,"translate")),2&v&&i.FS9("message",i.bMT(1,1,"error.bitstream"))}function ut(v,N){1&v&&(i.nrm(0,"ds-loading",15),i.nI1(1,"translate")),2&v&&i.FS9("message",i.bMT(1,1,"loading.bitstream"))}function ct(v,N){if(1&v&&(i.qex(0),i.j41(1,"div",1),i.DNE(2,lt,13,6,"div",2)(3,mt,2,3,"ds-error",3)(4,ut,2,3,"ds-loading",3),i.k0s(),i.bVm()),2&v){const s=N.ngVar;i.R7$(2),i.Y8G("ngIf",null==s?null:s.hasSucceeded),i.R7$(),i.Y8G("ngIf",null==s?null:s.hasFailed),i.R7$(),i.Y8G("ngIf",!s||(null==s?null:s.isLoading))}}let ht=(()=>{class v{constructor(s,d,c,o,O,a,r,n,l,D){this.route=s,this.router=d,this.changeDetectorRef=c,this.formService=o,this.translate=O,this.bitstreamService=a,this.dsoNameService=r,this.notificationsService=n,this.bitstreamFormatService=l,this.primaryBitstreamService=D,this.KEY_PREFIX="bitstream.edit.form.",this.LABEL_KEY_SUFFIX=".label",this.HINT_KEY_SUFFIX=".hint",this.NOTIFICATIONS_PREFIX="bitstream.edit.notifications.",this.IMAGE_WIDTH_METADATA="iiif.image.width",this.IMAGE_HEIGHT_METADATA="iiif.image.height",this.IIIF_TOC_METADATA="iiif.toc",this.IIIF_LABEL_METADATA="iiif.label",this.findAllOptions={elementsPerPage:20,currentPage:1},this.fileNameModel=new $.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"fileName",name:"fileName",required:!0,validators:{required:null},errorMessages:{required:"You must provide a file name for the bitstream"}}),this.primaryBitstreamModel=new it.i({id:"primaryBitstream",name:"primaryBitstream"}),this.descriptionModel=new Z.E({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"description",name:"description",rows:10}),this.selectedFormatModel=new st.j({id:"selectedFormat",name:"selectedFormat",displayKey:"shortDescription",repeatable:!1,metadataFields:[],submissionId:"",hasSelectableMetadata:!1,resourceType:tt.a,formatFunction:T=>T instanceof q.v?(0,C.a4)(T)&&T.supportLevel===J.c.Unknown?this.translate.instant(this.KEY_PREFIX+"selectedFormat.unknown"):T.shortDescription:T}),this.newFormatModel=new h.rA_({id:"newFormat",name:"newFormat"}),this.iiifLabelModel=new $.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifLabel",name:"iiifLabel"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifLabelContainer=new h.iO5({id:"iiifLabelContainer",group:[this.iiifLabelModel]},{grid:{host:"form-row"}}),this.iiifTocModel=new $.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifToc",name:"iiifToc"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifTocContainer=new h.iO5({id:"iiifTocContainer",group:[this.iiifTocModel]},{grid:{host:"form-row"}}),this.iiifWidthModel=new $.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifWidth",name:"iiifWidth"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifWidthContainer=new h.iO5({id:"iiifWidthContainer",group:[this.iiifWidthModel]},{grid:{host:"form-row"}}),this.iiifHeightModel=new $.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifHeight",name:"iiifHeight"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifHeightContainer=new h.iO5({id:"iiifHeightContainer",group:[this.iiifHeightModel]},{grid:{host:"form-row"}}),this.inputModels=[this.primaryBitstreamModel,this.fileNameModel,this.descriptionModel,this.selectedFormatModel,this.newFormatModel],this.formModel=[new h.iO5({id:"fileNamePrimaryContainer",group:[this.primaryBitstreamModel,this.fileNameModel]},{grid:{host:"form-row"}}),new h.iO5({id:"descriptionContainer",group:[this.descriptionModel]}),new h.iO5({id:"formatContainer",group:[this.selectedFormatModel,this.newFormatModel]})],this.newFormatBaseLayout="col col-sm-6 d-inline-block",this.formLayout={fileName:{grid:{host:"col col-sm-8 d-inline-block"}},primaryBitstream:{grid:{container:"col-12"},element:{container:"text-right"}},description:{grid:{host:"col-12 d-inline-block"}},embargo:{grid:{host:"col-12 d-inline-block"}},selectedFormat:{grid:{host:"col col-sm-6 d-inline-block"}},newFormat:{grid:{host:this.newFormatBaseLayout+" invisible"}},fileNamePrimaryContainer:{grid:{host:"row position-relative"}},descriptionContainer:{grid:{host:"row"}},formatContainer:{grid:{host:"row"}}},this.isIIIF=!1,this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.queryParams.itemId,this.entityType=this.route.snapshot.queryParams.entityType,this.bitstreamRD$=this.route.data.pipe((0,m.T)(a=>a.bitstream));const s=this.bitstreamRD$.pipe((0,A.yd)(),(0,A.Bo)()),d=s.pipe((0,p.n)(a=>a.bundle),(0,A.ak)()),c=d.pipe((0,C.Az)(),(0,p.n)(a=>this.bitstreamService.findByHref(a._links.primaryBitstream.href)),(0,A.ak)()),o=d.pipe((0,p.n)(a=>a.item),(0,A.ak)()),O=s.pipe((0,p.n)(a=>a.format),(0,A.ak)());this.subs.push((0,M.z)(s,d,c,o,O).subscribe(([a,r,n,l,D])=>{this.bitstream=a,this.bundle=r,this.selectedFormat=D,this.primaryBitstreamUUID=(0,C.a4)(n)?n.uuid:null,this.itemId=l.uuid,this.setIiifStatus(this.bitstream)}),O.pipe((0,g.s)(1)).subscribe(a=>this.originalFormat=a)),this.subs.push(this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}))}setForm(){this.formGroup=this.formService.createFormGroup(this.formModel),this.updateForm(this.bitstream),this.updateFieldTranslations()}updateForm(s){this.formGroup.patchValue({fileNamePrimaryContainer:{fileName:s.name,primaryBitstream:this.primaryBitstreamUUID===s.uuid},descriptionContainer:{description:s.firstMetadataValue("dc.description")},formatContainer:{selectedFormat:this.selectedFormat.shortDescription,newFormat:(0,C.a4)(s.firstMetadata("dc.format"))?s.firstMetadata("dc.format").value:void 0}}),this.isIIIF&&this.formGroup.patchValue({iiifLabelContainer:{iiifLabel:s.firstMetadataValue(this.IIIF_LABEL_METADATA)},iiifTocContainer:{iiifToc:s.firstMetadataValue(this.IIIF_TOC_METADATA)},iiifWidthContainer:{iiifWidth:s.firstMetadataValue(this.IMAGE_WIDTH_METADATA)},iiifHeightContainer:{iiifHeight:s.firstMetadataValue(this.IMAGE_HEIGHT_METADATA)}}),this.updateNewFormatLayout()}updateNewFormatLayout(){this.formLayout.newFormat.grid.host=this.isUnknownFormat()?this.newFormatBaseLayout:this.newFormatBaseLayout+" invisible"}isUnknownFormat(){return(0,C.a4)(this.selectedFormat)&&this.selectedFormat.supportLevel===J.c.Unknown}updateFieldTranslations(){this.inputModels.forEach(s=>{this.updateFieldTranslation(s)})}updateFieldTranslation(s){s.label=this.translate.instant(this.KEY_PREFIX+s.id+this.LABEL_KEY_SUFFIX),s.id!==this.primaryBitstreamModel.id&&(s.hint=this.translate.instant(this.KEY_PREFIX+s.id+this.HINT_KEY_SUFFIX))}onChange(s){const d=s.model;d.id===this.selectedFormatModel.id&&(this.selectedFormat=d.value,this.updateNewFormatLayout())}onSubmit(){const s=this.formGroup.getRawValue(),d=this.formToBitstream(s),c=this.selectedFormat.id!==this.originalFormat.id,O=this.primaryBitstreamUUID===this.bitstream.uuid;let a,r,n=!1;if(O!==s.fileNamePrimaryContainer.primaryBitstream){let l;l=O?this.primaryBitstreamService.delete(this.bundle):(0,C.a4)(this.primaryBitstreamUUID)?this.primaryBitstreamService.put(this.bitstream,this.bundle):this.primaryBitstreamService.create(this.bitstream,this.bundle);const D=l.pipe((0,A.qD)());this.subs.push(D.pipe((0,y.p)(T=>T.hasFailed)).subscribe(T=>{this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.primaryBitstream.title"),T.errorMessage),n=!0})),r=D.pipe((0,m.T)(T=>T.hasSucceeded?T.payload:this.bundle)),this.subs.push(r.pipe((0,C.Az)(),(0,p.n)(T=>this.bitstreamService.findByHref(T._links.primaryBitstream.href,!1)),(0,A.ak)()).subscribe(T=>{this.primaryBitstreamUUID=(0,C.a4)(T)?T.uuid:null}))}else r=(0,f.of)(this.bundle);a=c?this.bitstreamService.updateFormat(this.bitstream,this.selectedFormat).pipe((0,A.qD)(),(0,m.T)(l=>{if(!(0,C.a4)(l)||!l.hasFailed)return l.payload;this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.format.title"),l.errorMessage)})):(0,f.of)(this.bitstream),(0,M.z)([r,a]).pipe((0,I.M)(([l])=>this.bundle=l),(0,p.n)(()=>this.bitstreamService.update(d).pipe((0,A.ak)()))).subscribe(()=>{this.bitstreamService.commitUpdates(),this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.content")),n||this.navigateToItemEditBitstreams()})}formToBitstream(s){const d=b()(this.bitstream),c=d.metadata;return R.O.setFirstValue(c,"dc.title",s.fileNamePrimaryContainer.fileName),(0,C.Im)(s.descriptionContainer.description)?delete c["dc.description"]:R.O.setFirstValue(c,"dc.description",s.descriptionContainer.description),this.isIIIF&&((0,C.Im)(s.iiifLabelContainer.iiifLabel)?delete c[this.IIIF_LABEL_METADATA]:R.O.setFirstValue(c,this.IIIF_LABEL_METADATA,s.iiifLabelContainer.iiifLabel),(0,C.Im)(s.iiifTocContainer.iiifToc)?delete c[this.IIIF_TOC_METADATA]:R.O.setFirstValue(c,this.IIIF_TOC_METADATA,s.iiifTocContainer.iiifToc),(0,C.Im)(s.iiifWidthContainer.iiifWidth)?delete c[this.IMAGE_WIDTH_METADATA]:R.O.setFirstValue(c,this.IMAGE_WIDTH_METADATA,s.iiifWidthContainer.iiifWidth),(0,C.Im)(s.iiifHeightContainer.iiifHeight)?delete c[this.IMAGE_HEIGHT_METADATA]:R.O.setFirstValue(c,this.IMAGE_HEIGHT_METADATA,s.iiifHeightContainer.iiifHeight)),(0,C.hj)(s.formatContainer.newFormat)&&R.O.setFirstValue(c,"dc.format",s.formatContainer.newFormat),d.metadata=c,d}onCancel(){this.navigateToItemEditBitstreams()}navigateToItemEditBitstreams(){this.router.navigate([(0,et.DL)(this.entityType,this.itemId),"bitstreams"])}setIiifStatus(s){const d=/OTHERCONTENT|THUMBNAIL|LICENSE/,c=/true|yes/i,o=this.bitstream.format.pipe((0,A.yd)(),(0,m.T)(n=>n.payload.mimetype.includes("image/"))),O=this.bitstream.bundle.pipe((0,A.yd)(),(0,m.T)(n=>null==this.dsoNameService.getName(n.payload).match(d))),a=this.bitstream.bundle.pipe((0,A.yd)(),(0,m.T)(n=>n.payload.item.pipe((0,A.yd)(),(0,m.T)(l=>l.payload.firstMetadataValue("dspace.iiif.enabled")&&null!==l.payload.firstMetadataValue("dspace.iiif.enabled").match(c))))),r=(0,M.z)(o,O,a).subscribe(([n,l,D])=>{n&&l&&D&&(this.isIIIF=!0,this.inputModels.push(this.iiifLabelModel),this.formModel.push(this.iiifLabelContainer),this.inputModels.push(this.iiifTocModel),this.formModel.push(this.iiifTocContainer),this.inputModels.push(this.iiifWidthModel),this.formModel.push(this.iiifWidthContainer),this.inputModels.push(this.iiifHeightModel),this.formModel.push(this.iiifHeightContainer)),this.setForm(),this.changeDetectorRef.detectChanges()});this.subs.push(r)}ngOnDestroy(){this.subs.filter(s=>(0,C.a4)(s)).forEach(s=>s.unsubscribe())}findAllFormatsServiceFactory(){return()=>this.bitstreamFormatService}static{this.\u0275fac=function(d){return new(d||v)(i.rXU(e.nX),i.rXU(e.Ix),i.rXU(i.gRc),i.rXU(h.J9r),i.rXU(u.c$),i.rXU(U.BitstreamDataService),i.rXU(_.f),i.rXU(K.I),i.rXU(L.BitstreamFormatDataService),i.rXU(H))}}static{this.\u0275cmp=i.VBU({type:v,selectors:[["ds-base-edit-bitstream-page"]],standalone:!0,features:[i.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[1,"container"],["class","row",4,"ngIf"],[3,"message",4,"ngIf"],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"col-12"],[1,"h2"],[1,"text-muted"],[3,"formId","formGroup","formModel","formLayout","submitLabel","submitForm","cancel","dfChange",4,"ngIf"],[3,"submitForm","cancel","dfChange","formId","formGroup","formModel","formLayout","submitLabel"],["additional","",1,"container","py-3"],[3,"routerLink"],[3,"message"]],template:function(d,c){1&d&&(i.DNE(0,ct,5,3,"ng-container",0),i.nI1(1,"async")),2&d&&i.Y8G("ngVar",i.bMT(1,1,c.bitstreamRD$))},dependencies:[at.s,E.bT,w.r,ot.T,E.Jj,e.Wk,x.A,rt.v,u.h,u.D9,nt.s],changeDetection:0})}}return v})()},90839:(P,B,t)=>{"use strict";t.d(B,{Q:()=>E});class E{constructor(h,u){this.text=h,this.url=u}}},70025:(P,B,t)=>{"use strict";t.d(B,{G:()=>F,o:()=>b});var E=t(96354),e=t(69799),h=t(82777),u=t(80183);const F=(M,f,m,p,...g)=>b(M,f,M.params.id,m,p,...g),b=(M,f,m,p,g,...y)=>g.findById(m,!0,!1,...y).pipe((0,u.qD)(),(0,u.Bo)(),(0,E.T)(I=>{if((0,h.a4)(I))return{provider:p,key:I,url:(0,e.wN)(I)}}))},67045:(P,B,t)=>{"use strict";t.d(B,{U:()=>y});var E=t(7673),e=t(47677),h=t(25558),u=t(96354),F=t(69799),b=t(90839),M=t(82777),f=t(67600),m=t(1321),p=t(96526),g=t(54438);let y=(()=>{class I{constructor(U,L){this.linkService=U,this.dsoNameService=L}getBreadcrumbs(U,L){const V=this.dsoNameService.getName(U),K=new b.Q(V,L),W=U.getParentLinkKey();return this.linkService.resolveLink(U,(0,f.s)(W))[W].pipe((0,e.I)(S=>S.hasSucceeded||204===S.statusCode),(0,h.n)(S=>{if((0,M.a4)(S)&&(0,M.a4)(S.payload)){const X=S.payload;return this.getBreadcrumbs(X,(0,F.wN)(X))}return(0,E.of)([])}),(0,u.T)(S=>[...S,K]))}static{this.\u0275fac=function(L){return new(L||I)(g.KVO(m._),g.KVO(p.f))}}static{this.\u0275prov=g.jDH({token:I,factory:I.\u0275fac,providedIn:"root"})}}return I})()},70379:(P,B,t)=>{"use strict";t.d(B,{S:()=>f});var E=t(54438),e=t(82777),h=t(30506),u=t(7673),F=t(90839);let M=(()=>{class m{getBreadcrumbs(g,y){return(0,u.of)([new F.Q(g+".breadcrumbs",y)])}static{this.\u0275fac=function(y){return new(y||m)}}static{this.\u0275prov=E.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})();const f=(m,p,g=(0,E.WQX)(M))=>{const y=m.data.breadcrumbKey;if((0,e.Tn)(y))throw new Error('You provided an i18nBreadcrumbResolver for url "'+m.url+"\" but no breadcrumbKey in the route's data");return{provider:g,key:y,url:(0,h.F)(m)}}},6056:(P,B,t)=>{"use strict";t.d(B,{L:()=>h});var E=t(96354),e=t(17024);const h=(u,F)=>(0,e.FO)(u,(b,M)=>F(b,M).pipe((0,E.T)(f=>[f])))},17024:(P,B,t)=>{"use strict";t.d(B,{FO:()=>M});var E=t(96354),e=t(82777),h=t(80183),u=t(51581);const b=f=>(m,p)=>{const g=(f=>{let m=f;for(;(0,e.Tn)(m.params.id)&&(0,e.a4)(m.parent);)m=m.parent;return m})(m);return f(g,p).pipe((0,h.Hz)(),(0,E.T)(y=>y.self))},M=(f,m,p=b,g)=>(0,u.h)((y,I)=>m(y,I),p(f()),g)},15927:(P,B,t)=>{"use strict";t.d(B,{z:()=>M});var E=t(7673),e=t(99437),h=t(96354),u=t(82640),F=t(53778),b=t(54438);let M=(()=>{class f{constructor(p,g){this.appConfig=p,this.restService=g}getLinks(p){return this.restService.get(`${this.appConfig.rest.baseUrl}/signposting/links/${p}`).pipe((0,e.W)(y=>(0,E.of)([])),(0,h.T)(y=>200===y.statusCode?y.payload:[]))}static{this.\u0275fac=function(g){return new(g||f)(b.KVO(u.vQ),b.KVO(F.Y))}}static{this.\u0275prov=b.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})()},13170:(P,B,t)=>{var E={"./custom/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component":[84957,4957]};function e(h){if(!t.o(E,h))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+h+"'");throw b.code="MODULE_NOT_FOUND",b});var u=E[h],F=u[0];return t.e(u[1]).then(()=>t(F))}e.keys=()=>Object.keys(E),e.id=13170,P.exports=e}}]);