"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[8500],{48156:(y,I,a)=>{a.d(I,{f:()=>k});var v=a(21626),o=a(5964),m=a(96354),T=a(47677),p=a(82777),C=a(72734),f=a(4910),R=a(80183),F=a(71135),M=a(13808),h=a(54438);let g=(()=>{class d{parse(E,n){const _=n.payload,c=Object.assign(new F.c,_);return new M.hT(n.statusCode,void 0,c)}static{this.\u0275fac=function(n){return new(n||d)}}static{this.\u0275prov=h.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();var u=a(43052),O=a(32473);let k=(()=>{class d{constructor(E,n,_){this.requestService=E,this.rdbService=n,this.halService=_,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(E){return this.halService.getEndpoint(this.linkPath).pipe((0,o.p)(n=>(0,p.hj)(n)),(0,m.T)(n=>`${n}${this.searchByTokenPath}${E}`))}registerEmail(E,n=null,_){const c=new F.c;c.email=E;const e=this.requestService.generateRequestId(),A=this.getRegistrationEndpoint(),P=Object.create({});let b=new v.Lr;return n&&(b=b.append("x-recaptcha-token",n)),P.headers=b,(0,p.a4)(_)&&(P.params=_?new v.Nl({fromString:"accountRequestType="+_}):new v.Nl),A.pipe((0,T.I)(D=>(0,p.a4)(D)),(0,m.T)(D=>{const G=new u.Qf(e,D,c,P);this.requestService.send(G)})).subscribe(),this.rdbService.buildFromRequestUUID(e).pipe((0,R.qD)())}searchByToken(E){const n=this.requestService.generateRequestId(),_=this.getTokenSearchEndpoint(E).pipe((0,T.I)(c=>(0,p.a4)(c)));return _.subscribe(c=>{const e=new u.IP(n,c);Object.assign(e,{getResponseParser:()=>g}),this.requestService.send(e,!0)}),this.rdbService.buildSingle(_).pipe((0,m.T)(c=>c.hasSucceeded&&(0,p.a4)(c.payload)?Object.assign(c,{payload:Object.assign(c.payload,{token:E})}):c))}static{this.\u0275fac=function(n){return new(n||d)(h.KVO(O.B),h.KVO(C.o),h.KVO(f.Y))}}static{this.\u0275prov=h.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},48500:(y,I,a)=>{a.r(I),a.d(I,{RegisterEmailFormComponent:()=>V,TYPE_REQUEST_FORGOT:()=>W,TYPE_REQUEST_REGISTER:()=>U});var v=a(60177),o=a(89417),m=a(41780),T=a(84412),p=a(84572),C=a(25558),f=a(7673),R=a(96354),F=a(96697),M=a(99172),h=a(8917),g=a(48156),u=a(34826),O=a(93130),k=a(80183),d=a(16292),B=a(47978),E=a(60456),n=a(82777),_=a(40788),c=a(39806),e=a(54438),A=a(7901),P=a(80566);const b=s=>({domains:s});function D(s,S){if(1&s&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Lme(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".info.maildomain")," ",t.validMailDomains.join(", ")," ")}}function G(s,S){if(1&s&&(e.j41(0,"span",16),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,1,t.MESSAGE_PREFIX+".email.error.required")," ")}}function j(s,S){if(1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&s){const t=e.XpG(3);e.R7$(),e.SpI(" ",e.i5U(2,1,t.MESSAGE_PREFIX+".email.error.not-valid-domain",e.eq3(4,b,t.validMailDomains.join(", ")))," ")}}function X(s,S){if(1&s&&(e.j41(0,"span",17),e.EFF(1),e.nI1(2,"translate"),e.DNE(3,j,3,6,"ng-container",2),e.k0s()),2&s){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".email.error.not-email-form")," "),e.R7$(2),e.Y8G("ngIf",t.validMailDomains.length>0)}}function $(s,S){if(1&s&&(e.j41(0,"div",13),e.DNE(1,G,3,3,"span",14)(2,X,4,4,"span",15),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.email.errors&&t.email.errors.required),e.R7$(),e.Y8G("ngIf",t.email.errors&&(t.email.errors.pattern&&t.typeRequest===t.TYPE_REQUEST_REGISTER||t.email.errors.email))}}function x(s,S){if(1&s){const t=e.RV6();e.j41(0,"ds-alert",18),e.nrm(1,"p",19),e.nI1(2,"translate"),e.j41(3,"p",20)(4,"a",21),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.klaroService.showSettings())}),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()}if(2&s){const t=e.XpG();e.Y8G("type",t.AlertTypeEnum.Warning),e.R7$(),e.Y8G("innerHTML",e.bMT(2,3,t.MESSAGE_PREFIX+".google-recaptcha.must-accept-cookies"),e.npT),e.R7$(4),e.JRh(e.bMT(6,5,t.MESSAGE_PREFIX+".google-recaptcha.open-cookie-settings"))}}function N(s,S){if(1&s){const t=e.RV6();e.j41(0,"div",22)(1,"ds-google-recaptcha",23),e.nI1(2,"async"),e.bIt("executeRecaptcha",function(i){e.eBV(t);const l=e.XpG();return e.Njj(l.register(i))})("checkboxChecked",function(i){e.eBV(t);const l=e.XpG();return e.Njj(l.onCheckboxChecked(i))})("showNotification",function(i){e.eBV(t);const l=e.XpG();return e.Njj(l.showNotification(i))}),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("captchaMode",e.bMT(2,1,t.googleRecaptchaService.captchaMode()))}}function K(s,S){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"button",24),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.register())}),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.bVm()}if(2&s){const t=e.XpG();e.R7$(),e.Y8G("dsBtnDisabled",t.form.invalid||t.registrationVerification&&!t.isRecaptchaCookieAccepted()||t.disableUntilChecked),e.R7$(),e.SpI(" ",e.bMT(3,2,t.MESSAGE_PREFIX+".submit")," ")}}function L(s,S){if(1&s){const t=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.executeRecaptcha())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("dsBtnDisabled",t.form.invalid),e.R7$(),e.SpI(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".submit")," ")}}const W="forgot",U="register";let V=(()=>{class s{captchaVersion(){return this.googleRecaptchaService.captchaVersion()}captchaMode(){return this.googleRecaptchaService.captchaMode()}constructor(t,r,i,l,Y,w,z,Q,Z,H,J){this.epersonRegistrationService=t,this.notificationService=r,this.translateService=i,this.router=l,this.formBuilder=Y,this.configService=w,this.googleRecaptchaService=z,this.cookieService=Q,this.klaroService=Z,this.changeDetectorRef=H,this.notificationsService=J,this.typeRequest=null,this.AlertTypeEnum=B.v,this.registrationVerification=!1,this.checkboxCheckedSubject$=new T.t(!1),this.disableUntilChecked=!0,this.TYPE_REQUEST_REGISTER=U,this.subscriptions=[]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}ngOnInit(){const t=[o.k0.required,o.k0.email,o.k0.pattern("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$")];this.form=this.formBuilder.group({email:new o.hs("",{validators:t})}),this.validMailDomains=[],this.typeRequest===U&&this.subscriptions.push(this.configService.findByPropertyName("authentication-password.domain.valid").pipe((0,k.Hz)()).subscribe(r=>{this.validMailDomains=r.values;for(const i of r.values)0!==this.validMailDomains.length&&(this.form.get("email").setValidators([...t,o.k0.pattern(this.validMailDomains.map(l=>"(^.*"+l.replace(new RegExp("\\.","g"),"\\.")+"$)").join("|"))]),this.form.updateValueAndValidity());this.changeDetectorRef.detectChanges()})),this.subscriptions.push(this.configService.findByPropertyName("registration.verification.enabled").pipe((0,k.ak)(),(0,R.T)(r=>"true"===r?.values[0].toLowerCase())).subscribe(r=>{this.registrationVerification=r})),this.subscriptions.push(this.disableUntilCheckedFcn().subscribe(r=>{this.disableUntilChecked=r,this.changeDetectorRef.detectChanges()}))}executeRecaptcha(){this.googleRecaptchaService.executeRecaptcha()}register(t){this.form.invalid||(this.registrationVerification?this.subscriptions.push((0,p.z)([this.captchaVersion(),this.captchaMode()]).pipe((0,C.n)(([r,i])=>"v3"===r?this.googleRecaptchaService.getRecaptchaToken("register_email"):"v2"===r&&"checkbox"===i?(0,f.of)(this.googleRecaptchaService.getRecaptchaTokenResponse()):"v2"===r&&"invisible"===i?(0,f.of)(t):(console.error(`Invalid reCaptcha configuration: version = ${r}, mode = ${i}`),void this.showNotification("error"))),(0,F.s)(1)).subscribe(r=>{(0,n.hj)(r)?this.registration(r):(console.error("reCaptcha error"),this.showNotification("error"))})):this.registration())}registration(t=null){const r=this.epersonRegistrationService.registerEmail(this.email.value,t||null,this.typeRequest);this.subscriptions.push(r.subscribe(i=>{i.hasSucceeded?(this.notificationService.success(this.translateService.get(`${this.MESSAGE_PREFIX}.success.head`),this.translateService.get(`${this.MESSAGE_PREFIX}.success.content`,{email:this.email.value})),this.router.navigate(["/home"])):this.notificationService.error(this.translateService.get(`${this.MESSAGE_PREFIX}.error.head`),422===i.statusCode?this.translateService.get(`${this.MESSAGE_PREFIX}.error.maildomain`,{domains:this.validMailDomains.join(", ")}):this.translateService.get(`${this.MESSAGE_PREFIX}.error.content`,{email:this.email.value}))}))}isRecaptchaCookieAccepted(){const t=this.cookieService.get("klaro-anonymous");return!!(0,n.hj)(t)&&t[u.BA]}disableUntilCheckedFcn(){const t=this.checkboxCheckedSubject$.asObservable();return(0,p.z)([this.captchaVersion(),this.captchaMode(),t]).pipe((0,C.n)(([r,i,l])=>(0,f.of)("v2"===r&&"checkbox"===i&&!l)),(0,M.Z)(!0))}get email(){return this.form.get("email")}onCheckboxChecked(t){this.checkboxCheckedSubject$.next(t)}showNotification(t){const r=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.title"),i=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.message.error"),l=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.message.expired");switch(t){case"expired":this.notificationsService.warning(r,l);break;case"error":this.notificationsService.error(r,i);break;default:console.warn(`Unimplemented notification '${t}' from reCaptcha service`)}}static{this.\u0275fac=function(r){return new(r||s)(e.rXU(g.f),e.rXU(c.I),e.rXU(m.c$),e.rXU(A.Ix),e.rXU(o.ze),e.rXU(h.ConfigurationDataService),e.rXU(u.wq),e.rXU(O.O),e.rXU(P.$,8),e.rXU(e.gRc),e.rXU(c.I))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-base-register-email-form"]],inputs:{MESSAGE_PREFIX:"MESSAGE_PREFIX",typeRequest:"typeRequest"},standalone:!0,features:[e.aNF],decls:29,vars:33,consts:[["v2Invisible",""],[1,"container"],[4,"ngIf"],[3,"formGroup"],[1,"form-group"],[1,"row"],[1,"col-12"],["for","email",1,"font-weight-bold"],["type","text","id","email","formControlName","email",3,"className"],["class","invalid-feedback show-feedback",4,"ngIf"],[3,"type",4,"ngIf"],["class","my-3",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"invalid-feedback","show-feedback"],["id","email-errors-required",4,"ngIf"],["id","email-error-not-valid",4,"ngIf"],["id","email-errors-required"],["id","email-error-not-valid"],[3,"type"],[1,"m-0",3,"innerHTML"],[1,"m-0"],["href","javascript:void(0);",3,"click"],[1,"my-3"],[3,"executeRecaptcha","checkboxChecked","showNotification","captchaMode"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"]],template:function(r,i){if(1&r&&(e.j41(0,"div",1)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"p"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,D,3,4,"p",2),e.j41(8,"form",3)(9,"div",4)(10,"div",5)(11,"div",6)(12,"label",7),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.nrm(15,"input",8),e.nI1(16,"translate"),e.DNE(17,$,3,2,"div",9),e.k0s(),e.j41(18,"div",6),e.EFF(19),e.nI1(20,"translate"),e.k0s()()(),e.DNE(21,x,7,7,"ds-alert",10)(22,N,3,3,"div",11),e.nI1(23,"async"),e.DNE(24,K,4,4,"ng-container",12),e.nI1(25,"async"),e.nI1(26,"async"),e.DNE(27,L,3,4,"ng-template",null,0,e.C5r),e.k0s()()),2&r){const l=e.sdS(28);e.R7$(2),e.JRh(e.bMT(3,17,i.MESSAGE_PREFIX+".header")),e.R7$(3),e.JRh(e.bMT(6,19,i.MESSAGE_PREFIX+".info")),e.R7$(2),e.Y8G("ngIf",0!==i.validMailDomains.length&&i.typeRequest===i.TYPE_REQUEST_REGISTER),e.R7$(),e.HbH("ng-invalid"),e.Y8G("formGroup",i.form),e.R7$(5),e.JRh(e.bMT(14,21,i.MESSAGE_PREFIX+".email")),e.R7$(2),e.Y8G("className",i.email.invalid&&(i.email.dirty||i.email.touched)?"form-control is-invalid":"form-control"),e.BMQ("aria-label",e.bMT(16,23,i.MESSAGE_PREFIX+".aria.label"))("aria-describedby",i.email.errors?i.email.errors.required?"email-errors-required":"email-error-not-valid":"")("aria-invalid",i.email.invalid),e.R7$(2),e.Y8G("ngIf",i.email.invalid&&(i.email.dirty||i.email.touched)),e.R7$(2),e.SpI(" ",e.bMT(20,25,i.MESSAGE_PREFIX+".email.hint")," "),e.R7$(2),e.Y8G("ngIf",i.registrationVerification&&!i.isRecaptchaCookieAccepted()),e.R7$(),e.Y8G("ngIf",i.isRecaptchaCookieAccepted()&&"v2"===e.bMT(23,27,i.googleRecaptchaService.captchaVersion())),e.R7$(2),e.Y8G("ngIf",!i.registrationVerification||"v2"!==e.bMT(25,29,i.googleRecaptchaService.captchaVersion())&&"invisible"===e.bMT(26,31,i.googleRecaptchaService.captchaMode()))("ngIfElse",l)}},dependencies:[v.bT,o.YN,o.qT,o.me,o.BC,o.cb,o.X1,o.j4,o.JD,d.C,_.U,v.Jj,m.h,m.D9,E.A],encapsulation:2})}}return s})()},40788:(y,I,a)=>{a.d(I,{U:()=>f});var v=a(60177),o=a(54438),m=a(1676),T=a(8917),p=a(80183),C=a(82777);let f=(()=>{class R{constructor(M,h){this._window=M,this.configService=h,this.executeRecaptcha=new o.bkB,this.checkboxChecked=new o.bkB,this.showNotification=new o.bkB,this.dataCallbackFcn=g=>{switch(this.captchaMode){case"invisible":this.executeRecaptcha.emit(g);break;case"checkbox":this.checkboxChecked.emit((0,C.hj)(g));break;default:console.error(`Invalid reCaptcha mode '${this.captchaMode}`),this.showNotification.emit("error")}},this.expiredCallbackFcn=()=>{this.checkboxChecked.emit(!1),this.showNotification.emit("expired")},this.errorCallbackFcn=()=>{this.showNotification.emit("error")}}ngOnInit(){this.recaptchaKey$=this.configService.findByPropertyName("google.recaptcha.key.site").pipe((0,p.ak)()),this._window.nativeWindow.dataCallback=this.dataCallbackFcn,this._window.nativeWindow.expiredCallback=this.expiredCallbackFcn,this._window.nativeWindow.errorCallback=this.errorCallbackFcn}static{this.\u0275fac=function(h){return new(h||R)(o.rXU(m.lc),o.rXU(T.ConfigurationDataService))}}static{this.\u0275cmp=o.VBU({type:R,selectors:[["ds-google-recaptcha"]],inputs:{captchaMode:"captchaMode"},outputs:{executeRecaptcha:"executeRecaptcha",checkboxChecked:"checkboxChecked",showNotification:"showNotification"},standalone:!0,features:[o.aNF],decls:2,vars:7,consts:[[1,"g-recaptcha"]],template:function(h,g){if(1&h&&(o.nrm(0,"div",0),o.nI1(1,"async")),2&h){let u;o.BMQ("data-callback","dataCallback")("data-expired-callback","expiredCallback")("data-error-callback","errorCallback")("data-sitekey",null==(u=o.bMT(1,5,g.recaptchaKey$))?null:u.values[0])("data-size","invisible"===g.captchaMode?"invisible":null)}},dependencies:[v.Jj]})}}return R})()}}]);